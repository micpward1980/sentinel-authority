<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Test Status — Sentinel Authority</title>
  <meta name="description" content="Check your CAT-72 conformance test status" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: dark;
      --purple-primary:#5B4B8A;
      --purple-bright:#9d8ccf;
      --purple-glow:rgba(157,140,207,.20);
      --bg-deep:#2a2f3d;
      --bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;
      --accent-amber:#D6A05C;
      --accent-red:#D65C5C;
      --text-primary:rgba(255,255,255,.94);
      --text-secondary:rgba(255,255,255,.75);
      --text-tertiary:rgba(255,255,255,.50);
      --border-glass:rgba(255,255,255,.10);
      --serif:'Source Serif 4',serif;
      --mono:'IBM Plex Mono',monospace;
      --sans:'Inter',system-ui,-apple-system,sans-serif;
      --ease:cubic-bezier(0.16,1,0.3,1);
      --max:800px;
      --nav-height:72px;
    }
    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; background:var(--bg-deep); }
    body{
      margin:0; font-family:var(--sans); color:var(--text-primary);
      background: radial-gradient(1200px 700px at 15% 10%,rgba(91,75,138,.15),transparent 55%),
                  radial-gradient(900px 600px at 85% 80%,rgba(92,214,133,.06),transparent 55%),
                  var(--bg-deep);
      -webkit-font-smoothing:antialiased;
      min-height:100vh;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; text-underline-offset:4px; }
    ::selection{ background:var(--purple-primary); color:#fff; }

    .grid-overlay{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      background-image: linear-gradient(rgba(255,255,255,0.04) 1px,transparent 1px),
                         linear-gradient(90deg,rgba(255,255,255,0.04) 1px,transparent 1px);
      background-size:120px 120px; opacity:.15;
      mask-image:radial-gradient(ellipse at center,rgba(0,0,0,.95) 20%,transparent 70%);
    }

    /* Nav */
    .site-header{
      position:fixed; top:0; width:100%; z-index:50;
      height:var(--nav-height); padding:0 20px;
      border-bottom:1px solid var(--border-glass);
      background:rgba(42,47,61,.88);
      backdrop-filter:blur(18px);
      display:flex; align-items:center;
    }
    .nav-inner{
      max-width:var(--max); margin:0 auto; width:100%;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; }
    .brand:hover{ text-decoration:none; }
    .brand-mark{
      width:24px; height:24px; background:var(--purple-primary);
      border:2px solid var(--purple-bright); border-radius:6px;
      display:flex; align-items:center; justify-content:center;
    }
    .brand-mark-inner{
      width:8px; height:8px; background:#c4b8e8; border-radius:50%;
      animation:eye-pulse 7s ease-in-out infinite;
    }
    @keyframes eye-pulse{
      0%,100%{ opacity:.75; transform:scale(.98); }
      50%{ opacity:1; transform:scale(1.02); box-shadow:0 0 10px rgba(157,140,207,.22); }
    }
    .brand-name{
      font-family:var(--mono); font-size:10px; letter-spacing:3px;
      text-transform:uppercase; color:rgba(255,255,255,.86);
    }
    .back-link{
      font-family:var(--mono); font-size:10px; font-weight:500;
      letter-spacing:2px; text-transform:uppercase;
      color:var(--text-tertiary); transition:color .2s;
    }
    .back-link:hover{ color:var(--text-primary); text-decoration:none; }

    /* Page */
    main{
      position:relative; z-index:1;
      max-width:var(--max); margin:0 auto;
      padding:calc(var(--nav-height) + 80px) 20px 80px;
    }

    .page-kicker{
      font-family:var(--mono); font-size:10px; letter-spacing:6px;
      text-transform:uppercase; color:var(--purple-bright);
      display:flex; align-items:center; gap:14px; margin-bottom:16px;
    }
    .page-kicker::before{
      content:""; width:40px; height:1px; background:var(--purple-bright); opacity:.95;
    }

    h1{
      font-family:var(--serif); font-size:clamp(36px,5vw,52px);
      font-weight:200; line-height:1.05; margin:0 0 12px; letter-spacing:-0.03em;
    }
    h1 .accent{ font-style:italic; color:var(--purple-bright); }

    .page-desc{
      color:var(--text-secondary); font-size:16px; font-weight:200;
      line-height:1.7; margin:0 0 40px; max-width:55ch;
    }

    /* Search */
    .search-panel{
      background:var(--bg-panel); border:1px solid var(--border-glass);
      border-radius:18px; padding:28px; backdrop-filter:blur(18px);
      position:relative; overflow:hidden; margin-bottom:32px;
    }
    .search-panel::before{
      content:""; position:absolute; inset:-20%;
      background:radial-gradient(circle at 20% 20%,rgba(157,140,207,.10),transparent 55%);
      pointer-events:none; opacity:.8;
    }
    .search-panel>*{ position:relative; z-index:1; }

    .search-label{
      font-family:var(--mono); font-size:9px; letter-spacing:2px;
      text-transform:uppercase; color:var(--text-tertiary);
      display:block; margin-bottom:10px;
    }

    .search-row{ display:flex; gap:10px; }

    .search-row input{
      flex:1; padding:14px 18px;
      background:rgba(255,255,255,.04); border:1px solid var(--border-glass);
      border-radius:12px; color:var(--text-primary);
      font-family:var(--mono); font-size:14px; letter-spacing:1px;
      outline:none; transition:border-color .2s;
    }
    .search-row input:focus{ border-color:rgba(157,140,207,.55); }
    .search-row input::placeholder{ color:var(--text-tertiary); font-size:13px; letter-spacing:0; }

    .search-row button{
      appearance:none; padding:14px 28px;
      border:1px solid rgba(157,140,207,.55);
      background:rgba(91,75,138,.18); color:var(--text-primary);
      border-radius:12px; font-family:var(--mono); font-size:10px;
      letter-spacing:2.5px; text-transform:uppercase; cursor:pointer;
      transition:all .2s; white-space:nowrap;
    }
    .search-row button:hover{
      border-color:rgba(157,140,207,.85); background:rgba(91,75,138,.30);
      transform:translateY(-1px);
    }

    .search-hint{
      font-family:var(--mono); font-size:10px; color:var(--text-tertiary);
      margin-top:12px; letter-spacing:0.5px;
    }
    .search-hint a{ color:var(--purple-bright); }

    /* Results */
    .result-panel{
      display:none; background:var(--bg-panel);
      border:1px solid var(--border-glass); border-radius:18px;
      padding:32px; backdrop-filter:blur(18px);
      position:relative; overflow:hidden;
      animation:fadeUp .4s var(--ease);
    }
    .result-panel::before{
      content:""; position:absolute; inset:-20%;
      background:radial-gradient(circle at 80% 20%,rgba(157,140,207,.08),transparent 55%);
      pointer-events:none;
    }
    .result-panel>*{ position:relative; z-index:1; }
    .result-panel.show{ display:block; }

    @keyframes fadeUp{
      from{ opacity:0; transform:translateY(16px); }
      to{ opacity:1; transform:translateY(0); }
    }

    /* Status badges */
    .status-badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 16px; border-radius:24px;
      font-family:var(--mono); font-size:10px; font-weight:500;
      letter-spacing:1.5px; text-transform:uppercase;
    }
    .status-badge .dot{ width:8px; height:8px; border-radius:50%; }
    .status-running{ background:rgba(92,214,133,.12); color:var(--accent-green); border:1px solid rgba(92,214,133,.25); }
    .status-running .dot{ background:var(--accent-green); animation:pulse 2s infinite; }
    .status-waiting{ background:rgba(214,160,92,.12); color:var(--accent-amber); border:1px solid rgba(214,160,92,.25); }
    .status-waiting .dot{ background:var(--accent-amber); animation:pulse 2s infinite; }
    .status-certified{ background:rgba(157,140,207,.12); color:var(--purple-bright); border:1px solid rgba(157,140,207,.25); }
    .status-certified .dot{ background:var(--purple-bright); }
    .status-not_found{ background:rgba(214,92,92,.10); color:var(--accent-red); border:1px solid rgba(214,92,92,.25); }
    .status-not_found .dot{ background:var(--accent-red); }

    @keyframes pulse{ 0%,100%{ opacity:1; } 50%{ opacity:.4; } }

    /* Time display */
    .time-display{
      text-align:center; margin:28px 0 8px;
    }
    .time-display .big{
      font-family:var(--serif); font-size:64px; font-weight:200;
      letter-spacing:-0.03em; line-height:1;
    }
    .time-display .label{
      font-family:var(--mono); font-size:10px; letter-spacing:3px;
      text-transform:uppercase; color:var(--text-tertiary); margin-top:4px;
    }

    /* Progress bar */
    .progress-bar{
      height:6px; background:rgba(255,255,255,.08);
      border-radius:3px; overflow:hidden; margin:20px 0 8px;
    }
    .progress-fill{
      height:100%; border-radius:3px;
      background:linear-gradient(90deg,var(--purple-primary),var(--purple-bright));
      transition:width .6s var(--ease);
    }
    .progress-label{
      font-family:var(--mono); font-size:11px;
      color:var(--text-tertiary); text-align:center;
    }

    /* Metrics */
    .metrics-grid{
      display:grid; grid-template-columns:repeat(4,1fr);
      gap:10px; margin:28px 0;
    }
    .metric-card{
      background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.06);
      border-radius:12px; padding:18px 8px; text-align:center;
    }
    .metric-value{
      font-family:var(--serif); font-size:28px; font-weight:200; line-height:1;
    }
    .metric-value.green{ color:var(--accent-green); }
    .metric-value.red{ color:var(--accent-red); }
    .metric-label{
      font-family:var(--mono); font-size:8px; letter-spacing:1.5px;
      text-transform:uppercase; color:var(--text-tertiary); margin-top:6px;
    }

    /* Criteria */
    .criteria-section{ margin-top:28px; padding-top:24px; border-top:1px solid var(--border-glass); }
    .criteria-title{
      font-family:var(--mono); font-size:10px; letter-spacing:3px;
      text-transform:uppercase; color:var(--purple-bright); margin:0 0 16px;
    }
    .criteria-item{
      display:flex; align-items:center; gap:12px;
      padding:12px 14px; border-radius:10px;
      border:1px solid rgba(255,255,255,.06);
      background:rgba(255,255,255,.02);
      margin-bottom:8px;
      font-size:14px; color:var(--text-secondary); font-weight:200;
    }
    .criteria-icon{
      width:24px; height:24px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:13px; flex-shrink:0;
    }
    .criteria-met{
      background:rgba(92,214,133,.15); color:var(--accent-green);
      border:1px solid rgba(92,214,133,.30);
    }
    .criteria-pending{
      background:rgba(255,255,255,.04); color:var(--text-tertiary);
      border:1px solid rgba(255,255,255,.10);
    }

    /* Message */
    .message{
      margin-top:24px; padding:16px 18px;
      background:rgba(91,75,138,.08); border:1px solid rgba(157,140,207,.20);
      border-radius:10px; font-size:13px; color:var(--text-secondary);
      font-weight:200; line-height:1.6;
    }

    /* Not found */
    .not-found-content{
      text-align:center; margin-top:24px;
    }
    .not-found-content p{
      color:var(--text-secondary); font-size:14px; line-height:1.7;
      font-weight:200; margin:0 0 8px;
    }

    /* Certified */
    .certified-content{ margin-top:24px; }
    .certified-content h2{
      font-family:var(--serif); font-size:28px; font-weight:200; margin:0 0 8px;
    }
    .certified-content p{
      color:var(--text-secondary); font-size:14px; margin:0 0 8px; font-weight:200;
    }
    .cert-details{
      background:rgba(0,0,0,.2); border:1px solid var(--border-glass);
      border-radius:10px; padding:16px; margin:16px 0;
    }
    .cert-details p{
      margin:0 0 6px; font-family:var(--mono); font-size:13px; color:var(--text-secondary);
    }
    .cert-details p:last-child{ margin:0; }
    .cert-details strong{ color:var(--text-primary); }

    .btn-cta{
      display:inline-block; padding:12px 24px;
      border:1px solid rgba(157,140,207,.55);
      background:rgba(91,75,138,.18); color:var(--text-primary);
      border-radius:12px; font-family:var(--mono); font-size:10px;
      letter-spacing:2px; text-transform:uppercase; cursor:pointer;
      transition:all .2s; margin-top:12px;
    }
    .btn-cta:hover{
      border-color:rgba(157,140,207,.85); background:rgba(91,75,138,.30);
      text-decoration:none; transform:translateY(-1px);
    }

    /* Loading */
    .loading{
      display:flex; flex-direction:column; align-items:center;
      gap:16px; padding:40px 0;
    }
    .spinner{
      width:32px; height:32px; border:2px solid rgba(255,255,255,.08);
      border-top-color:var(--purple-bright); border-radius:50%;
      animation:spin .8s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }
    .loading-text{
      font-family:var(--mono); font-size:10px; letter-spacing:2px;
      text-transform:uppercase; color:var(--text-tertiary);
    }

    /* Info cards below search */
    .info-grid{
      display:grid; grid-template-columns:repeat(3,1fr);
      gap:16px; margin-top:40px;
    }
    .info-card{
      padding:20px; border:1px solid var(--border-glass);
      background:rgba(255,255,255,.02); border-radius:14px;
    }
    .info-card-num{
      font-family:var(--mono); font-size:9px; letter-spacing:3px;
      text-transform:uppercase; color:var(--purple-bright); margin-bottom:8px;
    }
    .info-card-title{
      font-family:var(--serif); font-size:18px; font-weight:200;
      margin:0 0 6px; letter-spacing:-0.02em;
    }
    .info-card-desc{
      color:var(--text-tertiary); font-size:12px; line-height:1.6; font-weight:200; margin:0;
    }

    /* Footer */
    footer{
      margin-top:80px; padding:40px 20px;
      border-top:1px solid var(--border-glass); text-align:center;
    }
    .footer-copy{
      font-family:var(--mono); font-size:10px; letter-spacing:2px;
      text-transform:uppercase; color:var(--text-tertiary);
    }
    .footer-links{
      margin-top:16px; display:flex; justify-content:center;
      gap:24px; flex-wrap:wrap;
    }
    .footer-links a{
      font-family:var(--mono); font-size:10px; letter-spacing:1px;
      color:var(--text-tertiary); transition:color .2s;
    }
    .footer-links a:hover{ color:var(--text-primary); text-decoration:none; }

    @media(max-width:600px){
      .metrics-grid{ grid-template-columns:repeat(2,1fr); }
      .info-grid{ grid-template-columns:1fr; }
      h1{ font-weight:300; }
      .time-display .big{ font-size:48px; }
      .search-row{ flex-direction:column; }
    }
  </style>
</head>
<body>
  <div class="grid-overlay" aria-hidden="true"></div>

  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark" aria-hidden="true"><div class="brand-mark-inner"></div></div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">← Back to Home</a>
    </div>
  </header>

  <main>
    <div class="page-kicker">CAT-72 Conformance</div>
    <h1>Test <span class="accent">Status</span></h1>
    <p class="page-desc">Track your system's 72-hour continuous conformance test in real time. Enter your Certificate ID to view progress, metrics, and criteria status.</p>

    <div class="search-panel">
      <label class="search-label" for="certId">Certificate ID</label>
      <div class="search-row">
        <input type="text" id="certId" placeholder="ODDC-2026-0001" />
        <button onclick="checkStatus()">Check Status</button>
      </div>
      <p class="search-hint">Find your Certificate ID in the <a href="https://app.sentinelauthority.org">applicant portal</a> or your approval email.</p>
    </div>

    <div class="result-panel" id="result"></div>

    <div class="info-grid">
      <div class="info-card">
        <div class="info-card-num">01</div>
        <div class="info-card-title">72 Hours</div>
        <p class="info-card-desc">Continuous autonomous operation with the ENVELO agent enforcing all approved boundaries.</p>
      </div>
      <div class="info-card">
        <div class="info-card-num">02</div>
        <div class="info-card-title">≥ 95% Pass</div>
        <p class="info-card-desc">Minimum pass rate across all boundary enforcement actions during the test window.</p>
      </div>
      <div class="info-card">
        <div class="info-card-num">03</div>
        <div class="info-card-title">Block Verified</div>
        <p class="info-card-desc">At least one intentional boundary violation must be correctly blocked by the agent.</p>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-copy">© <span id="footer-year"></span> Sentinel Authority</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="index.html#artifacts">Documents</a>
      <a href="conformance-agreement.html">Conformance</a>
    </div>
  </footer>

  <script>
    document.getElementById("footer-year").textContent = new Date().getFullYear();

    const params = new URLSearchParams(window.location.search);
    const certParam = params.get('cert');
    if (certParam) {
      document.getElementById('certId').value = certParam;
      checkStatus();
    }

    async function checkStatus() {
      const certId = document.getElementById('certId').value.trim();
      if (!certId) { document.getElementById('certId').focus(); return; }

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Checking status...</div></div>';
      resultDiv.classList.add('show');

      try {
        const res = await fetch(`https://sentinel-authority-production.up.railway.app/api/verify/status/${encodeURIComponent(certId)}`);
        const data = await res.json();

        if (data.status === 'not_found') {
          resultDiv.innerHTML = `
            <span class="status-badge status-not_found"><span class="dot"></span>Not Found</span>
            <div class="not-found-content">
              <p>${data.message || 'No active test found for this Certificate ID.'}</p>
              <p>Make sure your ENVELO Agent is running and connected with the correct Certificate ID.</p>
            </div>
          `;
        } else if (data.status === 'certified') {
          resultDiv.innerHTML = `
            <span class="status-badge status-certified"><span class="dot"></span>Certified</span>
            <div class="certified-content">
              <h2>Conformance Verified</h2>
              <p>Your system has successfully completed the CAT-72 conformance test.</p>
              <div class="cert-details">
                <p><strong>Certificate:</strong> ${data.certificate_number}</p>
                <p><strong>Issued:</strong> ${new Date(data.issued_at).toLocaleDateString()}</p>
                <p><strong>Expires:</strong> ${new Date(data.expires_at).toLocaleDateString()}</p>
              </div>
              <a href="https://app.sentinelauthority.org" class="btn-cta">View in Dashboard →</a>
            </div>
          `;
        } else {
          const progressPercent = Math.min(100, (data.hours_elapsed / 72) * 100);
          resultDiv.innerHTML = `
            <span class="status-badge status-${data.status}">
              <span class="dot"></span>${data.status === 'running' ? 'Test Running' : 'Waiting for Agent'}
            </span>

            <div class="time-display">
              <div class="big">${data.hours_remaining.toFixed(1)}h</div>
              <div class="label">Remaining</div>
            </div>

            <div class="progress-bar"><div class="progress-fill" style="width:${progressPercent}%"></div></div>
            <p class="progress-label">${data.hours_elapsed.toFixed(1)} / 72 hours elapsed</p>

            <div class="metrics-grid">
              <div class="metric-card"><div class="metric-value">${data.total_actions.toLocaleString()}</div><div class="metric-label">Total Actions</div></div>
              <div class="metric-card"><div class="metric-value green">${data.pass_count.toLocaleString()}</div><div class="metric-label">Passed</div></div>
              <div class="metric-card"><div class="metric-value ${data.block_count > 0 ? 'red' : ''}">${data.block_count.toLocaleString()}</div><div class="metric-label">Blocked</div></div>
              <div class="metric-card"><div class="metric-value ${data.pass_rate >= 95 ? 'green' : ''}">${data.pass_rate}%</div><div class="metric-label">Pass Rate</div></div>
            </div>

            <div class="criteria-section">
              <h3 class="criteria-title">Certification Criteria</h3>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.duration_met ? 'criteria-met' : 'criteria-pending'}">${data.criteria.duration_met ? '✓' : '○'}</span>72 hours continuous operation</div>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.actions_met ? 'criteria-met' : 'criteria-pending'}">${data.criteria.actions_met ? '✓' : '○'}</span>Minimum 100 enforced actions</div>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.pass_rate_met ? 'criteria-met' : 'criteria-pending'}">${data.criteria.pass_rate_met ? '✓' : '○'}</span>≥ 95% boundary pass rate</div>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.blocking_verified ? 'criteria-met' : 'criteria-pending'}">${data.criteria.blocking_verified ? '✓' : '○'}</span>Blocking enforcement verified</div>
            </div>

            <div class="message">${data.status === 'waiting' ? '⚠ Your ENVELO Agent is not currently connected. Ensure it is running with the correct API key and Certificate ID.' : 'Test in progress — keep your system and ENVELO Agent running continuously until completion.'}</div>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `<div class="not-found-content"><p style="color:var(--accent-red);">Connection error: ${err.message}</p><p>Please try again or contact support at info@sentinelauthority.org</p></div>`;
      }
    }
  </script>
</body>
</html>
