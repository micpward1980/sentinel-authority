<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>SA Mobile Diagnostics</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background:#0a0a0f; color:#fff; font-family:'SF Mono',monospace; font-size:11px; padding:12px; }
.section { border:1px solid rgba(157,140,207,0.3); border-radius:8px; padding:12px; margin-bottom:12px; }
.title { color:rgba(157,140,207,0.9); font-size:10px; letter-spacing:2px; margin-bottom:8px; }
.row { display:flex; justify-content:space-between; padding:3px 0; border-bottom:1px solid rgba(255,255,255,0.05); }
.label { color:rgba(255,255,255,0.5); }
.value { color:rgba(92,214,133,0.9); }
.warn { color:rgba(214,160,92,0.9); }
.error { color:rgba(214,92,92,0.9); }
.issue { background:rgba(214,92,92,0.1); border:1px solid rgba(214,92,92,0.3); border-radius:6px; padding:8px; margin-top:8px; }
.issue-title { color:rgba(214,92,92,0.9); font-size:10px; letter-spacing:1px; margin-bottom:4px; }
.ok { background:rgba(92,214,133,0.1); border:1px solid rgba(92,214,133,0.3); border-radius:6px; padding:8px; margin-top:8px; }
.ok-title { color:rgba(92,214,133,0.9); font-size:10px; letter-spacing:1px; }
#log { max-height:200px; overflow-y:auto; font-size:9px; color:rgba(255,255,255,0.4); padding:8px; background:rgba(0,0,0,0.3); border-radius:6px; margin-top:8px; }
button { background:rgba(157,140,207,0.2); border:1px solid rgba(157,140,207,0.4); color:rgba(157,140,207,0.9); padding:10px 20px; border-radius:6px; font-family:inherit; font-size:10px; letter-spacing:2px; cursor:pointer; margin:4px; }
.btn-row { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
iframe { width:100%; height:500px; border:1px solid rgba(157,140,207,0.3); border-radius:8px; margin-top:12px; }
</style>
</head>
<body>

<div class="section">
  <div class="title">VIEWPORT</div>
  <div class="row"><span class="label">window.innerWidth</span><span class="value" id="vw">-</span></div>
  <div class="row"><span class="label">window.innerHeight</span><span class="value" id="vh">-</span></div>
  <div class="row"><span class="label">screen.width</span><span class="value" id="sw">-</span></div>
  <div class="row"><span class="label">screen.height</span><span class="value" id="sh">-</span></div>
  <div class="row"><span class="label">devicePixelRatio</span><span class="value" id="dpr">-</span></div>
  <div class="row"><span class="label">orientation</span><span class="value" id="orient">-</span></div>
  <div class="row"><span class="label">visualViewport</span><span class="value" id="vvp">-</span></div>
</div>

<div class="section">
  <div class="title">CSS MOBILE.CSS STATUS</div>
  <div id="css-status">Checking...</div>
</div>

<div class="section">
  <div class="title">ROTATION LOG</div>
  <div class="btn-row">
    <button onclick="rotateTest()">SIMULATE ROTATE</button>
    <button onclick="clearLog()">CLEAR LOG</button>
  </div>
  <div id="log"></div>
</div>

<div class="section">
  <div class="title">LIVE SITE TEST</div>
  <p style="color:rgba(255,255,255,0.5);margin-bottom:8px;">Embedded view — scroll through and check each section:</p>
  <iframe id="site-frame" src="https://www.sentinelauthority.org"></iframe>
</div>

<script>
var logEl = document.getElementById('log');
function log(msg) {
  var d = new Date();
  var ts = d.toISOString().substr(11,12);
  logEl.innerHTML = '<div>[' + ts + '] ' + msg + '</div>' + logEl.innerHTML;
}

function update() {
  document.getElementById('vw').textContent = window.innerWidth + 'px';
  document.getElementById('vh').textContent = window.innerHeight + 'px';
  document.getElementById('sw').textContent = screen.width + 'px';
  document.getElementById('sh').textContent = screen.height + 'px';
  document.getElementById('dpr').textContent = window.devicePixelRatio;
  
  var isLandscape = window.innerWidth > window.innerHeight;
  var angle = screen.orientation ? screen.orientation.angle : '?';
  document.getElementById('orient').textContent = (isLandscape ? 'LANDSCAPE' : 'PORTRAIT') + ' (' + angle + '°)';
  document.getElementById('orient').className = isLandscape ? 'warn' : 'value';
  
  if (window.visualViewport) {
    document.getElementById('vvp').textContent = 
      Math.round(window.visualViewport.width) + 'x' + Math.round(window.visualViewport.height) +
      ' scale:' + window.visualViewport.scale.toFixed(2);
  }
}

function checkCSS() {
  var el = document.getElementById('css-status');
  // Check if we can load mobile.css
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = 'https://www.sentinelauthority.org/mobile.css';
  link.onload = function() {
    el.innerHTML = '<div class="ok"><div class="ok-title">✓ mobile.css LOADED</div></div>';
  };
  link.onerror = function() {
    el.innerHTML = '<div class="issue"><div class="issue-title">✗ mobile.css FAILED TO LOAD</div></div>';
  };
  document.head.appendChild(link);
  
  // Also check mobile-canvas.js
  fetch('https://www.sentinelauthority.org/mobile-canvas.js')
    .then(function(r) { 
      if (r.ok) {
        el.innerHTML += '<div class="ok"><div class="ok-title">✓ mobile-canvas.js LOADED (' + r.status + ')</div></div>';
      } else {
        el.innerHTML += '<div class="issue"><div class="issue-title">✗ mobile-canvas.js ' + r.status + '</div></div>';
      }
    })
    .catch(function(e) {
      el.innerHTML += '<div class="issue"><div class="issue-title">✗ mobile-canvas.js ERROR</div></div>';
    });
}

function rotateTest() {
  log('--- ROTATE TEST START ---');
  log('Before: ' + window.innerWidth + 'x' + window.innerHeight);
  
  // Check iframe canvases
  try {
    var frame = document.getElementById('site-frame').contentWindow;
    var canvases = ['hero-canvas','envelo-canvas','security-canvas','cat72-canvas','process-canvas'];
    canvases.forEach(function(id) {
      var c = frame.document.getElementById(id);
      if (c) {
        var r = c.getBoundingClientRect();
        log(id + ': ' + Math.round(r.width) + 'x' + Math.round(r.height) + 
            ' canvas:' + c.width + 'x' + c.height +
            ' _saResize:' + (typeof c._saResize));
      } else {
        log(id + ': NOT FOUND');
      }
    });
  } catch(e) {
    log('Cannot access iframe (cross-origin): ' + e.message);
    log('Open sentinelauthority.org directly and use console instead');
  }
}

function clearLog() { logEl.innerHTML = ''; }

// Auto-update
update();
setInterval(update, 500);
checkCSS();

// Log orientation changes
window.addEventListener('orientationchange', function() {
  setTimeout(function() {
    log('ORIENTATION CHANGED → ' + window.innerWidth + 'x' + window.innerHeight);
    update();
  }, 300);
});

window.addEventListener('resize', function() {
  log('RESIZE → ' + window.innerWidth + 'x' + window.innerHeight);
  update();
});

log('Diagnostics initialized');
log('UA: ' + navigator.userAgent.substr(0, 80));
</script>

</body>
</html>
