import{u as V,a as J,b as q,j as e,A as G,d as v}from"./index-DE2YKgEw.js";import{r as x,R as Y}from"./icons-DL0PQMVt.js";import{P as T}from"./Panel-DXfHMjAz.js";import"./vendor-DYB3FAiG.js";function se(){const F=V(),{user:i}=J(),[S,h]=x.useState([]),[_,N]=x.useState([]),[j,B]=x.useState("live"),[n,p]=x.useState(""),l=q(),[m,c]=x.useState({}),[s,d]=x.useState(1),[f,M]=x.useState(0),[g,b]=x.useState(""),[y,u]=x.useState(""),[z,C]=x.useState("created_at"),[X,W]=x.useState(Date.now()),R=()=>{const t=new URLSearchParams({page:s,per_page:25,state:"completed",sort:z,order:"desc"});g&&t.set("search",g),y&&t.set("result_filter",y),v.get(`/api/cat72/tests?${t}`).then(r=>{var o;const a=r.data;a.tests&&(h(k=>[...k.filter(U=>U.state!=="completed"),...a.tests]),M(((o=a.pagination)==null?void 0:o.pages)||1))}).catch(console.error)};x.useEffect(()=>{R()},[s,g,y,z]);const w=()=>{v.get("/api/cat72/tests?per_page=100").then(t=>h(t.data.tests||t.data)).catch(console.error),v.get("/api/envelo/monitoring/overview").then(t=>{const r=(t.data.sessions||[]).filter(a=>a.session_type==="cat72_test");N(r)}).catch(console.error)};x.useEffect(()=>{w();const t=setInterval(w,15e3),r=setInterval(()=>W(Date.now()),1e3);return()=>{clearInterval(t),clearInterval(r)}},[]);const E=async t=>{var r,a;if(await F({title:"Begin CAT-72 Window",message:"Begin the 72-hour Conformance Authorization Test? The evaluation timer will start and the connected ENVELO Interlock will be monitored."})){c(o=>({...o,[t]:"starting"}));try{await v.post(`/api/cat72/tests/${t}/start`),w()}catch(o){l.show("Failed to start test: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}c(o=>({...o,[t]:null}))}},I=async t=>{var r,a;if(await F({title:"Stop Test",message:"Stop this CAT-72 test and evaluate results?"})){c(o=>({...o,[t]:"stopping"}));try{await v.post(`/api/cat72/tests/${t}/stop`),w()}catch(o){l.show("Failed to stop test: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}c(o=>({...o,[t]:null}))}},$=async t=>{var r,a;if(await F({title:"Confirm Specs & Start CAT-72",message:"You have reviewed the auto-pulled specifications. Confirm they are accurate and start the 72-hour conformance window?"})){c(o=>({...o,[t]:"confirming"}));try{await v.post("/api/cat72/tests/"+t+"/confirm-specs"),l.show("Specs confirmed — 72-hour CAT-72 window started","success"),w()}catch(o){l.show("Failed: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}c(o=>({...o,[t]:null}))}},O=async t=>{var r,a;if(await F({title:"Issue Certificate",message:"Issue ODDC certificate for this passed test?"})){c(o=>({...o,[t]:"issuing"}));try{const o=await v.post(`/api/certificates/issue/${t}`);l.show(`Certificate issued: ${o.data.certificate_number}`,"success"),w()}catch(o){l.show("Failed to issue certificate: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}c(o=>({...o,[t]:null}))}},H=t=>{const r=Math.floor(t/3600),a=Math.floor(t%3600/60),o=Math.floor(t%60);return`${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`};S.filter(t=>t.state==="running");const A=S.filter(t=>t.state==="scheduled"),P=S.filter(t=>t.state==="spec_review"),D=S.filter(t=>t.state==="completed");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("p",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"4px",textTransform:"uppercase",color:"#a896d6",marginBottom:"10px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{width:"24px",height:"1px",background:"#a896d6"}}),"Testing"]}),e.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 4vw, 32px)",fontWeight:200,letterSpacing:"-0.02em",margin:0},children:"CAT-72 Console"}),e.jsx("p",{style:{color:"rgba(255,255,255,.78)",marginTop:"8px"},children:(i==null?void 0:i.role)==="admin"?"72-hour Conformance Authorization Tests · Auto-refreshes every 15s":"Monitor your 72-hour conformance test in real time"})]}),e.jsx("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:["live","spec_review","scheduled","completed"].map(t=>{const r=t==="live"?"Live Tests":t==="spec_review"?"Spec Review":t==="scheduled"?"Awaiting Deploy":"Completed",a=t==="spec_review"?P.length:t==="scheduled"?A.length:null;return e.jsxs("button",{onClick:()=>B(t),style:{background:j===t?"rgba(91,75,138,0.25)":"transparent",border:"1px solid rgba(91,75,138,0.3)",color:j===t?"rgba(255,255,255,.94)":"rgba(255,255,255,.50)",padding:"6px 16px",fontFamily:"Consolas, monospace",fontSize:"10px",textTransform:"uppercase",letterSpacing:"1px",cursor:"pointer",position:"relative"},children:[r,a>0&&e.jsx("span",{style:{marginLeft:"6px",background:t==="spec_review"?"rgba(214,160,92,0.3)":"rgba(91,75,138,0.4)",color:t==="spec_review"?"#D6A05C":"rgba(255,255,255,.78)",padding:"1px 6px",fontFamily:"Consolas, monospace",fontSize:"9px",borderRadius:"0"},children:a})]},t)})}),j==="spec_review"?e.jsx(e.Fragment,{children:P.length===0?e.jsx(T,{children:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"rgba(255,255,255,.4)",fontFamily:"Consolas, monospace",fontSize:"11px"},children:"No tests awaiting spec confirmation"})}):P.map(t=>{const r=typeof t.envelope_definition=="string"?(()=>{try{return JSON.parse(t.envelope_definition)}catch{return null}})():t.envelope_definition,a=(r==null?void 0:r.boundaries)||[];return e.jsxs(T,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"16px",flexWrap:"wrap",gap:"12px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:500,color:"rgba(255,255,255,.94)",fontSize:"16px"},children:[t.organization_name," — ",t.system_name]}),e.jsx("div",{style:{fontFamily:"Consolas, monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",marginTop:"4px"},children:t.test_id})]}),e.jsx("span",{style:{fontFamily:"Consolas, monospace",fontSize:"10px",color:"#D6A05C",textTransform:"uppercase",letterSpacing:"1px",padding:"4px 10px",border:"1px solid rgba(214,160,92,.3)"},children:"Awaiting Spec Confirmation"})]}),e.jsx("p",{style:{color:"rgba(255,255,255,.60)",fontSize:"12px",marginBottom:"16px"},children:"The ENVELO Interlock has connected and pulled the system specifications below. Review them with the customer, then confirm to start the 72-hour CAT-72 window."}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontFamily:"Consolas, monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"#a896d6",marginBottom:"8px"},children:"Auto-Pulled Safety Boundaries"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"16px"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:["Type","Constraint","Unit"].map(o=>e.jsx("th",{style:{fontFamily:"Consolas, monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400,padding:"8px 12px",textAlign:"left"},children:o},o))})}),e.jsx("tbody",{children:a.map((o,k)=>{const L=o.max&&o.min?o.min+" - "+o.max:o.max?"<= "+o.max:o.min?">= "+o.min:o.corridors?o.corridors.join(", "):"-";return e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.04)"},children:[e.jsx("td",{style:{padding:"8px 12px",fontFamily:"Consolas, monospace",fontSize:"11px",color:"#a896d6",textTransform:"uppercase"},children:o.type}),e.jsx("td",{style:{padding:"8px 12px",color:"rgba(255,255,255,.78)",fontSize:"13px"},children:L}),e.jsx("td",{style:{padding:"8px 12px",fontFamily:"Consolas, monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:o.unit||"-"})]},k)})})]})]}),r&&!a.length&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontFamily:"Consolas, monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"#a896d6",marginBottom:"8px"},children:"Auto-Pulled Envelope Definition"}),e.jsx("pre",{style:{color:"rgba(255,255,255,.60)",fontSize:"11px",fontFamily:"Consolas, monospace",padding:"12px",border:"1px solid rgba(255,255,255,.07)",overflow:"auto",maxHeight:"200px",margin:"0 0 16px"},children:JSON.stringify(r,null,2)})]}),(i==null?void 0:i.role)==="admin"&&e.jsxs("div",{style:{display:"flex",gap:"8px",paddingTop:"12px",borderTop:"1px solid rgba(255,255,255,.07)"},children:[e.jsx("button",{onClick:()=>$(t.test_id),disabled:m[t.test_id],className:"px-4 py-2 btn",style:{color:"#5CD685",borderColor:"rgba(92,214,133,.3)",fontFamily:"Consolas, monospace",fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:m[t.test_id]==="confirming"?"Starting...":"Confirm Specs & Start CAT-72"}),e.jsx("button",{onClick:()=>I(t.test_id),disabled:m[t.test_id],className:"px-4 py-2 btn",style:{color:"#D65C5C",borderColor:"rgba(214,92,92,.3)",fontFamily:"Consolas, monospace",fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:"Reject Specs"})]})]},t.id)})}):j==="live"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Search sessions...",value:n,onChange:t=>p(t.target.value),style:{background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.90)",padding:"6px 12px",fontFamily:"Consolas, monospace",fontSize:"11px",width:"200px",outline:"none",marginBottom:"12px"}}),e.jsx(K,{sessions:_,search:n,onStop:I,loading:m,user:i})]}):j==="scheduled"?e.jsxs(e.Fragment,{children:[!1,e.jsxs(T,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("div",{className:"hud-label",children:"Scheduled"}),e.jsx("input",{type:"text",placeholder:"Search...",value:n,onChange:t=>p(t.target.value),style:{background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.90)",padding:"5px 10px",fontFamily:"Consolas, monospace",fontSize:"10px",width:"160px",outline:"none"}})]}),A.filter(t=>!n||(t.organization_name||"").toLowerCase().includes(n.toLowerCase())||(t.system_name||"").toLowerCase().includes(n.toLowerCase())||(t.test_id||"").toLowerCase().includes(n.toLowerCase())).length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"rgba(255,255,255,.4)",fontFamily:"Consolas, monospace",fontSize:"11px"},children:["No scheduled tests",n?" matching search":""]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"System"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Deployment Status"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Scheduled"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Actions"})]})}),e.jsx("tbody",{children:A.filter(t=>!n||(t.organization_name||"").toLowerCase().includes(n.toLowerCase())||(t.system_name||"").toLowerCase().includes(n.toLowerCase())||(t.test_id||"").toLowerCase().includes(n.toLowerCase())).map(t=>{const r=_.some(a=>a.organization_name===t.organization_name&&a.system_name===t.system_name||a.test_id===t.test_id);return e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{style:{fontWeight:500,color:"rgba(255,255,255,.94)"},children:[t.organization_name," — ",t.system_name]}),e.jsx("div",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",marginTop:"2px"},children:t.test_id})]}),e.jsx("td",{className:"px-4 py-4",children:r?e.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"#5CD685",textTransform:"uppercase",letterSpacing:"1px"},children:"● Interlock Connected"}):e.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"#D6A05C",textTransform:"uppercase",letterSpacing:"1px"},children:"○ Awaiting Customer Deployment"})}),e.jsxs("td",{className:"px-4 py-4",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",color:"rgba(255,255,255,.78)"},children:[t.duration_hours,"h"]}),e.jsx("td",{className:"px-4 py-4",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.60)"},children:t.created_at?new Date(t.created_at).toLocaleDateString():"—"}),e.jsx("td",{className:"px-4 py-4",children:(i==null?void 0:i.role)==="admin"&&r?e.jsx("button",{onClick:()=>E(t.test_id),disabled:m[t.test_id],className:"px-3 py-1 btn",children:m[t.test_id]==="starting"?"...":"Begin 72h Window"}):(i==null?void 0:i.role)==="admin"?e.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",color:"rgba(255,255,255,.30)",textTransform:"uppercase",letterSpacing:"1px"},children:"Pending deployment"}):null})]},t.id)})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(T,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",flexWrap:"wrap",gap:"8px"},children:[e.jsx("div",{className:"hud-label",children:"Completed Tests"}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search...",value:g,onChange:t=>{b(t.target.value),d(1)},style:{background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.90)",padding:"5px 10px",fontFamily:"Consolas, monospace",fontSize:"10px",width:"160px",outline:"none"}}),e.jsxs("select",{value:y,onChange:t=>{u(t.target.value),d(1)},style:{background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.90)",padding:"5px 8px",fontFamily:"Consolas, monospace",fontSize:"10px",outline:"none"},children:[e.jsx("option",{value:"",children:"All Results"}),e.jsx("option",{value:"PASS",children:"PASS"}),e.jsx("option",{value:"FAIL",children:"FAIL"})]}),e.jsxs("select",{value:z,onChange:t=>C(t.target.value),style:{background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.90)",padding:"5px 8px",fontFamily:"Consolas, monospace",fontSize:"10px",outline:"none"},children:[e.jsx("option",{value:"created_at",children:"Newest"}),e.jsx("option",{value:"convergence_score",children:"Pass Rate"}),e.jsx("option",{value:"elapsed_seconds",children:"Duration"})]})]})]}),D.length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"rgba(255,255,255,.4)",fontFamily:"Consolas, monospace",fontSize:"11px"},children:["No completed tests",g||y?" matching filters":""]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"System"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Result"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Pass Rate"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Completed"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Actions"})]})}),e.jsx("tbody",{children:D.map(t=>{const r=(t.conformant_samples||0)+(t.interlock_activations||0),a=r>0?((t.conformant_samples||0)/r*100).toFixed(1):t.convergence_score?t.convergence_score.toFixed(1):"—";return e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{style:{fontWeight:500,color:"rgba(255,255,255,.94)"},children:[t.organization_name," — ",t.system_name]}),e.jsx("div",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",marginTop:"2px"},children:t.test_id})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",fontWeight:600,color:t.result==="PASS"?"#5CD685":"#D65C5C",padding:"4px 10px",background:t.result==="PASS"?"rgba(92,214,133,0.04)":"rgba(214,92,92,0.04)"},children:t.result||"—"})}),e.jsxs("td",{className:"px-4 py-4",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",color:typeof a=="string"&&a!=="—"&&parseFloat(a)>=95?"#5CD685":"#D6A35C"},children:[a,"%"]}),e.jsx("td",{className:"px-4 py-4",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",color:"rgba(255,255,255,.78)"},children:H(t.elapsed_seconds)}),e.jsx("td",{className:"px-4 py-4",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.60)"},children:t.ended_at?new Date(t.ended_at).toLocaleDateString():"—"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[(i==null?void 0:i.role)==="admin"&&t.result==="PASS"&&!t.certificate_issued&&e.jsx("button",{onClick:()=>O(t.test_id),disabled:m[t.test_id],className:"px-3 py-1 btn",children:m[t.test_id]==="issuing"?"...":"Issue Certificate"}),t.certificate_issued&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"#5CD685",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px"},children:"✓ Certified"}),e.jsx("a",{href:`${G}/api/certificates/${t.certificate_number||t.test_id}/pdf`,target:"_blank",style:{marginLeft:"8px",padding:"2px 8px",background:"#5B4B8A",color:"rgba(255,255,255,.94)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",textDecoration:"none"},children:"PDF"})]})]})})]},t.id)})})]}),f>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"4px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>d(t=>Math.max(1,t-1)),disabled:s<=1,style:{background:"transparent",border:"1px solid rgba(91,75,138,0.3)",color:s<=1?"rgba(255,255,255,.25)":"rgba(255,255,255,.70)",padding:"4px 10px",fontFamily:"Consolas, monospace",fontSize:"10px",cursor:s<=1?"default":"pointer"},children:"Prev"}),e.jsxs("span",{style:{fontFamily:"Consolas, monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",padding:"4px 8px"},children:[s," / ",f]}),e.jsx("button",{onClick:()=>d(t=>Math.min(f,t+1)),disabled:s>=f,style:{background:"transparent",border:"1px solid rgba(91,75,138,0.3)",color:s>=f?"rgba(255,255,255,.25)":"rgba(255,255,255,.70)",padding:"4px 10px",fontFamily:"Consolas, monospace",fontSize:"10px",cursor:s>=f?"default":"pointer"},children:"Next"})]})]})})]})}function K({sessions:F,search:i,onStop:S,loading:h,user:_}){const[N,j]=x.useState(null),B=F.filter(s=>{if(!i)return!0;const d=i.toLowerCase();return s.session_id.toLowerCase().includes(d)||(s.organization_name||"").toLowerCase().includes(d)||(s.system_name||"").toLowerCase().includes(d)});if(!B.length)return e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"rgba(255,255,255,.4)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px"},children:"No active CAT-72 tests"});const n="Consolas, 'IBM Plex Mono', monospace",p="rgba(255,255,255,.50)",l="#5CD685",m="#D6A35C",c={fontFamily:n,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:p,fontWeight:400};return e.jsxs(T,{children:[e.jsx(Q,{}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[e.jsx("th",{className:"px-4 py-3 text-left",style:c,children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",style:c,children:"System"}),e.jsx("th",{className:"px-4 py-3 text-left",style:c,children:"Progress"}),e.jsx("th",{className:"px-4 py-3 text-left",style:c,children:"Actions"}),e.jsx("th",{className:"px-4 py-3 text-left",style:c,children:"Pass Rate"}),e.jsx("th",{className:"px-4 py-3 text-left",style:c,children:"Uptime"})]})}),e.jsx("tbody",{children:B.map(s=>{const d=(s.pass_count||0)+(s.block_count||0),f=d>0?((s.pass_count||0)/d*100).toFixed(1):"0.0",M=d>0?((s.block_count||0)/d*100).toFixed(1):"0.0",g=s.is_online,b=N===s.session_id,y=parseFloat(s.uptime_hours||0),u=Math.min(y/72*100,100).toFixed(1),z=Math.max(72-y,0).toFixed(1);return e.jsxs(Y.Fragment,{children:[e.jsxs("tr",{onClick:()=>j(b?null:s.session_id),style:{borderBottom:"1px solid rgba(255,255,255,.07)",cursor:"pointer",background:b?"rgba(91,75,138,0.12)":"transparent"},onMouseEnter:C=>{b||(C.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:C=>{b||(C.currentTarget.style.background="transparent")},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontFamily:n,fontSize:"11px",color:g?l:"#D65C5C",textTransform:"uppercase",letterSpacing:"1px"},children:g?"Online":"Offline"}),g&&e.jsx("span",{style:{animation:"heartbeat 1.2s ease-in-out infinite",fontSize:"13px",color:"#D66A6A"},children:"♥"})]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{style:{fontWeight:500,color:"rgba(255,255,255,.94)"},children:[s.organization_name||"Unknown"," — ",s.system_name||s.session_id.slice(0,16)]}),e.jsxs("div",{style:{fontFamily:n,fontSize:"10px",color:p,marginTop:"2px"},children:[s.session_id.slice(0,12),"..."]})]}),e.jsx("td",{className:"px-4 py-4",style:{minWidth:"120px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"6px",background:"rgba(91,75,138,0.15)",overflow:"hidden"},children:e.jsx("div",{style:{width:u+"%",height:"100%",background:parseFloat(u)>=100?l:"#5B4B8A",transition:"width 0.5s"}})}),e.jsxs("span",{style:{fontFamily:n,fontSize:"11px",color:parseFloat(u)>=100?l:"rgba(255,255,255,.78)",minWidth:"36px"},children:[u,"%"]})]})}),e.jsx("td",{className:"px-4 py-4",style:{fontFamily:n,fontSize:"12px",color:"rgba(255,255,255,.78)"},children:d.toLocaleString()}),e.jsxs("td",{className:"px-4 py-4",style:{fontFamily:n,fontSize:"12px",color:parseFloat(f)>=98?l:m},children:[f,"%"]}),e.jsxs("td",{className:"px-4 py-4",style:{fontFamily:n,fontSize:"12px",color:"rgba(255,255,255,.78)"},children:[y.toFixed(1),"h"]})]}),b&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{padding:0,border:"none"},children:e.jsxs("div",{style:{padding:"12px 16px",background:"rgba(91,75,138,0.08)",borderBottom:"1px solid rgba(91,75,138,0.15)"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px",marginBottom:"12px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Session ID"}),e.jsx("div",{style:{fontFamily:n,fontSize:"11px",color:"rgba(255,255,255,.80)"},children:s.session_id})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Started"}),e.jsx("div",{style:{fontFamily:n,fontSize:"11px",color:"rgba(255,255,255,.80)"},children:s.started_at?new Date(s.started_at).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Last Heartbeat"}),e.jsxs("div",{style:{fontFamily:n,fontSize:"11px",color:"rgba(255,255,255,.80)",display:"flex",alignItems:"center",gap:"6px"},children:[g&&e.jsx("span",{style:{display:"inline-block",animation:"heartbeat 1.2s ease-in-out infinite",fontSize:"13px",color:"#D66A6A"},children:"♥"}),s.last_heartbeat_at?new Date(s.last_heartbeat_at).toLocaleString():"—"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"16px",marginBottom:"12px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Pass Count"}),e.jsx("div",{style:{fontFamily:n,fontSize:"14px",color:l},children:(s.pass_count||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Block Count"}),e.jsx("div",{style:{fontFamily:n,fontSize:"14px",color:parseInt(s.block_count||0)>0?m:"rgba(255,255,255,.80)"},children:(s.block_count||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Conformance"}),e.jsxs("div",{style:{fontFamily:n,fontSize:"14px",color:parseFloat(f)>=98?l:parseFloat(f)>=95?m:"#D66A6A"},children:[f,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"Violation Rate"}),e.jsxs("div",{style:{fontFamily:n,fontSize:"14px",color:parseFloat(M)<=2?l:m},children:[M,"%"]})]})]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{fontFamily:n,fontSize:"9px",color:p,letterSpacing:"1px",textTransform:"uppercase"},children:"72-Hour Progress"}),e.jsxs("span",{style:{fontFamily:n,fontSize:"9px",color:p},children:[u,"% — ",z,"h remaining"]})]}),e.jsx("div",{style:{height:"6px",background:"rgba(255,255,255,0.06)",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${u}%`,background:parseFloat(u)>=100?l:"var(--purple-bright)",transition:"width 0.3s"}})})]}),(_==null?void 0:_.role)==="admin"&&S&&e.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px solid rgba(91,75,138,0.15)",display:"flex",gap:"8px"},children:e.jsx("button",{onClick:C=>{C.stopPropagation(),S(s.test_id||s.session_id)},disabled:h==null?void 0:h[s.test_id||s.session_id],className:"px-3 py-1 btn",style:{fontFamily:n,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:(h==null?void 0:h[s.test_id||s.session_id])==="stopping"?"...":"Stop & Evaluate"})})]})})})]},s.session_id)})})]})]})}const Q=()=>e.jsx("style",{children:"@keyframes heartbeat { 0%,100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.3); opacity: 1; } }"});export{se as default};
