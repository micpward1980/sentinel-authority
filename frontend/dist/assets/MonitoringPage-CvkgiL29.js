import{f as X,u as Y,a as ee,e as te,j as e,s as t,d as j}from"./index-CQToRwbo.js";import{r as h,i as W,D as ne,k as ie,R as re}from"./icons-DCxkC3Ow.js";import{u as U}from"./useQuery-DvUtKwTH.js";import"./Panel-CTXV6eYW.js";import"./vendor-DxYwK_Rn.js";function pe(){const[b,z]=h.useState(null),[T,D]=h.useState([]),[R,N]=h.useState(!0),[G,P]=h.useState(!1),k=X(),[F,q]=h.useState(""),[L,V]=h.useState(!1),[E,M]=h.useState(!0),{user:i}=Y(),f=ee(),$=te(),{data:K,isLoading:Q,refetch:oe}=U({queryKey:["monitoring-overview"],queryFn:()=>j.get("/api/envelo/monitoring/overview").then(n=>n.data),refetchInterval:R?1e4:!1}),{data:C}=U({queryKey:["monitoring-alerts"],queryFn:()=>j.get("/api/envelo/monitoring/alerts").then(n=>n.data),refetchInterval:R?1e4:!1}),v=K??null,w=(C==null?void 0:C.alerts)??[],H=h.useCallback(async()=>{P(!0),await Promise.all([k.invalidateQueries({queryKey:["monitoring-overview"]}),k.invalidateQueries({queryKey:["monitoring-alerts"]})]),setTimeout(()=>P(!1),600)},[k]),Z=async n=>{try{const a=await j.get(`/api/envelo/monitoring/session/${n}/timeline?hours=24`);D(a.data.timeline||[])}catch(a){console.error("Failed to fetch timeline:",a)}};h.useEffect(()=>{b&&Z(b.session_id)},[b]);const J=()=>{const n=B.map(o=>{var g;const r=(o.pass_count||0)+(o.block_count||0),s=r>0?(o.pass_count/r*100).toFixed(2):"0.00";return{status:o.is_online?"Online":o.status==="ended"?"Ended":"Offline",organization:o.organization_name||"",system_name:o.system_name||"",certificate:o.certificate_id||"",session_id:o.session_id||"",started_at:o.started_at||"",ended_at:o.ended_at||"",uptime_hours:((g=o.uptime_hours)==null?void 0:g.toFixed(2))||"0",pass_count:o.pass_count||0,block_count:o.block_count||0,total_actions:r,pass_rate:s+"%",agent_version:o.agent_version||"",last_activity:o.last_activity||""}});if(n.length===0){f.show("No sessions to export","warning");return}const a=Object.keys(n[0]),p=[a.join(","),...n.map(o=>a.map(r=>{const s=String(o[r]).replace(/"/g,'""');return s.includes(",")||s.includes('"')||s.includes(`
`)?`"${s}"`:s}).join(","))].join(`
`),m=new Blob([p],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(m),c=document.createElement("a");c.href=x,c.download=`envelo-sessions-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(x)};if(Q)return e.jsxs("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:[e.jsx(W,{size:24,style:{animation:"spin 1s linear infinite",color:t.purpleBright}}),e.jsx("p",{style:{marginTop:"16px",color:t.textSecondary},children:"Loading monitoring data..."})]});const d=(v==null?void 0:v.summary)||{},S=(v==null?void 0:v.sessions)||[],B=S.filter(n=>!(F&&n.organization_name!==F||L&&!n.is_online||E&&(n.status==="ended"||n.status==="completed"||n.status==="disconnected")));return e.jsxs("div",{style:{maxWidth:"1400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontFamily:t.mono,fontSize:"10px",fontWeight:600,letterSpacing:"0.20em",textTransform:"uppercase",color:t.purpleBright,margin:"0 0 8px 0"},children:(i==null?void 0:i.role)==="admin"?"Administration":"Compliance"}),e.jsx("h1",{style:{fontFamily:t.serif,fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0,color:t.textPrimary},children:"System Monitoring"}),e.jsx("p",{style:{color:t.textSecondary,marginTop:"4px",fontSize:"14px"},children:(i==null?void 0:i.role)==="admin"?"Real-time ENVELO agent status and telemetry":"Track your certified systems' compliance status"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",color:t.textSecondary,fontSize:"13px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:R,onChange:n=>N(n.target.checked),style:{accentColor:t.purpleBright}}),"Auto-refresh"]}),e.jsxs("button",{onClick:H,style:{background:t.bgPanel,border:`1px solid ${t.borderGlass}`,padding:"8px 16px",color:t.textPrimary,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(W,{size:14,style:G?{animation:"spin 1s linear infinite"}:{}})," ",G?"Refreshing...":"Refresh"]}),(i==null?void 0:i.role)==="admin"&&e.jsxs("button",{onClick:J,style:{background:t.bgPanel,border:`1px solid ${t.borderGlass}`,padding:"8px 16px",color:t.textPrimary,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontFamily:t.mono,fontSize:"11px",letterSpacing:"0.5px"},children:[e.jsx(ne,{size:14})," Export CSV"]})]})]}),w.length>0&&e.jsxs("div",{style:{background:"rgba(214, 92, 92, 0.1)",border:"1px solid "+t.borderGlass,padding:"16px",marginBottom:"24px",borderRadius:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx(ie,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:18,style:{color:t.accentRed}}),e.jsxs("span",{style:{fontWeight:500,color:t.accentRed},children:[w.length," Active Alert",w.length>1?"s":""]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:w.map((n,a)=>{var p;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",background:"transparent",padding:"10px 14px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:n.severity==="critical"?t.accentRed:t.accentAmber,marginRight:"12px"},children:n.severity}),e.jsx("span",{style:{color:t.textPrimary},children:n.message})]}),e.jsxs("span",{style:{color:t.textTertiary,fontSize:"12px",fontFamily:t.mono},children:[(p=n.session_id)==null?void 0:p.slice(0,8),"..."]})]},a)})})]}),(()=>{var r,s,g;const n=S.filter(l=>l.is_online).length,a=S.filter(l=>!l.is_online&&l.status!=="ended").length,p=n+a,m=p>0?n/p*100:0,x={background:t.cardSurface,border:"1px solid "+t.borderSubtle,padding:"20px"},c={fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"2px",color:t.textTertiary,marginBottom:"8px"},o={fontSize:"12px",color:t.textSecondary,marginTop:"4px"};return e.jsxs("div",{style:{marginBottom:"32px"},children:[p>0&&e.jsxs("div",{style:{marginBottom:"20px",padding:"16px 20px",...x},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"10px"},children:[e.jsx("div",{style:c,children:"Fleet Health"}),e.jsxs("div",{style:{fontFamily:t.mono,fontSize:"13px",color:m>=90?t.accentGreen:m>=70?t.accentAmber:t.accentRed,fontWeight:500},children:[m.toFixed(0),"% Online"]})]}),e.jsxs("div",{style:{height:"8px",background:"transparent",overflow:"hidden",display:"flex"},children:[n>0&&e.jsx("div",{style:{width:n/p*100+"%",background:t.accentGreen,transition:"width 0.5s"}}),a>0&&e.jsx("div",{style:{width:a/p*100+"%",background:t.accentRed,transition:"width 0.5s"}})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"8px"},children:[e.jsxs("span",{style:{fontSize:"11px",color:t.accentGreen,display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:t.accentGreen,display:"inline-block"}})," ",n," online"]}),e.jsxs("span",{style:{fontSize:"11px",color:t.accentRed,display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:t.accentRed,display:"inline-block"}})," ",a," offline"]}),e.jsxs("span",{style:{fontSize:"11px",color:t.textTertiary,display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:t.textTertiary,display:"inline-block"}})," ",d.ended||0," ended"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:x,children:[e.jsx("div",{style:c,children:(i==null?void 0:i.role)==="admin"?"Active Sessions":"Active Systems"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.accentGreen},children:d.active||0}),e.jsxs("div",{style:o,children:[d.offline||0," offline"]})]}),e.jsxs("div",{style:x,children:[e.jsx("div",{style:c,children:"Total Actions"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.textPrimary},children:(d.total_actions||0).toLocaleString()}),e.jsxs("div",{style:o,children:[((r=d.total_pass)==null?void 0:r.toLocaleString())||0," passed, ",((s=d.total_block)==null?void 0:s.toLocaleString())||0," blocked"]})]}),e.jsxs("div",{style:x,children:[e.jsx("div",{style:c,children:"Pass Rate"}),e.jsxs("div",{style:{fontSize:"32px",fontWeight:300,color:d.pass_rate>=99?t.accentGreen:d.pass_rate>=95?t.accentAmber:t.accentRed},children:[((g=d.pass_rate)==null?void 0:g.toFixed(1))||0,"%"]}),e.jsx("div",{style:o,children:"enforcement success"})]}),e.jsxs("div",{style:x,children:[e.jsx("div",{style:c,children:"Violations (24h)"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:(d.total_block||0)>0?t.accentRed:t.accentGreen},children:(d.total_block||0).toLocaleString()}),e.jsxs("div",{style:o,children:[((d.total_block||0)/Math.max(d.total_actions||1,1)*100).toFixed(2),"% of actions"]})]}),(i==null?void 0:i.role)==="admin"&&e.jsxs("div",{style:x,children:[e.jsx("div",{style:c,children:"Total Sessions"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.textPrimary},children:d.total||0}),e.jsxs("div",{style:o,children:[d.ended||0," completed"]})]}),(i==null?void 0:i.role)==="admin"&&e.jsxs("div",{style:x,children:[e.jsx("div",{style:c,children:"Unique Systems"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.purpleBright},children:[...new Set(S.map(l=>l.certificate_id).filter(Boolean))].length}),e.jsxs("div",{style:o,children:[[...new Set(S.map(l=>l.organization_name).filter(Boolean))].length," organizations"]})]})]})]})})(),e.jsxs("div",{style:{background:t.cardSurface,border:"1px solid "+t.borderSubtle,overflow:"hidden",borderRadius:4},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.borderGlass}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"14px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"2px",color:t.textTertiary},children:(i==null?void 0:i.role)==="admin"?"Agent Sessions":"System Monitoring"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[(i==null?void 0:i.role)==="admin"&&e.jsxs("select",{value:F,onChange:n=>q(n.target.value),style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"6px 10px",color:t.textPrimary,fontSize:"12px"},children:[e.jsx("option",{value:"",children:"All Customers"}),[...new Set(S.map(n=>n.organization_name).filter(Boolean))].map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",color:t.textSecondary,fontSize:"12px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:E,onChange:n=>M(n.target.checked),style:{accentColor:t.purpleBright}}),"Hide ended"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",color:t.textSecondary,fontSize:"12px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:L,onChange:n=>V(n.target.checked),style:{accentColor:t.purpleBright}}),"Online only"]})]})]}),B.length===0?e.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:t.textSecondary},children:(i==null?void 0:i.role)==="admin"?"No ENVELO sessions found. Deploy an agent to begin monitoring.":"No active systems. Once your system is ODDC certified and running the ENVELO agent, real-time monitoring data will appear here."}):e.jsx("div",{className:"table-scroll",style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"transparent"},children:(()=>{const n={padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},a={...n,textAlign:"right"};return e.jsxs(e.Fragment,{children:[e.jsx("th",{style:n,children:"Status"}),e.jsx("th",{style:n,children:"Organization"}),e.jsx("th",{style:n,children:"System / Certificate"}),e.jsx("th",{style:n,children:"Session"}),e.jsx("th",{style:n,children:"Uptime"}),e.jsx("th",{style:a,children:"Actions"}),e.jsx("th",{style:a,children:"Pass Rate"}),e.jsx("th",{style:n,children:"Last Activity"})]})})()})}),e.jsx("tbody",{children:B.map(n=>{var x,c,o;const a=n.pass_count+n.block_count,p=a>0?n.pass_count/a*100:0,m=(b==null?void 0:b.id)===n.id;return e.jsxs(re.Fragment,{children:[e.jsxs("tr",{onClick:()=>z(m?null:n),style:{borderBottom:`1px solid ${t.borderGlass}`,cursor:"pointer",background:m?"rgba(91, 75, 138, 0.15)":"transparent",transition:"background 0.15s"},onMouseEnter:r=>{m||(r.currentTarget.style.background="transparent")},onMouseLeave:r=>{m||(r.currentTarget.style.background="transparent")},children:[e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:n.is_online?t.accentGreen:n.status==="ended"?t.textTertiary:t.accentRed,boxShadow:"none"}}),e.jsx("span",{style:{fontSize:"11px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:n.is_online?t.accentGreen:n.status==="ended"?t.textTertiary:t.accentRed},children:n.is_online?"Online":n.status==="ended"?"Ended":"Offline"})]})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsx("div",{style:{fontSize:"13px",color:t.textPrimary,fontWeight:500},children:n.organization_name||"Unknown"})}),e.jsxs("td",{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:"13px",color:t.textPrimary},children:n.system_name||"-"}),e.jsx("div",{style:{fontFamily:t.mono,fontSize:"10px",color:t.textTertiary,marginTop:"2px"},children:n.certificate_id||"-"})]}),e.jsxs("td",{style:{padding:"14px 16px",fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:[(x=n.session_id)==null?void 0:x.slice(0,12),"..."]}),e.jsxs("td",{style:{padding:"14px 16px",color:t.textSecondary,fontSize:"13px"},children:[(c=n.uptime_hours)==null?void 0:c.toFixed(1),"h"]}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right",color:t.textPrimary,fontFamily:t.mono,fontSize:"13px"},children:a.toLocaleString()}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:e.jsxs("span",{style:{color:p>=99?t.accentGreen:p>=95?t.accentAmber:t.accentRed,fontFamily:t.mono,fontSize:"13px"},children:[p.toFixed(1),"%"]})}),e.jsx("td",{style:{padding:"14px 16px",color:t.textTertiary,fontSize:"12px"},children:n.last_activity?new Date(n.last_activity).toISOString().replace("T"," ").substring(0,16)+"Z":"-"})]}),m&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:0,border:"none"},children:e.jsxs("div",{style:{background:t.bgPanel,borderTop:"1px solid "+t.borderGlass,borderBottom:"2px solid "+t.purpleBright},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid "+t.borderGlass,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs("h2",{style:{margin:0,fontSize:"14px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"2px",color:t.textTertiary},children:["Session Detail: ",n.session_id]}),e.jsx("button",{onClick:()=>z(null),style:{background:"none",border:"none",color:t.textTertiary,cursor:"pointer",fontSize:"18px"},children:"×"})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 4px 0",fontSize:"18px",fontWeight:400,color:t.textPrimary},children:n.organization_name||"Unknown Organization"}),e.jsxs("p",{style:{margin:0,fontSize:"13px",color:t.textSecondary},children:[n.system_name||"Unknown System"," · ",n.certificate_id||"No certificate"]}),e.jsxs("p",{style:{margin:"4px 0 0",fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:["Agent v",n.agent_version||"1.0.0"," · Session ",n.session_id]})]}),n.is_online&&e.jsx("button",{onClick:async()=>{if(await $({title:"End Session",message:"Force-end this session?",danger:!0}))try{await j.post("/api/envelo/sessions/"+n.session_id+"/end",{ended_at:new Date().toISOString(),final_stats:{pass_count:n.pass_count,block_count:n.block_count}}),z(null),k.invalidateQueries({queryKey:["monitoring-overview"]})}catch(r){f.show("Failed: "+r.message,"error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderSubtle,color:t.accentRed,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",borderRadius:4},children:"Force End Session"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Started"}),e.jsx("div",{style:{color:t.textPrimary,fontSize:"13px"},children:n.started_at?new Date(n.started_at).toISOString().replace("T"," ").substring(0,16)+"Z":"-"})]}),e.jsxs("div",{style:{padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Uptime"}),e.jsxs("div",{style:{color:t.textPrimary,fontFamily:t.mono,fontSize:"18px"},children:[((o=n.uptime_hours)==null?void 0:o.toFixed(1))||"0","h"]})]}),e.jsxs("div",{style:{padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Passed"}),e.jsx("div",{style:{color:t.accentGreen,fontFamily:t.mono,fontSize:"18px"},children:(n.pass_count||0).toLocaleString()})]}),e.jsxs("div",{style:{padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Blocked"}),e.jsx("div",{style:{color:t.accentRed,fontFamily:t.mono,fontSize:"18px"},children:(n.block_count||0).toLocaleString()})]}),e.jsxs("div",{style:{padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Pass Rate"}),(()=>{const r=(n.pass_count||0)+(n.block_count||0),s=r>0?n.pass_count/r*100:0;return e.jsxs("div",{style:{color:s>=99?t.accentGreen:s>=95?t.accentAmber:t.accentRed,fontFamily:t.mono,fontSize:"18px"},children:[s.toFixed(1),"%"]})})()]}),e.jsxs("div",{style:{padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Certificate"}),e.jsx("div",{style:{color:t.purpleBright,fontFamily:t.mono,fontSize:"12px"},children:n.certificate_id||"-"})]})]}),(()=>{const r=(n.pass_count||0)+(n.block_count||0);if(r===0)return null;const s=n.pass_count/r*100;return e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"8px"},children:"Enforcement Distribution"}),e.jsxs("div",{style:{height:"12px",overflow:"hidden",display:"flex"},children:[e.jsx("div",{style:{width:s+"%",background:t.accentGreen}}),e.jsx("div",{style:{width:100-s+"%",background:t.accentRed}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"11px"},children:[e.jsxs("span",{style:{color:t.accentGreen},children:["Pass: ",s.toFixed(1),"%"]}),e.jsxs("span",{style:{color:t.accentRed},children:["Block: ",(100-s).toFixed(1),"%"]})]})]})})(),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:async()=>{try{const s=(i==null?void 0:i.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",l=(await j.get(s+n.session_id+"/telemetry")).data.records||[];if(l.length===0){f.show("No telemetry data yet","info");return}const y=["timestamp","action_id","action_type","result","execution_time_ms"],_=[y.join(","),...l.map(O=>y.map(I=>JSON.stringify(O[I]??"")).join(","))].join(`
`),A=new Blob([_],{type:"text/csv"}),u=document.createElement("a");u.href=URL.createObjectURL(A),u.download="telemetry-"+n.session_id+".csv",u.click()}catch{f.show("Failed to download telemetry","error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderSubtle,color:t.purpleBright,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"6px",borderRadius:4},children:"↓ Telemetry CSV"}),e.jsx("button",{onClick:async()=>{try{const s=(i==null?void 0:i.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",l=(await j.get(s+n.session_id+"/violations")).data.violations||[];if(l.length===0){f.show("No violations recorded","info");return}const y=["timestamp","boundary_name","violation_message"],_=[y.join(","),...l.map(O=>y.map(I=>JSON.stringify(O[I]??"")).join(","))].join(`
`),A=new Blob([_],{type:"text/csv"}),u=document.createElement("a");u.href=URL.createObjectURL(A),u.download="violations-"+n.session_id+".csv",u.click()}catch{f.show("Failed to download violations","error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderSubtle,color:t.accentRed,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"6px",borderRadius:4},children:"↓ Violations CSV"}),e.jsx("button",{onClick:async()=>{try{const s=(i==null?void 0:i.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",g=await j.get(s+n.session_id+"/report",{responseType:"blob"}),l=new Blob([g.data],{type:"application/pdf"}),y=document.createElement("a");y.href=URL.createObjectURL(l),y.download="CAT72-Report-"+n.session_id+".pdf",y.click()}catch{f.show("Failed to download report","error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderGlass,color:t.accentGreen,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"6px",borderRadius:4},children:"↓ CAT-72 Report PDF"})]}),T.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"12px"},children:"24-Hour Activity"}),e.jsx("div",{style:{display:"flex",gap:"2px",height:"60px",alignItems:"flex-end"},children:T.map((r,s)=>{const g=Math.max(...T.map(_=>_.total),1),l=r.total/g*100,y=r.total>0?r.pass/r.total:1;return e.jsx("div",{style:{flex:1,height:Math.max(l,2)+"%",background:y>=.99?t.accentGreen:y>=.95?t.accentAmber:t.accentRed,opacity:.8},title:new Date(r.hour).toISOString().substring(11,16)+"Z: "+r.total+" actions ("+r.pass+" pass, "+r.block+" block)"},s)})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"10px",color:t.textTertiary},children:[e.jsx("span",{children:"24h ago"}),e.jsx("span",{children:"Now"})]})]})]})]})})})]},n.id)})})]})})]})]})}export{pe as default};
