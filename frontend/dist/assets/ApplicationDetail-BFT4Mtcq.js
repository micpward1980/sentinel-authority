import{j as e,s as t,e as de,b as xe,a as me,u as ge,d as f,c as ue,L as Q}from"./index-yBtxF6iz.js";import{r as h,l as he,R as ye}from"./icons-CHtaS-ny.js";import{P as w}from"./Panel-DzaT4GMG.js";import"./vendor-Dzneq-kE.js";const B=({children:a,style:o={}})=>e.jsx("div",{style:{background:"transparent",border:`1px solid ${t.borderGlass}`,padding:"24px",...o},children:a}),v=({children:a,onClick:o,variant:l="primary",disabled:i=!1,style:n={}})=>e.jsx("button",{onClick:o,disabled:i,style:{padding:"10px 20px",border:"none",cursor:i?"not-allowed":"pointer",fontFamily:t.mono,fontSize:"12px",letterSpacing:"1px",textTransform:"uppercase",transition:"all 0.2s",opacity:i?.5:1,...l==="primary"?{background:t.purpleBright,color:t.textPrimary}:l==="danger"?{background:t.accentRed,color:t.textPrimary}:{background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textSecondary},...n},children:a}),u=({label:a,value:o,onChange:l,type:i="text",placeholder:n="",style:p={}})=>e.jsxs("div",{style:{marginBottom:"12px",...p},children:[a&&e.jsx("label",{style:{display:"block",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"6px",fontFamily:t.mono},children:a}),e.jsx("input",{type:i,value:o,onChange:y=>l(i==="number"?parseFloat(y.target.value)||0:y.target.value),placeholder:n,style:{width:"100%",padding:"10px 12px",background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textPrimary,fontSize:"14px",fontFamily:t.mono}})]}),E=({label:a,value:o,onChange:l,options:i,style:n={}})=>e.jsxs("div",{style:{marginBottom:"12px",...n},children:[a&&e.jsx("label",{style:{display:"block",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"6px",fontFamily:t.mono},children:a}),e.jsx("select",{value:o,onChange:p=>l(p.target.value),style:{width:"100%",padding:"10px 12px",background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textPrimary,fontSize:"14px",fontFamily:t.mono},children:i.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),fe=({boundary:a,onChange:o,onRemove:l})=>e.jsxs(B,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:t.purpleBright,fontSize:"12px",fontFamily:t.mono},children:"NUMERIC BOUNDARY"}),e.jsx(v,{variant:"danger",onClick:l,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx(u,{label:"Name",value:a.name||"",onChange:i=>o({...a,name:i}),placeholder:"e.g., Speed Limit"}),e.jsx(u,{label:"Parameter",value:a.parameter||"",onChange:i=>o({...a,parameter:i}),placeholder:"e.g., speed"}),e.jsx(u,{label:"Min Value",type:"number",value:a.min_value??"",onChange:i=>o({...a,min_value:i||null}),placeholder:"Optional"}),e.jsx(u,{label:"Max Value",type:"number",value:a.max_value??"",onChange:i=>o({...a,max_value:i||null}),placeholder:"Required"}),e.jsx(u,{label:"Unit",value:a.unit||"",onChange:i=>o({...a,unit:i}),placeholder:"e.g., km/h, °C"}),e.jsx(u,{label:"Tolerance",type:"number",value:a.tolerance||0,onChange:i=>o({...a,tolerance:i}),placeholder:"0"})]}),e.jsx(E,{label:"On Violation",value:a.violation_action||"block",onChange:i=>o({...a,violation_action:i}),options:[{value:"block",label:"Block Action"},{value:"warn",label:"Warn Only"},{value:"log",label:"Log Only"}],style:{marginTop:"12px",marginBottom:0}})]}),je=({boundary:a,onChange:o,onRemove:l})=>{var i,n;return e.jsxs(B,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:t.accentGreen,fontSize:"12px",fontFamily:t.mono},children:"GEOGRAPHIC BOUNDARY"}),e.jsx(v,{variant:"danger",onClick:l,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsx(u,{label:"Name",value:a.name||"",onChange:p=>o({...a,name:p}),placeholder:"e.g., Warehouse Zone"}),e.jsx(E,{label:"Boundary Type",value:a.boundary_type||"circle",onChange:p=>o({...a,boundary_type:p}),options:[{value:"circle",label:"Circle (Center + Radius)"},{value:"polygon",label:"Polygon (Multiple Points)"}]}),a.boundary_type==="circle"||!a.boundary_type?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},children:[e.jsx(u,{label:"Center Latitude",type:"number",value:((i=a.center)==null?void 0:i.lat)??"",onChange:p=>o({...a,center:{...a.center,lat:p}}),placeholder:"30.2672"}),e.jsx(u,{label:"Center Longitude",type:"number",value:((n=a.center)==null?void 0:n.lon)??"",onChange:p=>o({...a,center:{...a.center,lon:p}}),placeholder:"-97.7431"}),e.jsx(u,{label:"Radius (meters)",type:"number",value:a.radius_meters||"",onChange:p=>o({...a,radius_meters:p}),placeholder:"1000"})]}):e.jsx("div",{style:{color:t.textSecondary,fontSize:"12px",padding:"12px",background:"transparent"},children:"Polygon editor coming soon. For now, enter coordinates as JSON in the raw editor below."})]})},ve=({boundary:a,onChange:o,onRemove:l})=>e.jsxs(B,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:t.accentAmber,fontSize:"12px",fontFamily:t.mono},children:"TIME BOUNDARY"}),e.jsx(v,{variant:"danger",onClick:l,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsx(u,{label:"Name",value:a.name||"",onChange:i=>o({...a,name:i}),placeholder:"e.g., Operating Hours"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx(u,{label:"Start Hour (0-23)",type:"number",value:a.allowed_hours_start??0,onChange:i=>o({...a,allowed_hours_start:Math.min(23,Math.max(0,i))})}),e.jsx(u,{label:"End Hour (0-23)",type:"number",value:a.allowed_hours_end??23,onChange:i=>o({...a,allowed_hours_end:Math.min(23,Math.max(0,i))})})]}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("label",{style:{display:"block",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"8px",fontFamily:t.mono},children:"Allowed Days"}),e.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((i,n)=>{const p=a.allowed_days||[0,1,2,3,4,5,6],y=p.includes(n);return e.jsx("button",{onClick:()=>{const k=y?p.filter(_=>_!==n):[...p,n].sort();o({...a,allowed_days:k})},style:{padding:"6px 12px",border:`1px solid ${y?t.purpleBright:t.borderGlass}`,background:y?t.purpleBright:"transparent",color:y?"white":t.textSecondary,cursor:"pointer",fontSize:"12px",fontFamily:t.mono},children:i},i)})})]})]}),be=({boundary:a,onChange:o,onRemove:l})=>e.jsxs(B,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:"#ec4899",fontSize:"12px",fontFamily:t.mono},children:"STATE BOUNDARY"}),e.jsx(v,{variant:"danger",onClick:l,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx(u,{label:"Name",value:a.name||"",onChange:i=>o({...a,name:i}),placeholder:"e.g., Operation Mode"}),e.jsx(u,{label:"Parameter",value:a.parameter||"",onChange:i=>o({...a,parameter:i}),placeholder:"e.g., mode"})]}),e.jsx(u,{label:"Allowed Values (comma-separated)",value:(a.allowed_values||[]).join(", "),onChange:i=>o({...a,allowed_values:i.split(",").map(n=>n.trim()).filter(Boolean)}),placeholder:"e.g., idle, moving, charging"}),e.jsx(u,{label:"Forbidden Values (comma-separated)",value:(a.forbidden_values||[]).join(", "),onChange:i=>o({...a,forbidden_values:i.split(",").map(n=>n.trim()).filter(Boolean)}),placeholder:"e.g., emergency, override",style:{marginBottom:0}})]});function Se({applicationId:a,initialBoundaries:o,onSave:l,api:i}){var A;const[n,p]=h.useState({numeric_boundaries:[],geo_boundaries:[],time_boundaries:[],state_boundaries:[],safe_state:{action:"stop",notify:!0,log:!0},fail_closed:!0,telemetry_interval:1,heartbeat_interval:60}),[y,k]=h.useState(!1),[_,$]=h.useState(!1),[z,P]=h.useState("");h.useEffect(()=>{o&&typeof o=="object"&&p(x=>({...x,...o}))},[o]),h.useEffect(()=>{P(JSON.stringify(n,null,2))},[n]);const b=x=>{const s=`${x}_boundaries`,g={numeric:{type:"numeric",name:"",parameter:"",max_value:null,unit:"",tolerance:0,violation_action:"block"},geo:{type:"geo",name:"",boundary_type:"circle",center:{lat:0,lon:0},radius_meters:1e3,violation_action:"block"},time:{type:"time",name:"",allowed_hours_start:6,allowed_hours_end:22,allowed_days:[0,1,2,3,4],violation_action:"block"},state:{type:"state",name:"",parameter:"",allowed_values:[],forbidden_values:[],violation_action:"block"}};p(S=>({...S,[s]:[...S[s],g[x]]}))},T=(x,s,g)=>{const S=`${x}_boundaries`;p(N=>({...N,[S]:N[S].map((F,O)=>O===s?g:F)}))},j=(x,s)=>{const g=`${x}_boundaries`;p(S=>({...S,[g]:S[g].filter((N,F)=>F!==s)}))},I=async()=>{k(!0);try{await l(n)}finally{k(!1)}},D=()=>{try{const x=JSON.parse(z);p(x),$(!1)}catch(x){alert("Invalid JSON: "+x.message)}},G=n.numeric_boundaries.length+n.geo_boundaries.length+n.time_boundaries.length+n.state_boundaries.length;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.purpleBright,margin:0},children:"Boundary Configuration"}),e.jsxs("p",{style:{color:t.textSecondary,margin:"8px 0 0",fontSize:"14px"},children:[G," boundaries defined"]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(v,{variant:"secondary",onClick:()=>$(!_),children:_?"Visual Editor":"Raw JSON"}),e.jsx(v,{onClick:I,disabled:y,children:y?"Saving...":"Save Boundaries"})]})]}),_?e.jsxs(B,{children:[e.jsx("textarea",{value:z,onChange:x=>P(x.target.value),style:{width:"100%",minHeight:"400px",padding:"16px",background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textPrimary,fontSize:"13px",fontFamily:t.mono,resize:"vertical"}}),e.jsx(v,{onClick:D,style:{marginTop:"12px"},children:"Apply JSON"})]}):e.jsxs("div",{children:[e.jsxs(B,{style:{marginBottom:"24px"},children:[e.jsx("p",{style:{fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,margin:"0 0 12px",fontFamily:t.mono},children:"Add Boundary"}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[e.jsx(v,{variant:"secondary",onClick:()=>b("numeric"),children:"+ Numeric (Speed, Temp, etc.)"}),e.jsx(v,{variant:"secondary",onClick:()=>b("geo"),children:"+ Geographic (Geofence)"}),e.jsx(v,{variant:"secondary",onClick:()=>b("time"),children:"+ Time (Operating Hours)"}),e.jsx(v,{variant:"secondary",onClick:()=>b("state"),children:"+ State (Allowed Modes)"})]})]}),n.numeric_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:t.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["Numeric Boundaries (",n.numeric_boundaries.length,")"]}),n.numeric_boundaries.map((x,s)=>e.jsx(fe,{boundary:x,onChange:g=>T("numeric",s,g),onRemove:()=>j("numeric",s)},s))]}),n.geo_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:t.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["Geographic Boundaries (",n.geo_boundaries.length,")"]}),n.geo_boundaries.map((x,s)=>e.jsx(je,{boundary:x,onChange:g=>T("geo",s,g),onRemove:()=>j("geo",s)},s))]}),n.time_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:t.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["Time Boundaries (",n.time_boundaries.length,")"]}),n.time_boundaries.map((x,s)=>e.jsx(ve,{boundary:x,onChange:g=>T("time",s,g),onRemove:()=>j("time",s)},s))]}),n.state_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:t.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["State Boundaries (",n.state_boundaries.length,")"]}),n.state_boundaries.map((x,s)=>e.jsx(be,{boundary:x,onChange:g=>T("state",s,g),onRemove:()=>j("state",s)},s))]}),e.jsxs(B,{children:[e.jsx("h3",{style:{fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,margin:"0 0 16px",fontFamily:t.mono},children:"Enforcement Settings"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(E,{label:"On Violation",value:((A=n.safe_state)==null?void 0:A.action)||"stop",onChange:x=>p(s=>({...s,safe_state:{...s.safe_state,action:x}})),options:[{value:"stop",label:"Stop System"},{value:"reduce",label:"Reduce Operation"},{value:"handoff",label:"Human Handoff"}]}),e.jsx(E,{label:"Fail Mode",value:n.fail_closed?"closed":"open",onChange:x=>p(s=>({...s,fail_closed:x==="closed"})),options:[{value:"closed",label:"Fail Closed (Block)"},{value:"open",label:"Fail Open (Allow)"}]}),e.jsx(u,{label:"Telemetry Interval (sec)",type:"number",value:n.telemetry_interval||1,onChange:x=>p(s=>({...s,telemetry_interval:x}))})]})]}),G===0&&e.jsxs(B,{style:{textAlign:"center",padding:"48px"},children:[e.jsx("p",{style:{color:t.textSecondary,fontSize:"16px",margin:0},children:"No boundaries defined yet."}),e.jsx("p",{style:{color:t.textTertiary,fontSize:"14px",marginTop:"8px"},children:"Add boundaries above to define the system's Operational Design Domain."})]})]})]})}function Be(){var J;const{id:a}=de(),o=xe(),{user:l}=me(),i=ge(),[n,p]=h.useState(null),[y,k]=h.useState(!1),[_,$]=h.useState(null),[z,P]=h.useState([]),[b,T]=h.useState([]),[j,I]=h.useState(""),[D,G]=h.useState(!1),[A,x]=h.useState(!1),[s,g]=h.useState(null),[S,N]=h.useState(!1),F=async(r,c)=>{N(!0);try{const d=await f.get(`/api/applications/${a}/email-preview?new_state=${r}`);g({...d.data,label:c,newState:r})}catch{o.show("Preview failed","error")}N(!1)},O=async()=>{var r,c;if(s)try{await f.patch(`/api/applications/${a}/state?new_state=${s.newState}`),g(null),await H(),o.show(`State changed to ${s.newState}`,"success")}catch(d){o.show("Failed: "+(((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.detail)||d.message),"error")}};h.useEffect(()=>{a&&(f.get(`/api/applications/${a}`).then(r=>p(r.data)).catch(console.error),f.get(`/api/applications/${a}/history`).then(r=>P(r.data)).catch(console.error),f.get(`/api/applications/${a}/comments`).then(r=>T(r.data)).catch(console.error))},[a]);const ee=async()=>{var r,c;if(await i({title:"Schedule Test",message:"Schedule a CAT-72 test for this application? The test will need to be started manually."})){k(!0);try{const d=await f.post("/api/cat72/tests",{application_id:parseInt(a)});$(d.data),o.show(`CAT-72 Test created: ${d.data.test_id} — Go to CAT-72 Console to start.`,"success")}catch(d){o.show("Failed to create test: "+(((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.detail)||d.message),"error")}k(!1)}},te=ue(),ne=async()=>{var r,c;if(await i({title:"Delete Application",message:"Are you sure? This cannot be undone.",danger:!0,confirmLabel:"Delete"}))try{await f.delete(`/api/applications/${a}`),o.show("Application deleted","success"),te("/applications")}catch(d){o.show("Failed to delete: "+(((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.detail)||d.message),"error")}},ae=()=>F("approved","Approve Application"),H=async()=>{try{const r=await f.get(`/api/applications/${a}`);p(r.data),f.get(`/api/applications/${a}/history`).then(c=>P(c.data)).catch(console.error)}catch(r){console.error("Failed to refresh:",r)}},re=async()=>{var r,c;if(j.trim()){x(!0);try{const d=await f.post(`/api/applications/${a}/comments`,{content:j,is_internal:D});T(m=>[d.data,...m]),I(""),G(!1),o.show("Comment added","success")}catch(d){o.show("Failed to post comment: "+(((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.detail)||d.message),"error")}x(!1)}},oe=async r=>{var c,d;try{await f.delete(`/api/applications/${a}/comments/${r}`),T(m=>m.filter(C=>C.id!==r)),o.show("Comment deleted","success")}catch(m){o.show("Failed to delete comment: "+(((d=(c=m.response)==null?void 0:c.data)==null?void 0:d.detail)||m.message),"error")}},ie=()=>F("under_review","Begin Review"),se=()=>F("suspended","Suspend Application"),W=async()=>{var r,c;if(await i({title:"Reinstate",message:"Reinstate this application to pending? The applicant will need to go through review again."}))try{await f.patch(`/api/applications/${a}/state?new_state=pending`),await H()}catch(d){o.show("Failed to reinstate: "+(((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.detail)||d.message),"error")}},M=[{key:"pending",label:"Submitted",icon:"1"},{key:"under_review",label:"Under Review",icon:"2"},{key:"approved",label:"Approved",icon:"3"},{key:"testing",label:"CAT-72 Testing",icon:"4"},{key:"conformant",label:"Conformant",icon:"✓"}],le=M.findIndex(r=>r.key===(n==null?void 0:n.state)),pe=(n==null?void 0:n.state)==="revoked"||(n==null?void 0:n.state)==="suspended",ce=()=>{switch(n==null?void 0:n.state){case"pending":return"Your application is queued for review by the Sentinel Authority team.";case"under_review":return"Our team is evaluating your ODD specification and boundary definitions.";case"approved":return"Your system is approved. The ENVELO agent is being configured for CAT-72 testing.";case"testing":return"CAT-72 continuous conformance test is in progress (72-hour minimum).";case"conformant":return"Your system has achieved ODDC Conformance. Your certificate and ENVELO agent credentials are active.";case"revoked":return"This application has been suspended. Contact info@sentinelauthority.org for remediation steps.";default:return""}};return n?e.jsxs("div",{className:"space-y-6",children:[s&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",backdropFilter:"blur(4px)"},children:e.jsxs("div",{style:{background:"transparent",border:"1px solid "+t.borderGlass,maxWidth:"min(650px, 95vw)",width:"95%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid "+t.borderGlass,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.purpleBright},children:"Email Preview"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"12px",color:t.textTertiary},children:["This email will be sent to ",e.jsx("strong",{style:{color:t.textPrimary},children:s.to})]})]}),e.jsx("button",{onClick:()=>g(null),style:{background:"none",border:"none",color:t.textTertiary,cursor:"pointer",fontSize:"20px",padding:"4px 8px"},children:"X"})]}),e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+t.borderGlass,background:"transparent"},children:[e.jsx("div",{style:{fontSize:"11px",color:t.textTertiary,marginBottom:"2px"},children:"Subject"}),e.jsx("div",{style:{fontSize:"14px",color:t.textPrimary,fontWeight:500},children:s.subject})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"20px 24px"},children:e.jsx("div",{style:{background:"#fff",overflow:"hidden"},dangerouslySetInnerHTML:{__html:s.html}})}),e.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid "+t.borderGlass,display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{onClick:()=>g(null),style:{padding:"8px 20px",background:"transparent",border:"1px solid "+t.borderGlass,color:t.textSecondary,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Cancel"}),e.jsxs("button",{onClick:O,className:"sexy-btn",style:{padding:"8px 20px",background:s.newState==="suspended"?"rgba(180,52,52,0.10)":t.purplePrimary,border:"1px solid "+(s.newState==="suspended"?"rgba(180,52,52,0.4)":t.purpleBright),color:s.newState==="suspended"?t.accentRed:"#fff",fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:[s.label," + Send Email"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Q,{to:"/applications",className:"flex items-center gap-2 no-underline",style:{color:t.textTertiary,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase"},children:[e.jsx(he,{className:"w-4 h-4"}),"Back to Applications"]}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[n.state==="pending"&&e.jsx("button",{onClick:ie,className:"px-4 py-2 transition-all",style:{background:"transparent",border:"1px solid rgba(0,0,0,.09)",color:t.accentAmber,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Begin Review"}),(n.state==="pending"||n.state==="under_review")&&e.jsx("button",{onClick:ae,className:"px-4 py-2 transition-all",style:{background:"transparent",border:"1px solid rgba(0,0,0,.09)",color:t.accentGreen,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Approve Application"}),n.state==="approved"&&e.jsx("button",{onClick:ee,disabled:y,className:"px-4 py-2 transition-all",style:{background:t.purplePrimary,border:`1px solid ${t.purpleBright}`,color:"#fff",fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:y?"wait":"pointer",opacity:y?.7:1},children:y?"Scheduling...":"Schedule CAT-72 Test"}),["pending","under_review","approved","testing","conformant"].includes(n.state)&&e.jsx("button",{onClick:se,className:"px-4 py-2 transition-all",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:t.accentRed,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Suspend"}),(n.state==="suspended"||n.state==="revoked")&&e.jsx("button",{onClick:W,className:"px-4 py-2 transition-all",style:{background:"transparent",border:"1px solid rgba(0,0,0,.09)",color:t.accentGreen,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Reinstate"}),n.state==="expired"&&e.jsx("button",{onClick:W,className:"px-4 py-2 transition-all",style:{background:"transparent",border:`1px solid ${t.purpleBright}`,color:t.purpleBright,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Re-open"}),e.jsx("button",{onClick:ne,className:"px-4 py-2 transition-all",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:t.accentRed,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Delete"})]})]}),e.jsx(w,{children:e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:M.map((r,c)=>{const d=r.key===n.state,m=le>c;return e.jsxs(ye.Fragment,{children:[c>0&&e.jsx("div",{style:{flex:1,height:"2px",background:m?t.accentGreen:t.borderGlass,margin:"0 8px"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",minWidth:"80px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:t.mono,fontSize:"12px",fontWeight:"bold",background:m?"rgba(22,135,62,0.10)":d?"rgba(74,61,117,0.25)":"transparent",border:`2px solid ${m?t.accentGreen:d?t.purpleBright:t.borderGlass}`,color:m?t.accentGreen:d?t.purpleBright:t.textTertiary},children:m?"✓":r.icon}),e.jsx("span",{style:{fontFamily:t.mono,fontSize:"9px",letterSpacing:"0.5px",textTransform:"uppercase",color:d?t.purpleBright:m?t.accentGreen:t.textTertiary,textAlign:"center"},children:r.label})]})]},r.key)})}),pe&&e.jsx("div",{style:{padding:"12px 16px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",marginBottom:"12px"},children:e.jsx("span",{style:{color:t.accentRed,fontFamily:t.mono,fontSize:"11px"},children:"⚠ SUSPENDED — This application has been suspended pending review."})}),e.jsx("div",{style:{padding:"12px 16px",background:"transparent",border:`1px solid ${t.borderGlass}`},children:e.jsx("span",{style:{color:t.textSecondary,fontSize:"13px",lineHeight:"1.5"},children:ce()})})]})}),_&&e.jsx("div",{className:"p-4",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)"},children:e.jsxs("p",{style:{color:t.accentGreen,fontFamily:t.mono,fontSize:"12px"},children:["Test Created: ",_.test_id," — ",e.jsx(Q,{to:"/cat72",style:{color:t.purpleBright},children:"Go to CAT-72 Console"})]})}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontFamily:t.mono,fontSize:"10px",letterSpacing:"4px",textTransform:"uppercase",color:t.purpleBright,marginBottom:"8px"},children:["Application ",n.application_number]}),e.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0},children:n.system_name}),e.jsx("p",{style:{color:t.textSecondary,marginTop:"8px"},children:n.system_description})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"Organization"}),e.jsx("p",{style:{color:t.textPrimary,fontSize:"18px",marginBottom:"8px"},children:n.organization_name}),e.jsxs("p",{style:{color:t.textSecondary,marginBottom:"4px"},children:[e.jsx("strong",{children:"Contact:"})," ",n.contact_name]}),e.jsxs("p",{style:{color:t.textSecondary,marginBottom:"4px"},children:[e.jsx("strong",{children:"Email:"})," ",n.contact_email]}),n.contact_phone&&e.jsxs("p",{style:{color:t.textSecondary},children:[e.jsx("strong",{children:"Phone:"})," ",n.contact_phone]})]}),e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"Status"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"px-3 py-1",style:{background:n.state==="conformant"?"rgba(22,135,62,0.06)":n.state==="revoked"?"rgba(180,52,52,0.06)":"rgba(158,110,18,0.06)",color:n.state==="conformant"?t.accentGreen:n.state==="revoked"?t.accentRed:t.accentAmber,fontFamily:t.mono,fontSize:"12px",letterSpacing:"1px",textTransform:"uppercase"},children:n.state}),(l==null?void 0:l.role)==="admin"&&e.jsxs("select",{value:n.state,onChange:async r=>{var d,m;const c=r.target.value;if(await i({title:"Change Status",message:`Change status to ${c.toUpperCase()}?`}))try{if(await f.patch(`/api/applications/${a}/state?new_state=${c}`),c==="approved")try{await f.post("/api/apikeys/admin/provision",null,{params:{application_id:a,send_email:!0}})}catch(C){console.log("Auto-provision note:",C.message)}p({...n,state:c})}catch(C){o.show("Failed to update state: "+(((m=(d=C.response)==null?void 0:d.data)==null?void 0:m.detail)||C.message),"error")}},className:"px-3 py-2",style:{background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textPrimary,fontFamily:t.mono,fontSize:"11px"},children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"approved",children:"Approved (Agent Access)"}),e.jsx("option",{value:"testing",children:"Testing (CAT-72 Active)"}),e.jsx("option",{value:"conformant",children:"Conformant"}),e.jsx("option",{value:"revoked",children:"Revoked"})]})]}),e.jsxs("p",{style:{color:t.textSecondary},children:[e.jsx("strong",{children:"Submitted:"})," ",n.submitted_at?new Date(n.submitted_at).toLocaleString():"N/A"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"System Details"}),e.jsxs("p",{style:{color:t.textSecondary,marginBottom:"8px"},children:[e.jsx("strong",{children:"Version:"})," ",n.system_version||"N/A"]}),e.jsxs("p",{style:{color:t.textSecondary,marginBottom:"8px"},children:[e.jsx("strong",{children:"Manufacturer:"})," ",n.manufacturer||"N/A"]}),n.facility_location&&e.jsxs("p",{style:{color:t.textSecondary,marginBottom:"8px"},children:[e.jsx("strong",{children:"Facility:"})," ",n.facility_location]}),n.preferred_test_date&&e.jsxs("p",{style:{color:t.textSecondary},children:[e.jsx("strong",{children:"Preferred Test Date:"})," ",new Date(n.preferred_test_date).toLocaleDateString()]})]}),e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"Safety Boundaries & Operational Limits"}),e.jsx("p",{style:{color:t.textSecondary,lineHeight:1.7,whiteSpace:"pre-wrap"},children:typeof n.envelope_definition=="object"?JSON.stringify(n.envelope_definition,null,2):n.envelope_definition||"Not specified"})]})]}),(l==null?void 0:l.role)==="admin"&&e.jsx(Se,{applicationId:n.id,initialBoundaries:n.envelope_definition||{},onSave:async r=>{try{await f.patch(`/api/applicants/${n.id}`,{envelope_definition:r}),o.show("Boundaries saved","success"),p({...n,envelope_definition:r})}catch(c){o.show("Failed to save: "+c.message,"error")}}}),z.length>0&&e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"20px"},children:"State Change History"}),e.jsxs("div",{style:{position:"relative",paddingLeft:"28px"},children:[e.jsx("div",{style:{position:"absolute",left:"8px",top:"4px",bottom:"4px",width:"2px",background:t.borderGlass}}),z.map((r,c)=>{var V,Y,q,X,Z;const m={submitted:t.purpleBright,state_changed:(()=>{var K;const R=(K=r.details)==null?void 0:K.new_state;return R==="conformant"?t.accentGreen:R==="suspended"||R==="revoked"?t.accentRed:R==="approved"?t.accentGreen:R==="under_review"||R==="testing"?t.purpleBright:t.accentAmber})(),certificate_issued:t.accentGreen}[r.action]||t.textTertiary,C=((Y=(V=r.details)==null?void 0:V.new_state)==null?void 0:Y.replace("_"," "))||((q=r.action)==null?void 0:q.replace("_"," ")),U=(Z=(X=r.details)==null?void 0:X.old_state)==null?void 0:Z.replace("_"," "),L=r.timestamp?new Date(r.timestamp):null;return e.jsxs("div",{style:{position:"relative",paddingBottom:c<z.length-1?"20px":"0",marginBottom:(c<z.length-1,"0")},children:[e.jsx("div",{style:{position:"absolute",left:"-24px",top:"2px",width:"12px",height:"12px",borderRadius:"50%",background:`${m}08`,border:`2px solid ${m}`}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontFamily:t.mono,fontSize:"12px",fontWeight:500,color:m,textTransform:"uppercase",letterSpacing:"0.5px"},children:C}),U&&r.action!=="submitted"&&e.jsxs("span",{style:{fontFamily:t.mono,fontSize:"10px",color:t.textTertiary,marginLeft:"8px"},children:["from ",U]}),e.jsx("div",{style:{marginTop:"4px"},children:e.jsx("span",{style:{fontSize:"12px",color:t.textTertiary},children:r.user_email})})]}),e.jsx("div",{style:{textAlign:"right",flexShrink:0},children:L&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:L.toLocaleDateString()}),e.jsx("div",{style:{fontFamily:t.mono,fontSize:"10px",color:t.textTertiary},children:L.toLocaleTimeString()})]})})]})]},c)})]})]}),e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"ODD Specification"}),e.jsx("p",{style:{color:t.textSecondary,lineHeight:1.7,whiteSpace:"pre-wrap"},children:typeof n.odd_specification=="object"?((J=n.odd_specification)==null?void 0:J.description)||JSON.stringify(n.odd_specification,null,2):n.odd_specification})]}),e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"Comments & Notes"}),e.jsxs("div",{style:{marginBottom:b.length>0?"20px":"0"},children:[e.jsx("textarea",{value:j,onChange:r=>I(r.target.value),rows:3,placeholder:"Add a comment or note...",className:"w-full px-4 py-3 outline-none resize-none",style:{background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textPrimary,fontSize:"13px",fontFamily:"inherit",transition:"border-color 0.2s"},onFocus:r=>r.target.style.borderColor=t.purpleBright,onBlur:r=>r.target.style.borderColor=t.borderGlass}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginTop:"8px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:(l==null?void 0:l.role)==="admin"&&e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:D,onChange:r=>G(r.target.checked),style:{accentColor:t.purpleBright}}),e.jsx("span",{style:{fontFamily:t.mono,fontSize:"10px",color:t.textTertiary,letterSpacing:"0.5px",textTransform:"uppercase"},children:"Internal only"})]})}),e.jsx("button",{onClick:re,disabled:A||!j.trim(),className:"px-4 py-2",style:{background:j.trim()?t.purplePrimary:"rgba(0,0,0,0.025)",border:`1px solid ${j.trim()?t.purpleBright:t.borderGlass}`,color:j.trim()?"#fff":t.textTertiary,fontFamily:t.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:j.trim()?"pointer":"default",opacity:A?.6:1},children:A?"Posting...":"Post Comment"})]})]}),b.length>0&&e.jsx("div",{style:{borderTop:`1px solid ${t.borderGlass}`,paddingTop:"16px"},children:b.map(r=>e.jsxs("div",{style:{padding:"12px 0",borderBottom:"1px solid rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"6px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontFamily:t.mono,fontSize:"12px",color:r.user_role==="admin"?t.purpleBright:t.textSecondary,fontWeight:500},children:r.user_email}),r.user_role==="admin"&&e.jsx("span",{style:{fontFamily:t.mono,fontSize:"9px",padding:"2px 6px",background:"transparent",color:t.purpleBright,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Admin"}),r.is_internal&&e.jsx("span",{style:{fontFamily:t.mono,fontSize:"9px",padding:"2px 6px",background:"transparent",color:t.accentAmber,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Internal"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontFamily:t.mono,fontSize:"10px",color:t.textTertiary},children:r.created_at?new Date(r.created_at).toLocaleString():""}),((l==null?void 0:l.role)==="admin"||(l==null?void 0:l.email)===r.user_email)&&e.jsx("button",{onClick:()=>oe(r.id),style:{background:"none",border:"none",color:t.textTertiary,cursor:"pointer",fontSize:"12px",padding:"0",opacity:.5},title:"Delete comment",children:"×"})]})]}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"13px",lineHeight:1.6,margin:0,whiteSpace:"pre-wrap"},children:r.content})]},r.id))}),b.length===0&&!j&&e.jsx("p",{style:{color:t.textTertiary,fontSize:"13px",fontStyle:"italic",margin:0},children:"No comments yet"})]}),n.notes&&e.jsxs(w,{children:[e.jsx("h2",{style:{fontFamily:t.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:"16px"},children:"Applicant Notes"}),e.jsx("p",{style:{color:t.textSecondary,lineHeight:1.7,whiteSpace:"pre-wrap"},children:n.notes})]})]}):e.jsx("div",{style:{color:t.textTertiary},children:"Loading..."})}export{Be as default};
