import{u as R,d as W,c,a as I,j as t,s as e}from"./index-CiYkEjR4.js";import{r as p}from"./icons-CE7UjK-E.js";import{P as w}from"./Panel-CtACPDlF.js";import{S as D}from"./SectionHeader-H88fD9QP.js";import"./vendor-BZ1VDJqt.js";function V(){const{user:s}=R();W();const[u,S]=p.useState(null),[y,k]=p.useState(!1),[v,j]=p.useState(!1),[f,T]=p.useState({full_name:(s==null?void 0:s.full_name)||"",organization:(s==null?void 0:s.organization)||""}),[m,z]=p.useState(!1),[n,h]=p.useState({current:"",new_pw:"",confirm:""}),[b,P]=p.useState(!1),[B,g]=p.useState(""),[i,l]=p.useState({enabled:!1,loading:!0,setup:null,code:"",verifying:!1,disablePw:"",disabling:!1});p.useEffect(()=>{c.get("/api/auth/me").then(r=>{l(a=>({...a,enabled:r.data.totp_enabled||!1,loading:!1}))}).catch(()=>l(r=>({...r,loading:!1})))},[]);const C=async()=>{var r,a;try{const o=await c.post("/api/auth/2fa/setup");l(x=>({...x,setup:o.data}))}catch(o){d.show("Setup failed: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}},F=async()=>{var r,a;l(o=>({...o,verifying:!0}));try{const o=await c.post("/api/auth/2fa/enable",{code:i.code});d.show("Two-factor authentication enabled","success"),l(x=>({...x,enabled:!0,setup:null,code:"",verifying:!1,backupCodes:o.data.backup_codes||[]}))}catch(o){d.show(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||"Invalid code","error"),l(x=>({...x,verifying:!1}))}},A=async()=>{var r,a;l(o=>({...o,disabling:!0}));try{await c.post("/api/auth/2fa/disable",{current_password:i.disablePw}),d.show("Two-factor authentication disabled","success"),l(o=>({...o,enabled:!1,disablePw:"",disabling:!1}))}catch(o){d.show(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||"Failed","error"),l(x=>({...x,disabling:!1}))}},d=I(),_=async()=>{var r,a;z(!0);try{const o=await c.put("/api/auth/profile",f);d.show("Profile updated","success"),o.data.user&&window.location.reload()}catch(o){d.show("Failed to update profile: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}z(!1)},E=async()=>{var r,a;if(g(""),n.current===""||n.new_pw===""||n.confirm===""){g("All fields required");return}if(n.new_pw!==n.confirm){g("Passwords do not match");return}if(n.new_pw.length<8){g("Min 8 characters");return}P(!0);try{await c.post("/api/auth/change-password",{current_password:n.current,new_password:n.new_pw}),d.show("Password changed successfully","success"),h({current:"",new_pw:"",confirm:""})}catch(o){g(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||"Failed to change password")}P(!1)};p.useEffect(()=>{c.get("/api/users/email-preferences").then(r=>S(r.data.preferences||{})).catch(()=>{S({application_updates:!0,test_notifications:!0,certificate_alerts:!0,agent_alerts:!0,marketing:!1})})},[]);const G=r=>{S(a=>({...a,[r]:!a[r]})),j(!1)},$=async()=>{var r,a;k(!0);try{await c.put("/api/users/email-preferences",u),j(!0),setTimeout(()=>j(!1),3e3)}catch(o){d.show("Failed to save: "+(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message),"error")}k(!1)},N=[{key:"application_updates",label:"Application Updates",desc:"Submission confirmations, review status changes, approval notifications"},{key:"test_notifications",label:"CAT-72 Test Notifications",desc:"Test scheduled, started, passed, and failed alerts"},{key:"certificate_alerts",label:"Certificate Alerts",desc:"Certificate issued, expiry warnings (30-day / 7-day), expiration notices"},{key:"agent_alerts",label:"ENVELO Interlock Alerts",desc:"Agent offline warnings, high violation rate, suspension alerts"},{key:"marketing",label:"Product Updates",desc:"New features, platform updates, and industry news from Sentinel Authority"}];return u?t.jsxs("div",{className:"space-y-6",style:{maxWidth:"min(700px, 95vw)",margin:"0 auto"},children:[t.jsx(D,{label:"Account",title:"Settings"}),t.jsxs(w,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Account Information"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",maxWidth:"min(400px, 90vw)"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Full Name"}),t.jsx("input",{type:"text",value:f.full_name,onChange:r=>T({...f,full_name:r.target.value}),className:"w-full px-4 py-3 outline-none",style:{background:e.cardSurface,border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Organization"}),t.jsx("input",{type:"text",value:f.organization,onChange:r=>T({...f,organization:r.target.value}),className:"w-full px-4 py-3 outline-none",style:{background:e.cardSurface,border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"16px"},children:[t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"Email"}),t.jsx("div",{style:{color:e.textPrimary,marginTop:"4px",fontSize:"13px"},children:(s==null?void 0:s.email)||"-"})]}),t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"Role"}),t.jsx("div",{style:{color:e.purpleBright,marginTop:"4px",fontFamily:e.mono,fontSize:"12px",textTransform:"uppercase",letterSpacing:"1px"},children:(s==null?void 0:s.role)||"-"})]})]}),t.jsx("button",{onClick:_,disabled:m,style:{padding:"10px 24px",background:"transparent",border:"none",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:m?"wait":"pointer",opacity:m?.7:1,alignSelf:"flex-start"},children:m?"Saving...":"Save Profile"})]})]}),t.jsxs(w,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Change Password"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",maxWidth:"min(400px, 90vw)"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Current Password"}),t.jsx("input",{type:"password",value:n.current,onChange:r=>h({...n,current:r.target.value}),className:"w-full px-4 py-3 outline-none",style:{background:e.cardSurface,border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"New Password"}),t.jsx("input",{type:"password",value:n.new_pw,onChange:r=>h({...n,new_pw:r.target.value}),className:"w-full px-4 py-3 outline-none",style:{background:e.cardSurface,border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Confirm New Password"}),t.jsx("input",{type:"password",value:n.confirm,onChange:r=>h({...n,confirm:r.target.value}),className:"w-full px-4 py-3 outline-none",style:{background:e.cardSurface,border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),B&&t.jsx("div",{style:{color:e.accentRed,fontSize:"12px"},children:B}),t.jsx("div",{style:{fontSize:"11px",color:e.textTertiary},children:"Min 8 chars, 1 uppercase, 1 lowercase, 1 number"}),t.jsx("button",{onClick:E,disabled:b,style:{padding:"10px 24px",background:"transparent",border:"none",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:b?"wait":"pointer",opacity:b?.7:1,alignSelf:"flex-start"},children:b?"Changing...":"Change Password"})]})]}),t.jsxs(w,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Two-Factor Authentication"}),i.loading?t.jsx("div",{style:{color:e.textTertiary,fontSize:"13px"},children:"Loading..."}):i.enabled?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:e.accentGreen}}),t.jsx("span",{style:{color:e.accentGreen,fontFamily:e.mono,fontSize:"12px"},children:"ENABLED"})]}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"13px",marginBottom:"12px"},children:"Your account is protected with TOTP two-factor authentication."}),i.backupCodes&&i.backupCodes.length>0&&t.jsxs("div",{style:{marginBottom:"16px",padding:"16px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,borderRadius:8},children:[t.jsx("p",{style:{color:e.accentAmber,fontFamily:e.mono,fontSize:"11px",marginBottom:"8px",fontWeight:500},children:"SAVE YOUR BACKUP CODES"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"12px",marginBottom:"12px"},children:"Use these if you lose your authenticator. Each code works once."}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:i.backupCodes.map((r,a)=>t.jsx("span",{style:{fontFamily:e.mono,fontSize:"13px",color:e.textPrimary,padding:"4px 8px",background:"transparent",textAlign:"center"},children:r},a))}),t.jsx("button",{onClick:()=>{navigator.clipboard.writeText(i.backupCodes.join(`
`)),d.show("Backup codes copied")},style:{marginTop:"12px",padding:"6px 16px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase",borderRadius:8},children:"Copy All"})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",maxWidth:"min(400px, 90vw)"},children:[t.jsx("input",{type:"password",value:i.disablePw,onChange:r=>l(a=>({...a,disablePw:r.target.value})),placeholder:"Enter password to disable",style:{flex:1,background:e.cardSurface,border:`1px solid ${e.borderGlass}`,padding:"8px 12px",color:e.textPrimary,fontSize:"13px"}}),t.jsx("button",{onClick:A,disabled:i.disabling,style:{padding:"8px 16px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentRed,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:i.disabling?"wait":"pointer",whiteSpace:"nowrap",borderRadius:8},children:i.disabling?"...":"Disable 2FA"})]})]}):i.setup?t.jsxs("div",{style:{maxWidth:"min(400px, 90vw)"},children:[t.jsx("p",{style:{color:e.textSecondary,fontSize:"13px",marginBottom:"16px"},children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),i.setup.qr_base64&&t.jsx("div",{style:{textAlign:"center",marginBottom:"16px"},children:t.jsx("img",{src:"data:image/png;base64,"+i.setup.qr_base64,alt:"QR Code",style:{width:"200px",height:"200px"}})}),t.jsxs("div",{style:{background:e.cardSurface,border:`1px solid ${e.borderGlass}`,padding:"12px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"10px",color:e.textTertiary,marginBottom:"4px",fontFamily:e.mono,textTransform:"uppercase",letterSpacing:"1px"},children:"Manual Entry Key"}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"14px",color:e.purpleBright,letterSpacing:"2px",wordBreak:"break-all"},children:i.setup.secret})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[t.jsx("input",{type:"text",value:i.code,onChange:r=>l(a=>({...a,code:r.target.value.replace(/\D/g,"").slice(0,6)})),placeholder:"6-digit code",maxLength:6,style:{flex:1,background:e.cardSurface,border:`1px solid ${e.borderGlass}`,padding:"10px 12px",color:e.textPrimary,fontSize:"18px",fontFamily:e.mono,letterSpacing:"6px",textAlign:"center"}}),t.jsx("button",{onClick:F,disabled:i.verifying||i.code.length!==6,style:{padding:"10px 20px",background:"transparent",border:"none",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:i.verifying?"wait":"pointer",opacity:i.code.length!==6?.5:1},children:i.verifying?"...":"Verify"})]})]}):t.jsxs("div",{children:[t.jsx("p",{style:{color:e.textSecondary,fontSize:"13px",marginBottom:"16px"},children:"Add an extra layer of security by requiring a code from your authenticator app when signing in."}),t.jsx("button",{onClick:C,style:{padding:"10px 24px",background:"transparent",border:"none",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Enable 2FA"})]})]}),t.jsxs(w,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Email Notifications"}),t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"from notifications@sentinelauthority.org"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:N.map(r=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",padding:"16px",background:u[r.key]?"rgba(22,135,62,0.03)":"transparent",border:`1px solid ${u[r.key]?"rgba(22,135,62,0.08)":e.borderGlass}`,transition:"all 0.2s"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{color:e.textPrimary,fontWeight:500,fontSize:"14px",marginBottom:"4px"},children:r.label}),t.jsx("div",{style:{color:e.textTertiary,fontSize:"12px",lineHeight:"1.5"},children:r.desc})]}),t.jsx("button",{onClick:()=>G(r.key),style:{width:"48px",height:"26px",borderRadius:"13px",border:"none",cursor:"pointer",background:u[r.key]?e.accentGreen:"rgba(0,0,0,0.04)",position:"relative",transition:"background 0.2s",flexShrink:0,marginLeft:"16px"},children:t.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"#fff",position:"absolute",top:"3px",left:u[r.key]?"25px":"3px",transition:"left 0.2s"}})})]},r.key))}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginTop:"20px",paddingTop:"16px",borderTop:`1px solid ${e.borderGlass}`},children:[t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"Admin and security emails are always sent."}),t.jsx("button",{onClick:$,disabled:y,style:{padding:"10px 24px",background:"transparent",border:"none",borderBottom:`1px solid ${v?"rgba(22,135,62,0.25)":e.purpleBright}`,color:v?e.accentGreen:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:y?"wait":"pointer",opacity:y?.7:1},children:v?"âœ“ Saved":y?"Saving...":"Save Preferences"})]})]})]}):t.jsx("div",{style:{color:e.textTertiary,padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:"Loading preferences..."})}export{V as default};
