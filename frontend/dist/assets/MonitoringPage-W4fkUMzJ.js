import{a as ae,b as re,u as le,j as e,d as b}from"./index-Wp5BDwYI.js";import{r as d,h as q,D as ce,i as de}from"./icons-DL0PQMVt.js";import"./vendor-DYB3FAiG.js";function he(){const[x,C]=d.useState(null),[j,J]=d.useState([]),[n,w]=d.useState(null),[k,U]=d.useState(null),Y=d.useRef(null),[T,G]=d.useState([]),[X,K]=d.useState(!0),[S,Q]=d.useState(!0),[W,V]=d.useState(!1),[z,B]=d.useState("all"),[M,Z]=d.useState(""),[I,P]=d.useState(1),[ee,te]=d.useState(1),[R,ne]=d.useState("last_activity"),[D,H]=d.useState("desc"),oe=25,{user:a}=ae(),m=re(),A=le(),_=async()=>{var t;try{const[i,r]=await Promise.all([b.get(`/api/envelo/monitoring/overview?page=${I}&per_page=${oe}&sort=${R}&order=${D}&session_type=production`),b.get("/api/envelo/monitoring/alerts")]);C(i.data),(t=i.data)!=null&&t.total_pages&&te(i.data.total_pages),J(r.data.alerts||[])}catch(i){console.error("Failed to fetch monitoring data:",i)}finally{K(!1)}};d.useEffect(()=>{if(_(),S){const t=setInterval(_,1e4);return()=>clearInterval(t)}},[S,I,R,D]);const se=async t=>{try{const i=await b.get(`/api/envelo/monitoring/session/${t}/timeline?hours=24`);G(i.data.timeline||[])}catch(i){console.error("Failed to fetch timeline:",i)}};d.useEffect(()=>{n&&se(n.session_id)},[n]);const ie=()=>{const t=L.map(l=>{var c;const s=(l.pass_count||0)+(l.block_count||0),o=s>0?(l.pass_count/s*100).toFixed(2):"0.00";return{status:l.is_online?"Online":"Offline",organization:l.organization_name||"",system_name:l.system_name||"",certificate:l.certificate_id||"",session_id:l.session_id||"",started_at:l.started_at||"",uptime_hours:((c=l.uptime_hours)==null?void 0:c.toFixed(2))||"0",pass_count:l.pass_count||0,block_count:l.block_count||0,total_actions:s,pass_rate:o+"%",agent_version:l.agent_version||"",last_activity:l.last_activity||""}});if(t.length===0){m.show("No sessions to export","warning");return}const i=Object.keys(t[0]),r=[i.join(","),...t.map(l=>i.map(s=>{const o=String(l[s]).replace(/"/g,'""');return o.includes(",")||o.includes('"')||o.includes(`
`)?`"${o}"`:o}).join(","))].join(`
`),p=new Blob([r],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(p),f=document.createElement("a");f.href=u,f.download=`envelo-sessions-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(u)};if(X)return e.jsxs("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:[e.jsx(xe,{}),e.jsx(q,{size:24,style:{animation:"spin 1s linear infinite",color:"#a896d6"}}),e.jsx("p",{style:{marginTop:"16px",color:"rgba(255,255,255,.78)"},children:"Loading monitoring data..."})]});x!=null&&x.summary;const F=(x==null?void 0:x.sessions)||[],L=F.filter(t=>{if((t.session_type||"production")!=="production")return!1;if(M){const i=M.toLowerCase();if(!(t.session_id||"").toLowerCase().includes(i)&&!(t.certificate_id||"").toLowerCase().includes(i)&&!(t.organization_name||"").toLowerCase().includes(i)&&!(t.system_name||"").toLowerCase().includes(i))return!1}return!(z==="online"&&!t.is_online||z==="offline"&&t.is_online)});return e.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"4px",textTransform:"uppercase",color:"#a896d6",marginBottom:"10px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{width:"24px",height:"1px",background:"#a896d6"}}),"Monitoring"]}),e.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 4vw, 32px)",fontWeight:200,letterSpacing:"-0.02em",margin:0},children:"Fleet Monitoring"}),e.jsx("p",{style:{color:"rgba(255,255,255,.78)",marginTop:"4px",fontSize:"14px"},children:(a==null?void 0:a.role)==="admin"?"Real-time ENVELO Interlock status and telemetry":"Track your certified systems' compliance status"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[e.jsxs("button",{onClick:()=>Q(!S),className:"btn",style:{padding:"6px 12px",color:S?"var(--accent-green)":"var(--text-tertiary)",borderColor:S?"rgba(92,214,133,0.2)":"rgba(255,255,255,0.06)"},children:["Auto-refresh ",S?"ON":"OFF"]}),e.jsxs("button",{onClick:async()=>{V(!0),await _(),setTimeout(()=>V(!1),600)},className:"btn",children:[e.jsx(q,{size:14,style:W?{animation:"spin 1s linear infinite"}:{}})," ",W?"Refreshing...":"Refresh"]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("button",{onClick:ie,className:"btn",children:[e.jsx(ce,{size:14})," Export CSV"]})]})]}),j.length>0&&e.jsxs("div",{style:{background:"rgba(214, 92, 92, 0.1)",border:"1px solid rgba(255,255,255,.10)",padding:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx(de,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:18,style:{color:"#D65C5C"}}),e.jsxs("span",{style:{fontWeight:500,color:"#D65C5C"},children:[j.length," Active Alert",j.length>1?"s":""]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:j.map((t,i)=>{var r;return e.jsxs("div",{onClick:()=>{const p=F.find(u=>u.session_id===t.session_id);p&&w(p)},style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",background:"transparent",padding:"10px 14px",cursor:"pointer",transition:"background .15s"},onMouseEnter:p=>p.currentTarget.style.background="rgba(214,92,92,0.08)",onMouseLeave:p=>p.currentTarget.style.background="transparent",children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:t.severity==="critical"?"#D65C5C":"#D6A05C",marginRight:"12px"},children:t.severity}),e.jsx("span",{style:{color:"rgba(255,255,255,.94)"},children:t.message})]}),e.jsxs("span",{style:{color:"rgba(255,255,255,.50)",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:[(r=t.session_id)==null?void 0:r.slice(0,8),"..."]})]},i)})})]}),(()=>{const t=F.filter(r=>!r.is_online).length,i=F.filter(r=>r.is_online&&r.pass_count+r.block_count>0&&r.pass_count/(r.pass_count+r.block_count)*100<95).length;return!t&&!i?null:e.jsxs("div",{style:{padding:"10px 16px",marginBottom:"16px",border:"1px solid rgba(214,160,92,0.2)",background:"rgba(214,160,92,0.04)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"#D6A05C",display:"flex",gap:"16px",flexWrap:"wrap"},children:[t>0&&e.jsxs("span",{style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>B("offline"),children:["⚠ ",t," system",t>1?"s":""," offline"]}),i>0&&e.jsxs("span",{style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>B("all"),children:["⚠ ",i," system",i>1?"s":""," below 95% conformance"]})]})})(),e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",overflow:"auto"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,.07)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:(a==null?void 0:a.role)==="admin"?"Interlock Sessions":"System Monitoring"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search session, system...",value:M,onChange:t=>{Z(t.target.value),P(1)},style:{background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.90)",padding:"6px 12px",fontFamily:"Consolas, monospace",fontSize:"11px",width:"200px",outline:"none"}}),["all","online","offline"].map(t=>e.jsx("button",{onClick:()=>B(t),className:"btn",style:{padding:"4px 10px",color:z===t?t==="offline"?"#D65C5C":t==="online"?"#5CD685":"rgba(255,255,255,.94)":"var(--text-tertiary)",borderColor:z===t?t==="offline"?"rgba(214,92,92,0.3)":t==="online"?"rgba(92,214,133,0.2)":"rgba(255,255,255,0.15)":"rgba(255,255,255,0.06)",textTransform:"capitalize",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",letterSpacing:"1px"},children:t},t))]})]}),L.length===0?e.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:"rgba(255,255,255,.78)"},children:(a==null?void 0:a.role)==="admin"?"No ENVELO sessions found. Deploy an Interlock to begin monitoring.":"No active systems. Once your system is ODDC certified and running the ENVELO Interlock, real-time monitoring data will appear here."}):e.jsx("div",{className:"table-scroll",style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed",minWidth:"1000px"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"100px"}}),e.jsx("col",{style:{width:"160px"}}),e.jsx("col",{style:{width:"180px"}}),e.jsx("col",{style:{width:"120px"}}),e.jsx("col",{style:{width:"80px"}}),e.jsx("col",{style:{width:"90px"}}),e.jsx("col",{style:{width:"90px"}}),e.jsx("col",{style:{width:"140px"}})]}),e.jsx("thead",{children:e.jsx("tr",{style:{background:"transparent"},children:(()=>{const t={padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},i=(r,p,u)=>{const f=R===p,l={...t,textAlign:u||"left",cursor:"pointer",userSelect:"none",color:f?"#a896d6":"rgba(255,255,255,.50)",transition:"color .15s"},s=f?D==="asc"?" ▲":" ▼":"";return e.jsxs("th",{style:l,onClick:()=>{f?H(D==="asc"?"desc":"asc"):(ne(p),H("desc")),P(1)},children:[r,s]})};return e.jsxs(e.Fragment,{children:[i("Status","status"),i("Organization","organization_name"),i("System / Certificate","system_name"),i("Session","started_at"),i("Uptime","uptime"),i("Actions","pass_count","right"),i("Pass Rate","pass_rate","right"),i("Last Activity","last_activity")]})})()})}),e.jsx("tbody",{children:L.map(t=>{var u,f,l;const i=t.pass_count+t.block_count,r=i>0?t.pass_count/i*100:0,p=(n==null?void 0:n.id)===t.id||k===t.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>{if(p){const s=window.scrollY;U(null),setTimeout(()=>{w(null),requestAnimationFrame(()=>window.scrollTo(0,s))},300)}else w(t),requestAnimationFrame(()=>U(t.id))},style:{borderBottom:"1px solid rgba(255,255,255,.07)",cursor:"pointer",background:p?"rgba(91, 75, 138, 0.15)":"transparent",transition:"background 0.15s"},onMouseEnter:s=>{p||(s.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:s=>{p||(s.currentTarget.style.background="transparent")},children:[e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:t.is_online?"#5CD685":"#D65C5C",boxShadow:"none"}}),e.jsxs("span",{style:{fontSize:"11px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:t.is_online?"#5CD685":"#D65C5C"},children:[t.is_online?"Online":"Offline",!t.is_online&&e.jsx("div",{style:{fontSize:"9px",color:"rgba(214,92,92,0.6)",marginTop:"2px",textTransform:"none",letterSpacing:"0"},children:t.offline_reason||(()=>{const s=t.last_heartbeat_at||t.last_activity,o=s?Math.round((Date.now()-new Date(s).getTime())/36e5):null;return o?o+"h ago":"no signal"})()})]}),t.is_online&&e.jsx("span",{style:{fontSize:"13px",color:"#D66A6A",animation:"heartbeat 1.2s ease-in-out infinite"},children:"♥"})]})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsx("div",{style:{fontSize:"13px",color:"rgba(255,255,255,.94)",fontWeight:500},children:t.organization_name||"Unknown"})}),e.jsxs("td",{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:"13px",color:"rgba(255,255,255,.94)"},children:t.system_name||"-"}),e.jsx("div",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",marginTop:"2px"},children:t.certificate_id||"-"})]}),e.jsxs("td",{style:{padding:"14px 16px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[(u=t.session_id)==null?void 0:u.slice(0,12),"..."]}),e.jsxs("td",{style:{padding:"14px 16px",color:"rgba(255,255,255,.78)",fontSize:"13px"},children:[(f=t.uptime_hours)==null?void 0:f.toFixed(1),"h"]}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right",color:"rgba(255,255,255,.94)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"13px"},children:i.toLocaleString()}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:e.jsxs("span",{style:{color:r>=99?"#5CD685":r>=95?"#D6A05C":"#D65C5C",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"13px"},children:[r.toFixed(1),"%"]})}),e.jsx("td",{style:{padding:"14px 16px",color:"rgba(255,255,255,.50)",fontSize:"12px"},children:t.last_activity?new Date(t.last_activity).toLocaleString():"-"})]},t.id),(n==null?void 0:n.id)===t.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:0,border:"none"},children:e.jsxs("div",{ref:Y,style:{background:"rgba(91,75,138,0.08)",borderBottom:"1px solid rgba(91,75,138,0.25)",maxHeight:k===t.id?"800px":"0px",opacity:k===t.id?1:0,overflow:"hidden",transition:"max-height 0.35s ease, opacity 0.25s ease",padding:k===t.id?"20px":"0 20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 4px 0",fontSize:"18px",fontWeight:400,color:"rgba(255,255,255,.94)"},children:n.organization_name||"Unknown Organization"}),e.jsxs("p",{style:{margin:0,fontSize:"13px",color:"rgba(255,255,255,.78)"},children:[n.system_name||"Unknown System"," · ",n.certificate_id||"No certificate"]}),e.jsxs("p",{style:{margin:"4px 0 0",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:["Interlock v",n.agent_version||"1.0.0"," · Session ",n.session_id]})]}),e.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[(a==null?void 0:a.role)==="admin"&&n.certificate_id&&e.jsx("button",{onClick:async s=>{var o,c;if(s.stopPropagation(),!!await A({title:"Reinstate Certificate",message:`Reinstate ${n.certificate_id} for ${n.organization_name}? System is back online.`}))try{await b.patch(`/api/certificates/${n.certificate_id}/reinstate`),m.show("Certificate reinstated","success"),_()}catch(g){m.show("Failed: "+(((c=(o=g.response)==null?void 0:o.data)==null?void 0:c.detail)||g.message),"error")}},className:"btn",style:{padding:"3px 8px",fontSize:"9px",fontFamily:"Consolas,monospace",letterSpacing:"1px",textTransform:"uppercase",color:"#5CD685",borderColor:"rgba(92,214,133,0.3)"},children:"Reinstate"}),(a==null?void 0:a.role)==="admin"&&n.certificate_id&&e.jsx("button",{onClick:async s=>{var o,c;if(s.stopPropagation(),!!await A({title:"Suspend Certificate",message:`Suspend ${n.certificate_id} for ${n.organization_name}? System is offline.`,danger:!0}))try{await b.patch(`/api/certificates/${n.certificate_id}/suspend`,null,{params:{reason:"System offline — suspended by admin"}}),m.show("Certificate suspended","warning"),_()}catch(g){m.show("Failed: "+(((c=(o=g.response)==null?void 0:o.data)==null?void 0:c.detail)||g.message),"error")}},className:"btn",style:{padding:"3px 8px",fontSize:"9px",fontFamily:"Consolas,monospace",letterSpacing:"1px",textTransform:"uppercase",color:"#D6A05C",borderColor:"rgba(214,160,92,0.3)"},children:"Suspend"}),(a==null?void 0:a.role)==="admin"&&n.certificate_id&&e.jsx("button",{onClick:async s=>{var o,c;if(s.stopPropagation(),!!await A({title:"Revoke Certificate",message:`Permanently revoke ${n.certificate_id} for ${n.organization_name}? This cannot be undone.`,danger:!0}))try{await b.patch(`/api/certificates/${n.certificate_id}/revoke`,null,{params:{reason:"Revoked by admin"}}),m.show("Certificate revoked","error"),_()}catch(g){m.show("Failed: "+(((c=(o=g.response)==null?void 0:o.data)==null?void 0:c.detail)||g.message),"error")}},className:"btn",style:{padding:"3px 8px",fontSize:"9px",fontFamily:"Consolas,monospace",letterSpacing:"1px",textTransform:"uppercase",color:"#D65C5C",borderColor:"rgba(214,92,92,0.3)"},children:"Revoke"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),w(null)},style:{background:"none",border:"none",color:"rgba(255,255,255,.50)",cursor:"pointer",fontSize:"18px",padding:"4px 8px"},children:"×"})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"12px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Last Heartbeat"}),e.jsxs("div",{style:{color:n.is_online?"#5CD685":"#D65C5C",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[n.is_online&&e.jsx("span",{style:{animation:"heartbeat 1.2s ease-in-out infinite",fontSize:"13px",color:"#D66A6A"},children:"♥"}),n.last_heartbeat_at?new Date(n.last_heartbeat_at).toLocaleString():n.last_activity?new Date(n.last_activity).toLocaleString():"-"]})]}),!n.is_online&&(()=>{const s=n.last_heartbeat_at||n.last_activity,o=s?Math.round((Date.now()-new Date(s).getTime())/36e5):null,c=o>72?"Connection lost — no heartbeat for "+o+"h":o>24?"Interlock unresponsive — offline "+o+"h (auto-suspend eligible)":o?"Heartbeat stopped "+o+"h ago":"No heartbeat received";return e.jsxs("div",{style:{gridColumn:"1 / -1",padding:"8px 12px",background:"rgba(214,92,92,0.06)",border:"1px solid rgba(214,92,92,0.15)",marginBottom:"4px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#D65C5C",fontFamily:"Consolas,monospace",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"⚠ Offline Reason"}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(255,255,255,.80)"},children:c})]})})(),!n.is_online&&e.jsxs("div",{style:{gridColumn:"1 / -1",padding:"8px 12px",background:"rgba(214,92,92,0.06)",border:"1px solid rgba(214,92,92,0.15)",marginBottom:"4px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#D65C5C",fontFamily:"Consolas,monospace",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Offline Reason"}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(255,255,255,.80)"},children:n.offline_reason||(()=>{const s=n.last_heartbeat_at||n.last_activity,o=s?Math.round((Date.now()-new Date(s).getTime())/36e5):null;return o>72?"Connection lost - no heartbeat for "+o+"h":o>24?"Interlock unresponsive - offline "+o+"h":o?"Heartbeat stopped "+o+"h ago":"No heartbeat received"})()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Started"}),e.jsx("div",{style:{color:"rgba(255,255,255,.94)",fontSize:"12px"},children:n.started_at?new Date(n.started_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Uptime"}),e.jsxs("div",{style:{color:"rgba(255,255,255,.94)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"16px"},children:[((l=n.uptime_hours)==null?void 0:l.toFixed(1))||"0","h"]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Passed"}),e.jsx("div",{style:{color:"#5CD685",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"16px"},children:(n.pass_count||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Blocked"}),e.jsx("div",{style:{color:"#D65C5C",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"16px"},children:(n.block_count||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Pass Rate"}),(()=>{const s=(n.pass_count||0)+(n.block_count||0),o=s>0?n.pass_count/s*100:0;return e.jsxs("div",{style:{color:o>=99?"#5CD685":o>=95?"#D6A05C":"#D65C5C",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"16px"},children:[o.toFixed(1),"%"]})})()]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"4px"},children:"Certificate"}),e.jsx("div",{style:{color:"#a896d6",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px"},children:n.certificate_id?e.jsx("a",{href:"/verify?cert="+n.certificate_id,style:{color:"#a896d6",textDecoration:"none"},children:n.certificate_id}):"-"})]})]}),(()=>{const s=(n.pass_count||0)+(n.block_count||0);if(s===0)return null;const o=n.pass_count/s*100;return e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Enforcement Distribution"}),e.jsxs("div",{style:{height:"8px",background:"rgba(255,255,255,0.06)",overflow:"hidden",display:"flex"},children:[e.jsx("div",{style:{width:o+"%",background:"#5CD685"}}),e.jsx("div",{style:{width:100-o+"%",background:"#D65C5C"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"10px"},children:[e.jsxs("span",{style:{color:"#5CD685"},children:["Pass: ",o.toFixed(1),"%"]}),e.jsxs("span",{style:{color:"#D65C5C"},children:["Block: ",(100-o).toFixed(1),"%"]})]})]})})(),e.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"20px"},children:[e.jsx("button",{onClick:async s=>{s.stopPropagation();try{const c=(a==null?void 0:a.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",y=(await b.get(c+n.session_id+"/telemetry")).data.records||[];if(y.length===0){m.show("No telemetry data yet","info");return}const h=["timestamp","action_id","action_type","result","execution_time_ms"],N=[h.join(","),...y.map(E=>h.map($=>JSON.stringify(E[$]??"")).join(","))].join(`
`),O=new Blob([N],{type:"text/csv"}),v=document.createElement("a");v.href=URL.createObjectURL(O),v.download="telemetry-"+n.session_id+".csv",v.click()}catch{m.show("Failed to download telemetry","error")}},className:"btn",style:{fontSize:"11px",padding:"6px 12px"},children:"↓ Telemetry CSV"}),e.jsx("button",{onClick:async s=>{s.stopPropagation();try{const c=(a==null?void 0:a.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",y=(await b.get(c+n.session_id+"/violations")).data.violations||[];if(y.length===0){m.show("No violations recorded","info");return}const h=["timestamp","boundary_name","violation_message"],N=[h.join(","),...y.map(E=>h.map($=>JSON.stringify(E[$]??"")).join(","))].join(`
`),O=new Blob([N],{type:"text/csv"}),v=document.createElement("a");v.href=URL.createObjectURL(O),v.download="violations-"+n.session_id+".csv",v.click()}catch{m.show("Failed to download violations","error")}},className:"btn",style:{fontSize:"11px",padding:"6px 12px"},children:"↓ Violations CSV"}),e.jsx("button",{onClick:async s=>{s.stopPropagation();try{const c=(a==null?void 0:a.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",g=await b.get(c+n.session_id+"/report",{responseType:"blob"}),y=new Blob([g.data],{type:"application/pdf"}),h=document.createElement("a");h.href=URL.createObjectURL(y),h.download="CAT72-Report-"+n.session_id+".pdf",h.click()}catch{m.show("Failed to download report","error")}},className:"btn",style:{fontSize:"11px",padding:"6px 12px"},children:"↓ CAT-72 Report PDF"})]}),T.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"rgba(255,255,255,.50)",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"8px"},children:"24-Hour Activity"}),e.jsx("div",{style:{display:"flex",gap:"2px",height:"40px",alignItems:"flex-end"},children:T.map((s,o)=>{const c=Math.max(...T.map(h=>h.total),1),g=s.total/c*100,y=s.total>0?s.pass/s.total:1;return e.jsx("div",{style:{flex:1,height:Math.max(g,2)+"%",background:y>=.99?"#5CD685":y>=.95?"#D6A05C":"#D65C5C",opacity:.8},title:new Date(s.hour).toLocaleTimeString()+": "+s.total+" actions"},o)})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"10px",color:"rgba(255,255,255,.50)"},children:[e.jsx("span",{children:"24h ago"}),e.jsx("span",{children:"Now"})]})]})]})})})]})})})]})})]}),e.jsx(pe,{page:I,pages:ee,onChange:P}),"    "]})}function pe({page:x,pages:C,onChange:j}){return C<=1?null:e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"16px 0"},children:[e.jsx("button",{disabled:x<=1,onClick:()=>j(x-1),className:"btn",style:{padding:"4px 12px",opacity:x<=1?.3:1},children:"Prev"}),e.jsxs("span",{style:{fontFamily:"Consolas, monospace",fontSize:"11px",color:"rgba(255,255,255,.60)"},children:["Page ",x," of ",C]}),e.jsx("button",{disabled:x>=C,onClick:()=>j(x+1),className:"btn",style:{padding:"4px 12px",opacity:x>=C?.3:1},children:"Next"})]})}const xe=()=>e.jsx("style",{children:"@keyframes heartbeat { 0%,100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.3); opacity: 1; } }"});export{he as default};
