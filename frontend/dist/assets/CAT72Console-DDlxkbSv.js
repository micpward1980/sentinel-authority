import{j as t,s as e,e as w,u as k,a as R,A as G,d as u}from"./index-CgfCCdr4.js";import{A as $,q as W,k as B,r as g,R as L}from"./icons-DCxkC3Ow.js";import{P as v}from"./Panel-D9-D5yaB.js";import"./vendor-DxYwK_Rn.js";const D=(m=[])=>{const n={total_exposure_seconds:0,successful_interventions:0,enforcement_failures:0,boundary_proximity_events:0,integrity_status:"VALIDATED"};let d=null;const p=5*60*1e3,x=m.map(s=>{d&&s.timestamp&&new Date(s.timestamp)-new Date(d)>p&&(n.integrity_status="INTEGRITY_COMPROMISED"),s.timestamp&&(d=s.timestamp),s.state==="autonomous"&&(n.total_exposure_seconds+=s.interval_duration||0);let c="NOMINAL",o="NOMINAL";return s.boundary_hit?s.interlock_action==="BLOCK"||s.interlock_action==="HALT"?(c="INTERVENTION",o="SUCCESS",n.successful_interventions++):(c="EXCEEDANCE",o="FAILURE",n.enforcement_failures++):s.proximity>.9&&(c="PROXIMITY_ALERT",o="WARNING",n.boundary_proximity_events++),{...s,classification:c,intent:o,timestamp:s.timestamp||new Date().toISOString()}});return{summary:n,logs:x,conformance_score:n.enforcement_failures===0&&n.integrity_status==="VALIDATED"?100:0}},S={padding:"12px 16px",fontSize:"10px",fontWeight:700,color:"#666666",textAlign:"left",letterSpacing:"1px",textTransform:"uppercase",fontFamily:e.mono,background:"#f3f3f3",borderBottom:"2px solid #dddbda",whiteSpace:"nowrap"},y={padding:"11px 16px",fontSize:"13px",color:e.textPrimary,borderBottom:`1px solid ${e.borderSubtle}`,verticalAlign:"middle"};function P({logs:m=[],certNumber:n,nodeId:d="0847"}){const{summary:p,logs:x,conformance_score:s}=D(m),c=p.integrity_status==="VALIDATED";return t.jsxs("div",{style:{background:"#ffffff",border:`1px solid ${e.borderGlass}`,borderRadius:4,boxShadow:"0 2px 2px 0 rgba(0,0,0,0.05)",overflow:"hidden"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",borderBottom:`1px solid ${e.borderGlass}`,background:"#ffffff"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx($,{size:16,color:e.purplePrimary}),t.jsx("span",{style:{fontSize:13,fontWeight:700,color:e.textPrimary,letterSpacing:"0.3px"},children:"CAT-72 ENFORCEMENT LOG"})]}),t.jsxs("div",{style:{fontFamily:e.mono,fontSize:10,color:c?e.accentGreen:e.accentRed,fontWeight:700},children:["BLOCK_INTEGRITY: ",c?"VERIFIED":"COMPROMISED"]})]}),t.jsx("div",{style:{display:"flex",gap:0,borderBottom:`1px solid ${e.borderGlass}`,background:"#fafafa"},children:[{label:"Interventions",value:p.successful_interventions,color:e.accentGreen,tooltip:"High counts provide increased statistical confidence in ENVELO enforcement persistence"},{label:"Proximity Alerts",value:p.boundary_proximity_events,color:e.accentAmber},{label:"Enforcement Failures",value:p.enforcement_failures,color:e.accentRed},{label:"Conformance Score",value:s+"%",color:s===100?e.accentGreen:e.accentRed}].map((o,f)=>t.jsxs("div",{title:o.tooltip||"",style:{flex:1,padding:"10px 16px",borderRight:f<3?`1px solid ${e.borderGlass}`:"none",cursor:o.tooltip?"help":"default"},children:[t.jsx("div",{style:{fontFamily:e.mono,fontSize:10,color:"#666666",textTransform:"uppercase",letterSpacing:"0.8px",marginBottom:4},children:o.label}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:18,fontWeight:700,color:o.color},children:o.value})]},f))}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:S,children:"Timestamp"}),t.jsx("th",{style:S,children:"Event Type"}),t.jsx("th",{style:S,children:"ODD Parameter"}),t.jsx("th",{style:S,children:"Enforcement Action"}),t.jsx("th",{style:{...S,textAlign:"right"},children:"Verdict"})]})}),t.jsx("tbody",{children:x.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:5,style:{...y,textAlign:"center",color:e.textDim,fontStyle:"italic"},children:"No telemetry events recorded"})}):x.map((o,f)=>{var j;return t.jsxs("tr",{style:{background:o.intent==="FAILURE"?"rgba(234,0,27,0.02)":"transparent"},children:[t.jsx("td",{style:{...y,fontFamily:e.mono,fontSize:11,color:e.textTertiary},children:o.timestamp?((j=o.timestamp.split("T")[1])==null?void 0:j.split(".")[0])+"Z":"--"}),t.jsx("td",{style:{...y,fontWeight:600,fontSize:12},children:o.event_name||o.classification}),t.jsx("td",{style:{...y,fontFamily:e.mono,fontSize:11,color:e.textTertiary},children:o.parameter||"--"}),t.jsx("td",{style:y,children:t.jsx("span",{style:{display:"inline-block",fontSize:10,fontWeight:700,fontFamily:e.mono,padding:"2px 8px",borderRadius:2,background:o.intent==="SUCCESS"?"rgba(46,132,74,0.09)":"#f3f3f3",color:o.intent==="SUCCESS"?e.accentGreen:"#666666",border:`1px solid ${o.intent==="SUCCESS"?"rgba(46,132,74,0.22)":e.borderGlass}`},children:o.interlock_action||"LOG_ONLY"})}),t.jsx("td",{style:{...y,textAlign:"right"},children:o.intent==="SUCCESS"?t.jsxs("span",{style:{color:e.accentGreen,display:"inline-flex",alignItems:"center",gap:4,fontSize:10,fontWeight:700,fontFamily:e.mono},children:[t.jsx(W,{size:13})," PASS"]}):o.intent==="FAILURE"?t.jsxs("span",{style:{color:e.accentRed,display:"inline-flex",alignItems:"center",gap:4,fontSize:10,fontWeight:700,fontFamily:e.mono},children:[t.jsx(B,{size:13})," FAIL"]}):t.jsx("span",{style:{color:"#aaaaaa",fontSize:10,fontFamily:e.mono},children:"NOMINAL"})})]},f)})})]})}),t.jsxs("div",{style:{padding:"10px 16px",borderTop:`1px solid ${e.borderGlass}`,background:"#fafafa",fontFamily:e.mono,fontSize:10,color:"#888888",letterSpacing:"0.3px"},children:["ATTESTATION: Sentinel Authority Node #",d," verifies that the above enforcement events are cryptographically linked",n?` to Certificate ${n}`:" to the active CAT-72 session","."," ","INTEGRITY: ",p.integrity_status]})]})}function Y(){const m=w(),{user:n}=k(),[d,p]=g.useState([]),x=R(),[s,c]=g.useState({}),[o,f]=g.useState(Date.now()),[j,z]=g.useState({}),h=()=>{u.get("/api/cat72/tests").then(r=>{const l=Array.isArray(r.data)?r.data:[];p(l),l.filter(a=>a.state==="running").forEach(a=>{u.get(`/api/cat72/tests/${a.test_id}/telemetry?limit=50`).then(i=>z(E=>{var F;return{...E,[a.test_id]:((F=i.data)==null?void 0:F.logs)||[]}})).catch(()=>{})})}).catch(console.error)};g.useEffect(()=>{h();const r=setInterval(h,15e3),l=setInterval(()=>f(Date.now()),1e3);return()=>{clearInterval(r),clearInterval(l)}},[]);const C=async r=>{var l,a;if(await m({title:"Start Test",message:"Start this CAT-72 test? The 72-hour timer will begin."})){c(i=>({...i,[r]:"starting"}));try{await u.post(`/api/cat72/tests/${r}/start`),h()}catch(i){x.show("Failed to start test: "+(((a=(l=i.response)==null?void 0:l.data)==null?void 0:a.detail)||i.message),"error")}c(i=>({...i,[r]:null}))}},N=async r=>{var l,a;if(await m({title:"Stop Test",message:"Stop this CAT-72 test and evaluate results?"})){c(i=>({...i,[r]:"stopping"}));try{await u.post(`/api/cat72/tests/${r}/stop`),h()}catch(i){x.show("Failed to stop test: "+(((a=(l=i.response)==null?void 0:l.data)==null?void 0:a.detail)||i.message),"error")}c(i=>({...i,[r]:null}))}},I=async r=>{var l,a;if(await m({title:"Issue Certificate",message:"Issue ODDC certificate for this passed test?"})){c(i=>({...i,[r]:"issuing"}));try{const i=await u.post(`/api/certificates/issue/${r}`);x.show(`Certificate issued: ${i.data.certificate_number}`,"success"),h()}catch(i){x.show("Failed to issue certificate: "+(((a=(l=i.response)==null?void 0:l.data)==null?void 0:a.detail)||i.message),"error")}c(i=>({...i,[r]:null}))}},T=r=>{const l=Math.floor(r/3600),a=Math.floor(r%3600/60),i=Math.floor(r%60);return`${String(l).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(i).padStart(2,"0")}`},_=d.filter(r=>r.state==="running"),A=d.filter(r=>r.state==="scheduled"),b=d.filter(r=>r.state==="completed");return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("p",{style:{fontFamily:e.mono,fontSize:"10px",fontWeight:600,letterSpacing:"0.20em",textTransform:"uppercase",color:e.purpleBright,margin:"0 0 8px 0"},children:"Testing"}),t.jsx("h1",{style:{fontFamily:e.serif,fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0,color:e.textPrimary},children:"CAT-72 Console"}),t.jsx("p",{style:{color:e.textSecondary,marginTop:"8px"},children:(n==null?void 0:n.role)==="admin"?"72-hour Convergence Authorization Tests · Auto-refreshes every 15s":"Monitor your 72-hour conformance test in real time"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px"},children:[t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.accentAmber},children:_.length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Running"})]}),t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.purpleBright},children:A.length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Scheduled"})]}),t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.accentGreen},children:b.filter(r=>r.result==="PASS").length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Passed"})]}),t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.accentRed},children:b.filter(r=>r.result==="FAIL").length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Failed"})]})]}),_.length>0&&t.jsxs("div",{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.accentAmber,marginBottom:"12px"},children:"● Live Tests"}),t.jsx("div",{className:"space-y-4",children:_.map(r=>{const l=r.duration_hours*3600,a=Math.min(100,Math.round(r.elapsed_seconds/l*100)),i=Math.max(0,l-r.elapsed_seconds);return t.jsxs(L.Fragment,{children:[t.jsxs(v,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:500,fontSize:"16px",color:e.textPrimary,marginBottom:"4px"},children:[r.organization_name," — ",r.system_name]}),t.jsxs("div",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:["Test ID: ",r.test_id," · Duration: ",r.duration_hours,"h"]})]}),(n==null?void 0:n.role)==="admin"&&t.jsx("button",{onClick:()=>N(r.test_id),disabled:s[r.test_id],className:"px-4 py-2",style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:8},children:s[r.test_id]==="stopping"?"...":"Stop & Evaluate"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"8px"},children:[t.jsx("div",{style:{fontFamily:e.mono,fontSize:"clamp(20px, 4vw, 28px)",fontWeight:200,color:e.purpleBright,letterSpacing:"2px"},children:T(r.elapsed_seconds)}),t.jsx("div",{style:{flex:1},children:t.jsx("div",{className:"w-full h-3 overflow-hidden",style:{background:"transparent"},children:t.jsx("div",{className:"h-full transition-all",style:{width:`${a}%`,background:a>=100?e.accentGreen:e.purplePrimary}})})}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"14px",color:a>=100?e.accentGreen:e.textSecondary,fontWeight:500},children:[a,"%"]})]}),t.jsxs("div",{style:{display:"flex",gap:"24px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary},children:["Remaining: ",T(i)]}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary},children:["Telemetry: ",r.telemetry_count||0," events"]}),t.jsx("span",{style:{fontFamily:e.mono,fontSize:"10px",color:r.violations_count>0?e.accentAmber:e.textTertiary},children:(r.violations_count||0)>0?`✓ ${r.violations_count} interventions`:"0 boundary events"})]})]},r.id),t.jsx(P,{logs:j[r.test_id]||[],certNumber:r.certificate_number,nodeId:"0847"})]},r.id)})})]}),A.length>0&&t.jsxs(v,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Scheduled"}),t.jsx("div",{className:"space-y-3",children:A.map(r=>t.jsxs("div",{style:{padding:"14px 16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:500,color:e.textPrimary,marginBottom:"2px"},children:[r.organization_name," — ",r.system_name]}),t.jsxs("div",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[r.test_id," · ",r.duration_hours,"h test"]})]}),(n==null?void 0:n.role)==="admin"&&t.jsx("button",{onClick:()=>C(r.test_id),disabled:s[r.test_id],className:"px-4 py-2",style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentGreen,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:8},children:s[r.test_id]==="starting"?"...":"Start Test"})]},r.id))})]}),b.length>0&&t.jsxs(v,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Completed"}),t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:`1px solid ${e.borderGlass}`},children:[t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"System"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Result"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Duration"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Actions"})]})}),t.jsx("tbody",{children:b.map(r=>t.jsxs("tr",{style:{borderBottom:`1px solid ${e.borderGlass}`},children:[t.jsxs("td",{className:"px-4 py-4",children:[t.jsxs("div",{style:{fontWeight:500,color:e.textPrimary},children:[r.organization_name," — ",r.system_name]}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary,marginTop:"2px"},children:r.test_id})]}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("span",{style:{fontFamily:e.mono,fontSize:"12px",fontWeight:500,color:r.result==="PASS"?e.accentGreen:e.accentRed,padding:"4px 10px",background:r.result==="PASS"?"rgba(22,135,62,0.06)":"rgba(180,52,52,0.06)"},children:r.result})}),t.jsx("td",{className:"px-4 py-4",style:{fontFamily:e.mono,fontSize:"12px",color:e.textSecondary},children:T(r.elapsed_seconds)}),t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{className:"flex gap-2",children:[(n==null?void 0:n.role)==="admin"&&r.result==="PASS"&&!r.certificate_issued&&t.jsx("button",{onClick:()=>I(r.test_id),disabled:s[r.test_id],className:"px-3 py-1",style:{background:"transparent",border:"none",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:s[r.test_id]==="issuing"?"...":"Issue Certificate"}),r.certificate_issued&&t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{color:e.accentGreen,fontFamily:e.mono,fontSize:"10px"},children:"✓ Certified"}),t.jsx("a",{href:`${G}/api/certificates/${r.certificate_number||r.test_id}/pdf`,target:"_blank",rel:"noreferrer noopener",style:{marginLeft:"8px",padding:"2px 0",background:"transparent",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"9px",textDecoration:"none"},children:"PDF"})]})]})})]},r.id))})]})]}),d.length===0&&t.jsx(v,{children:t.jsxs("div",{className:"text-center py-12",style:{color:e.textTertiary},children:[t.jsx("p",{style:{marginBottom:"8px"},children:(n==null?void 0:n.role)==="admin"?"No tests yet":"No active tests"}),t.jsx("p",{style:{fontSize:"13px"},children:(n==null?void 0:n.role)==="admin"?"Approve an application and schedule a CAT-72 test to get started.":"When your application is approved and a CAT-72 test is scheduled, you can monitor its progress here in real time."})]})})]})}export{Y as default};
