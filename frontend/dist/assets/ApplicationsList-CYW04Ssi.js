import{j as t,b as I,a as W,u as R,L as A,d as S}from"./index-uTJ6pxJc.js";import{R as E,r as l,j as L,F as O}from"./icons-DL0PQMVt.js";import{P as Q}from"./Panel-B27QNSqs.js";import"./vendor-DYB3FAiG.js";function G({icon:i,title:a,message:g,description:y,action:h}){const f=g||y;return t.jsxs("div",{style:{textAlign:"center",padding:"48px 20px",fontFamily:"var(--mono)"},children:[i&&t.jsx("div",{style:{marginBottom:"16px",opacity:.4,display:"flex",justifyContent:"center"},children:E.isValidElement(i)?i:t.jsx(i,{size:28,strokeWidth:1.5})}),a&&t.jsx("div",{style:{fontFamily:"var(--serif)",fontSize:"20px",fontWeight:"normal",color:"var(--text-secondary)",marginBottom:"8px"},children:a}),f&&t.jsx("div",{style:{fontSize:"12px",letterSpacing:"0.5px",color:"var(--text-tertiary)",maxWidth:"380px",margin:"0 auto",lineHeight:1.7},children:f}),h&&t.jsx("div",{style:{marginTop:"20px"},children:h})]})}function q(){const i=I(),{user:a}=W(),g=R(),[y,h]=l.useState([]),[f,B]=l.useState(0),[u,F]=l.useState({}),[c,P]=l.useState("all"),[C,D]=l.useState(""),[r,b]=l.useState(new Set),[d,N]=l.useState(!1),T=e=>b(o=>{const n=new Set(o);return n.has(e)?n.delete(e):n.add(e),n}),_=()=>b(new Set(p.map(e=>e.id))),M=()=>b(new Set),j=async(e,o)=>{var x,m;const n=[...r];if(n.length===0)return;const s=e==="delete"?`Delete ${n.length} application(s)?`:`${e} ${n.length} application(s)?`;if(await g({title:"Confirm",message:s})){N(!0);try{e==="delete"?await S.post("/api/applications/bulk-delete",{ids:n}):await S.post("/api/applications/bulk-state",{ids:n,new_state:o}),b(new Set),v()}catch(z){i.show("Bulk operation failed: "+(((m=(x=z.response)==null?void 0:x.data)==null?void 0:m.detail)||z.message),"error")}N(!1)}},v=(e="",o="all")=>{const n={};e&&(n.search=e),o&&o!=="all"&&(n.state=o),S.get("/api/applications/",{params:n}).then(s=>{h(s.data.applications||s.data),B(s.data.total??(s.data.applications||s.data).length),F(s.data.state_counts||{})}).catch(console.error)};l.useEffect(()=>{v()},[]),l.useEffect(()=>{const e=setTimeout(()=>{v(C,c)},300);return()=>clearTimeout(e)},[C,c]);const k=async(e,o,n)=>{var s,x;if(await g({title:"Confirm",message:n+"?"}))try{await S.patch(`/api/applications/${e}/state?new_state=${o}`),v()}catch(m){i.show("Failed: "+(((x=(s=m.response)==null?void 0:s.data)==null?void 0:x.detail)||m.message),"error")}},$=[{key:"all",label:"All"},{key:"pending",label:"Pending"},{key:"under_review",label:"Review"},{key:"approved",label:"Awaiting Deploy"},{key:"failed",label:"Failed"},{key:"rejected",label:"Rejected"}],p=y,w=e=>e==="conformant"?"#5CD685":e==="revoked"||e==="suspended"||e==="failed"||e==="rejected"?"#D65C5C":e==="testing"||e==="approved"?"#a896d6":"#D6A05C";return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex justify-between items-start",children:t.jsxs("div",{children:[t.jsxs("p",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"4px",textTransform:"uppercase",color:"#a896d6",marginBottom:"10px",display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{width:"24px",height:"1px",background:"#a896d6"}}),(a==null?void 0:a.role)==="admin"?"Conformance":"My Organization"]}),t.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 4vw, 32px)",fontWeight:200,margin:0,letterSpacing:"-0.02em",color:"rgba(255,255,255,.94)"},children:(a==null?void 0:a.role)==="admin"?"Applications":"Certification Status"})]})}),(a==null?void 0:a.role)==="admin"&&t.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"min(400px, 90vw)"},children:[t.jsx(L,{className:"w-4 h-4",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"rgba(255,255,255,.50)"}}),t.jsx("input",{value:C,onChange:e=>D(e.target.value),placeholder:"Search by name, org, or ID...",style:{width:"100%",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px 8px 36px",color:"rgba(255,255,255,.94)",fontSize:"13px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",outline:"none"}})]}),t.jsxs("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[p.length," of ",f]})]}),(a==null?void 0:a.role)==="admin"&&t.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:$.map(e=>{const o=e.key==="all"?u.all||0:e.key==="revoked"?(u.suspended||0)+(u.revoked||0):u[e.key]||0;return t.jsxs("button",{onClick:()=>P(e.key),style:{padding:"6px 14px",cursor:"pointer",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",background:c===e.key?"rgba(157,140,207,0.2)":"rgba(255,255,255,0.03)",border:`1px solid ${c===e.key?"#a896d6":"rgba(255,255,255,.07)"}`,color:c===e.key?"#a896d6":"rgba(255,255,255,.50)"},children:[e.label," ",o>0?`(${o})`:""]},e.key)})}),t.jsxs(Q,{children:[t.jsx("div",{style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:t.jsxs("table",{className:"w-full",style:{minWidth:"700px"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[(a==null?void 0:a.role)==="admin"&&t.jsx("th",{className:"px-2 py-3 text-center",style:{width:"40px"},children:t.jsx("input",{type:"checkbox",checked:r.size>0&&r.size===p.length,onChange:e=>e.target.checked?_():M(),style:{cursor:"pointer",accentColor:"#a896d6"}})}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"System Name"}),(a==null?void 0:a.role)==="admin"&&t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Organization"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"State"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Submitted"}),(a==null?void 0:a.role)==="admin"&&t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Actions"})]})}),t.jsx("tbody",{children:p.map(e=>{var o;return t.jsxs("tr",{className:"transition-colors",style:{borderBottom:"1px solid rgba(255,255,255,.07)",background:r.has(e.id)?"rgba(157,140,207,0.08)":"transparent"},children:[(a==null?void 0:a.role)==="admin"&&t.jsx("td",{className:"px-2 py-4 text-center",children:t.jsx("input",{type:"checkbox",checked:r.has(e.id),onChange:()=>T(e.id),style:{cursor:"pointer",accentColor:"#a896d6"}})}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsx(A,{to:`/applications/${e.id}`,style:{color:"#a896d6",textDecoration:"none"},children:e.system_name}),t.jsx("div",{style:{fontSize:"11px",color:"rgba(255,255,255,.50)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",marginTop:"2px"},children:e.application_number})]}),(a==null?void 0:a.role)==="admin"&&t.jsx("td",{className:"px-4 py-4",style:{color:"rgba(255,255,255,.78)"},children:e.organization_name}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("span",{className:"px-2 py-1",style:{background:`${w(e.state)}06`,color:w(e.state),border:`1px solid ${w(e.state)}10`,fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:e.state==="approved"?"Awaiting Deploy":e.state==="conformant"?"Certified":e.state==="testing"?"CAT-72 Active":e.state==="under_review"?"In Review":(o=e.state)==null?void 0:o.replace("_"," ")})}),t.jsx("td",{className:"px-4 py-4",style:{color:"rgba(255,255,255,.50)",fontSize:"14px"},children:e.submitted_at?new Date(e.submitted_at).toLocaleDateString():"N/A"}),(a==null?void 0:a.role)==="admin"&&t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.state==="pending"&&t.jsx("button",{onClick:n=>{n.stopPropagation(),k(e.id,"under_review",`Begin review for ${e.system_name}`)},className:"btn",style:{padding:"4px 10px",color:"#D6A05C"},children:"Review"}),(e.state==="pending"||e.state==="under_review")&&t.jsx("button",{onClick:n=>{n.stopPropagation(),k(e.id,"approved",`Approve ${e.system_name}`)},className:"btn",style:{padding:"4px 10px",color:"#5CD685"},children:"Approve"}),e.state==="approved"&&t.jsx(A,{to:`/applications/${e.id}`,className:"px-2 py-1 no-underline btn",children:"Schedule CAT-72"}),["pending","under_review","approved"].includes(e.state)&&t.jsx("button",{onClick:n=>{n.stopPropagation(),k(e.id,"suspended",`Suspend ${e.system_name}`)},className:"btn",style:{padding:"4px 10px",color:"#D65C5C"},children:"Withdraw"})]})})]},e.id)})})]})}),r.size>0&&(a==null?void 0:a.role)==="admin"&&t.jsxs("div",{style:{position:"sticky",bottom:"16px",zIndex:50,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",padding:"12px 20px",margin:"16px",background:"rgba(18,12,30,0.95)",border:"1px solid #a896d6"},children:[t.jsxs("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",color:"#a896d6"},children:[r.size," selected"]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[t.jsx("button",{onClick:()=>j("approve","approved"),disabled:d,className:"btn",style:{padding:"6px 14px",color:"var(--accent-green)"},children:"Approve"}),t.jsx("button",{onClick:()=>j("review","under_review"),disabled:d,className:"btn",style:{padding:"6px 14px",color:"#D6A05C"},children:"Review"}),t.jsx("button",{onClick:()=>j("withdraw","suspended"),disabled:d,className:"btn",style:{padding:"6px 14px",color:"#D65C5C"},children:"Withdraw"}),t.jsx("div",{style:{width:"1px",height:"20px",background:"rgba(255,255,255,.07)",margin:"0 4px"}}),t.jsx("button",{onClick:()=>j("delete"),disabled:d,className:"btn",style:{padding:"6px 14px",color:"#D65C5C"},children:"Delete"}),t.jsx("button",{onClick:M,className:"btn",children:"Cancel"}),d&&t.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)"},children:"Processing..."})]})]}),p.length===0&&t.jsx(G,{icon:O,title:"No Applications Found",description:y.length===0?"No ODDC certification applications submitted yet.":"No applications match your current filter."})]})]})}export{q as default};
