import{b as J,d as m,j as t}from"./index-BSEmsdEo.js";import{r as o}from"./icons-DL0PQMVt.js";import{P as k}from"./Panel-SsB0PYs3.js";import{S as K}from"./SectionHeader-DfvzKBAI.js";import"./vendor-DYB3FAiG.js";function re(){const u=J(),[v,z]=o.useState([]),[I,B]=o.useState(0),[A,w]=o.useState(!0),[i,T]=o.useState(""),[p,_]=o.useState(""),[d,D]=o.useState(""),[a,n]=o.useState(0),[c,y]=o.useState(""),[x,h]=o.useState(""),[r,R]=o.useState(null),[b,F]=o.useState(!1),[S,j]=o.useState("30"),$=e=>{if(j(e),n(0),e==="all")y(""),h("");else{const s=new Date;s.setDate(s.getDate()-parseInt(e)),y(s.toISOString().split("T")[0]),h("")}},L=async()=>{F(!0);try{const e=await m.get("/api/audit/verify?limit=5000");R(e.data),u.show(e.data.integrity==="passed"?`Integrity verified — ${e.data.valid} entries valid`:`Integrity check FAILED — ${e.data.invalid} tampered entries`,e.data.integrity==="passed"?"success":"error")}catch{u.show("Verification failed","error")}F(!1)},[E,O]=o.useState([]),[V,U]=o.useState([]),M=50;o.useEffect(()=>{m.get("/api/audit/actions").then(e=>O(e.data.actions||[])).catch(()=>{}),m.get("/api/audit/resource-types").then(e=>U(e.data.resource_types||[])).catch(()=>{})},[]);const W=async()=>{w(!0);try{const e=new URLSearchParams;i&&e.set("action",i),p&&e.set("resource_type",p),d&&e.set("user_email",d),c&&e.set("date_from",new Date(c).toISOString()),x&&e.set("date_to",new Date(x+"T23:59:59").toISOString()),e.set("limit",M),e.set("offset",a*M);const s=await m.get(`/api/audit/logs?${e}`);z(s.data.logs||[]),B(s.data.total||0)}catch(e){console.error("Failed to load audit logs:",e)}w(!1)},N=async()=>{try{const e=new URLSearchParams;i&&e.set("action",i),p&&e.set("resource_type",p),d&&e.set("user_email",d),c&&e.set("date_from",new Date(c).toISOString()),x&&e.set("date_to",new Date(x+"T23:59:59").toISOString()),e.set("limit",1e4),e.set("offset",0);const f=(await m.get(`/api/audit/logs?${e}`)).data.logs||[];if(f.length===0){u.show("No entries to export","warning");return}const Q=["Timestamp,User,Action,Resource Type,Resource ID,Details,Hash",...f.map(l=>{const G=l.details?Object.entries(l.details).map(([X,Z])=>X+"="+Z).join("; "):"";return[l.timestamp||"",l.user_email||"",l.action||"",l.resource_type||"",l.resource_id||"",'"'+G.replace(/"/g,'""')+'"',l.log_hash||""].join(",")})].join(`
`),q=new Blob([Q],{type:"text/csv"}),P=URL.createObjectURL(q),C=document.createElement("a");C.href=P,C.download="audit-log-"+new Date().toISOString().split("T")[0]+".csv",C.click(),URL.revokeObjectURL(P),u.show("CSV exported ("+f.length+" entries)","success")}catch{u.show("Export failed","error")}};o.useEffect(()=>{W()},[i,p,d,c,x,a]);const H=e=>e!=null&&e.includes("issued")||e!=null&&e.includes("approved")||e!=null&&e.includes("conformant")?"#5CD685":e!=null&&e.includes("suspended")||e!=null&&e.includes("revoked")||e!=null&&e.includes("failed")?"#D65C5C":e!=null&&e.includes("pending")||e!=null&&e.includes("under_review")?"#D6A05C":"#a896d6",g=Math.ceil(I/M);return t.jsxs("div",{className:"space-y-6",children:[t.jsx(K,{label:"Administration",title:"Activity History"}),t.jsx(k,{children:t.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("select",{value:i,onChange:e=>{T(e.target.value),n(0)},style:{background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px",color:"rgba(255,255,255,.94)",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",minWidth:"180px"},children:[t.jsx("option",{value:"",children:"All Actions"}),E.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:p,onChange:e=>{_(e.target.value),n(0)},style:{background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px",color:"rgba(255,255,255,.94)",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",minWidth:"150px"},children:[t.jsx("option",{value:"",children:"All Resources"}),V.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx("input",{value:d,onChange:e=>{D(e.target.value),n(0)},placeholder:"Filter by email...",style:{background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px",color:"rgba(255,255,255,.94)",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",flex:1,minWidth:"150px"}}),["7","30","90","all"].map(e=>t.jsx("button",{onClick:()=>$(e),style:{padding:"5px 10px",background:S===e?"rgba(168,150,214,0.15)":"transparent",border:`1px solid ${S===e?"rgba(168,150,214,0.4)":"rgba(255,255,255,.07)"}`,color:S===e?"#a896d6":"rgba(255,255,255,.50)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",cursor:"pointer",letterSpacing:"0.5px",transition:"all 0.15s ease"},children:e==="all"?"All":e+"d"},e)),t.jsx("input",{type:"date",value:c,onChange:e=>{y(e.target.value),n(0),j("")},style:{background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px",color:"rgba(255,255,255,.94)",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",colorScheme:"dark"}}),t.jsx("span",{style:{fontSize:"11px",color:"rgba(255,255,255,.50)"},children:"to"}),t.jsx("input",{type:"date",value:x,onChange:e=>{h(e.target.value),n(0),j("")},style:{background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px",color:"rgba(255,255,255,.94)",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",colorScheme:"dark"}}),t.jsxs("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[I.toLocaleString()," entries"]}),t.jsx("button",{onClick:N,style:{padding:"6px 14px",background:"rgba(157,140,207,0.12)",border:"1px solid rgba(157,140,207,0.3)",color:"#a896d6",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase"},children:"Export CSV"}),t.jsx("button",{onClick:L,disabled:b,style:{padding:"6px 14px",background:r?r.integrity==="passed"?"rgba(92,214,133,0.12)":"rgba(214,92,92,0.12)":"rgba(157,140,207,0.12)",border:"1px solid "+(r?r.integrity==="passed"?"rgba(92,214,133,0.3)":"rgba(214,92,92,0.3)":"rgba(157,140,207,0.3)"),color:r?r.integrity==="passed"?"#5CD685":"#D65C5C":"#a896d6",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",cursor:b?"wait":"pointer",letterSpacing:"1px",textTransform:"uppercase"},children:b?"Verifying...":r?r.integrity==="passed"?`✓ ${r.valid} Verified`:`✗ ${r.invalid} Invalid`:"⛓ Verify Chain"})]})}),t.jsxs(k,{noPad:!0,children:[A?t.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:"rgba(255,255,255,.50)"},children:"Loading..."}):v.length===0?t.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:"rgba(255,255,255,.50)"},children:"No audit log entries found"}):t.jsx("div",{className:"table-scroll",style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"transparent"},children:[t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},children:"Timestamp"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},children:"User"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},children:"Action"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},children:"Resource"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},children:"Details"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"},children:"Hash"})]})}),t.jsx("tbody",{children:v.map(e=>t.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.04)"},children:[t.jsx("td",{style:{padding:"12px 16px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.78)",whiteSpace:"nowrap"},children:e.timestamp?new Date(e.timestamp).toLocaleString():"-"}),t.jsx("td",{style:{padding:"12px 16px",fontSize:"13px",color:"rgba(255,255,255,.94)"},children:e.user_email||"-"}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:H(e.action),letterSpacing:"0.5px"},children:e.action})}),t.jsxs("td",{style:{padding:"12px 16px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[e.resource_type,e.resource_id?` #${e.resource_id}`:""]}),t.jsx("td",{style:{padding:"12px 16px",fontSize:"12px",color:"rgba(255,255,255,.50)",maxWidth:"300px"},children:e.details?Object.entries(e.details).filter(([s])=>s!=="old_state").map(([s,f])=>t.jsxs("span",{style:{marginRight:"12px"},children:[t.jsxs("span",{style:{color:"rgba(255,255,255,.50)"},children:[s.replace(/_/g," "),":"]})," ",t.jsx("span",{style:{color:"rgba(255,255,255,.78)"},children:String(f)})]},s)):"-"}),t.jsx("td",{style:{padding:"12px 16px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",letterSpacing:"0.5px"},children:e.log_hash||"-"})]},e.id))})]})}),g>1&&t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"8px",padding:"16px",borderTop:"1px solid rgba(255,255,255,.04)"},children:[t.jsx("button",{onClick:()=>n(Math.max(0,a-1)),disabled:a===0,style:{padding:"6px 12px",background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",color:a===0?"rgba(255,255,255,.50)":"rgba(255,255,255,.94)",cursor:a===0?"not-allowed":"pointer",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px"},children:"← Prev"}),t.jsxs("span",{style:{padding:"6px 12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.78)"},children:[a+1," / ",g]}),t.jsx("button",{onClick:()=>n(Math.min(g-1,a+1)),disabled:a>=g-1,style:{padding:"6px 12px",background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",color:a>=g-1?"rgba(255,255,255,.50)":"rgba(255,255,255,.94)",cursor:a>=g-1?"not-allowed":"pointer",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px"},children:"Next →"})]})]})]})}export{re as default};
