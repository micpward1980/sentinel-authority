import{u as D,b as W,d as p,j as a,s as e}from"./index-BedPMBGb.js";import{r as d,P as q,n as H,U as J,i as O,m as X,X as B}from"./icons-BDb2Zpiz.js";import{P as T}from"./Panel-BxJjkWUN.js";import{S as K}from"./SectionHeader-Brkl_dpu.js";import{S as b}from"./StatCard-DaTHKwxY.js";import"./vendor-BY35fGmp.js";function ae(){const h=D(),c=W(),[x,S]=d.useState([]),[U,P]=d.useState(!0),[f,F]=d.useState(""),[G,j]=d.useState(!1),[v,m]=d.useState(null),[i,k]=d.useState(null),[n,u]=d.useState({email:"",full_name:"",company:"",role:"applicant"}),[w,C]=d.useState(!1);d.useEffect(()=>{g()},[]);const g=async()=>{try{const r=await p.get("/api/users/");S(r.data||[])}catch(r){console.log("Users API not available:",r),S([])}P(!1)},N=x.filter(r=>{var l,t,s;return((l=r.email)==null?void 0:l.toLowerCase().includes(f.toLowerCase()))||((t=r.full_name)==null?void 0:t.toLowerCase().includes(f.toLowerCase()))||((s=r.company)==null?void 0:s.toLowerCase().includes(f.toLowerCase()))}),y={total:x.length,admins:x.filter(r=>r.role==="admin").length,applicants:x.filter(r=>r.role==="applicant").length,pending:x.filter(r=>r.role==="pending").length,inactive:x.filter(r=>r.is_active===!1).length},I=async()=>{var r,l;if(!n.email||!n.full_name){c.show("Email and full name are required","warning");return}C(!0);try{const t=Math.random().toString(36).slice(-8)+"A1!";await p.post("/api/users/",{...n,password:t}),c.show("User created — share credentials securely","success"),j(!1),u({email:"",full_name:"",company:"",role:"applicant"}),g()}catch(t){c.show("Failed to create user: "+(((l=(r=t.response)==null?void 0:r.data)==null?void 0:l.detail)||t.message),"error")}C(!1)},R=async(r,l)=>{var t,s;if(await h({title:"Change Role",message:"Change user role to "+l.toUpperCase()+"?"}))try{await p.patch("/api/users/"+r,{role:l}),g(),m(null)}catch(o){c.show("Failed to update role: "+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.detail)||o.message),"error")}},_=async(r,l)=>{var s,o;const t=l?"deactivate":"activate";if(await h({title:t.charAt(0).toUpperCase()+t.slice(1),message:t.charAt(0).toUpperCase()+t.slice(1)+" this user?"}))try{await p.patch("/api/users/"+r,{is_active:!l}),g(),m(null)}catch(A){c.show("Failed to update user: "+(((o=(s=A.response)==null?void 0:s.data)==null?void 0:o.detail)||A.message),"error")}},z=async(r,l)=>{var t,s;if(await h({title:"Reset Password",message:"Reset password for "+l+"?"}))try{const o=Math.random().toString(36).slice(-8)+"A1!";await p.post("/api/users/"+r+"/reset-password"),c.show("Password reset — share credentials securely","success")}catch(o){c.show("Failed to reset password: "+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.detail)||o.message),"error")}},L=async(r,l)=>{var t,s;if(await h({title:"Approve User",message:"Approve "+l+" as an applicant?"}))try{await p.post("/api/users/"+r+"/approve"),g(),m(null)}catch(o){c.show("Failed to approve: "+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.detail)||o.message),"error")}},E=async(r,l)=>{var t,s;if(await h({title:"Reject User",message:"Reject "+l+"? Their account will be deactivated.",danger:!0}))try{await p.post("/api/users/"+r+"/reject"),g(),m(null)}catch(o){c.show("Failed to reject: "+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.detail)||o.message),"error")}},M=async(r,l)=>{var t,s;if(await h({title:"Delete User",message:"DELETE "+l+"? This cannot be undone.",danger:!0,confirmLabel:"Delete"}))try{await p.delete("/api/users/"+r),g(),m(null)}catch(o){c.show("Failed to delete user: "+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.detail)||o.message),"error")}};return a.jsxs("div",{className:"space-y-6",children:[a.jsx(K,{label:"Administration",title:"User Management",description:"Manage admin and applicant accounts",action:a.jsxs("button",{onClick:()=>j(!0),className:"px-4 py-2 flex items-center gap-2",style:{background:"transparent",border:"none",borderBottom:"1px solid "+e.purpleBright,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:[a.jsx(q,{className:"w-4 h-4"})," Invite User"]})}),a.jsxs("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))"},children:[a.jsx(b,{label:"Total Users",value:y.total,color:e.textPrimary}),a.jsx(b,{label:"Admins",value:y.admins,color:e.purpleBright}),a.jsx(b,{label:"Applicants",value:y.applicants,color:e.accentGreen}),a.jsx(b,{label:"Pending",value:y.pending,color:e.accentAmber}),a.jsx(b,{label:"Inactive",value:y.inactive,color:e.accentRed})]}),a.jsx(T,{children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(H,{className:"w-5 h-5",style:{color:e.textTertiary}}),a.jsx("input",{type:"text",placeholder:"Search by name, email, or company...",value:f,onChange:r=>F(r.target.value),className:"flex-1 px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]})}),a.jsx(T,{children:U?a.jsx("div",{style:{color:e.textTertiary,textAlign:"center",padding:"clamp(16px, 4vw, 40px)"},children:"Loading users..."}):N.length===0?a.jsxs("div",{style:{textAlign:"center",padding:"clamp(24px, 5vw, 60px)"},children:[a.jsx(J,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-12 h-12 mx-auto mb-4",style:{color:e.textTertiary}}),a.jsx("p",{style:{color:e.textSecondary,marginBottom:"8px"},children:"No users found"}),a.jsx("p",{style:{color:e.textTertiary,fontSize:"14px"},children:x.length===0?"The /api/users/ endpoint may not be configured.":"Try adjusting your search."})]}):a.jsx("div",{className:"space-y-2",children:N.map(r=>{var l,t;return a.jsxs("div",{style:{borderRadius:8,overflow:"hidden",border:"1px solid "+(v===(r.id||r.email)?e.purpleBright:e.borderGlass),transition:"border-color 0.2s"},children:[a.jsxs("div",{onClick:()=>{v===(r.id||r.email)?(m(null),k(null)):(m(r.id||r.email),k(r))},className:"flex items-center gap-4 p-4 cursor-pointer transition-all",style:{background:e.cardSurface},children:[a.jsx("div",{className:"w-10 h-10 flex items-center justify-center flex-shrink-0",style:{background:"transparent",color:e.purpleBright,fontWeight:"400"},children:((l=r.full_name)==null?void 0:l[0])||((t=r.email)==null?void 0:t[0])||"?"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{style:{color:e.textPrimary,fontWeight:"500"},children:r.full_name||"No Name"}),a.jsx("p",{style:{color:e.textTertiary,fontSize:"13px"},children:r.email}),r.company&&a.jsx("p",{style:{color:e.textTertiary,fontSize:"12px"},children:r.company})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"px-2 py-1 text-xs",style:{background:r.role==="admin"?"rgba(74,61,117,0.10)":r.role==="pending"?"rgba(158,110,18,0.10)":"rgba(0,0,0,0.04)",color:r.role==="admin"?e.purpleBright:r.role==="pending"?e.accentAmber:e.textTertiary,fontFamily:e.mono,textTransform:"uppercase"},children:r.role}),r.role==="pending"&&a.jsxs("div",{className:"flex gap-1",onClick:s=>s.stopPropagation(),children:[a.jsx("button",{onClick:()=>L(r.id,r.email),className:"px-2 py-1 text-xs",style:{background:"rgba(22,135,62,0.10)",color:e.accentGreen,border:"1px solid rgba(22,135,62,0.3)",cursor:"pointer"},children:"Approve"}),a.jsx("button",{onClick:()=>E(r.id,r.email),className:"px-2 py-1 text-xs",style:{background:e.cardSurface,color:e.accentRed,border:"1px solid "+e.borderSubtle,cursor:"pointer",borderRadius:8},children:"Reject"})]}),r.is_active===!1&&a.jsx("span",{className:"px-2 py-1 text-xs",style:{background:"transparent",color:e.accentRed},children:"Inactive"})]})]}),v===(r.id||r.email)&&i&&a.jsxs("div",{onClick:s=>s.stopPropagation(),style:{background:"rgba(74,61,117,0.03)",borderTop:"1px solid "+e.borderGlass,padding:"20px 24px"},children:[a.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[a.jsx("button",{onClick:()=>R(i.id,"applicant"),style:{flex:1,padding:"10px",background:i.role==="applicant"?"rgba(74,61,117,0.10)":"transparent",border:"1px solid "+(i.role==="applicant"?e.purpleBright:e.borderGlass),color:i.role==="applicant"?e.purpleBright:e.textTertiary,borderRadius:6,cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:"Applicant"}),a.jsx("button",{onClick:()=>R(i.id,"admin"),style:{flex:1,padding:"10px",background:i.role==="admin"?"rgba(74,61,117,0.10)":"transparent",border:"1px solid "+(i.role==="admin"?e.purpleBright:e.borderGlass),color:i.role==="admin"?e.purpleBright:e.textTertiary,borderRadius:6,cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:"Admin"})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[a.jsxs("button",{onClick:()=>z(i.id,i.email),style:{width:"100%",padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textSecondary,textAlign:"left",borderRadius:6,cursor:"pointer"},children:[a.jsx(O,{className:"w-4 h-4",style:{color:e.purpleBright}}),"Reset Password"]}),a.jsx("button",{onClick:()=>_(i.id,i.is_active!==!1),style:{width:"100%",padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:e.cardSurface,border:"1px solid "+e.borderGlass,color:i.is_active===!1?e.accentGreen:e.accentRed,textAlign:"left",borderRadius:6,cursor:"pointer"},children:i.is_active===!1?a.jsxs(a.Fragment,{children:[a.jsx(X,{className:"w-4 h-4"})," Activate Account"]}):a.jsxs(a.Fragment,{children:[a.jsx(B,{className:"w-4 h-4"})," Deactivate Account"]})}),a.jsxs("button",{onClick:()=>M(i.id,i.email),style:{width:"100%",padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentRed,textAlign:"left",borderRadius:6,cursor:"pointer"},children:[a.jsx(B,{className:"w-4 h-4"})," Delete User"]})]})]})]},r.id||r.email)})})}),G&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",style:{background:"rgba(0,0,0,0.4)"},children:a.jsxs("div",{className:"w-full max-w-md mx-4 p-6",style:{background:"rgba(255,255,255,0.96)",backdropFilter:e.frostModal,WebkitBackdropFilter:e.frostModal,border:"1px solid "+e.borderGlass,borderRadius:8},children:[a.jsx("h2",{style:{fontFamily:e.serif,color:e.textPrimary,fontSize:"20px",fontWeight:200,marginBottom:"24px",textAlign:"center"},children:"Invite New User"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Email *"}),a.jsx("input",{type:"email",value:n.email,onChange:r=>u({...n,email:r.target.value}),placeholder:"user@company.com",className:"w-full px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]}),a.jsxs("div",{children:[a.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Full Name *"}),a.jsx("input",{type:"text",value:n.full_name,onChange:r=>u({...n,full_name:r.target.value}),placeholder:"John Smith",className:"w-full px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]}),a.jsxs("div",{children:[a.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Company"}),a.jsx("input",{type:"text",value:n.company,onChange:r=>u({...n,company:r.target.value}),placeholder:"Company name",className:"w-full px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]}),a.jsxs("div",{children:[a.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Role"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>u({...n,role:"applicant"}),className:"flex-1 px-4 py-3",style:{background:n.role==="applicant"?"rgba(74,61,117,0.10)":"rgba(0,0,0,0.025)",border:"1px solid "+(n.role==="applicant"?e.purpleBright:e.borderGlass),color:n.role==="applicant"?e.purpleBright:e.textTertiary,borderRadius:8},children:"Applicant"}),a.jsx("button",{onClick:()=>u({...n,role:"admin"}),className:"flex-1 px-4 py-3",style:{background:n.role==="admin"?"rgba(74,61,117,0.10)":"rgba(0,0,0,0.025)",border:"1px solid "+(n.role==="admin"?e.purpleBright:e.borderGlass),color:n.role==="admin"?e.purpleBright:e.textTertiary,borderRadius:8},children:"Admin"})]})]})]}),a.jsxs("div",{className:"mt-6 space-y-3",children:[a.jsx("button",{onClick:I,disabled:w,className:"w-full px-4 py-3",style:{background:"transparent",border:"none",borderBottom:"1px solid "+e.purpleBright,color:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",opacity:w?.5:1},children:w?"Creating...":"Create Account"}),a.jsx("button",{onClick:()=>{j(!1),u({email:"",full_name:"",company:"",role:"applicant"})},className:"w-full px-4 py-3",style:{background:"transparent",border:"none",color:e.textTertiary},children:"Cancel"})]})]})})]})}export{ae as default};
