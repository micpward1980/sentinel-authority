import{u as Y,a as U,b as X,c as $,d as x,j as t,s as e,L as g,B as H,A as ne,e as ae}from"./index-DahDwAfW.js";import{r as d,F as oe,h as Q,A as K,W as Z,i as se,j as le,k as ce}from"./icons-DCxkC3Ow.js";import{P as C}from"./Panel-C7nTqE8Z.js";import{S as F}from"./StatCard-D0qRnuPC.js";import{E as de}from"./EmptyState-S4XDhXen.js";import"./vendor-DxYwK_Rn.js";function pe(){const{user:c}=Y();U();const f=X(),N=$(),[b,w]=d.useState([]),[j,P]=d.useState([]),[M,E]=d.useState(!0),[T,O]=d.useState(null),[m,V]=d.useState([]);d.useEffect(()=>{Promise.all([x.get("/api/applications/").catch(()=>({data:[]})),x.get("/api/certificates/").catch(()=>({data:[]})),x.get("/api/envelo/monitoring/overview").catch(()=>({data:null})),x.get("/api/audit/my-logs?limit=5&offset=0").catch(()=>({data:{logs:[]}}))]).then(([i,s,l,o])=>{w(i.data.applications||i.data||[]),P(s.data||[]),l.data&&O(l.data),V(o.data.logs||o.data||[]),E(!1)})},[]);const B=[{key:"pending",label:"Submitted"},{key:"under_review",label:"In Review"},{key:"approved",label:"Approved"},{key:"testing",label:"Testing"},{key:"conformant",label:"Conformant"}],J=i=>B.findIndex(s=>s.key===i),v=i=>{switch(i){case"pending":return"Awaiting review";case"under_review":return"Under evaluation";case"approved":return"Preparing CAT-72 test";case"testing":return"ENVELO Interlock test in progress";case"conformant":return"Certificate issued";case"revoked":return"Suspended — contact support";default:return"Pending"}},I=i=>i==="conformant"?e.accentGreen:i==="revoked"||i==="suspended"?e.accentRed:i==="testing"||i==="approved"?e.purpleBright:e.accentAmber,W=i=>{if(!i)return null;const s=Date.now()-new Date(i).getTime(),l=Math.floor(s/6e4);if(l<1)return"just now";if(l<60)return l+"m ago";const o=Math.floor(l/60);if(o<24)return o+"h ago";const y=Math.floor(o/24);return y<30?y+"d ago":new Date(i).toLocaleDateString()};return M?t.jsx("div",{style:{color:e.textTertiary,padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:"Loading…"}):t.jsxs("div",{className:"space-y-6",style:{maxWidth:"1000px",margin:"0 auto"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px"},children:t.jsxs("div",{children:[t.jsx("p",{style:{fontFamily:e.mono,fontSize:"10px",fontWeight:600,letterSpacing:"0.20em",textTransform:"uppercase",color:e.purpleBright,margin:"0 0 8px 0"},children:"ODDC Certification"}),t.jsxs("h1",{style:{fontFamily:e.serif,fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0,color:e.textPrimary},children:["Welcome",c!=null&&c.full_name?", "+c.full_name.split(" ")[0]:""]}),t.jsxs("p",{style:{color:e.textSecondary,marginTop:"8px"},children:[c!=null&&c.organization?c.organization+" · ":"","Track your certification progress and manage your systems."]})]})}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(${N?"140px":"200px"}, 1fr))`,gap:N?"10px":"16px"},children:[t.jsx(F,{onClick:()=>f("/applications"),label:"Applications",value:b.length,color:e.purpleBright,icon:t.jsx(oe,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.purpleBright}}),subtitle:b.filter(i=>i.state==="pending"||i.state==="under_review").length>0?b.filter(i=>i.state==="pending"||i.state==="under_review").length+" in review":null}),t.jsx(F,{onClick:()=>f("/certificates"),label:"Certificates",value:j.length,color:e.accentGreen,icon:t.jsx(Q,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.accentGreen}}),subtitle:j.filter(i=>i.state==="conformant").length>0?j.filter(i=>i.state==="conformant").length+" active":null}),t.jsx(F,{onClick:()=>f("/cat72"),label:"Active Tests",value:b.filter(i=>i.state==="testing").length,color:e.accentAmber,icon:t.jsx(K,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.accentAmber}})}),(()=>{var A;const s=((T==null?void 0:T.sessions)||[]).filter(u=>{const S=u.last_heartbeat_at||u.last_telemetry_at||u.last_activity||u.started_at;return u.status==="active"&&S&&Date.now()-new Date(S).getTime()<12e4}).length,l=((A=T==null?void 0:T.summary)==null?void 0:A.total)||0,o=l>0,y=o?s>0?e.accentGreen:e.accentAmber:e.textTertiary,p=o?s>0?s+" of "+l+" online":"All interlocks offline":"No active interlocks";return t.jsx(F,{onClick:()=>f("/monitoring"),label:"Live Interlocks",value:o?s:"—",color:y,icon:t.jsx(Z,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:y}}),subtitle:p})})()]}),t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Your Applications"}),b.length>0&&t.jsx(g,{to:"/applications",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none",letterSpacing:"1px"},children:"View All →"})]}),b.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"56px 20px"},children:[t.jsx("div",{style:{margin:"0 auto 20px",width:72,height:72},children:t.jsx(H,{size:72})}),t.jsx("p",{style:{color:e.textPrimary,fontSize:"17px",fontWeight:500,marginBottom:"8px",fontFamily:"Georgia, 'Source Serif 4', serif"},children:"Begin Your Certification"}),t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",maxWidth:"380px",margin:"0 auto 28px",lineHeight:"1.6"},children:"Submit your autonomous system for ODDC certification. The CAT-72 test verifies your system's ENVELO Interlock is enforcing ODD boundaries in real time across a continuous 72-hour window."}),t.jsx(g,{to:"/applications/new",style:{display:"inline-block",background:e.purplePrimary,color:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",padding:"12px 28px",borderRadius:"6px",textDecoration:"none",border:"none"},children:"+ New Application"})]}):t.jsx("div",{className:"space-y-4",children:b.map(i=>{var y;const s=J(i.state),l=["pending","under_review"].includes(i.state)&&i.updated_at,o=l?Math.floor((Date.now()-new Date(i.updated_at).getTime())/(1e3*60*60*24)):0;return t.jsx(g,{to:"/applications/"+i.id,style:{textDecoration:"none",display:"block"},children:t.jsxs("div",{style:{padding:"20px",background:e.cardSurface,border:"1px solid "+e.borderGlass,cursor:"pointer",transition:"border-color 0.2s"},onMouseEnter:p=>p.currentTarget.style.borderColor=e.purpleBright,onMouseLeave:p=>p.currentTarget.style.borderColor=e.borderGlass,children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500,color:e.textPrimary,fontSize:"15px",marginBottom:"4px"},children:i.system_name}),t.jsxs("div",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono},children:[i.application_number," · ",(y=i.system_type)==null?void 0:y.replace(/_/g," ")]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[t.jsx("span",{style:{fontSize:"12px",color:e.textTertiary},children:v(i.state)}),l&&o>3&&t.jsxs("span",{style:{fontSize:"11px",color:e.accentAmber,fontFamily:e.mono},children:[o,"d in queue"]}),t.jsx("span",{style:{padding:"4px 12px",fontSize:"10px",fontFamily:e.mono,textTransform:"uppercase",letterSpacing:"1px",background:I(i.state)+"06",color:I(i.state),border:"1px solid "+I(i.state)+"10"},children:i.state})]})]}),t.jsx("div",{style:{display:"flex",gap:"3px",height:"4px"},children:B.map((p,A)=>t.jsx("div",{style:{flex:1,background:A<=s?I(i.state):"rgba(0,0,0,0.05)"}},p.key))}),["pending","under_review"].includes(i.state)&&t.jsxs("div",{style:{marginTop:"12px",fontSize:"11px",color:e.textTertiary},children:["Questions about this review? ",t.jsx("a",{href:"mailto:review@sentinelauthority.org",style:{color:e.purpleBright,textDecoration:"none"},onClick:p=>p.stopPropagation(),children:"Contact your review officer →"})]})]})},i.id)})})]}),j.length===0?t.jsx(de,{icon:Q,title:"No Certificates Yet",description:"Certificates are issued after your system passes the 72-hour CAT-72 ENVELO Interlock conformance test. Submit an application to begin."}):t.jsxs(C,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Your Certificates"}),t.jsx("div",{className:"space-y-3",children:j.map(i=>t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",borderRadius:8},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500,color:e.accentGreen,marginBottom:"4px",fontFamily:e.mono,fontSize:"14px"},children:i.certificate_number}),t.jsxs("div",{style:{fontSize:"12px",color:e.textTertiary},children:["Issued: ",new Date(i.issued_at).toLocaleDateString(),i.expires_at?" · Expires: "+new Date(i.expires_at).toLocaleDateString():""]})]}),t.jsx("a",{href:ne+"/api/certificates/"+i.certificate_number+"/pdf",target:"_blank",rel:"noreferrer noopener",style:{padding:"8px 16px",background:"transparent",color:e.purpleBright,fontSize:"11px",fontFamily:e.mono,textDecoration:"none"},children:"Download PDF"})]},i.id))})]}),t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Recent Activity"}),t.jsx(g,{to:"/my-activity",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none",letterSpacing:"1px"},children:"View All →"})]}),m.length===0?t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",textAlign:"center",padding:"20px 0"},children:"No activity yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:m.map((i,s)=>{var u,S,z,R,L;const l={user_login:"Signed in",user_registered:"Account created",login_failed:"Failed login attempt",application_submitted:"Application submitted",application_state_changed:"Application status updated",application_deleted:"Application deleted",test_created:"CAT-72 test scheduled",test_started:"CAT-72 test started",test_completed:"CAT-72 test completed",certificate_issued:"Certificate issued",certificate_suspended:"Certificate suspended",certificate_revoked:"Certificate revoked",certificate_reinstated:"Certificate reinstated",api_key_created:"API key created",api_key_revoked:"API key revoked",password_changed:"Password changed",profile_updated:"Profile updated","2fa_enabled":"Two-factor authentication enabled","2fa_disabled":"Two-factor authentication disabled"},o={user_login:e.textTertiary,login_failed:e.accentRed,application_submitted:e.purpleBright,application_state_changed:e.accentAmber,test_created:e.purpleBright,test_started:e.accentAmber,test_completed:e.accentGreen,certificate_issued:e.accentGreen,certificate_suspended:e.accentAmber,certificate_revoked:e.accentRed,api_key_created:e.purpleBright,api_key_revoked:e.accentRed},y=l[i.action]||i.action.replace(/_/g," "),p=o[i.action]||e.textSecondary,A=((u=i.details)==null?void 0:u.system_name)||((S=i.details)==null?void 0:S.application_number)||((z=i.details)==null?void 0:z.test_id)||((R=i.details)==null?void 0:R.certificate_number)||((L=i.details)==null?void 0:L.key_name)||"";return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"10px 0",borderBottom:s<m.length-1?"1px solid "+e.borderSubtle:"none"},children:[t.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:p,flexShrink:0}}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textPrimary},children:y}),A&&t.jsx("span",{style:{fontSize:"12px",color:e.textTertiary,marginLeft:"8px"},children:A})]}),t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono,flexShrink:0},children:W(i.timestamp)})]},i.id||s)})})]})]})}function xe(){const{user:c}=Y(),f=U(),N=ae(),b=X(),w=$(),[j,P]=d.useState(null),[M,E]=d.useState([]),[T,O]=d.useState([]),[m,V]=d.useState([]),[B,J]=d.useState([]),[v,I]=d.useState(null),[W,i]=d.useState([]),[s,l]=d.useState(!1),[o,y]=d.useState(null),[p,A]=d.useState(""),u=r=>{r&&l(!0),x.get("/api/dashboard/stats").then(n=>P(n.data)).catch(console.error),x.get("/api/dashboard/recent-applications").then(n=>E(n.data)).catch(console.error),x.get("/api/dashboard/active-tests").then(n=>O(n.data)).catch(console.error),x.get("/api/applications/").then(n=>V(n.data.applications||n.data||[])).catch(console.error),x.get("/api/dashboard/recent-certificates").then(n=>J(n.data)).catch(console.error),x.get("/api/envelo/monitoring/overview").then(n=>I(n.data)).catch(console.error),x.get("/api/audit/admin-logs?limit=8&offset=0").then(n=>i(n.data.logs||n.data||[])).catch(console.error),r&&setTimeout(()=>l(!1),800)};d.useEffect(()=>{u();const r=setInterval(u,3e4);return()=>clearInterval(r)},[]);const S={pending:m.filter(r=>r.state==="pending").length,under_review:m.filter(r=>r.state==="under_review").length,approved:m.filter(r=>r.state==="approved").length,testing:m.filter(r=>r.state==="testing").length,conformant:m.filter(r=>r.state==="conformant").length,revoked:m.filter(r=>r.state==="revoked"||r.state==="suspended").length},z=m.filter(r=>r.state==="pending"||r.state==="under_review"),R=(r,n,a)=>{A(""),y({appId:r,newState:n,label:a})},L=async()=>{var h,_;if(!p.trim()){f.show("A justification note is required","error");return}const{appId:r,newState:n,label:a}=o;y(null);try{if(await x.patch("/api/applications/"+r+"/state?new_state="+n,{note:p}),n==="approved")try{await x.post("/api/apikeys/admin/provision",null,{params:{application_id:r,send_email:!0}}),f.show("Approved — API key provisioned and emailed to applicant","success")}catch{f.show("Approved — applicant can generate key from their dashboard","success")}else f.show(a+" recorded",n==="suspended"?"error":"success");u()}catch(D){f.show("Failed: "+(((_=(h=D.response)==null?void 0:h.data)==null?void 0:_.detail)||D.message),"error")}},ee=async(r,n)=>{var a,h;if(await N({title:"Begin Review",message:"Start review for "+n+"?"}))try{await x.patch("/api/applications/"+r+"/state?new_state=under_review"),f.show("Review started","success"),u()}catch(_){f.show("Failed: "+(((h=(a=_.response)==null?void 0:a.data)==null?void 0:h.detail)||_.message),"error")}},te=r=>{if(!r)return"";const n=Date.now()-new Date(r).getTime(),a=Math.floor(n/6e4);if(a<1)return"just now";if(a<60)return a+"m ago";const h=Math.floor(a/60);return h<24?h+"h ago":Math.floor(h/24)+"d ago"},re={application_state_changed:"Status changed",application_submitted:"Application received",certificate_issued:"Certificate issued",certificate_suspended:"Certificate suspended",certificate_revoked:"Certificate revoked",certificate_reinstated:"Certificate reinstated",test_created:"CAT-72 test created",test_started:"CAT-72 test started",test_completed:"CAT-72 test completed",user_registered:"New account registered",api_key_created:"API key provisioned",api_key_revoked:"API key revoked"},ie={certificate_issued:e.accentGreen,certificate_revoked:e.accentRed,certificate_suspended:e.accentAmber,application_state_changed:e.accentAmber,test_completed:e.accentGreen,test_started:e.purpleBright,user_registered:e.purpleBright};return t.jsxs("div",{className:"space-y-6",style:{maxWidth:"1200px",margin:"0 auto"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"28px"},children:[t.jsxs("div",{children:[t.jsx("p",{style:{fontFamily:e.mono,fontSize:"10px",fontWeight:600,letterSpacing:"0.20em",textTransform:"uppercase",color:e.purpleBright,margin:"0 0 8px 0"},children:"Administration"}),t.jsxs("h1",{style:{fontFamily:e.serif,fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0,color:e.textPrimary},children:["Welcome",c!=null&&c.full_name?", "+c.full_name.split(" ")[0]:""]}),t.jsx("p",{style:{color:e.textTertiary,marginTop:"6px",fontSize:"13px",fontFamily:e.mono},children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})})]}),t.jsxs("button",{onClick:()=>u(!0),style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,padding:"10px 16px",color:e.textSecondary,cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(se,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:14,style:s?{animation:"spin 0.8s linear infinite"}:{}}),s?"Refreshing…":"Refresh"]})]}),(()=>{var h,_,D;const r=((h=v==null?void 0:v.sessions)==null?void 0:h.filter(k=>{const G=k.last_heartbeat_at||k.last_telemetry_at||k.started_at;return k.status==="active"&&G&&Date.now()-new Date(G).getTime()<12e4}).length)||((_=v==null?void 0:v.summary)==null?void 0:_.active)||0,n=B.filter(k=>k.expires_at&&k.state==="conformant"&&new Date(k.expires_at)<new Date(Date.now()+30*24*60*60*1e3)).length,a=z.length+n;return t.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(${w?"140px":"220px"}, 1fr))`,gap:w?"10px":"16px"},children:[t.jsx(F,{onClick:()=>b("/applications"),label:"Needs Action",value:a,color:a>0?e.accentAmber:e.textTertiary,icon:t.jsx(le,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:a>0?e.accentAmber:e.textTertiary}}),subtitle:a>0?z.length+" pending · "+n+" expiring":"All clear"}),t.jsx(F,{onClick:()=>b("/cat72"),label:"Active Tests",value:(j==null?void 0:j.active_tests)||0,color:e.accentAmber,icon:t.jsx(K,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.accentAmber}})}),t.jsx(F,{onClick:()=>b("/certificates"),label:"Active Certificates",value:(j==null?void 0:j.certificates_active)||0,color:e.accentGreen,icon:t.jsx(H,{size:20})}),t.jsx(F,{onClick:()=>b("/monitoring"),label:"Online Interlocks",value:r,color:r>0?e.accentGreen:e.textTertiary,icon:t.jsx(Z,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:r>0?e.accentGreen:e.textTertiary}}),subtitle:(D=v==null?void 0:v.summary)!=null&&D.total?"of "+v.summary.total+" registered":null})]})})(),t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Certification Pipeline"}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[m.length," total"]})]}),m.length===0?t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",textAlign:"center",padding:"20px 0"},children:"No applications yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[{key:"pending",label:"Pending",color:e.accentAmber,count:S.pending},{key:"under_review",label:"In Review",color:e.accentAmber,count:S.under_review},{key:"approved",label:"Approved",color:e.purpleBright,count:S.approved},{key:"testing",label:"Testing",color:e.purpleBright,count:S.testing},{key:"conformant",label:"Conformant",color:e.accentGreen,count:S.conformant},{key:"revoked",label:"Suspended",color:e.accentRed,count:S.revoked}].filter(r=>r.count>0).map(r=>{const n=Math.max(r.count/m.length*100,4);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary,width:w?"60px":"80px",textAlign:"right",flexShrink:0},children:r.label}),t.jsx("div",{style:{flex:1,height:"20px",background:"rgba(0,0,0,0.03)",position:"relative"},children:t.jsx("div",{style:{width:n+"%",height:"100%",background:r.color+"14",borderLeft:"3px solid "+r.color,transition:"width 0.4s"}})}),t.jsx("span",{style:{fontFamily:e.mono,fontSize:"12px",color:r.color,width:"24px",flexShrink:0},children:r.count})]},r.key)})})]}),z.length>0&&t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsxs("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.accentAmber,margin:0},children:["⚡ Review Queue (",z.length,")"]}),t.jsx(g,{to:"/applications",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"View All →"})]}),t.jsx("div",{className:"space-y-3",children:z.slice(0,5).map(r=>{var n;return t.jsxs("div",{style:{padding:w?"12px":"14px 16px",background:e.cardSurface,border:"1px solid "+e.borderGlass,display:"flex",justifyContent:"space-between",alignItems:w?"flex-start":"center",flexDirection:w?"column":"row",gap:"12px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:w?"8px":"16px",flexWrap:"wrap"},children:[t.jsx(g,{to:"/applications/"+r.id,style:{color:e.purpleBright,textDecoration:"none",fontWeight:500,fontSize:"14px"},children:r.system_name}),t.jsx("span",{style:{color:e.textTertiary,fontSize:"12px"},children:r.organization_name}),t.jsx("span",{style:{color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:(n=r.state)==null?void 0:n.replace("_"," ")})]}),t.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",width:w?"100%":"auto"},children:[r.state==="pending"&&t.jsx("button",{onClick:()=>ee(r.id,r.system_name),style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"4px 10px",borderRadius:8},children:"Begin Review"}),t.jsx("button",{onClick:()=>R(r.id,"approved","Approve "+r.system_name),style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentGreen,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"4px 10px",borderRadius:8},children:"Approve"}),t.jsx("button",{onClick:()=>R(r.id,"suspended","Suspend "+r.system_name),style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentRed,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"4px 10px",borderRadius:8},children:"Suspend"}),t.jsx(g,{to:"/applications/"+r.id,style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",textDecoration:"none",padding:"4px 10px"},children:"View"})]})]},r.id)})})]}),o&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{background:"#fff",border:"1px solid "+e.borderGlass,padding:w?"20px 16px":"32px",maxWidth:"480px",width:"90%"},children:[t.jsx("h3",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontWeight:400,fontSize:"20px",marginBottom:"8px"},children:o.label}),t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",marginBottom:"20px"},children:"A justification note is required for all certification decisions. This is recorded in the audit log."}),t.jsx("textarea",{autoFocus:!0,value:p,onChange:r=>A(r.target.value),placeholder:"Describe the basis for this decision…",rows:4,style:{width:"100%",padding:"12px",border:"1px solid "+e.borderGlass,fontFamily:e.mono,fontSize:"13px",color:e.textPrimary,background:e.cardSurface,resize:"vertical",boxSizing:"border-box"}}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"20px",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:()=>y(null),style:{padding:"8px 20px",background:"transparent",border:"1px solid "+e.borderGlass,color:e.textSecondary,fontFamily:e.mono,fontSize:"11px",cursor:"pointer"},children:"Cancel"}),t.jsxs("button",{onClick:L,style:{padding:"8px 20px",background:o.newState==="suspended"?e.accentRed:e.accentGreen,border:"none",color:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:["Confirm ",o.newState==="suspended"?"Suspension":"Approval"]})]})]})}),T.length>0&&t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Active CAT-72 Tests"}),t.jsx(g,{to:"/cat72",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"Console →"})]}),t.jsx("div",{className:"space-y-3",children:T.map(r=>{const n=Math.round(r.elapsed_seconds/(r.duration_hours*3600)*100),a=Math.max(0,(r.duration_hours*3600-r.elapsed_seconds)/3600).toFixed(1);return t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:"1px solid "+e.borderGlass},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"12px",color:e.purpleBright},children:[r.organization_name," — ",r.system_name]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[a,"h remaining"]}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.accentAmber},children:[n,"%"]})]})]}),t.jsx("div",{style:{height:"4px",background:"rgba(0,0,0,0.05)"},children:t.jsx("div",{style:{width:n+"%",height:"100%",background:n>=100?e.accentGreen:e.purpleBright,transition:"width 0.3s"}})})]},r.id)})})]}),(()=>{const r=B.filter(n=>n.expires_at&&n.state==="conformant"&&new Date(n.expires_at)<new Date(Date.now()+2592e6));return r.length===0?null:t.jsxs("div",{style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,padding:"16px",borderRadius:8},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[t.jsx(ce,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:16,style:{color:e.accentAmber}}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:e.accentAmber},children:[r.length," Certificate",r.length>1?"s":""," Expiring Within 30 Days"]})]}),r.map(n=>{const a=Math.ceil((new Date(n.expires_at)-Date.now())/864e5);return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",padding:"10px 0",borderTop:"1px solid "+e.borderSubtle},children:[t.jsxs("div",{children:[t.jsx("span",{style:{color:e.textPrimary,fontWeight:500,fontSize:"13px"},children:n.system_name}),t.jsx("span",{style:{color:e.textTertiary,fontSize:"12px",marginLeft:"12px"},children:n.organization_name})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:a<=7?e.accentRed:e.accentAmber},children:[a,"d remaining"]}),t.jsx(g,{to:"/verify?cert="+n.certificate_number,style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:n.certificate_number}),t.jsx("button",{onClick:async()=>{try{await x.post("/api/certificates/"+n.id+"/notify-renewal"),f.show("Renewal notice sent to "+n.organization_name,"success")}catch{f.show("Could not send notice — contact licensee directly","error")}},style:{background:"transparent",border:"1px solid "+e.accentAmber+"40",color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"3px 8px",borderRadius:4},children:"Notify"})]})]},n.id)})]})})(),B.length>0&&t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Recent Certificates"}),t.jsx(g,{to:"/certificates",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"View All →"})]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsx("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:["Certificate","System","Status","Issued","Expires"].map(r=>t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontFamily:e.mono,fontSize:"11px",letterSpacing:"0.08em",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:r},r))})}),t.jsx("tbody",{children:B.slice(0,5).map(r=>t.jsxs("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:[t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx(g,{to:"/verify?cert="+r.certificate_number,style:{color:e.purpleBright,textDecoration:"none",fontFamily:e.mono,fontSize:"12px"},children:r.certificate_number})}),t.jsxs("td",{style:{padding:"12px 16px"},children:[t.jsx("span",{style:{color:e.textPrimary,fontSize:"13px"},children:r.system_name}),t.jsx("span",{style:{color:e.textTertiary,fontSize:"11px",marginLeft:"8px"},children:r.organization_name})]}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("span",{style:{fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",padding:"2px 8px",background:r.state==="conformant"?"rgba(22,135,62,0.06)":"rgba(180,52,52,0.06)",color:r.state==="conformant"?e.accentGreen:e.accentRed},children:r.state})}),t.jsx("td",{style:{padding:"12px 16px",color:e.textTertiary,fontSize:"13px"},children:r.issued_at?new Date(r.issued_at).toLocaleDateString():"—"}),t.jsx("td",{style:{padding:"12px 16px",fontFamily:e.mono,fontSize:"12px",color:r.expires_at&&new Date(r.expires_at)<new Date(Date.now()+30*24*60*60*1e3)?e.accentAmber:e.textTertiary},children:r.expires_at?new Date(r.expires_at).toLocaleDateString():"—"})]},r.id))})]})})]}),t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Recent Applications"}),t.jsx(g,{to:"/applications",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"View All →"})]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsx("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:["System","Organization","State","Submitted"].map(r=>t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontFamily:e.mono,fontSize:"11px",letterSpacing:"0.08em",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:r},r))})}),t.jsx("tbody",{children:M.map(r=>t.jsxs("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:[t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx(g,{to:"/applications/"+r.id,style:{color:e.purpleBright,textDecoration:"none"},children:r.system_name})}),t.jsx("td",{style:{padding:"12px 16px",color:e.textSecondary},children:r.organization_name}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("span",{style:{background:r.state==="conformant"?"rgba(22,135,62,0.06)":r.state==="revoked"?"rgba(180,52,52,0.06)":"rgba(158,110,18,0.06)",color:r.state==="conformant"?e.accentGreen:r.state==="revoked"?e.accentRed:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",padding:"2px 8px"},children:r.state})}),t.jsx("td",{style:{padding:"12px 16px",color:e.textTertiary,fontSize:"13px"},children:r.submitted_at?new Date(r.submitted_at).toLocaleDateString():"N/A"})]},r.id))})]})})]}),t.jsxs(C,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"System Activity"}),t.jsx(g,{to:"/activity",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"Full Log →"})]}),W.length===0?t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",textAlign:"center",padding:"20px 0"},children:"No recent activity"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:W.map((r,n)=>{var D,k,G,q;const a=re[r.action]||r.action.replace(/_/g," "),h=ie[r.action]||e.textSecondary,_=((D=r.details)==null?void 0:D.system_name)||((k=r.details)==null?void 0:k.application_number)||((G=r.details)==null?void 0:G.certificate_number)||((q=r.details)==null?void 0:q.organization_name)||"";return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"10px 0",borderBottom:n<W.length-1?"1px solid "+e.borderSubtle:"none"},children:[t.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:h,flexShrink:0}}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textPrimary},children:a}),_&&t.jsx("span",{style:{fontSize:"12px",color:e.textTertiary,marginLeft:"8px"},children:_}),r.actor_name&&t.jsxs("span",{style:{fontSize:"11px",color:e.textTertiary,marginLeft:"8px",fontFamily:e.mono},children:["by ",r.actor_name]})]}),t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono,flexShrink:0},children:te(r.timestamp)})]},r.id||n)})})]})]})}function be(){const{user:c}=Y();return(c==null?void 0:c.role)==="admin"?t.jsx(xe,{}):t.jsx(pe,{})}export{pe as CustomerDashboard,be as RoleBasedDashboard,xe as default};
