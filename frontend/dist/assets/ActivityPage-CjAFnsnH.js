import{b as K,d as f,j as r,s as t}from"./index-yBtxF6iz.js";import{r as s}from"./icons-CHtaS-ny.js";import{P as R}from"./Panel-DzaT4GMG.js";import{S as Y}from"./SectionHeader-CiDCzYXr.js";import"./vendor-Dzneq-kE.js";function ie(){const y=K(),[F,P]=s.useState([]),[z,C]=s.useState(0),[$,k]=s.useState(!0),[p,D]=s.useState(""),[d,I]=s.useState(""),[c,L]=s.useState(""),[a,n]=s.useState(0),[x,h]=s.useState(""),[g,S]=s.useState(""),[i,E]=s.useState(null),[b,A]=s.useState(!1),[j,v]=s.useState("30"),G=e=>{if(v(e),n(0),e==="all")h(""),S("");else{const o=new Date;o.setDate(o.getDate()-parseInt(e)),h(o.toISOString().split("T")[0]),S("")}},O=async()=>{A(!0);try{const e=await f.get("/api/audit/verify?limit=5000");E(e.data),y.show(e.data.integrity==="passed"?`Integrity verified — ${e.data.valid} entries valid`:`Integrity check FAILED — ${e.data.invalid} tampered entries`,e.data.integrity==="passed"?"success":"error")}catch{y.show("Verification failed","error")}A(!1)},[V,U]=s.useState([]),[B,W]=s.useState([]),T=50;s.useEffect(()=>{f.get("/api/audit/actions").then(e=>U(e.data.actions||[])).catch(()=>{}),f.get("/api/audit/resource-types").then(e=>W(e.data.resource_types||[])).catch(()=>{})},[]);const N=async()=>{k(!0);try{const e=new URLSearchParams;p&&e.set("action",p),d&&e.set("resource_type",d),c&&e.set("user_email",c),x&&e.set("date_from",new Date(x).toISOString()),g&&e.set("date_to",new Date(g+"T23:59:59").toISOString()),e.set("limit",T),e.set("offset",a*T);const o=await f.get(`/api/audit/logs?${e}`);P(o.data.logs||[]),C(o.data.total||0)}catch(e){console.error("Failed to load audit logs:",e)}k(!1)},H=async()=>{try{const e=new URLSearchParams;p&&e.set("action",p),d&&e.set("resource_type",d),c&&e.set("user_email",c),x&&e.set("date_from",new Date(x).toISOString()),g&&e.set("date_to",new Date(g+"T23:59:59").toISOString()),e.set("limit",1e4),e.set("offset",0);const m=(await f.get(`/api/audit/logs?${e}`)).data.logs||[];if(m.length===0){y.show("No entries to export","warning");return}const Q=["Timestamp,User,Action,Resource Type,Resource ID,Details,Hash",...m.map(l=>{const X=l.details?Object.entries(l.details).map(([Z,J])=>Z+"="+J).join("; "):"";return[l.timestamp||"",l.user_email||"",l.action||"",l.resource_type||"",l.resource_id||"",'"'+X.replace(/"/g,'""')+'"',l.log_hash||""].join(",")})].join(`
`),q=new Blob([Q],{type:"text/csv"}),_=URL.createObjectURL(q),w=document.createElement("a");w.href=_,w.download="audit-log-"+new Date().toISOString().split("T")[0]+".csv",w.click(),URL.revokeObjectURL(_),y.show("CSV exported ("+m.length+" entries)","success")}catch{y.show("Export failed","error")}};s.useEffect(()=>{N()},[p,d,c,x,g,a]);const M=e=>e!=null&&e.includes("issued")||e!=null&&e.includes("approved")||e!=null&&e.includes("conformant")?t.accentGreen:e!=null&&e.includes("suspended")||e!=null&&e.includes("revoked")||e!=null&&e.includes("failed")?t.accentRed:e!=null&&e.includes("pending")||e!=null&&e.includes("under_review")?t.accentAmber:t.purpleBright,u=Math.ceil(z/T);return r.jsxs("div",{className:"space-y-6",children:[r.jsx(Y,{label:"Administration",title:"Activity History"}),r.jsx(R,{children:r.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("select",{value:p,onChange:e=>{D(e.target.value),n(0)},style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"8px 12px",color:t.textPrimary,fontSize:"12px",fontFamily:t.mono,minWidth:"180px"},children:[r.jsx("option",{value:"",children:"All Actions"}),V.map(e=>r.jsx("option",{value:e,children:e},e))]}),r.jsxs("select",{value:d,onChange:e=>{I(e.target.value),n(0)},style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"8px 12px",color:t.textPrimary,fontSize:"12px",fontFamily:t.mono,minWidth:"150px"},children:[r.jsx("option",{value:"",children:"All Resources"}),B.map(e=>r.jsx("option",{value:e,children:e},e))]}),r.jsx("input",{value:c,onChange:e=>{L(e.target.value),n(0)},placeholder:"Filter by email...",style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"8px 12px",color:t.textPrimary,fontSize:"12px",fontFamily:t.mono,flex:1,minWidth:"150px"}}),["7","30","90","all"].map(e=>r.jsx("button",{onClick:()=>G(e),style:{padding:"5px 10px",background:j===e?"rgba(74,61,117,0.08)":"transparent",border:`1px solid ${j===e?"rgba(74,61,117,0.30)":t.borderGlass}`,color:j===e?t.purpleBright:t.textTertiary,fontFamily:t.mono,fontSize:"10px",cursor:"pointer",letterSpacing:"0.5px",transition:"all 0.15s ease"},children:e==="all"?"All":e+"d"},e)),r.jsx("input",{type:"date",value:x,onChange:e=>{h(e.target.value),n(0),v("")},style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"8px 12px",color:t.textPrimary,fontSize:"12px",fontFamily:t.mono,colorScheme:"light"}}),r.jsx("span",{style:{fontSize:"11px",color:t.textTertiary},children:"to"}),r.jsx("input",{type:"date",value:g,onChange:e=>{S(e.target.value),n(0),v("")},style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"8px 12px",color:t.textPrimary,fontSize:"12px",fontFamily:t.mono,colorScheme:"light"}}),r.jsxs("span",{style:{fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:[z.toLocaleString()," entries"]}),r.jsx("button",{onClick:H,style:{padding:"6px 14px",background:"rgba(74,61,117,0.12)",border:"1px solid rgba(74,61,117,0.15)",color:t.purpleBright,fontFamily:t.mono,fontSize:"10px",cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase"},children:"Export CSV"}),r.jsx("button",{onClick:O,disabled:b,style:{padding:"6px 14px",background:i?i.integrity==="passed"?"rgba(22,135,62,0.12)":"rgba(180,52,52,0.08)":"rgba(74,61,117,0.12)",border:"1px solid "+(i?i.integrity==="passed"?"rgba(22,135,62,0.18)":"rgba(180,52,52,0.18)":"rgba(74,61,117,0.15)"),color:i?i.integrity==="passed"?t.accentGreen:t.accentRed:t.purpleBright,fontFamily:t.mono,fontSize:"10px",cursor:b?"wait":"pointer",letterSpacing:"1px",textTransform:"uppercase"},children:b?"Verifying...":i?i.integrity==="passed"?`✓ ${i.valid} Verified`:`✗ ${i.invalid} Invalid`:"⛓ Verify Chain"})]})}),r.jsxs(R,{noPad:!0,children:[$?r.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:t.textTertiary},children:"Loading..."}):F.length===0?r.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:t.textTertiary},children:"No audit log entries found"}):r.jsx("div",{className:"table-scroll",style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"transparent"},children:[r.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},children:"Timestamp"}),r.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},children:"User"}),r.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},children:"Action"}),r.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},children:"Resource"}),r.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},children:"Details"}),r.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},children:"Hash"})]})}),r.jsx("tbody",{children:F.map(e=>r.jsxs("tr",{style:{borderBottom:`1px solid ${t.borderSubtle}`},children:[r.jsx("td",{style:{padding:"12px 16px",fontFamily:t.mono,fontSize:"11px",color:t.textSecondary,whiteSpace:"nowrap"},children:e.timestamp?new Date(e.timestamp).toLocaleString():"-"}),r.jsx("td",{style:{padding:"12px 16px",fontSize:"13px",color:t.textPrimary},children:e.user_email||"-"}),r.jsx("td",{style:{padding:"12px 16px"},children:r.jsx("span",{style:{fontFamily:t.mono,fontSize:"11px",color:M(e.action),letterSpacing:"0.5px"},children:e.action})}),r.jsxs("td",{style:{padding:"12px 16px",fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:[e.resource_type,e.resource_id?` #${e.resource_id}`:""]}),r.jsx("td",{style:{padding:"12px 16px",fontSize:"12px",color:t.textTertiary,maxWidth:"300px"},children:e.details?Object.entries(e.details).filter(([o])=>o!=="old_state").map(([o,m])=>r.jsxs("span",{style:{marginRight:"12px"},children:[r.jsxs("span",{style:{color:t.textTertiary},children:[o.replace(/_/g," "),":"]})," ",r.jsx("span",{style:{color:t.textSecondary},children:String(m)})]},o)):"-"}),r.jsx("td",{style:{padding:"12px 16px",fontFamily:t.mono,fontSize:"10px",color:t.textTertiary,letterSpacing:"0.5px"},children:e.log_hash||"-"})]},e.id))})]})}),u>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"8px",padding:"16px",borderTop:`1px solid ${t.borderSubtle}`},children:[r.jsx("button",{onClick:()=>n(Math.max(0,a-1)),disabled:a===0,style:{padding:"6px 12px",background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,color:a===0?t.textTertiary:t.textPrimary,cursor:a===0?"not-allowed":"pointer",fontFamily:t.mono,fontSize:"11px"},children:"← Prev"}),r.jsxs("span",{style:{padding:"6px 12px",fontFamily:t.mono,fontSize:"11px",color:t.textSecondary},children:[a+1," / ",u]}),r.jsx("button",{onClick:()=>n(Math.min(u-1,a+1)),disabled:a>=u-1,style:{padding:"6px 12px",background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,color:a>=u-1?t.textTertiary:t.textPrimary,cursor:a>=u-1?"not-allowed":"pointer",fontFamily:t.mono,fontSize:"11px"},children:"Next →"})]})]})]})}export{ie as default};
