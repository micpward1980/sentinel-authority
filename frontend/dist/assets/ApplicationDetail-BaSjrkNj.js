import{j as e,e as ue,b as fe,a as be,u as je,c as ve,d as u,L as ne}from"./index-DvE4LfXv.js";import{r as y,k as Se,R as we}from"./icons-DL0PQMVt.js";import{R as Ce}from"./vendor-DYB3FAiG.js";import{P as w}from"./Panel-KSTCF72h.js";const c={bgPrimary:"#0d0d1a",textPrimary:"#e8e8f0",textSecondary:"#a0a0b0",textTertiary:"#6a6a80",purpleBright:"#8b5cf6",greenBright:"#10b981",redBright:"#ef4444",border:"#2a2a45"},R=({children:r,style:a={}})=>e.jsx("div",{style:{background:"transparent",border:`1px solid ${c.border}`,padding:"24px",...a},children:r}),C=({children:r,onClick:a,variant:p="primary",disabled:l=!1,style:o={}})=>e.jsx("button",{onClick:a,disabled:l,style:{padding:"10px 20px",border:"none",cursor:l?"not-allowed":"pointer",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",letterSpacing:"1px",textTransform:"uppercase",transition:"all 0.2s",opacity:l?.5:1,...p==="primary"?{background:c.purpleBright,color:"rgba(255,255,255,.94)"}:p==="danger"?{background:c.redBright,color:"rgba(255,255,255,.94)"}:{background:"transparent",border:`1px solid ${c.border}`,color:c.textSecondary},...o},children:r}),f=({label:r,value:a,onChange:p,type:l="text",placeholder:o="",style:x={}})=>e.jsxs("div",{style:{marginBottom:"12px",...x},children:[r&&e.jsx("label",{style:{display:"block",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:c.textTertiary,marginBottom:"6px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:r}),e.jsx("input",{type:l,value:a,onChange:j=>p(l==="number"?parseFloat(j.target.value)||0:j.target.value),placeholder:o,style:{width:"100%",padding:"10px 12px",background:c.bgPrimary,border:`1px solid ${c.border}`,color:c.textPrimary,fontSize:"14px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"}})]}),H=({label:r,value:a,onChange:p,options:l,style:o={}})=>e.jsxs("div",{style:{marginBottom:"12px",...o},children:[r&&e.jsx("label",{style:{display:"block",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:c.textTertiary,marginBottom:"6px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:r}),e.jsx("select",{value:a,onChange:x=>p(x.target.value),style:{width:"100%",padding:"10px 12px",background:c.bgPrimary,border:`1px solid ${c.border}`,color:c.textPrimary,fontSize:"14px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:l.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),_e=({boundary:r,onChange:a,onRemove:p})=>e.jsxs(R,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:c.purpleBright,fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"NUMERIC BOUNDARY"}),e.jsx(C,{variant:"danger",onClick:p,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx(f,{label:"Name",value:r.name||"",onChange:l=>a({...r,name:l}),placeholder:"e.g., Speed Limit"}),e.jsx(f,{label:"Parameter",value:r.parameter||"",onChange:l=>a({...r,parameter:l}),placeholder:"e.g., speed"}),e.jsx(f,{label:"Min Value",type:"number",value:r.min_value??"",onChange:l=>a({...r,min_value:l||null}),placeholder:"Optional"}),e.jsx(f,{label:"Max Value",type:"number",value:r.max_value??"",onChange:l=>a({...r,max_value:l||null}),placeholder:"Required"}),e.jsx(f,{label:"Unit",value:r.unit||"",onChange:l=>a({...r,unit:l}),placeholder:"e.g., km/h, °C"}),e.jsx(f,{label:"Tolerance",type:"number",value:r.tolerance||0,onChange:l=>a({...r,tolerance:l}),placeholder:"0"})]}),e.jsx(H,{label:"On Violation",value:r.violation_action||"block",onChange:l=>a({...r,violation_action:l}),options:[{value:"block",label:"Block Action"},{value:"warn",label:"Warn Only"},{value:"log",label:"Log Only"}],style:{marginTop:"12px",marginBottom:0}})]}),Be=({boundary:r,onChange:a,onRemove:p})=>{var l,o;return e.jsxs(R,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:c.greenBright,fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"GEOGRAPHIC BOUNDARY"}),e.jsx(C,{variant:"danger",onClick:p,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsx(f,{label:"Name",value:r.name||"",onChange:x=>a({...r,name:x}),placeholder:"e.g., Warehouse Zone"}),e.jsx(H,{label:"Boundary Type",value:r.boundary_type||"circle",onChange:x=>a({...r,boundary_type:x}),options:[{value:"circle",label:"Circle (Center + Radius)"},{value:"polygon",label:"Polygon (Multiple Points)"}]}),r.boundary_type==="circle"||!r.boundary_type?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},children:[e.jsx(f,{label:"Center Latitude",type:"number",value:((l=r.center)==null?void 0:l.lat)??"",onChange:x=>a({...r,center:{...r.center,lat:x}}),placeholder:"30.2672"}),e.jsx(f,{label:"Center Longitude",type:"number",value:((o=r.center)==null?void 0:o.lon)??"",onChange:x=>a({...r,center:{...r.center,lon:x}}),placeholder:"-97.7431"}),e.jsx(f,{label:"Radius (meters)",type:"number",value:r.radius_meters||"",onChange:x=>a({...r,radius_meters:x}),placeholder:"1000"})]}):e.jsx("div",{style:{color:c.textSecondary,fontSize:"12px",padding:"12px",background:c.bgPrimary},children:"Polygon editor coming soon. For now, enter coordinates as JSON in the raw editor below."})]})},ke=({boundary:r,onChange:a,onRemove:p})=>e.jsxs(R,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:"#f59e0b",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"TIME BOUNDARY"}),e.jsx(C,{variant:"danger",onClick:p,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsx(f,{label:"Name",value:r.name||"",onChange:l=>a({...r,name:l}),placeholder:"e.g., Operating Hours"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx(f,{label:"Start Hour (0-23)",type:"number",value:r.allowed_hours_start??0,onChange:l=>a({...r,allowed_hours_start:Math.min(23,Math.max(0,l))})}),e.jsx(f,{label:"End Hour (0-23)",type:"number",value:r.allowed_hours_end??23,onChange:l=>a({...r,allowed_hours_end:Math.min(23,Math.max(0,l))})})]}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("label",{style:{display:"block",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:c.textTertiary,marginBottom:"8px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"Allowed Days"}),e.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((l,o)=>{const x=r.allowed_days||[0,1,2,3,4,5,6],j=x.includes(o);return e.jsx("button",{onClick:()=>{const I=j?x.filter(_=>_!==o):[...x,o].sort();a({...r,allowed_days:I})},style:{padding:"6px 12px",border:`1px solid ${j?c.purpleBright:c.border}`,background:j?c.purpleBright:"transparent",color:j?"white":c.textSecondary,cursor:"pointer",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:l},l)})})]})]}),Te=({boundary:r,onChange:a,onRemove:p})=>e.jsxs(R,{style:{marginBottom:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("span",{style:{color:"#ec4899",fontSize:"12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"STATE BOUNDARY"}),e.jsx(C,{variant:"danger",onClick:p,style:{padding:"4px 12px",fontSize:"10px"},children:"Remove"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx(f,{label:"Name",value:r.name||"",onChange:l=>a({...r,name:l}),placeholder:"e.g., Operation Mode"}),e.jsx(f,{label:"Parameter",value:r.parameter||"",onChange:l=>a({...r,parameter:l}),placeholder:"e.g., mode"})]}),e.jsx(f,{label:"Allowed Values (comma-separated)",value:(r.allowed_values||[]).join(", "),onChange:l=>a({...r,allowed_values:l.split(",").map(o=>o.trim()).filter(Boolean)}),placeholder:"e.g., idle, moving, charging"}),e.jsx(f,{label:"Forbidden Values (comma-separated)",value:(r.forbidden_values||[]).join(", "),onChange:l=>a({...r,forbidden_values:l.split(",").map(o=>o.trim()).filter(Boolean)}),placeholder:"e.g., emergency, override",style:{marginBottom:0}})]});function ze({applicationId:r,initialBoundaries:a,onSave:p,api:l}){var E;const[o,x]=y.useState({numeric_boundaries:[],geo_boundaries:[],time_boundaries:[],state_boundaries:[],safe_state:{action:"stop",notify:!0,log:!0},fail_closed:!0,telemetry_interval:1,heartbeat_interval:60}),[j,I]=y.useState(!1),[_,F]=y.useState(!1),[k,M]=y.useState("");y.useEffect(()=>{a&&typeof a=="object"&&x(g=>({...g,...a}))},[a]),y.useEffect(()=>{M(JSON.stringify(o,null,2))},[o]);const B=g=>{const d=`${g}_boundaries`,b={numeric:{type:"numeric",name:"",parameter:"",max_value:null,unit:"",tolerance:0,violation_action:"block"},geo:{type:"geo",name:"",boundary_type:"circle",center:{lat:0,lon:0},radius_meters:1e3,violation_action:"block"},time:{type:"time",name:"",allowed_hours_start:6,allowed_hours_end:22,allowed_days:[0,1,2,3,4],violation_action:"block"},state:{type:"state",name:"",parameter:"",allowed_values:[],forbidden_values:[],violation_action:"block"}};x(S=>({...S,[d]:[...S[d],b[g]]}))},A=(g,d,b)=>{const S=`${g}_boundaries`;x(D=>({...D,[S]:D[S].map((P,O)=>O===d?b:P)}))},N=(g,d)=>{const b=`${g}_boundaries`;x(S=>({...S,[b]:S[b].filter((D,P)=>P!==d)}))},W=async()=>{I(!0);try{await p(o)}finally{I(!1)}},v=()=>{try{const g=JSON.parse(k);x(g),F(!1)}catch(g){alert("Invalid JSON: "+g.message)}},T=o.numeric_boundaries.length+o.geo_boundaries.length+o.time_boundaries.length+o.state_boundaries.length;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:c.purpleBright,margin:0},children:"Boundary Configuration"}),e.jsxs("p",{style:{color:c.textSecondary,margin:"8px 0 0",fontSize:"14px"},children:[T," boundaries defined"]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{variant:"secondary",onClick:()=>F(!_),children:_?"Visual Editor":"Raw JSON"}),e.jsx(C,{onClick:W,disabled:j,children:j?"Saving...":"Save Boundaries"})]})]}),_?e.jsxs(R,{children:[e.jsx("textarea",{value:k,onChange:g=>M(g.target.value),style:{width:"100%",minHeight:"400px",padding:"16px",background:c.bgPrimary,border:`1px solid ${c.border}`,color:c.textPrimary,fontSize:"13px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",resize:"vertical"}}),e.jsx(C,{onClick:v,style:{marginTop:"12px"},children:"Apply JSON"})]}):e.jsxs("div",{children:[e.jsxs(R,{style:{marginBottom:"24px"},children:[e.jsx("p",{style:{fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:c.textTertiary,margin:"0 0 12px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"Add Boundary"}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[e.jsx(C,{variant:"secondary",onClick:()=>B("numeric"),children:"+ Numeric (Speed, Temp, etc.)"}),e.jsx(C,{variant:"secondary",onClick:()=>B("geo"),children:"+ Geographic (Geofence)"}),e.jsx(C,{variant:"secondary",onClick:()=>B("time"),children:"+ Time (Operating Hours)"}),e.jsx(C,{variant:"secondary",onClick:()=>B("state"),children:"+ State (Allowed Modes)"})]})]}),o.numeric_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:c.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["Numeric Boundaries (",o.numeric_boundaries.length,")"]}),o.numeric_boundaries.map((g,d)=>e.jsx(_e,{boundary:g,onChange:b=>A("numeric",d,b),onRemove:()=>N("numeric",d)},d))]}),o.geo_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:c.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["Geographic Boundaries (",o.geo_boundaries.length,")"]}),o.geo_boundaries.map((g,d)=>e.jsx(Be,{boundary:g,onChange:b=>A("geo",d,b),onRemove:()=>N("geo",d)},d))]}),o.time_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:c.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["Time Boundaries (",o.time_boundaries.length,")"]}),o.time_boundaries.map((g,d)=>e.jsx(ke,{boundary:g,onChange:b=>A("time",d,b),onRemove:()=>N("time",d)},d))]}),o.state_boundaries.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:c.textPrimary,fontSize:"14px",marginBottom:"12px"},children:["State Boundaries (",o.state_boundaries.length,")"]}),o.state_boundaries.map((g,d)=>e.jsx(Te,{boundary:g,onChange:b=>A("state",d,b),onRemove:()=>N("state",d)},d))]}),e.jsxs(R,{children:[e.jsx("h3",{style:{fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:c.textTertiary,margin:"0 0 16px",fontFamily:"Consolas, 'IBM Plex Mono', monospace"},children:"Enforcement Settings"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(H,{label:"On Violation",value:((E=o.safe_state)==null?void 0:E.action)||"stop",onChange:g=>x(d=>({...d,safe_state:{...d.safe_state,action:g}})),options:[{value:"stop",label:"Stop System"},{value:"reduce",label:"Reduce Operation"},{value:"handoff",label:"Human Handoff"}]}),e.jsx(H,{label:"Fail Mode",value:o.fail_closed?"closed":"open",onChange:g=>x(d=>({...d,fail_closed:g==="closed"})),options:[{value:"closed",label:"Fail Closed (Block)"},{value:"open",label:"Fail Open (Allow)"}]}),e.jsx(f,{label:"Telemetry Interval (sec)",type:"number",value:o.telemetry_interval||1,onChange:g=>x(d=>({...d,telemetry_interval:g}))})]})]}),T===0&&e.jsxs(R,{style:{textAlign:"center",padding:"48px"},children:[e.jsx("p",{style:{color:c.textSecondary,fontSize:"16px",margin:0},children:"No boundaries defined yet."}),e.jsx("p",{style:{color:c.textTertiary,fontSize:"14px",marginTop:"8px"},children:"Add boundaries above to define the system's Operational Design Domain."})]})]})]})}const m="Consolas, 'IBM Plex Mono', monospace",t={purple:"#a896d6",green:"#5CD685",red:"#D65C5C",amber:"#D6A05C",text:"rgba(255,255,255,.78)",textDim:"rgba(255,255,255,.50)",border:"rgba(255,255,255,.07)"};function Ne(){const{id:r}=ue(),a=fe(),{user:p}=be(),l=je();ve();const[o,x]=y.useState(null),[j,I]=y.useState([]),[_,F]=y.useState([]),[k,M]=y.useState(""),[B,A]=y.useState(!1),[N,W]=y.useState(!1),[v,T]=y.useState(null),[E,g]=y.useState(null),[d,b]=y.useState({org_verified:!1,system_in_scope:!1,contact_valid:!1,application_complete:!1}),[S,D]=y.useState(""),[P,O]=y.useState(!1),[J,q]=y.useState(""),[Y,V]=y.useState(!1);y.useEffect(()=>{r&&(u.get("/api/applications/"+r).then(n=>{x(n.data),n.data.review_checklist&&b(s=>({...s,...n.data.review_checklist}))}).catch(console.error),u.get("/api/applications/"+r+"/history").then(n=>I(n.data)).catch(console.error),u.get("/api/applications/"+r+"/comments").then(n=>F(n.data)).catch(console.error))},[r]);const L=async()=>{try{const n=await u.get("/api/applications/"+r);x(n.data);const s=await u.get("/api/applications/"+r+"/history");I(s.data)}catch(n){console.error("Refresh failed:",n)}},$=async(n,s)=>{try{const i=await u.get("/api/applications/"+r+"/email-preview?new_state="+n);T({...i.data,label:s,newState:n})}catch{a.show("Preview failed","error")}},ie=async()=>{var n,s;if(v)try{if(await u.patch("/api/applications/"+r+"/state?new_state="+v.newState),v.newState==="approved")try{await u.post("/api/cat72/tests",{application_id:parseInt(r)}),a.show("CAT-72 test auto-scheduled","success")}catch(i){console.error("Auto-schedule CAT-72:",i.message)}T(null),await L(),a.show("State changed to "+v.newState,"success")}catch(i){a.show("Failed: "+(((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.detail)||i.message),"error")}},G=async(n,s)=>{var i,h;if(await l({title:"Change State",message:s+"?"}))try{await u.patch("/api/applications/"+r+"/state?new_state="+n),await L(),a.show("State updated","success")}catch(z){a.show("Failed: "+(((h=(i=z.response)==null?void 0:i.data)==null?void 0:h.detail)||z.message),"error")}},re=async()=>{var n,s;if(await l({title:"Begin Review",message:"Move this application to In Review? The applicant will be notified that review has started."}))try{await u.patch("/api/applications/"+r+"/state?new_state=under_review"),await L(),a.show("Application moved to review","success")}catch(i){a.show("Failed: "+(((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.detail)||i.message),"error")}},Q=()=>$("approved","Approve Application"),ae=()=>$("suspended","Withdraw Application"),se=async()=>{var n,s;if(await l({title:"Reinstate",message:"Reinstate this application to pending?"}))try{await u.patch("/api/applications/"+r+"/state?new_state=pending"),await L()}catch(i){a.show("Failed: "+(((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.detail)||i.message),"error")}},le=async()=>{var n,s;if(!S.trim()){a.show("Please provide a reason","error");return}if(await l({title:"Reject Application",message:"Reject this application? This will notify the applicant with your reason.",danger:!0,confirmLabel:"Reject"}))try{await u.patch("/api/applications/"+r+"/state?new_state=rejected"),await u.post("/api/applications/"+r+"/comments",{content:"REJECTED: "+S,is_internal:!1}),O(!1),D(""),await L(),a.show("Application rejected","success")}catch(i){a.show("Failed: "+(((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.detail)||i.message),"error")}},pe=async()=>{var n,s;if(!J.trim()){a.show("Please describe what info is needed","error");return}try{await u.post("/api/applications/"+r+"/comments",{content:"INFO REQUESTED: "+J,is_internal:!1}),V(!1),q("");const i=await u.get("/api/applications/"+r+"/comments");F(i.data),a.show("Request sent and logged","success")}catch(i){a.show("Failed: "+(((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.detail)||i.message),"error")}},de=async()=>{var n,s;if(k.trim()){W(!0);try{const i=await u.post("/api/applications/"+r+"/comments",{content:k,is_internal:B});F(h=>[i.data,...h]),M(""),A(!1),a.show("Comment added","success")}catch(i){a.show("Failed: "+(((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.detail)||i.message),"error")}W(!1)}},ce=async n=>{var s,i;try{await u.delete("/api/applications/"+r+"/comments/"+n),F(h=>h.filter(z=>z.id!==n)),a.show("Comment deleted","success")}catch(h){a.show("Failed: "+(((i=(s=h.response)==null?void 0:s.data)==null?void 0:i.detail)||h.message),"error")}},xe=n=>{b(s=>{const i={...s,[n]:!s[n]};return u.patch("/api/applicants/"+r,{review_checklist:i}).catch(()=>{}),i})},K=Object.values(d).every(Boolean),X=[{key:"pending",label:"Submitted",icon:"1"},{key:"under_review",label:"In Review",icon:"2"},{key:"approved",label:"Awaiting Deploy",icon:"3"}],me=X.findIndex(n=>n.key===(o==null?void 0:o.state)),ge=(o==null?void 0:o.state)==="revoked"||(o==null?void 0:o.state)==="suspended"||(o==null?void 0:o.state)==="rejected"||(o==null?void 0:o.state)==="failed",he=()=>{switch(o==null?void 0:o.state){case"pending":return"Application queued for review by the Sentinel Authority team.";case"under_review":return"Under review. Approval triggers automatic Interlock credentials and CAT-72 scheduling.";case"approved":return"Approved. Interlock credentials sent. CAT-72 auto-starts when Interlock connects.";case"testing":return"CAT-72 running. Certificate auto-issues on pass.";case"conformant":return"ODDC Conformance achieved. Certificate issued.";case"rejected":return"Application rejected. See comments for details.";case"failed":return"CAT-72 test failed. Re-approve to schedule another attempt.";case"revoked":case"suspended":return"Application withdrawn. Contact info@sentinelauthority.org.";default:return""}},ye=n=>({approved:"Awaiting Deploy",under_review:"In Review",conformant:"Certified",pending:"Pending",rejected:"Rejected",suspended:"Withdrawn",revoked:"Revoked",failed:"Failed"})[n]||(n||"").replace(/_/g," ");return o?e.jsxs("div",{className:"space-y-6",children:[v&&Ce.createPortal(e.jsx("div",{onClick:()=>T(null),style:{position:"fixed",inset:0,zIndex:99999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.75)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)"},children:e.jsxs("div",{onClick:n=>n.stopPropagation(),style:{background:"rgba(18,12,30,0.95)",border:"1px solid rgba(157,140,207,0.12)",maxWidth:"min(650px, 95vw)",width:"95%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative"},children:[e.jsx("span",{style:{position:"absolute",top:-1,left:-1,width:10,height:10,borderTop:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",top:-1,right:-1,width:10,height:10,borderTop:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,left:-1,width:10,height:10,borderBottom:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,right:-1,width:10,height:10,borderBottom:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid rgba(255,255,255,.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontFamily:m,fontSize:"9px",letterSpacing:"3px",textTransform:"uppercase",color:"rgba(157,140,207,0.6)"},children:"Email Preview"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"12px",color:t.textDim},children:["This email will be sent to ",e.jsx("strong",{style:{color:"rgba(255,255,255,.94)"},children:v.to})]})]}),e.jsx("button",{onClick:()=>T(null),style:{background:"none",border:"none",color:"rgba(255,255,255,.4)",cursor:"pointer",fontSize:"16px",padding:"4px 8px"},children:"✕"})]}),e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid rgba(255,255,255,.04)"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"2px",textTransform:"uppercase",color:"rgba(255,255,255,.35)",marginBottom:"4px"},children:"Subject"}),e.jsx("div",{style:{fontSize:"14px",color:"rgba(255,255,255,.94)",fontWeight:400},children:v.subject})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"20px 24px"},children:e.jsx("div",{style:{background:"#fff",overflow:"hidden"},dangerouslySetInnerHTML:{__html:v.html}})}),e.jsxs("div",{style:{padding:"16px 24px",display:"flex",justifyContent:"flex-end",gap:"10px",borderTop:"1px solid rgba(255,255,255,.04)"},children:[e.jsx("button",{onClick:()=>T(null),style:{padding:"8px 20px",background:"transparent",border:"1px solid rgba(255,255,255,.06)",color:"rgba(255,255,255,.5)",fontFamily:m,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",cursor:"pointer"},children:"Cancel"}),e.jsxs("button",{onClick:ie,style:{padding:"8px 20px",background:"transparent",border:"1px solid "+(v.newState==="suspended"?"rgba(214,92,92,0.3)":"rgba(157,140,207,0.25)"),color:v.newState==="suspended"?t.red:"rgba(157,140,207,0.9)",fontFamily:m,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",cursor:"pointer"},children:[v.label," + Send Email"]})]})]})}),document.body),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ne,{to:"/applications",className:"flex items-center gap-2 no-underline",style:{color:t.textDim,fontFamily:m,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase"},children:[e.jsx(Se,{className:"w-4 h-4"})," Back to Applications"]}),(p==null?void 0:p.role)==="admin"&&e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[o.state==="under_review"&&e.jsx("button",{onClick:()=>G("pending","Move back to Pending"),className:"px-3 py-2 btn",style:{fontSize:"11px"},children:"← Pending"}),o.state==="approved"&&e.jsx("button",{onClick:()=>G("under_review","Move back to Review"),className:"px-3 py-2 btn",style:{fontSize:"11px"},children:"← Review"}),o.state==="pending"&&e.jsx("button",{onClick:re,className:"px-3 py-2 btn",style:{fontSize:"11px",color:t.purple},children:"Begin Review →"}),o.state==="under_review"&&K&&e.jsx("button",{onClick:Q,className:"px-3 py-2 btn",style:{fontSize:"11px",color:t.green},children:"Approve →"}),["pending","under_review","approved"].includes(o.state)&&e.jsx("button",{onClick:ae,className:"px-3 py-2 btn",style:{fontSize:"11px",color:t.red},children:"Withdraw"}),(o.state==="suspended"||o.state==="revoked"||o.state==="rejected")&&e.jsx("button",{onClick:se,className:"px-3 py-2 btn",style:{fontSize:"11px",color:t.green},children:"Reinstate"})]})]}),e.jsx(w,{children:e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:X.map((n,s)=>{const i=n.key===o.state,h=me>s;return e.jsxs(we.Fragment,{children:[s>0&&e.jsx("div",{style:{flex:1,height:"2px",background:h?t.green:t.border,margin:"0 8px"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",minWidth:"80px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:m,fontSize:"12px",fontWeight:"bold",background:h?"rgba(92,214,133,0.2)":i?"rgba(157,140,207,0.25)":"rgba(255,255,255,0.03)",border:"2px solid "+(h?t.green:i?t.purple:t.border),color:h?t.green:i?t.purple:t.textDim},children:h?"✓":n.icon}),e.jsx("span",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"0.5px",textTransform:"uppercase",color:i?t.purple:h?t.green:t.textDim,textAlign:"center"},children:n.label})]})]},n.key)})}),ge&&e.jsx("div",{style:{padding:"12px 16px",border:"1px solid "+t.border,marginBottom:"12px"},children:e.jsxs("span",{style:{color:t.red,fontFamily:m,fontSize:"11px"},children:["⚠ ",o.state==="rejected"?"REJECTED":o.state==="failed"?"FAILED":"WITHDRAWN"," — See comments for details."]})}),e.jsx("div",{style:{padding:"12px 16px",border:"1px solid "+t.border},children:e.jsx("span",{style:{color:t.text,fontSize:"13px",lineHeight:"1.5"},children:he()})})]})}),E&&e.jsx("div",{style:{padding:"16px",border:"1px solid "+t.border},children:e.jsxs("p",{style:{color:t.green,fontFamily:m,fontSize:"12px",margin:0},children:["CAT-72 Test Scheduled: ",E.test_id," — ",e.jsx(ne,{to:"/cat72",style:{color:t.purple},children:"Go to Console"})]})}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontFamily:m,fontSize:"10px",letterSpacing:"4px",textTransform:"uppercase",color:t.purple,marginBottom:"8px"},children:["Application ",o.application_number]}),e.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 4vw, 32px)",fontWeight:200,letterSpacing:"-0.02em",margin:0},children:o.system_name}),e.jsx("p",{style:{color:t.text,marginTop:"8px"},children:o.system_description})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Organization"}),e.jsx("p",{style:{color:"rgba(255,255,255,.94)",fontSize:"18px",marginBottom:"8px"},children:o.organization_name}),e.jsxs("p",{style:{color:t.text,marginBottom:"4px"},children:[e.jsx("strong",{children:"Contact:"})," ",o.contact_name]}),e.jsxs("p",{style:{color:t.text,marginBottom:"4px"},children:[e.jsx("strong",{children:"Email:"})," ",o.contact_email]}),o.contact_phone&&e.jsxs("p",{style:{color:t.text},children:[e.jsx("strong",{children:"Phone:"})," ",o.contact_phone]})]}),e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Status"}),e.jsx("span",{style:{fontFamily:m,fontSize:"12px",letterSpacing:"1px",textTransform:"uppercase",color:o.state==="approved"?t.green:o.state==="rejected"||o.state==="failed"||o.state==="suspended"?t.red:t.amber},children:ye(o.state)}),e.jsxs("p",{style:{color:t.text,marginTop:"12px"},children:[e.jsx("strong",{children:"Submitted:"})," ",o.submitted_at?new Date(o.submitted_at).toLocaleString():"N/A"]})]})]}),["approved","testing","conformant"].includes(o.state)&&e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Deploy Interlock"}),e.jsx("p",{style:{color:t.text,fontSize:"13px",marginBottom:"20px"},children:o.state==="approved"?"Your application is approved. Deploy the Interlock to begin your CAT-72 certification test.":o.state==="testing"?"CAT-72 is running. Your Interlock is connected and reporting telemetry.":"Certified. Your Interlock is actively enforcing boundaries."}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"2px",textTransform:"uppercase",color:t.purple,marginBottom:"8px"},children:"Step 1 — Install"}),e.jsxs("div",{style:{background:"rgba(0,0,0,.3)",border:"1px solid "+t.border,padding:"12px 16px",fontFamily:m,fontSize:"13px",color:t.green,position:"relative"},children:[e.jsx("span",{style:{position:"absolute",top:-1,left:-1,width:8,height:8,borderTop:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",top:-1,right:-1,width:8,height:8,borderTop:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,left:-1,width:8,height:8,borderBottom:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,right:-1,width:8,height:8,borderBottom:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),"pip install envelo"]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"2px",textTransform:"uppercase",color:t.purple,marginBottom:"8px"},children:"Step 2 — Start"}),e.jsxs("div",{style:{background:"rgba(0,0,0,.3)",border:"1px solid "+t.border,padding:"12px 16px",fontFamily:m,fontSize:"13px",color:t.green,position:"relative"},children:[e.jsx("span",{style:{position:"absolute",top:-1,left:-1,width:8,height:8,borderTop:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",top:-1,right:-1,width:8,height:8,borderTop:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,left:-1,width:8,height:8,borderBottom:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,right:-1,width:8,height:8,borderBottom:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsxs("div",{children:["export ENVELO_API_KEY=",e.jsx("span",{style:{color:t.amber},children:"[your key from approval email]"})]}),e.jsx("div",{style:{marginTop:"4px"},children:"envelo start"})]}),e.jsxs("p",{style:{color:t.textDim,fontSize:"11px",marginTop:"8px"},children:["Your API key was sent to ",e.jsx("strong",{style:{color:t.text},children:o.contact_email})," on approval. Check your inbox."]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"2px",textTransform:"uppercase",color:t.purple,marginBottom:"8px"},children:"Step 3 — Integrate"}),e.jsxs("div",{style:{background:"rgba(0,0,0,.3)",border:"1px solid "+t.border,padding:"12px 16px",fontFamily:m,fontSize:"13px",color:t.text,position:"relative"},children:[e.jsx("span",{style:{position:"absolute",top:-1,left:-1,width:8,height:8,borderTop:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",top:-1,right:-1,width:8,height:8,borderTop:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,left:-1,width:8,height:8,borderBottom:"1px solid rgba(157,140,207,0.3)",borderLeft:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("span",{style:{position:"absolute",bottom:-1,right:-1,width:8,height:8,borderBottom:"1px solid rgba(157,140,207,0.3)",borderRight:"1px solid rgba(157,140,207,0.3)"}}),e.jsx("div",{style:{color:t.textDim,fontSize:"11px",marginBottom:"8px"},children:"# Before any action, check boundaries"}),e.jsx("div",{style:{color:t.green},children:"curl -X POST http://localhost:9090/enforce \\"}),e.jsx("div",{style:{color:t.green,paddingLeft:"20px"},children:`  -d '{ "speed": 50, "lat": 30.5 }'`}),e.jsx("div",{style:{color:t.textDim,fontSize:"11px",marginTop:"12px",marginBottom:"8px"},children:"# Python integration"}),e.jsx("div",{style:{color:t.amber},children:"@agent.enforce"}),e.jsx("div",{style:{color:t.text},children:"def move(speed, position):"}),e.jsx("div",{style:{color:t.text,paddingLeft:"20px"},children:"robot.actuate(speed, position)"})]})]}),e.jsxs("div",{style:{padding:"12px 16px",border:"1px solid "+t.border,background:"rgba(157,140,207,0.03)"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"2px",textTransform:"uppercase",color:t.purple,marginBottom:"8px"},children:"What happens automatically"}),e.jsxs("div",{style:{display:"grid",gap:"6px",fontSize:"12px",color:t.text},children:[e.jsx("div",{children:"✓ Interlock connects and downloads your boundaries"}),e.jsx("div",{children:"✓ CAT-72 test starts on first heartbeat (72-hour timer)"}),e.jsx("div",{children:"✓ Telemetry flows in real-time to this dashboard"}),e.jsx("div",{children:"✓ Certificate auto-issues when CAT-72 passes"})]})]})]}),o.state==="under_review"&&(p==null?void 0:p.role)==="admin"&&e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Review Checklist"}),e.jsx("p",{style:{color:t.textDim,fontSize:"12px",marginBottom:"16px"},children:"Verify the applicant before provisioning Interlock access. Technical specs are pulled automatically after install."}),e.jsx("div",{style:{display:"grid",gap:"0"},children:[{key:"org_verified",label:"Organization Verified",desc:"Applicant is a legitimate entity with verifiable corporate identity"},{key:"system_in_scope",label:"System In Scope",desc:"Autonomous system type falls within ODDC certification scope"},{key:"contact_valid",label:"Contact Information",desc:"Primary contact is reachable and authorized to represent the organization"},{key:"application_complete",label:"Application Complete",desc:"All required fields submitted — system name, description, and org details"}].map(n=>e.jsxs("div",{onClick:()=>xe(n.key),style:{display:"flex",alignItems:"flex-start",gap:"12px",padding:"14px 12px",borderBottom:"1px solid rgba(255,255,255,.04)",cursor:"pointer",userSelect:"none"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"3px",border:"2px solid "+(d[n.key]?t.green:"rgba(255,255,255,.15)"),background:d[n.key]?"rgba(92,214,133,0.15)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"2px",transition:"all 0.2s"},children:d[n.key]&&e.jsx("span",{style:{color:t.green,fontSize:"14px",lineHeight:1},children:"✓"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:m,fontSize:"12px",color:d[n.key]?t.green:"rgba(255,255,255,.94)",letterSpacing:"0.5px",marginBottom:"4px"},children:n.label}),e.jsx("div",{style:{fontSize:"12px",color:t.textDim,lineHeight:1.4},children:n.desc})]})]},n.key))}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px",flexWrap:"wrap"},children:[K&&e.jsx("button",{onClick:Q,className:"px-4 py-2 btn",style:{color:t.green,borderColor:"rgba(92,214,133,.3)"},children:"Approve Application →"}),e.jsx("button",{onClick:()=>V(!Y),className:"px-4 py-2 btn",style:{color:t.amber},children:"Request More Info"}),e.jsx("button",{onClick:()=>O(!P),className:"px-4 py-2 btn",style:{color:t.red},children:"Reject"})]}),Y&&e.jsxs("div",{style:{marginTop:"16px",padding:"16px",border:"1px solid rgba(214,160,92,.2)"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",color:t.amber,marginBottom:"8px"},children:"Request Additional Information"}),e.jsx("textarea",{value:J,onChange:n=>q(n.target.value),rows:3,placeholder:"Describe what information is missing or unclear...",style:{width:"100%",background:"rgba(255,255,255,0.03)",border:"1px solid "+t.border,color:"rgba(255,255,255,.94)",fontSize:"13px",padding:"12px",fontFamily:"inherit",resize:"none",outline:"none"}}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>{V(!1),q("")},className:"px-3 py-2 btn",style:{fontSize:"11px"},children:"Cancel"}),e.jsx("button",{onClick:pe,className:"px-3 py-2 btn",style:{fontSize:"11px",color:t.amber,borderColor:"rgba(214,160,92,.3)"},children:"Send Request"})]})]}),P&&e.jsxs("div",{style:{marginTop:"16px",padding:"16px",border:"1px solid rgba(214,92,92,.2)"},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",color:t.red,marginBottom:"8px"},children:"Reject Application"}),e.jsx("textarea",{value:S,onChange:n=>D(n.target.value),rows:3,placeholder:"Explain why this application is being rejected...",style:{width:"100%",background:"rgba(255,255,255,0.03)",border:"1px solid "+t.border,color:"rgba(255,255,255,.94)",fontSize:"13px",padding:"12px",fontFamily:"inherit",resize:"none",outline:"none"}}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>{O(!1),D("")},className:"px-3 py-2 btn",style:{fontSize:"11px"},children:"Cancel"}),e.jsx("button",{onClick:le,className:"px-3 py-2 btn",style:{fontSize:"11px",color:t.red,borderColor:"rgba(214,92,92,.3)"},children:"Reject Application"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"System Details"}),e.jsxs("p",{style:{color:t.text,marginBottom:"8px"},children:[e.jsx("strong",{children:"Version:"})," ",o.system_version||"N/A"]}),e.jsxs("p",{style:{color:t.text,marginBottom:"8px"},children:[e.jsx("strong",{children:"Manufacturer:"})," ",o.manufacturer||"N/A"]}),o.facility_location&&e.jsxs("p",{style:{color:t.text,marginBottom:"8px"},children:[e.jsx("strong",{children:"Facility:"})," ",o.facility_location]})]}),e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Safety Boundaries"}),(()=>{const n=typeof o.envelope_definition=="string"?(()=>{try{return JSON.parse(o.envelope_definition)}catch{return null}})():o.envelope_definition,s=(n==null?void 0:n.boundaries)||[];return s.length===0?e.jsx("p",{style:{color:t.textDim,fontSize:"13px",fontStyle:"italic"},children:"No boundaries defined"}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:"1px solid "+t.border},children:["Type","Constraint","Unit"].map(i=>e.jsx("th",{style:{fontFamily:m,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:t.textDim,fontWeight:400,padding:"8px 12px",textAlign:"left"},children:i},i))})}),e.jsx("tbody",{children:s.map((i,h)=>{const z=i.max&&i.min?i.min+" - "+i.max:i.max?"<= "+i.max:i.min?">= "+i.min:i.radius_m?"radius "+i.radius_m+"m":i.corridors?i.corridors.join(", "):i.polygon||"-";return e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.04)"},children:[e.jsx("td",{style:{padding:"8px 12px",fontFamily:m,fontSize:"11px",color:t.purple,textTransform:"uppercase",letterSpacing:"0.5px"},children:i.type}),e.jsx("td",{style:{padding:"8px 12px",color:t.text,fontSize:"13px"},children:z}),e.jsx("td",{style:{padding:"8px 12px",fontFamily:m,fontSize:"11px",color:t.textDim},children:i.unit||"-"})]},h)})})]})})()]})]}),(p==null?void 0:p.role)==="admin"&&(()=>{var s;const n=typeof o.envelope_definition=="string"?(()=>{try{return JSON.parse(o.envelope_definition)}catch{return null}})():o.envelope_definition;return((s=n==null?void 0:n.boundaries)==null?void 0:s.length)>0?null:e.jsx(ze,{applicationId:o.id,initialBoundaries:o.envelope_definition||{},onSave:async i=>{try{await u.patch("/api/applicants/"+o.id,{envelope_definition:i}),a.show("Boundaries saved","success"),x({...o,envelope_definition:i})}catch(h){a.show("Failed: "+h.message,"error")}}})})(),e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"ODD Specification"}),(()=>{const n=typeof o.odd_specification=="string"?(()=>{try{return JSON.parse(o.odd_specification)}catch{return null}})():o.odd_specification;return!n||Object.keys(n).length===0?e.jsx("p",{style:{color:t.textDim,fontSize:"13px",fontStyle:"italic"},children:"Not specified"}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0"},children:Object.entries(n).map(([s,i])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,.04)"},children:[e.jsx("span",{style:{fontFamily:m,fontSize:"10px",color:t.textDim,textTransform:"uppercase",letterSpacing:"0.5px"},children:s.replace(/_/g," ")}),e.jsx("span",{style:{color:t.text,fontSize:"13px",textAlign:"right"},children:Array.isArray(i)?i.join(", "):typeof i=="boolean"?i?"Yes":"No":String(i)})]},s))})})()]}),j.length>0&&e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"State Change History"}),e.jsxs("div",{style:{position:"relative",paddingLeft:"28px"},children:[e.jsx("div",{style:{position:"absolute",left:"8px",top:"4px",bottom:"4px",width:"2px",background:t.border}}),j.map((n,s)=>{var ee,te,oe;const i=(ee=n.details)==null?void 0:ee.new_state,h=i==="conformant"||i==="approved"?t.green:i==="suspended"||i==="revoked"||i==="rejected"?t.red:i==="under_review"||i==="testing"||n.action==="submitted"?t.purple:t.amber,z=i?i.replace(/_/g," "):(n.action||"").replace(/_/g," "),Z=(oe=(te=n.details)==null?void 0:te.old_state)==null?void 0:oe.replace(/_/g," "),U=n.timestamp?new Date(n.timestamp):null;return e.jsxs("div",{style:{position:"relative",paddingBottom:s<j.length-1?"20px":"0"},children:[e.jsx("div",{style:{position:"absolute",left:"-24px",top:"2px",width:"12px",height:"12px",borderRadius:"50%",background:h+"08",border:"2px solid "+h}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontFamily:m,fontSize:"12px",fontWeight:500,color:h,textTransform:"uppercase",letterSpacing:"0.5px"},children:z}),Z&&n.action!=="submitted"&&e.jsxs("span",{style:{fontFamily:m,fontSize:"10px",color:t.textDim,marginLeft:"8px"},children:["from ",Z]}),e.jsx("div",{style:{marginTop:"4px"},children:e.jsx("span",{style:{fontSize:"12px",color:t.textDim},children:n.user_email})})]}),U&&e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsx("div",{style:{fontFamily:m,fontSize:"11px",color:t.textDim},children:U.toLocaleDateString()}),e.jsx("div",{style:{fontFamily:m,fontSize:"10px",color:t.textDim},children:U.toLocaleTimeString()})]})]})]},s)})]})]}),e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Comments & Notes"}),e.jsxs("div",{style:{marginBottom:_.length>0?"20px":"0"},children:[e.jsx("textarea",{value:k,onChange:n=>M(n.target.value),rows:3,placeholder:"Add a comment or note...",className:"w-full px-4 py-3 outline-none resize-none",style:{background:"rgba(255,255,255,0.03)",border:"1px solid "+t.border,color:"rgba(255,255,255,.94)",fontSize:"13px",fontFamily:"inherit"},onFocus:n=>n.target.style.borderColor=t.purple,onBlur:n=>n.target.style.borderColor=t.border}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginTop:"8px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:(p==null?void 0:p.role)==="admin"&&e.jsxs("button",{onClick:()=>A(!B),className:"btn",style:{padding:"4px 10px",color:B?t.green:t.textDim,borderColor:B?"rgba(92,214,133,0.2)":"rgba(255,255,255,0.06)"},children:["Internal ",B?"ON":"OFF"]})}),e.jsx("button",{onClick:de,disabled:N||!k.trim(),className:"px-4 py-2 btn",children:N?"Posting...":"Post Comment"})]})]}),_.length>0&&e.jsx("div",{style:{borderTop:"1px solid "+t.border,paddingTop:"16px"},children:_.map(n=>{var s,i;return e.jsxs("div",{style:{padding:"12px 0",borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"6px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontFamily:m,fontSize:"12px",color:n.user_role==="admin"?t.purple:t.text,fontWeight:500},children:n.user_email}),n.user_role==="admin"&&e.jsx("span",{style:{fontFamily:m,fontSize:"9px",padding:"2px 6px",color:t.purple,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Admin"}),n.is_internal&&e.jsx("span",{style:{fontFamily:m,fontSize:"9px",padding:"2px 6px",color:t.amber,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Internal"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontFamily:m,fontSize:"10px",color:t.textDim},children:n.created_at?new Date(n.created_at).toLocaleString():""}),((p==null?void 0:p.role)==="admin"||(p==null?void 0:p.email)===n.user_email)&&e.jsx("button",{onClick:()=>ce(n.id),style:{background:"none",border:"none",color:t.textDim,cursor:"pointer",fontSize:"12px",padding:"0",opacity:.5},children:"x"})]})]}),e.jsx("p",{style:{color:(s=n.content)!=null&&s.startsWith("REJECTED:")?t.red:(i=n.content)!=null&&i.startsWith("INFO REQUESTED:")?t.amber:t.text,fontSize:"13px",lineHeight:1.6,margin:0,whiteSpace:"pre-wrap"},children:n.content})]},n.id)})}),_.length===0&&!k&&e.jsx("p",{style:{color:t.textDim,fontSize:"13px",fontStyle:"italic",margin:0},children:"No comments yet"})]}),o.notes&&e.jsxs(w,{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"16px"},children:"Applicant Notes"}),e.jsx("p",{style:{color:t.text,lineHeight:1.7,whiteSpace:"pre-wrap"},children:o.notes})]})]}):e.jsx("div",{style:{color:t.textDim},children:"Loading..."})}export{Ne as default};
