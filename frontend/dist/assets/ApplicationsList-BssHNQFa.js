import{j as e,b as $,a as E,u as L,L as D,d as P}from"./index-BSEmsdEo.js";import{R as N,r as m,j as R,F as O}from"./icons-DL0PQMVt.js";import{P as H}from"./Panel-SsB0PYs3.js";import"./vendor-DYB3FAiG.js";function V({icon:c,title:o,message:S,description:b,action:g}){const u=S||b;return e.jsxs("div",{style:{textAlign:"center",padding:"48px 20px",fontFamily:"var(--mono)"},children:[c&&e.jsx("div",{style:{marginBottom:"16px",opacity:.4,display:"flex",justifyContent:"center"},children:N.isValidElement(c)?c:e.jsx(c,{size:28,strokeWidth:1.5})}),o&&e.jsx("div",{style:{fontFamily:"var(--serif)",fontSize:"20px",fontWeight:"normal",color:"var(--text-secondary)",marginBottom:"8px"},children:o}),u&&e.jsx("div",{style:{fontSize:"12px",letterSpacing:"0.5px",color:"var(--text-tertiary)",maxWidth:"380px",margin:"0 auto",lineHeight:1.7},children:u}),g&&e.jsx("div",{style:{marginTop:"20px"},children:g})]})}function G({isOpen:c,onClose:o,onImport:S,boundaryType:b}){const[g,u]=N.useState(""),[h,C]=N.useState("json"),[B,d]=N.useState(""),[p,y]=N.useState(null),A={numeric:{json:'[{"name":"Speed Limit","parameter":"speed","min_value":0,"max_value":100,"unit":"km/h","tolerance":5}]',csv:`name,parameter,min_value,max_value,hard_limit,unit,tolerance
Speed Limit,speed,0,100,120,km/h,5`},geo:{json:'[{"name":"Operating Zone","boundary_type":"circle","lat":30.123,"lon":-97.456,"radius_meters":500}]',csv:`name,boundary_type,lat,lon,radius_meters,altitude_max
Operating Zone,circle,30.123,-97.456,500,120`},time:{json:'[{"name":"Business Hours","start_hour":6,"end_hour":22,"timezone":"America/Chicago","days":[0,1,2,3,4]}]',csv:`name,start_hour,end_hour,timezone,days
Business Hours,6,22,America/Chicago,0;1;2;3;4`},state:{json:'[{"name":"Mode Check","parameter":"mode","allowed_values":"autonomous,semi-auto","forbidden_values":"manual_override"}]',csv:`name,parameter,allowed_values,forbidden_values
Mode Check,mode,"autonomous,semi-auto",manual_override`}},x=()=>{d(""),y(null);try{let a=[];if(h==="json"){const s=JSON.parse(g);a=Array.isArray(s)?s:[s]}else{const s=g.trim().split(`
`);if(s.length<2)throw new Error("CSV needs header + data rows");const k=s[0].split(",").map(j=>j.trim());a=s.slice(1).map(j=>{const F=j.match(/(".*?"|[^,]+)/g)||[],v={};return k.forEach((l,w)=>{let f=(F[w]||"").replace(/^"|"$/g,"").trim();l==="days"?v[l]=f.split(";").map(Number):["min_value","max_value","hard_limit","tolerance","lat","lon","radius_meters","altitude_min","altitude_max","start_hour","end_hour"].includes(l)?v[l]=f===""?"":f:v[l]=f}),v})}if(a.length===0)throw new Error("No data found");y(a)}catch(a){d(a.message)}};return c?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.75)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:o,children:e.jsxs("div",{style:{background:"rgba(18,12,30,0.95)",border:"1px solid rgba(157,140,207,0.12)",padding:"32px",position:"relative",maxWidth:"min(700px, 95vw)",width:"100%",maxHeight:"80vh",overflowY:"auto"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h3",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",fontWeight:400,margin:0,letterSpacing:"2px",textTransform:"uppercase",color:"#a896d6"},children:["Bulk Import — ",b]}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"rgba(255,255,255,.50)",fontSize:"20px",cursor:"pointer"},children:"×"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[["json","csv"].map(a=>e.jsx("button",{onClick:()=>{C(a),d(""),y(null)},style:{padding:"6px 16px",border:"1px solid "+(h===a?"#a896d6":"rgba(255,255,255,0.1)"),background:h===a?"rgba(91,75,138,0.25)":"transparent",color:h===a?"#a896d6":"rgba(255,255,255,.60)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:a},a)),e.jsx("button",{onClick:()=>{var a;return u(((a=A[b])==null?void 0:a[h])||"")},style:{marginLeft:"auto",padding:"6px 12px",border:"1px solid rgba(255,255,255,0.1)",background:"transparent",color:"rgba(255,255,255,.60)",fontSize:"11px",cursor:"pointer"},children:"Load Example"})]}),e.jsx("textarea",{value:g,onChange:a=>u(a.target.value),rows:10,placeholder:h==="json"?"Paste JSON array of boundaries...":"Paste CSV with header row...",style:{width:"100%",background:"rgba(255,255,255,.05)",border:"1px solid rgba(255,255,255,0.1)",padding:"12px",color:"rgba(255,255,255,.90)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",lineHeight:"1.5",resize:"vertical",outline:"none"}}),B&&e.jsxs("p",{style:{color:"#D65C5C",fontSize:"12px",marginTop:"8px"},children:["⚠ ",B]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[e.jsx("button",{onClick:x,style:{padding:"8px 20px",border:"1px solid #a896d6",background:"transparent",color:"#a896d6",fontSize:"12px",cursor:"pointer"},children:"Preview"}),p&&e.jsxs("button",{onClick:()=>{S(p),o(),u(""),y(null)},style:{padding:"8px 20px",border:"none",background:"transparent",color:"rgba(255,255,255,.94)",fontSize:"12px",cursor:"pointer",fontWeight:500},children:["Import ",p.length," ",p.length===1?"boundary":"boundaries"]})]}),p&&e.jsxs("div",{style:{marginTop:"16px",background:"transparent",padding:"12px",maxHeight:"200px",overflowY:"auto"},children:[e.jsxs("p",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)",marginBottom:"8px"},children:["PREVIEW (",p.length," rows)"]}),p.map((a,s)=>e.jsx("div",{style:{fontSize:"11px",color:"rgba(255,255,255,.60)",padding:"4px 0",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:Object.entries(a).map(([k,j])=>`${k}: ${j}`).join(" · ")},s))]})]})}):null}function X(){const c=$(),{user:o}=E(),S=L(),[b,g]=m.useState([]),[u,h]=m.useState(0),[C,B]=m.useState({}),[d,p]=m.useState("all"),[y,A]=m.useState(""),[x,a]=m.useState(new Set),[s,k]=m.useState(!1),j=t=>a(r=>{const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),n}),F=()=>a(new Set(_.map(t=>t.id))),v=()=>a(new Set),l=async(t,r)=>{var z,M;const n=[...x];if(n.length===0)return;const i=t==="delete"?`Delete ${n.length} application(s)?`:`${t} ${n.length} application(s)?`;if(await S({title:"Confirm",message:i})){k(!0);try{t==="delete"?await P.post("/api/applications/bulk-delete",{ids:n}):await P.post("/api/applications/bulk-state",{ids:n,new_state:r}),a(new Set),w()}catch(T){c.show("Bulk operation failed: "+(((M=(z=T.response)==null?void 0:z.data)==null?void 0:M.detail)||T.message),"error")}k(!1)}},w=(t="",r="all")=>{const n={};t&&(n.search=t),r&&r!=="all"&&(n.state=r),P.get("/api/applications/",{params:n}).then(i=>{g(i.data.applications||i.data),h(i.data.total??(i.data.applications||i.data).length),B(i.data.state_counts||{})}).catch(console.error)};m.useEffect(()=>{w()},[]),m.useEffect(()=>{const t=setTimeout(()=>{w(y,d)},300);return()=>clearTimeout(t)},[y,d]);const f=async(t,r,n)=>{var i,z;if(await S({title:"Confirm",message:n+"?"}))try{await P.patch(`/api/applications/${t}/state?new_state=${r}`),w()}catch(M){c.show("Failed: "+(((z=(i=M.response)==null?void 0:i.data)==null?void 0:z.detail)||M.message),"error")}},W=[{key:"all",label:"All"},{key:"pending",label:"Pending"},{key:"under_review",label:"Review"},{key:"approved",label:"Awaiting Deploy"},{key:"failed",label:"Failed"},{key:"rejected",label:"Rejected"}],_=b,I=t=>t==="conformant"?"#5CD685":t==="revoked"||t==="suspended"||t==="failed"||t==="rejected"?"#D65C5C":t==="testing"||t==="approved"?"#a896d6":"#D6A05C";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs("p",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"4px",textTransform:"uppercase",color:"#a896d6",marginBottom:"10px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{width:"24px",height:"1px",background:"#a896d6"}}),(o==null?void 0:o.role)==="admin"?"Conformance":"My Organization"]}),e.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 4vw, 32px)",fontWeight:200,margin:0,letterSpacing:"-0.02em",color:"rgba(255,255,255,.94)"},children:(o==null?void 0:o.role)==="admin"?"Applications":"Certification Status"})]})}),(o==null?void 0:o.role)==="admin"&&e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"min(400px, 90vw)"},children:[e.jsx(R,{className:"w-4 h-4",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"rgba(255,255,255,.50)"}}),e.jsx("input",{value:y,onChange:t=>A(t.target.value),placeholder:"Search by name, org, or ID...",style:{width:"100%",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,.07)",padding:"8px 12px 8px 36px",color:"rgba(255,255,255,.94)",fontSize:"13px",fontFamily:"Consolas, 'IBM Plex Mono', monospace",outline:"none"}})]}),e.jsxs("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[_.length," of ",u]})]}),(o==null?void 0:o.role)==="admin"&&e.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:W.map(t=>{const r=t.key==="all"?C.all||0:t.key==="revoked"?(C.suspended||0)+(C.revoked||0):C[t.key]||0;return e.jsxs("button",{onClick:()=>p(t.key),style:{padding:"6px 14px",cursor:"pointer",fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",background:d===t.key?"rgba(157,140,207,0.2)":"rgba(255,255,255,0.03)",border:`1px solid ${d===t.key?"#a896d6":"rgba(255,255,255,.07)"}`,color:d===t.key?"#a896d6":"rgba(255,255,255,.50)"},children:[t.label," ",r>0?`(${r})`:""]},t.key)})}),e.jsxs(H,{children:[e.jsx("div",{style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs("table",{className:"w-full",style:{minWidth:"700px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.07)"},children:[(o==null?void 0:o.role)==="admin"&&e.jsx("th",{className:"px-2 py-3 text-center",style:{width:"40px"},children:e.jsx("input",{type:"checkbox",checked:x.size>0&&x.size===_.length,onChange:t=>t.target.checked?F():v(),style:{cursor:"pointer",accentColor:"#a896d6"}})}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"System Name"}),(o==null?void 0:o.role)==="admin"&&e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Organization"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"State"}),e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Submitted"}),(o==null?void 0:o.role)==="admin"&&e.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:"rgba(255,255,255,.50)",fontWeight:400},children:"Actions"})]})}),e.jsx("tbody",{children:_.map(t=>{var r;return e.jsxs("tr",{className:"transition-colors",style:{borderBottom:"1px solid rgba(255,255,255,.07)",background:x.has(t.id)?"rgba(157,140,207,0.08)":"transparent"},children:[(o==null?void 0:o.role)==="admin"&&e.jsx("td",{className:"px-2 py-4 text-center",children:e.jsx("input",{type:"checkbox",checked:x.has(t.id),onChange:()=>j(t.id),style:{cursor:"pointer",accentColor:"#a896d6"}})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx(D,{to:`/applications/${t.id}`,style:{color:"#a896d6",textDecoration:"none"},children:t.system_name}),e.jsx("div",{style:{fontSize:"11px",color:"rgba(255,255,255,.50)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",marginTop:"2px"},children:t.application_number})]}),(o==null?void 0:o.role)==="admin"&&e.jsx("td",{className:"px-4 py-4",style:{color:"rgba(255,255,255,.78)"},children:t.organization_name}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"px-2 py-1",style:{background:`${I(t.state)}06`,color:I(t.state),border:`1px solid ${I(t.state)}10`,fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:t.state==="approved"?"Awaiting Deploy":t.state==="conformant"?"Certified":t.state==="testing"?"CAT-72 Active":t.state==="under_review"?"In Review":(r=t.state)==null?void 0:r.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-4",style:{color:"rgba(255,255,255,.50)",fontSize:"14px"},children:t.submitted_at?new Date(t.submitted_at).toLocaleDateString():"N/A"}),(o==null?void 0:o.role)==="admin"&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[t.state==="pending"&&e.jsx("button",{onClick:n=>{n.stopPropagation(),f(t.id,"under_review",`Begin review for ${t.system_name}`)},className:"btn",style:{padding:"4px 10px",color:"#D6A05C"},children:"Review"}),(t.state==="pending"||t.state==="under_review")&&e.jsx("button",{onClick:n=>{n.stopPropagation(),f(t.id,"approved",`Approve ${t.system_name}`)},className:"btn",style:{padding:"4px 10px",color:"#5CD685"},children:"Approve"}),t.state==="approved"&&e.jsx(D,{to:`/applications/${t.id}`,className:"px-2 py-1 no-underline btn",children:"Schedule CAT-72"}),["pending","under_review","approved"].includes(t.state)&&e.jsx("button",{onClick:n=>{n.stopPropagation(),f(t.id,"suspended",`Suspend ${t.system_name}`)},className:"btn",style:{padding:"4px 10px",color:"#D65C5C"},children:"Withdraw"})]})})]},t.id)})})]})}),x.size>0&&(o==null?void 0:o.role)==="admin"&&e.jsxs("div",{style:{position:"sticky",bottom:"16px",zIndex:50,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",padding:"12px 20px",margin:"16px",background:"rgba(18,12,30,0.95)",border:"1px solid #a896d6"},children:[e.jsxs("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"12px",color:"#a896d6"},children:[x.size," selected"]}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("button",{onClick:()=>l("approve","approved"),disabled:s,className:"btn",style:{padding:"6px 14px",color:"var(--accent-green)"},children:"Approve"}),e.jsx("button",{onClick:()=>l("review","under_review"),disabled:s,className:"btn",style:{padding:"6px 14px",color:"#D6A05C"},children:"Review"}),e.jsx("button",{onClick:()=>l("withdraw","suspended"),disabled:s,className:"btn",style:{padding:"6px 14px",color:"#D65C5C"},children:"Withdraw"}),e.jsx("div",{style:{width:"1px",height:"20px",background:"rgba(255,255,255,.07)",margin:"0 4px"}}),e.jsx("button",{onClick:()=>l("delete"),disabled:s,className:"btn",style:{padding:"6px 14px",color:"#D65C5C"},children:"Delete"}),e.jsx("button",{onClick:v,className:"btn",children:"Cancel"}),s&&e.jsx("span",{style:{fontFamily:"Consolas, 'IBM Plex Mono', monospace",fontSize:"10px",color:"rgba(255,255,255,.50)"},children:"Processing..."})]})]}),_.length===0&&e.jsx(V,{icon:O,title:"No Applications Found",description:b.length===0?"No ODDC certification applications submitted yet.":"No applications match your current filter."})]})]})}export{G as BulkImportModal,X as default};
