import{j as t,s as e,b as I,a as D,u as L,L as R,d as B}from"./index-yBtxF6iz.js";import{R as $,r as u,n as O,F as H}from"./icons-CHtaS-ny.js";import{P as M}from"./Panel-DzaT4GMG.js";import{E as V}from"./EmptyState-DoXMh6tF.js";import"./vendor-Dzneq-kE.js";function q({isOpen:C,onClose:n,onImport:F,boundaryType:k}){const[v,w]=$.useState(""),[g,b]=$.useState("json"),[N,c]=$.useState(""),[d,y]=$.useState(null),A={numeric:{json:'[{"name":"Speed Limit","parameter":"speed","min_value":0,"max_value":100,"unit":"km/h","tolerance":5}]',csv:`name,parameter,min_value,max_value,hard_limit,unit,tolerance
Speed Limit,speed,0,100,120,km/h,5`},geo:{json:'[{"name":"Operating Zone","boundary_type":"circle","lat":30.123,"lon":-97.456,"radius_meters":500}]',csv:`name,boundary_type,lat,lon,radius_meters,altitude_max
Operating Zone,circle,30.123,-97.456,500,120`},time:{json:'[{"name":"Business Hours","start_hour":6,"end_hour":22,"timezone":"America/Chicago","days":[0,1,2,3,4]}]',csv:`name,start_hour,end_hour,timezone,days
Business Hours,6,22,America/Chicago,0;1;2;3;4`},state:{json:'[{"name":"Mode Check","parameter":"mode","allowed_values":"autonomous,semi-auto","forbidden_values":"manual_override"}]',csv:`name,parameter,allowed_values,forbidden_values
Mode Check,mode,"autonomous,semi-auto",manual_override`}},x=()=>{c(""),y(null);try{let o=[];if(g==="json"){const s=JSON.parse(v);o=Array.isArray(s)?s:[s]}else{const s=v.trim().split(`
`);if(s.length<2)throw new Error("CSV needs header + data rows");const S=s[0].split(",").map(h=>h.trim());o=s.slice(1).map(h=>{const P=h.match(/(".*?"|[^,]+)/g)||[],f={};return S.forEach((l,j)=>{let m=(P[j]||"").replace(/^"|"$/g,"").trim();l==="days"?f[l]=m.split(";").map(Number):["min_value","max_value","hard_limit","tolerance","lat","lon","radius_meters","altitude_min","altitude_max","start_hour","end_hour"].includes(l)?f[l]=m===""?"":m:f[l]=m}),f})}if(o.length===0)throw new Error("No data found");y(o)}catch(o){c(o.message)}};return C?t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:n,children:t.jsxs("div",{style:{background:e.bgDeep,border:"1px solid rgba(74,61,117,0.2)",padding:"32px",maxWidth:"min(700px, 95vw)",width:"100%",maxHeight:"80vh",overflowY:"auto"},onClick:o=>o.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[t.jsxs("h3",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"20px",fontWeight:200,margin:0},children:["Bulk Import — ",k]}),t.jsx("button",{onClick:n,style:{background:"none",border:"none",color:e.textTertiary,fontSize:"20px",cursor:"pointer"},children:"×"})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[["json","csv"].map(o=>t.jsx("button",{onClick:()=>{b(o),c(""),y(null)},style:{padding:"6px 16px",border:"1px solid "+(g===o?"styles.purpleBright":"rgba(0,0,0,0.04)"),background:g===o?"rgba(74,61,117,0.08)":"transparent",color:g===o?"styles.purpleBright":e.textTertiary,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:o},o)),t.jsx("button",{onClick:()=>{var o;return w(((o=A[k])==null?void 0:o[g])||"")},style:{marginLeft:"auto",padding:"6px 12px",border:"1px solid rgba(0,0,0,0.09)",background:"transparent",color:e.textTertiary,fontSize:"11px",cursor:"pointer"},children:"Load Example"})]}),t.jsx("textarea",{value:v,onChange:o=>w(o.target.value),rows:10,placeholder:g==="json"?"Paste JSON array of boundaries...":"Paste CSV with header row...",style:{width:"100%",background:"transparent",border:"1px solid rgba(0,0,0,0.09)",padding:"12px",color:e.textPrimary,fontFamily:e.mono,fontSize:"12px",lineHeight:"1.5",resize:"vertical",outline:"none"}}),N&&t.jsxs("p",{style:{color:e.accentRed,fontSize:"12px",marginTop:"8px"},children:["⚠ ",N]}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[t.jsx("button",{onClick:x,style:{padding:"8px 20px",border:"1px solid styles.purpleBright",background:"transparent",color:"styles.purpleBright",fontSize:"12px",cursor:"pointer"},children:"Preview"}),d&&t.jsxs("button",{onClick:()=>{F(d),n(),w(""),y(null)},style:{padding:"8px 20px",border:"none",background:"transparent",color:e.textPrimary,fontSize:"12px",cursor:"pointer",fontWeight:500},children:["Import ",d.length," ",d.length===1?"boundary":"boundaries"]})]}),d&&t.jsxs("div",{style:{marginTop:"16px",background:"transparent",padding:"12px",maxHeight:"200px",overflowY:"auto"},children:[t.jsxs("p",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary,marginBottom:"8px"},children:["PREVIEW (",d.length," rows)"]}),d.map((o,s)=>t.jsx("div",{style:{fontSize:"11px",color:e.textTertiary,padding:"4px 0",borderBottom:"1px solid rgba(0,0,0,0.05)"},children:Object.entries(o).map(([S,h])=>`${S}: ${h}`).join(" · ")},s))]})]})}):null}function K(){const C=I(),{user:n}=D(),F=L(),[k,v]=u.useState([]),[w,g]=u.useState(0),[b,N]=u.useState({}),[c,d]=u.useState("all"),[y,A]=u.useState(""),[x,o]=u.useState(new Set),[s,S]=u.useState(!1),h=r=>o(i=>{const a=new Set(i);return a.has(r)?a.delete(r):a.add(r),a}),P=()=>o(new Set(z.map(r=>r.id))),f=()=>o(new Set),l=async(r,i)=>{var T,_;const a=[...x];if(a.length===0)return;const p=r==="delete"?`Delete ${a.length} application(s)?`:`${r} ${a.length} application(s)?`;if(await F({title:"Confirm",message:p})){S(!0);try{r==="delete"?await B.post("/api/applications/bulk-delete",{ids:a}):await B.post("/api/applications/bulk-state",{ids:a,new_state:i}),o(new Set),j()}catch(W){C.show("Bulk operation failed: "+(((_=(T=W.response)==null?void 0:T.data)==null?void 0:_.detail)||W.message),"error")}S(!1)}},j=(r="",i="all")=>{const a={};r&&(a.search=r),i&&i!=="all"&&(a.state=i),B.get("/api/applications/",{params:a}).then(p=>{v(p.data.applications||p.data),g(p.data.total??(p.data.applications||p.data).length),N(p.data.state_counts||{})}).catch(console.error)};u.useEffect(()=>{j()},[]),u.useEffect(()=>{const r=setTimeout(()=>{j(y,c)},300);return()=>clearTimeout(r)},[y,c]);const m=async(r,i,a)=>{var p,T;if(await F({title:"Confirm",message:a+"?"}))try{await B.patch(`/api/applications/${r}/state?new_state=${i}`),j()}catch(_){C.show("Failed: "+(((T=(p=_.response)==null?void 0:p.data)==null?void 0:T.detail)||_.message),"error")}},E=[{key:"all",label:"All"},{key:"pending",label:"Pending"},{key:"under_review",label:"Review"},{key:"approved",label:"Approved"},{key:"testing",label:"Testing"},{key:"conformant",label:"Conformant"},{key:"revoked",label:"Suspended"}],z=k,G=r=>r==="conformant"?e.accentGreen:r==="revoked"||r==="suspended"?e.accentRed:r==="testing"||r==="approved"?e.purpleBright:e.accentAmber;return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex justify-between items-start",children:t.jsxs("div",{children:[t.jsx("p",{style:{fontFamily:e.mono,fontSize:"10px",letterSpacing:"4px",textTransform:"uppercase",color:e.purpleBright,marginBottom:"8px"},children:(n==null?void 0:n.role)==="admin"?"Conformance":"My Organization"}),t.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0},children:(n==null?void 0:n.role)==="admin"?"Applications":"Certification Status"})]})}),(n==null?void 0:n.role)==="admin"&&t.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"min(400px, 90vw)"},children:[t.jsx(O,{className:"w-4 h-4",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textTertiary}}),t.jsx("input",{value:y,onChange:r=>A(r.target.value),placeholder:"Search by name, org, or ID...",style:{width:"100%",background:"transparent",border:`1px solid ${e.borderGlass}`,padding:"8px 12px 8px 36px",color:e.textPrimary,fontSize:"13px",fontFamily:e.mono,outline:"none"}})]}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[z.length," of ",w]})]}),(n==null?void 0:n.role)==="admin"&&t.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:E.map(r=>{const i=r.key==="all"?b.all||0:r.key==="revoked"?(b.suspended||0)+(b.revoked||0):b[r.key]||0;return t.jsxs("button",{onClick:()=>d(r.key),style:{padding:"6px 14px",cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",background:c===r.key?"rgba(74,61,117,0.10)":"transparent",border:`1px solid ${c===r.key?e.purpleBright:e.borderGlass}`,color:c===r.key?e.purpleBright:e.textTertiary},children:[r.label," ",i>0?`(${i})`:""]},r.key)})}),t.jsxs(M,{children:[t.jsx("div",{style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:t.jsxs("table",{className:"w-full",style:{minWidth:"700px"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:`1px solid ${e.borderGlass}`},children:[(n==null?void 0:n.role)==="admin"&&t.jsx("th",{className:"px-2 py-3 text-center",style:{width:"40px"},children:t.jsx("input",{type:"checkbox",checked:x.size>0&&x.size===z.length,onChange:r=>r.target.checked?P():f(),style:{cursor:"pointer",accentColor:e.purpleBright}})}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"System Name"}),(n==null?void 0:n.role)==="admin"&&t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Organization"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"State"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Submitted"}),(n==null?void 0:n.role)==="admin"&&t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Actions"})]})}),t.jsx("tbody",{children:z.map(r=>{var i;return t.jsxs("tr",{className:"transition-colors",style:{borderBottom:`1px solid ${e.borderGlass}`,background:x.has(r.id)?"rgba(74,61,117,0.06)":"transparent"},children:[(n==null?void 0:n.role)==="admin"&&t.jsx("td",{className:"px-2 py-4 text-center",children:t.jsx("input",{type:"checkbox",checked:x.has(r.id),onChange:()=>h(r.id),style:{cursor:"pointer",accentColor:e.purpleBright}})}),t.jsxs("td",{className:"px-4 py-4",children:[t.jsx(R,{to:`/applications/${r.id}`,style:{color:e.purpleBright,textDecoration:"none"},children:r.system_name}),t.jsx("div",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono,marginTop:"2px"},children:r.application_number})]}),(n==null?void 0:n.role)==="admin"&&t.jsx("td",{className:"px-4 py-4",style:{color:e.textSecondary},children:r.organization_name}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("span",{className:"px-2 py-1",style:{background:`${G(r.state)}06`,color:G(r.state),border:`1px solid ${G(r.state)}10`,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:(i=r.state)==null?void 0:i.replace("_"," ")})}),t.jsx("td",{className:"px-4 py-4",style:{color:e.textTertiary,fontSize:"14px"},children:r.submitted_at?new Date(r.submitted_at).toLocaleDateString():"N/A"}),(n==null?void 0:n.role)==="admin"&&t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.state==="pending"&&t.jsx("button",{onClick:a=>{a.stopPropagation(),m(r.id,"under_review",`Begin review for ${r.system_name}`)},className:"px-2 py-1",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentAmber,fontFamily:e.mono,fontSize:"9px",cursor:"pointer",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Review"}),(r.state==="pending"||r.state==="under_review")&&t.jsx("button",{onClick:a=>{a.stopPropagation(),m(r.id,"approved",`Approve ${r.system_name}`)},className:"px-2 py-1",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentGreen,fontFamily:e.mono,fontSize:"9px",cursor:"pointer",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Approve"}),r.state==="approved"&&t.jsx(R,{to:`/applications/${r.id}`,className:"px-2 py-1 no-underline",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"9px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Schedule Test"}),r.state==="conformant"&&t.jsx("span",{style:{color:e.accentGreen,fontFamily:e.mono,fontSize:"9px"},children:"✓ Certified"}),r.state==="testing"&&t.jsx(R,{to:"/cat72",className:"px-2 py-1 no-underline",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"9px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"View Test"}),["pending","under_review","approved","testing","conformant"].includes(r.state)&&t.jsx("button",{onClick:a=>{a.stopPropagation(),m(r.id,"suspended",`Suspend ${r.system_name}`)},className:"px-2 py-1",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentRed,fontFamily:e.mono,fontSize:"9px",cursor:"pointer",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Suspend"}),(r.state==="suspended"||r.state==="revoked")&&t.jsx("button",{onClick:a=>{a.stopPropagation(),m(r.id,"pending",`Reinstate ${r.system_name} to pending`)},className:"px-2 py-1",style:{background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentGreen,fontFamily:e.mono,fontSize:"9px",cursor:"pointer",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reinstate"})]})})]},r.id)})})]})}),x.size>0&&(n==null?void 0:n.role)==="admin"&&t.jsxs("div",{style:{position:"sticky",bottom:"16px",zIndex:50,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",padding:"12px 20px",margin:"16px",background:"rgba(0,0,0,.92)",backdropFilter:"blur(12px)",border:`1px solid ${e.purpleBright}`},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"12px",color:e.purpleBright},children:[x.size," selected"]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[t.jsx("button",{onClick:()=>l("approve","approved"),disabled:s,style:{padding:"6px 14px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentGreen,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Approve"}),t.jsx("button",{onClick:()=>l("review","under_review"),disabled:s,style:{padding:"6px 14px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Review"}),t.jsx("button",{onClick:()=>l("suspend","suspended"),disabled:s,style:{padding:"6px 14px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentRed,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Suspend"}),t.jsx("button",{onClick:()=>l("reinstate","pending"),disabled:s,style:{padding:"6px 14px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentGreen,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Reinstate"}),t.jsx("div",{style:{width:"1px",height:"20px",background:e.borderGlass,margin:"0 4px"}}),t.jsx("button",{onClick:()=>l("delete"),disabled:s,style:{padding:"6px 14px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentRed,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Delete"}),t.jsx("button",{onClick:f,style:{padding:"6px 14px",background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.textTertiary,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Cancel"}),s&&t.jsx("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary},children:"Processing..."})]})]}),z.length===0&&t.jsx(V,{icon:H,title:"No Applications Found",description:k.length===0?"You haven't submitted any certification applications yet. Start your ODDC certification journey.":"No applications match your current filter."})]})]})}export{q as BulkImportModal,K as default};
