import{u as J,a as Q,b as U,c as x,j as t,s as e,L as h,A as te,d as re,B as ne}from"./index-CiYkEjR4.js";import{r as d,F as ie,A as q,d as X,W as H,e as ae,P as oe,l as se,m as le,n as ce}from"./icons-CE7UjK-E.js";import{P as T}from"./Panel-CtACPDlF.js";import{S as D}from"./StatCard-BPGDfoMT.js";import{E as de}from"./EmptyState-sxA8n5aZ.js";import"./vendor-BZ1VDJqt.js";function pe(){const{user:c}=J();Q();const f=U(),[k,F]=d.useState([]),[b,L]=d.useState([]),[P,E]=d.useState(!0),[A,M]=d.useState(null),[m,O]=d.useState([]);d.useEffect(()=>{Promise.all([x.get("/api/applications/").catch(()=>({data:[]})),x.get("/api/certificates/").catch(()=>({data:[]})),x.get("/api/envelo/monitoring/overview").catch(()=>({data:null})),x.get("/api/audit/my-logs?limit=5&offset=0").catch(()=>({data:{logs:[]}}))]).then(([n,s,l,o])=>{F(n.data.applications||n.data||[]),L(s.data||[]),l.data&&M(l.data),O(o.data.logs||o.data||[]),E(!1)})},[]);const B=[{key:"pending",label:"Submitted"},{key:"under_review",label:"In Review"},{key:"approved",label:"Approved"},{key:"testing",label:"Testing"},{key:"conformant",label:"Conformant"}],V=n=>B.findIndex(s=>s.key===n),j=n=>{switch(n){case"pending":return"Awaiting review";case"under_review":return"Under evaluation";case"approved":return"Preparing CAT-72 test";case"testing":return"ENVELO Interlock test in progress";case"conformant":return"Certificate issued";case"revoked":return"Suspended — contact support";default:return"Pending"}},I=n=>n==="conformant"?e.accentGreen:n==="revoked"||n==="suspended"?e.accentRed:n==="testing"||n==="approved"?e.purpleBright:e.accentAmber,W=n=>{if(!n)return null;const s=Date.now()-new Date(n).getTime(),l=Math.floor(s/6e4);if(l<1)return"just now";if(l<60)return l+"m ago";const o=Math.floor(l/60);if(o<24)return o+"h ago";const y=Math.floor(o/24);return y<30?y+"d ago":new Date(n).toLocaleDateString()};return P?t.jsx("div",{style:{color:e.textTertiary,padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:"Loading…"}):t.jsxs("div",{className:"space-y-6",style:{maxWidth:"1000px",margin:"0 auto"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px"},children:t.jsxs("div",{children:[t.jsx("p",{style:{fontFamily:e.mono,fontSize:"10px",letterSpacing:"4px",textTransform:"uppercase",color:e.purpleBright,marginBottom:"8px"},children:"ODDC Certification"}),t.jsxs("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0},children:["Welcome",c!=null&&c.full_name?", "+c.full_name.split(" ")[0]:""]}),t.jsxs("p",{style:{color:e.textSecondary,marginTop:"8px"},children:[c!=null&&c.organization?c.organization+" · ":"","Track your certification progress and manage your systems."]})]})}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[t.jsx(D,{onClick:()=>f("/applications"),label:"Applications",value:k.length,color:e.purpleBright,icon:t.jsx(ie,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.purpleBright}}),subtitle:k.filter(n=>n.state==="pending"||n.state==="under_review").length>0?k.filter(n=>n.state==="pending"||n.state==="under_review").length+" in review":null}),t.jsx(D,{onClick:()=>f("/certificates"),label:"Certificates",value:b.length,color:e.accentGreen,icon:t.jsx(q,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.accentGreen}}),subtitle:b.filter(n=>n.state==="conformant").length>0?b.filter(n=>n.state==="conformant").length+" active":null}),t.jsx(D,{onClick:()=>f("/cat72"),label:"Active Tests",value:k.filter(n=>n.state==="testing").length,color:e.accentAmber,icon:t.jsx(X,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.accentAmber}})}),(()=>{var _;const s=((A==null?void 0:A.sessions)||[]).filter(u=>{const S=u.last_heartbeat_at||u.last_telemetry_at||u.last_activity||u.started_at;return u.status==="active"&&S&&Date.now()-new Date(S).getTime()<12e4}).length,l=((_=A==null?void 0:A.summary)==null?void 0:_.total)||0,o=l>0,y=o?s>0?e.accentGreen:e.accentAmber:e.textTertiary,p=o?s>0?s+" of "+l+" online":"All interlocks offline":"No active interlocks";return t.jsx(D,{onClick:()=>f("/monitoring"),label:"Live Interlocks",value:o?s:"—",color:y,icon:t.jsx(H,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:y}}),subtitle:p})})()]}),t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Your Applications"}),k.length>0&&t.jsx(h,{to:"/applications",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none",letterSpacing:"1px"},children:"View All →"})]}),k.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"56px 20px"},children:[t.jsx("div",{style:{width:"72px",height:"72px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",borderRadius:8},children:t.jsx(ae,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:32,style:{color:e.purpleBright,opacity:.7}})}),t.jsx("p",{style:{color:e.textPrimary,fontSize:"17px",fontWeight:500,marginBottom:"8px",fontFamily:"Georgia, 'Source Serif 4', serif"},children:"Begin Your Certification"}),t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",maxWidth:"380px",margin:"0 auto 28px",lineHeight:"1.6"},children:"Submit your autonomous system for ODDC certification. The CAT-72 test verifies your system's ENVELO Interlock is enforcing ODD boundaries in real time across a continuous 72-hour window."}),t.jsxs(h,{to:"/applications/new",className:"inline-flex items-center gap-2 px-6 py-3 no-underline",style:{background:"transparent",border:"none",color:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase"},children:[t.jsx(oe,{className:"w-4 h-4"})," New Application"]})]}):t.jsx("div",{className:"space-y-4",children:k.map(n=>{var y;const s=V(n.state),l=["pending","under_review"].includes(n.state)&&n.updated_at,o=l?Math.floor((Date.now()-new Date(n.updated_at).getTime())/(1e3*60*60*24)):0;return t.jsx(h,{to:"/applications/"+n.id,style:{textDecoration:"none",display:"block"},children:t.jsxs("div",{style:{padding:"20px",background:e.cardSurface,border:"1px solid "+e.borderGlass,cursor:"pointer",transition:"border-color 0.2s"},onMouseEnter:p=>p.currentTarget.style.borderColor=e.purpleBright,onMouseLeave:p=>p.currentTarget.style.borderColor=e.borderGlass,children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500,color:e.textPrimary,fontSize:"15px",marginBottom:"4px"},children:n.system_name}),t.jsxs("div",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono},children:[n.application_number," · ",(y=n.system_type)==null?void 0:y.replace(/_/g," ")]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[t.jsx("span",{style:{fontSize:"12px",color:e.textTertiary},children:j(n.state)}),l&&o>3&&t.jsxs("span",{style:{fontSize:"11px",color:e.accentAmber,fontFamily:e.mono},children:[o,"d in queue"]}),t.jsx("span",{style:{padding:"4px 12px",fontSize:"10px",fontFamily:e.mono,textTransform:"uppercase",letterSpacing:"1px",background:I(n.state)+"06",color:I(n.state),border:"1px solid "+I(n.state)+"10"},children:n.state})]})]}),t.jsx("div",{style:{display:"flex",gap:"3px",height:"4px"},children:B.map((p,_)=>t.jsx("div",{style:{flex:1,background:_<=s?I(n.state):"rgba(0,0,0,0.05)"}},p.key))}),["pending","under_review"].includes(n.state)&&t.jsxs("div",{style:{marginTop:"12px",fontSize:"11px",color:e.textTertiary},children:["Questions about this review? ",t.jsx("a",{href:"mailto:review@sentinelauthority.org",style:{color:e.purpleBright,textDecoration:"none"},onClick:p=>p.stopPropagation(),children:"Contact your review officer →"})]})]})},n.id)})})]}),b.length===0?t.jsx(de,{icon:q,title:"No Certificates Yet",description:"Certificates are issued after your system passes the 72-hour CAT-72 ENVELO Interlock conformance test. Submit an application to begin."}):t.jsxs(T,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Your Certificates"}),t.jsx("div",{className:"space-y-3",children:b.map(n=>t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",borderRadius:8},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500,color:e.accentGreen,marginBottom:"4px",fontFamily:e.mono,fontSize:"14px"},children:n.certificate_number}),t.jsxs("div",{style:{fontSize:"12px",color:e.textTertiary},children:["Issued: ",new Date(n.issued_at).toLocaleDateString(),n.expires_at?" · Expires: "+new Date(n.expires_at).toLocaleDateString():""]})]}),t.jsx("a",{href:te+"/api/certificates/"+n.certificate_number+"/pdf",target:"_blank",rel:"noreferrer noopener",style:{padding:"8px 16px",background:"transparent",color:e.purpleBright,fontSize:"11px",fontFamily:e.mono,textDecoration:"none"},children:"Download PDF"})]},n.id))})]}),t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Recent Activity"}),t.jsx(h,{to:"/my-activity",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none",letterSpacing:"1px"},children:"View All →"})]}),m.length===0?t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",textAlign:"center",padding:"20px 0"},children:"No activity yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:m.map((n,s)=>{var u,S,C,R,N;const l={user_login:"Signed in",user_registered:"Account created",login_failed:"Failed login attempt",application_submitted:"Application submitted",application_state_changed:"Application status updated",application_deleted:"Application deleted",test_created:"CAT-72 test scheduled",test_started:"CAT-72 test started",test_completed:"CAT-72 test completed",certificate_issued:"Certificate issued",certificate_suspended:"Certificate suspended",certificate_revoked:"Certificate revoked",certificate_reinstated:"Certificate reinstated",api_key_created:"API key created",api_key_revoked:"API key revoked",password_changed:"Password changed",profile_updated:"Profile updated","2fa_enabled":"Two-factor authentication enabled","2fa_disabled":"Two-factor authentication disabled"},o={user_login:e.textTertiary,login_failed:e.accentRed,application_submitted:e.purpleBright,application_state_changed:e.accentAmber,test_created:e.purpleBright,test_started:e.accentAmber,test_completed:e.accentGreen,certificate_issued:e.accentGreen,certificate_suspended:e.accentAmber,certificate_revoked:e.accentRed,api_key_created:e.purpleBright,api_key_revoked:e.accentRed},y=l[n.action]||n.action.replace(/_/g," "),p=o[n.action]||e.textSecondary,_=((u=n.details)==null?void 0:u.system_name)||((S=n.details)==null?void 0:S.application_number)||((C=n.details)==null?void 0:C.test_id)||((R=n.details)==null?void 0:R.certificate_number)||((N=n.details)==null?void 0:N.key_name)||"";return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"10px 0",borderBottom:s<m.length-1?"1px solid "+e.borderSubtle:"none"},children:[t.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:p,flexShrink:0}}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textPrimary},children:y}),_&&t.jsx("span",{style:{fontSize:"12px",color:e.textTertiary,marginLeft:"8px"},children:_})]}),t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono,flexShrink:0},children:W(n.timestamp)})]},n.id||s)})})]})]})}function xe(){const{user:c}=J(),f=Q(),k=re(),F=U(),[b,L]=d.useState(null),[P,E]=d.useState([]),[A,M]=d.useState([]),[m,O]=d.useState([]),[B,V]=d.useState([]),[j,I]=d.useState(null),[W,n]=d.useState([]),[s,l]=d.useState(!1),[o,y]=d.useState(null),[p,_]=d.useState(""),u=r=>{r&&l(!0),x.get("/api/dashboard/stats").then(i=>L(i.data)).catch(console.error),x.get("/api/dashboard/recent-applications").then(i=>E(i.data)).catch(console.error),x.get("/api/dashboard/active-tests").then(i=>M(i.data)).catch(console.error),x.get("/api/applications/").then(i=>O(i.data.applications||i.data||[])).catch(console.error),x.get("/api/dashboard/recent-certificates").then(i=>V(i.data)).catch(console.error),x.get("/api/envelo/monitoring/overview").then(i=>I(i.data)).catch(console.error),x.get("/api/audit/admin-logs?limit=8&offset=0").then(i=>n(i.data.logs||i.data||[])).catch(console.error),r&&setTimeout(()=>l(!1),800)};d.useEffect(()=>{u();const r=setInterval(u,3e4);return()=>clearInterval(r)},[]);const S={pending:m.filter(r=>r.state==="pending").length,under_review:m.filter(r=>r.state==="under_review").length,approved:m.filter(r=>r.state==="approved").length,testing:m.filter(r=>r.state==="testing").length,conformant:m.filter(r=>r.state==="conformant").length,revoked:m.filter(r=>r.state==="revoked"||r.state==="suspended").length},C=m.filter(r=>r.state==="pending"||r.state==="under_review"),R=(r,i,a)=>{_(""),y({appId:r,newState:i,label:a})},N=async()=>{var g,v;if(!p.trim()){f.show("A justification note is required","error");return}const{appId:r,newState:i,label:a}=o;y(null);try{if(await x.patch("/api/applications/"+r+"/state?new_state="+i,{note:p}),i==="approved")try{await x.post("/api/apikeys/admin/provision",null,{params:{application_id:r,send_email:!0}}),f.show("Approved — API key provisioned and emailed to applicant","success")}catch{f.show("Approved — applicant can generate key from their dashboard","success")}else f.show(a+" recorded",i==="suspended"?"error":"success");u()}catch(z){f.show("Failed: "+(((v=(g=z.response)==null?void 0:g.data)==null?void 0:v.detail)||z.message),"error")}},K=async(r,i)=>{var a,g;if(await k({title:"Begin Review",message:"Start review for "+i+"?"}))try{await x.patch("/api/applications/"+r+"/state?new_state=under_review"),f.show("Review started","success"),u()}catch(v){f.show("Failed: "+(((g=(a=v.response)==null?void 0:a.data)==null?void 0:g.detail)||v.message),"error")}},Z=r=>{if(!r)return"";const i=Date.now()-new Date(r).getTime(),a=Math.floor(i/6e4);if(a<1)return"just now";if(a<60)return a+"m ago";const g=Math.floor(a/60);return g<24?g+"h ago":Math.floor(g/24)+"d ago"},$={application_state_changed:"Status changed",application_submitted:"Application received",certificate_issued:"Certificate issued",certificate_suspended:"Certificate suspended",certificate_revoked:"Certificate revoked",certificate_reinstated:"Certificate reinstated",test_created:"CAT-72 test created",test_started:"CAT-72 test started",test_completed:"CAT-72 test completed",user_registered:"New account registered",api_key_created:"API key provisioned",api_key_revoked:"API key revoked"},ee={certificate_issued:e.accentGreen,certificate_revoked:e.accentRed,certificate_suspended:e.accentAmber,application_state_changed:e.accentAmber,test_completed:e.accentGreen,test_started:e.purpleBright,user_registered:e.purpleBright};return t.jsxs("div",{className:"space-y-6",style:{maxWidth:"1200px",margin:"0 auto"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"28px"},children:[t.jsxs("div",{children:[t.jsxs("p",{style:{fontFamily:e.mono,fontSize:"10px",letterSpacing:"4px",textTransform:"uppercase",color:e.purpleBright,marginBottom:"8px",display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{width:"24px",height:"1px",background:e.purpleBright}}),"Administration"]}),t.jsxs("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0},children:["Welcome",c!=null&&c.full_name?", "+c.full_name.split(" ")[0]:""]}),t.jsx("p",{style:{color:e.textTertiary,marginTop:"6px",fontSize:"13px",fontFamily:e.mono},children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})})]}),t.jsxs("button",{onClick:()=>u(!0),style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,padding:"10px 16px",color:e.textSecondary,cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(se,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:14,style:s?{animation:"spin 0.8s linear infinite"}:{}}),s?"Refreshing…":"Refresh"]})]}),(()=>{var g,v,z;const r=((g=j==null?void 0:j.sessions)==null?void 0:g.filter(w=>{const G=w.last_heartbeat_at||w.last_telemetry_at||w.started_at;return w.status==="active"&&G&&Date.now()-new Date(G).getTime()<12e4}).length)||((v=j==null?void 0:j.summary)==null?void 0:v.active)||0,i=B.filter(w=>w.expires_at&&w.state==="conformant"&&new Date(w.expires_at)<new Date(Date.now()+30*24*60*60*1e3)).length,a=C.length+i;return t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"16px"},children:[t.jsx(D,{onClick:()=>F("/applications"),label:"Needs Action",value:a,color:a>0?e.accentAmber:e.textTertiary,icon:t.jsx(le,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:a>0?e.accentAmber:e.textTertiary}}),subtitle:a>0?C.length+" pending · "+i+" expiring":"All clear"}),t.jsx(D,{onClick:()=>F("/cat72"),label:"Active Tests",value:(b==null?void 0:b.active_tests)||0,color:e.accentAmber,icon:t.jsx(X,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:e.accentAmber}})}),t.jsx(D,{onClick:()=>F("/certificates"),label:"Active Certificates",value:(b==null?void 0:b.certificates_active)||0,color:e.accentGreen,icon:t.jsx(ne,{size:20})}),t.jsx(D,{onClick:()=>F("/monitoring"),label:"Online Interlocks",value:r,color:r>0?e.accentGreen:e.textTertiary,icon:t.jsx(H,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-5 h-5",style:{color:r>0?e.accentGreen:e.textTertiary}}),subtitle:(z=j==null?void 0:j.summary)!=null&&z.total?"of "+j.summary.total+" registered":null})]})})(),t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Certification Pipeline"}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[m.length," total"]})]}),m.length===0?t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",textAlign:"center",padding:"20px 0"},children:"No applications yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[{key:"pending",label:"Pending",color:e.accentAmber,count:S.pending},{key:"under_review",label:"In Review",color:e.accentAmber,count:S.under_review},{key:"approved",label:"Approved",color:e.purpleBright,count:S.approved},{key:"testing",label:"Testing",color:e.purpleBright,count:S.testing},{key:"conformant",label:"Conformant",color:e.accentGreen,count:S.conformant},{key:"revoked",label:"Suspended",color:e.accentRed,count:S.revoked}].filter(r=>r.count>0).map(r=>{const i=Math.max(r.count/m.length*100,4);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary,width:"80px",textAlign:"right",flexShrink:0},children:r.label}),t.jsx("div",{style:{flex:1,height:"20px",background:"rgba(0,0,0,0.03)",position:"relative"},children:t.jsx("div",{style:{width:i+"%",height:"100%",background:r.color+"14",borderLeft:"3px solid "+r.color,transition:"width 0.4s"}})}),t.jsx("span",{style:{fontFamily:e.mono,fontSize:"12px",color:r.color,width:"24px",flexShrink:0},children:r.count})]},r.key)})})]}),C.length>0&&t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsxs("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.accentAmber,margin:0},children:["⚡ Review Queue (",C.length,")"]}),t.jsx(h,{to:"/applications",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"View All →"})]}),t.jsx("div",{className:"space-y-3",children:C.slice(0,5).map(r=>{var i;return t.jsxs("div",{style:{padding:"14px 16px",background:e.cardSurface,border:"1px solid "+e.borderGlass,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:[t.jsx(h,{to:"/applications/"+r.id,style:{color:e.purpleBright,textDecoration:"none",fontWeight:500,fontSize:"14px"},children:r.system_name}),t.jsx("span",{style:{color:e.textTertiary,fontSize:"12px"},children:r.organization_name}),t.jsx("span",{style:{color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:(i=r.state)==null?void 0:i.replace("_"," ")})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.state==="pending"&&t.jsx("button",{onClick:()=>K(r.id,r.system_name),style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"4px 10px",borderRadius:8},children:"Begin Review"}),t.jsx("button",{onClick:()=>R(r.id,"approved","Approve "+r.system_name),style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentGreen,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"4px 10px",borderRadius:8},children:"Approve"}),t.jsx("button",{onClick:()=>R(r.id,"suspended","Suspend "+r.system_name),style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentRed,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"4px 10px",borderRadius:8},children:"Suspend"}),t.jsx(h,{to:"/applications/"+r.id,style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",textDecoration:"none",padding:"4px 10px"},children:"View"})]})]},r.id)})})]}),o&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{background:"#fff",border:"1px solid "+e.borderGlass,padding:"32px",maxWidth:"480px",width:"90%"},children:[t.jsx("h3",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontWeight:400,fontSize:"20px",marginBottom:"8px"},children:o.label}),t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",marginBottom:"20px"},children:"A justification note is required for all certification decisions. This is recorded in the audit log."}),t.jsx("textarea",{autoFocus:!0,value:p,onChange:r=>_(r.target.value),placeholder:"Describe the basis for this decision…",rows:4,style:{width:"100%",padding:"12px",border:"1px solid "+e.borderGlass,fontFamily:e.mono,fontSize:"13px",color:e.textPrimary,background:e.cardSurface,resize:"vertical",boxSizing:"border-box"}}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"20px",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:()=>y(null),style:{padding:"8px 20px",background:"transparent",border:"1px solid "+e.borderGlass,color:e.textSecondary,fontFamily:e.mono,fontSize:"11px",cursor:"pointer"},children:"Cancel"}),t.jsxs("button",{onClick:N,style:{padding:"8px 20px",background:o.newState==="suspended"?e.accentRed:e.accentGreen,border:"none",color:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:["Confirm ",o.newState==="suspended"?"Suspension":"Approval"]})]})]})}),A.length>0&&t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Active CAT-72 Tests"}),t.jsx(h,{to:"/cat72",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"Console →"})]}),t.jsx("div",{className:"space-y-3",children:A.map(r=>{const i=Math.round(r.elapsed_seconds/(r.duration_hours*3600)*100),a=Math.max(0,(r.duration_hours*3600-r.elapsed_seconds)/3600).toFixed(1);return t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:"1px solid "+e.borderGlass},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"12px",color:e.purpleBright},children:[r.organization_name," — ",r.system_name]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[a,"h remaining"]}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:e.accentAmber},children:[i,"%"]})]})]}),t.jsx("div",{style:{height:"4px",background:"rgba(0,0,0,0.05)"},children:t.jsx("div",{style:{width:i+"%",height:"100%",background:i>=100?e.accentGreen:e.purpleBright,transition:"width 0.3s"}})})]},r.id)})})]}),(()=>{const r=B.filter(i=>i.expires_at&&i.state==="conformant"&&new Date(i.expires_at)<new Date(Date.now()+2592e6));return r.length===0?null:t.jsxs("div",{style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,padding:"16px",borderRadius:8},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[t.jsx(ce,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:16,style:{color:e.accentAmber}}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",color:e.accentAmber},children:[r.length," Certificate",r.length>1?"s":""," Expiring Within 30 Days"]})]}),r.map(i=>{const a=Math.ceil((new Date(i.expires_at)-Date.now())/864e5);return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",padding:"10px 0",borderTop:"1px solid "+e.borderSubtle},children:[t.jsxs("div",{children:[t.jsx("span",{style:{color:e.textPrimary,fontWeight:500,fontSize:"13px"},children:i.system_name}),t.jsx("span",{style:{color:e.textTertiary,fontSize:"12px",marginLeft:"12px"},children:i.organization_name})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"11px",color:a<=7?e.accentRed:e.accentAmber},children:[a,"d remaining"]}),t.jsx(h,{to:"/verify?cert="+i.certificate_number,style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:i.certificate_number}),t.jsx("button",{onClick:async()=>{try{await x.post("/api/certificates/"+i.id+"/notify-renewal"),f.show("Renewal notice sent to "+i.organization_name,"success")}catch{f.show("Could not send notice — contact licensee directly","error")}},style:{background:"transparent",border:"1px solid "+e.accentAmber+"40",color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",padding:"3px 8px",borderRadius:4},children:"Notify"})]})]},i.id)})]})})(),B.length>0&&t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Recent Certificates"}),t.jsx(h,{to:"/certificates",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"View All →"})]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsx("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:["Certificate","System","Status","Issued","Expires"].map(r=>t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontFamily:e.mono,fontSize:"11px",letterSpacing:"0.08em",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:r},r))})}),t.jsx("tbody",{children:B.slice(0,5).map(r=>t.jsxs("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:[t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx(h,{to:"/verify?cert="+r.certificate_number,style:{color:e.purpleBright,textDecoration:"none",fontFamily:e.mono,fontSize:"12px"},children:r.certificate_number})}),t.jsxs("td",{style:{padding:"12px 16px"},children:[t.jsx("span",{style:{color:e.textPrimary,fontSize:"13px"},children:r.system_name}),t.jsx("span",{style:{color:e.textTertiary,fontSize:"11px",marginLeft:"8px"},children:r.organization_name})]}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("span",{style:{fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",padding:"2px 8px",background:r.state==="conformant"?"rgba(22,135,62,0.06)":"rgba(180,52,52,0.06)",color:r.state==="conformant"?e.accentGreen:e.accentRed},children:r.state})}),t.jsx("td",{style:{padding:"12px 16px",color:e.textTertiary,fontSize:"13px"},children:r.issued_at?new Date(r.issued_at).toLocaleDateString():"—"}),t.jsx("td",{style:{padding:"12px 16px",fontFamily:e.mono,fontSize:"12px",color:r.expires_at&&new Date(r.expires_at)<new Date(Date.now()+30*24*60*60*1e3)?e.accentAmber:e.textTertiary},children:r.expires_at?new Date(r.expires_at).toLocaleDateString():"—"})]},r.id))})]})})]}),t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Recent Applications"}),t.jsx(h,{to:"/applications",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"View All →"})]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsx("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:["System","Organization","State","Submitted"].map(r=>t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontFamily:e.mono,fontSize:"11px",letterSpacing:"0.08em",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:r},r))})}),t.jsx("tbody",{children:P.map(r=>t.jsxs("tr",{style:{borderBottom:"1px solid "+e.borderGlass},children:[t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx(h,{to:"/applications/"+r.id,style:{color:e.purpleBright,textDecoration:"none"},children:r.system_name})}),t.jsx("td",{style:{padding:"12px 16px",color:e.textSecondary},children:r.organization_name}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("span",{style:{background:r.state==="conformant"?"rgba(22,135,62,0.06)":r.state==="revoked"?"rgba(180,52,52,0.06)":"rgba(158,110,18,0.06)",color:r.state==="conformant"?e.accentGreen:r.state==="revoked"?e.accentRed:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",padding:"2px 8px"},children:r.state})}),t.jsx("td",{style:{padding:"12px 16px",color:e.textTertiary,fontSize:"13px"},children:r.submitted_at?new Date(r.submitted_at).toLocaleDateString():"N/A"})]},r.id))})]})})]}),t.jsxs(T,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"System Activity"}),t.jsx(h,{to:"/activity",style:{fontFamily:e.mono,fontSize:"10px",color:e.purpleBright,textDecoration:"none"},children:"Full Log →"})]}),W.length===0?t.jsx("p",{style:{color:e.textTertiary,fontSize:"13px",textAlign:"center",padding:"20px 0"},children:"No recent activity"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:W.map((r,i)=>{var z,w,G,Y;const a=$[r.action]||r.action.replace(/_/g," "),g=ee[r.action]||e.textSecondary,v=((z=r.details)==null?void 0:z.system_name)||((w=r.details)==null?void 0:w.application_number)||((G=r.details)==null?void 0:G.certificate_number)||((Y=r.details)==null?void 0:Y.organization_name)||"";return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"10px 0",borderBottom:i<W.length-1?"1px solid "+e.borderSubtle:"none"},children:[t.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:g,flexShrink:0}}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textPrimary},children:a}),v&&t.jsx("span",{style:{fontSize:"12px",color:e.textTertiary,marginLeft:"8px"},children:v}),r.actor_name&&t.jsxs("span",{style:{fontSize:"11px",color:e.textTertiary,marginLeft:"8px",fontFamily:e.mono},children:["by ",r.actor_name]})]}),t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary,fontFamily:e.mono,flexShrink:0},children:Z(r.timestamp)})]},r.id||i)})})]})]})}function be(){const{user:c}=J();return(c==null?void 0:c.role)==="admin"?t.jsx(xe,{}):t.jsx(pe,{})}export{pe as CustomerDashboard,be as RoleBasedDashboard,xe as default};
