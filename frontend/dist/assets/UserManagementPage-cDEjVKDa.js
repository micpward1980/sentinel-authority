import{e as q,a as H,d as x,j as r,s as e}from"./index-CQToRwbo.js";import{r as d,P as J,l as O,U as X,i as K,n as Q,X as U}from"./icons-DCxkC3Ow.js";import{P as F}from"./Panel-CTXV6eYW.js";import{S as V}from"./SectionHeader-lim_qPma.js";import{S as j}from"./StatCard-CWZ4Z2x1.js";import"./vendor-DxYwK_Rn.js";function te(){const y=q(),c=H(),[m,C]=d.useState([]),[P,G]=d.useState(!0),[p,f]=d.useState(null),[v,_]=d.useState(""),[I,w]=d.useState(!1),[S,u]=d.useState(null),[i,N]=d.useState(null),[n,g]=d.useState({email:"",full_name:"",company:"",role:"applicant"}),[k,R]=d.useState(!1);d.useEffect(()=>{h()},[]);const h=async()=>{try{const a=await x.get("/api/users/");C(a.data||[])}catch(a){console.log("Users API not available:",a),C([])}G(!1)},A=m.filter(a=>p==="admins"?a.role==="admin":p==="applicants"?a.role==="applicant":p==="pending"?a.role==="pending":p==="inactive"?a.is_active===!1:!0).filter(a=>{var s,t,l;return((s=a.email)==null?void 0:s.toLowerCase().includes(v.toLowerCase()))||((t=a.full_name)==null?void 0:t.toLowerCase().includes(v.toLowerCase()))||((l=a.company)==null?void 0:l.toLowerCase().includes(v.toLowerCase()))}),b={total:m.length,admins:m.filter(a=>a.role==="admin").length,applicants:m.filter(a=>a.role==="applicant").length,pending:m.filter(a=>a.role==="pending").length,inactive:m.filter(a=>a.is_active===!1).length},z=async()=>{var a,s;if(!n.email||!n.full_name){c.show("Email and full name are required","warning");return}R(!0);try{const t=Math.random().toString(36).slice(-8)+"A1!";await x.post("/api/users/",{...n,password:t}),c.show("User created — share credentials securely","success"),w(!1),g({email:"",full_name:"",company:"",role:"applicant"}),h()}catch(t){c.show("Failed to create user: "+(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||t.message),"error")}R(!1)},B=async(a,s)=>{var t,l;if(await y({title:"Change Role",message:"Change user role to "+s.toUpperCase()+"?"}))try{await x.patch("/api/users/"+a,{role:s}),h(),u(null)}catch(o){c.show("Failed to update role: "+(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.detail)||o.message),"error")}},L=async(a,s)=>{var l,o;const t=s?"deactivate":"activate";if(await y({title:t.charAt(0).toUpperCase()+t.slice(1),message:t.charAt(0).toUpperCase()+t.slice(1)+" this user?"}))try{await x.patch("/api/users/"+a,{is_active:!s}),h(),u(null)}catch(T){c.show("Failed to update user: "+(((o=(l=T.response)==null?void 0:l.data)==null?void 0:o.detail)||T.message),"error")}},E=async(a,s)=>{var t,l;if(await y({title:"Reset Password",message:"Reset password for "+s+"?"}))try{const o=Math.random().toString(36).slice(-8)+"A1!";await x.post("/api/users/"+a+"/reset-password"),c.show("Password reset — share credentials securely","success")}catch(o){c.show("Failed to reset password: "+(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.detail)||o.message),"error")}},M=async(a,s)=>{var t,l;if(await y({title:"Approve User",message:"Approve "+s+" as an applicant?"}))try{await x.post("/api/users/"+a+"/approve"),h(),u(null)}catch(o){c.show("Failed to approve: "+(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.detail)||o.message),"error")}},D=async(a,s)=>{var t,l;if(await y({title:"Reject User",message:"Reject "+s+"? Their account will be deactivated.",danger:!0}))try{await x.post("/api/users/"+a+"/reject"),h(),u(null)}catch(o){c.show("Failed to reject: "+(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.detail)||o.message),"error")}},W=async(a,s)=>{var t,l;if(await y({title:"Delete User",message:"DELETE "+s+"? This cannot be undone.",danger:!0,confirmLabel:"Delete"}))try{await x.delete("/api/users/"+a),h(),u(null)}catch(o){c.show("Failed to delete user: "+(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.detail)||o.message),"error")}};return r.jsxs("div",{className:"space-y-6",children:[r.jsx(V,{label:"Administration",title:"User Management",description:"Manage admin and applicant accounts",action:r.jsxs("button",{onClick:()=>w(!0),className:"px-4 py-2 flex items-center gap-2",style:{background:"transparent",border:"none",borderBottom:"1px solid "+e.purpleBright,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:[r.jsx(J,{className:"w-4 h-4"})," Invite User"]})}),r.jsxs("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))"},children:[r.jsx(j,{label:"Total Users",value:b.total,color:p===null?e.purpleBright:e.textPrimary,onClick:()=>f(null)}),r.jsx(j,{label:"Admins",value:b.admins,color:e.purpleBright,onClick:()=>f(p==="admins"?null:"admins")}),r.jsx(j,{label:"Applicants",value:b.applicants,color:e.accentGreen,onClick:()=>f(p==="applicants"?null:"applicants")}),r.jsx(j,{label:"Pending",value:b.pending,color:e.accentAmber,onClick:()=>f(p==="pending"?null:"pending")}),r.jsx(j,{label:"Inactive",value:b.inactive,color:e.accentRed,onClick:()=>f(p==="inactive"?null:"inactive")})]}),r.jsx(F,{children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(O,{className:"w-5 h-5",style:{color:e.textTertiary}}),r.jsx("input",{type:"text",placeholder:"Search by name, email, or company...",value:v,onChange:a=>_(a.target.value),className:"flex-1 px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]})}),r.jsx(F,{children:P?r.jsx("div",{style:{color:e.textTertiary,textAlign:"center",padding:"clamp(16px, 4vw, 40px)"},children:"Loading users..."}):A.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"clamp(24px, 5vw, 60px)"},children:[r.jsx(X,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-12 h-12 mx-auto mb-4",style:{color:e.textTertiary}}),r.jsx("p",{style:{color:e.textSecondary,marginBottom:"8px"},children:"No users found"}),r.jsx("p",{style:{color:e.textTertiary,fontSize:"14px"},children:m.length===0?"The /api/users/ endpoint may not be configured.":"Try adjusting your search."})]}):r.jsx("div",{className:"space-y-2",children:A.map(a=>{var s,t;return r.jsxs("div",{style:{borderRadius:8,overflow:"hidden",border:"1px solid "+(S===(a.id||a.email)?e.purpleBright:e.borderGlass),transition:"border-color 0.2s"},children:[r.jsxs("div",{onClick:()=>{S===(a.id||a.email)?(u(null),N(null)):(u(a.id||a.email),N(a))},className:"flex items-center gap-4 p-4 cursor-pointer transition-all",style:{background:e.cardSurface},children:[r.jsx("div",{className:"w-10 h-10 flex items-center justify-center flex-shrink-0",style:{background:"transparent",color:e.purpleBright,fontWeight:"400"},children:((s=a.full_name)==null?void 0:s[0])||((t=a.email)==null?void 0:t[0])||"?"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{style:{color:e.textPrimary,fontWeight:"500"},children:a.full_name||"No Name"}),r.jsx("p",{style:{color:e.textTertiary,fontSize:"13px"},children:a.email}),a.company&&r.jsx("p",{style:{color:e.textTertiary,fontSize:"12px"},children:a.company})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"px-2 py-1 text-xs",style:{background:a.role==="admin"?"rgba(29,26,59,0.10)":a.role==="pending"?"rgba(158,110,18,0.10)":"rgba(0,0,0,0.04)",color:a.role==="admin"?e.purpleBright:a.role==="pending"?e.accentAmber:e.textTertiary,fontFamily:e.mono,textTransform:"uppercase"},children:a.role}),a.role==="pending"&&r.jsxs("div",{className:"flex gap-1",onClick:l=>l.stopPropagation(),children:[r.jsx("button",{onClick:()=>M(a.id,a.email),className:"px-2 py-1 text-xs",style:{background:"rgba(22,135,62,0.10)",color:e.accentGreen,border:"1px solid rgba(22,135,62,0.3)",cursor:"pointer"},children:"Approve"}),r.jsx("button",{onClick:()=>D(a.id,a.email),className:"px-2 py-1 text-xs",style:{background:e.cardSurface,color:e.accentRed,border:"1px solid "+e.borderSubtle,cursor:"pointer",borderRadius:8},children:"Reject"})]}),a.is_active===!1&&r.jsx("span",{className:"px-2 py-1 text-xs",style:{background:"transparent",color:e.accentRed},children:"Inactive"})]})]}),S===(a.id||a.email)&&i&&r.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"rgba(29,26,59,0.03)",borderTop:"1px solid "+e.borderGlass,padding:"20px 24px"},children:[r.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[r.jsx("button",{onClick:()=>B(i.id,"applicant"),style:{flex:1,padding:"10px",background:i.role==="applicant"?"rgba(29,26,59,0.10)":"transparent",border:"1px solid "+(i.role==="applicant"?e.purpleBright:e.borderGlass),color:i.role==="applicant"?e.purpleBright:e.textTertiary,borderRadius:6,cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:"Applicant"}),r.jsx("button",{onClick:()=>B(i.id,"admin"),style:{flex:1,padding:"10px",background:i.role==="admin"?"rgba(29,26,59,0.10)":"transparent",border:"1px solid "+(i.role==="admin"?e.purpleBright:e.borderGlass),color:i.role==="admin"?e.purpleBright:e.textTertiary,borderRadius:6,cursor:"pointer",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase"},children:"Admin"})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[r.jsxs("button",{onClick:()=>E(i.id,i.email),style:{width:"100%",padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textSecondary,textAlign:"left",borderRadius:6,cursor:"pointer"},children:[r.jsx(K,{className:"w-4 h-4",style:{color:e.purpleBright}}),"Reset Password"]}),r.jsx("button",{onClick:()=>L(i.id,i.is_active!==!1),style:{width:"100%",padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:e.cardSurface,border:"1px solid "+e.borderGlass,color:i.is_active===!1?e.accentGreen:e.accentRed,textAlign:"left",borderRadius:6,cursor:"pointer"},children:i.is_active===!1?r.jsxs(r.Fragment,{children:[r.jsx(Q,{className:"w-4 h-4"})," Activate Account"]}):r.jsxs(r.Fragment,{children:[r.jsx(U,{className:"w-4 h-4"})," Deactivate Account"]})}),r.jsxs("button",{onClick:()=>W(i.id,i.email),style:{width:"100%",padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentRed,textAlign:"left",borderRadius:6,cursor:"pointer"},children:[r.jsx(U,{className:"w-4 h-4"})," Delete User"]})]})]})]},a.id||a.email)})})}),I&&r.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",style:{background:"rgba(0,0,0,0.4)"},children:r.jsxs("div",{className:"w-full max-w-md mx-4 p-6",style:{background:"rgba(255,255,255,0.96)",backdropFilter:e.frostModal,WebkitBackdropFilter:e.frostModal,border:"1px solid "+e.borderGlass,borderRadius:8},children:[r.jsx("h2",{style:{fontFamily:e.serif,color:e.textPrimary,fontSize:"20px",fontWeight:200,marginBottom:"24px",textAlign:"center"},children:"Invite New User"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Email *"}),r.jsx("input",{type:"email",value:n.email,onChange:a=>g({...n,email:a.target.value}),placeholder:"user@company.com",className:"w-full px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Full Name *"}),r.jsx("input",{type:"text",value:n.full_name,onChange:a=>g({...n,full_name:a.target.value}),placeholder:"John Smith",className:"w-full px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Company"}),r.jsx("input",{type:"text",value:n.company,onChange:a=>g({...n,company:a.target.value}),placeholder:"Company name",className:"w-full px-4 py-3",style:{background:e.cardSurface,border:"1px solid "+e.borderGlass,color:e.textPrimary,outline:"none",borderRadius:8}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{color:e.textSecondary,fontSize:"12px",display:"block",marginBottom:"6px"},children:"Role"}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>g({...n,role:"applicant"}),className:"flex-1 px-4 py-3",style:{background:n.role==="applicant"?"rgba(29,26,59,0.10)":"rgba(0,0,0,0.025)",border:"1px solid "+(n.role==="applicant"?e.purpleBright:e.borderGlass),color:n.role==="applicant"?e.purpleBright:e.textTertiary,borderRadius:8},children:"Applicant"}),r.jsx("button",{onClick:()=>g({...n,role:"admin"}),className:"flex-1 px-4 py-3",style:{background:n.role==="admin"?"rgba(29,26,59,0.10)":"rgba(0,0,0,0.025)",border:"1px solid "+(n.role==="admin"?e.purpleBright:e.borderGlass),color:n.role==="admin"?e.purpleBright:e.textTertiary,borderRadius:8},children:"Admin"})]})]})]}),r.jsxs("div",{className:"mt-6 space-y-3",children:[r.jsx("button",{onClick:z,disabled:k,className:"w-full px-4 py-3",style:{background:"transparent",border:"none",borderBottom:"1px solid "+e.purpleBright,color:e.purpleBright,fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",opacity:k?.5:1},children:k?"Creating...":"Create Account"}),r.jsx("button",{onClick:()=>{w(!1),g({email:"",full_name:"",company:"",role:"applicant"})},className:"w-full px-4 py-3",style:{background:"transparent",border:"none",color:e.textTertiary},children:"Cancel"})]})]})})]})}export{te as default};
