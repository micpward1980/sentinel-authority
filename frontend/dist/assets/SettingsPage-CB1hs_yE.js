import{u as I,a as W,j as e,s as t,d as y,e as G}from"./index-D7btnJak.js";import{r as x,R as L,u as $,d as N,K,v as O,I as D,P as H,i as _,e as V,f as M,w as U,x as q}from"./icons-DCxkC3Ow.js";import"./vendor-DxYwK_Rn.js";const X="#f5f5f7",w="#e2e5ea",v="#ffffff",Y={admin:{label:"System Admin",color:t.purplePrimary},auditor:{label:"Independent Auditor",color:t.accentBlue},operator:{label:"System Operator",color:t.accentGreen},user:{label:"Certified Operator",color:t.accentGreen},customer:{label:"Certified Operator",color:t.accentGreen},viewer:{label:"Read-Only Viewer",color:t.textTertiary}};function Q({role:i}){const r=Y[(i||"").toLowerCase()]||{label:i||"User",color:t.textTertiary};return e.jsx("span",{style:{fontFamily:t.mono,fontSize:"10px",fontWeight:700,letterSpacing:"0.8px",padding:"3px 10px",borderRadius:"3px",border:`1px solid ${r.color}`,color:r.color,textTransform:"uppercase"},children:r.label})}function m({label:i,...r}){const[n,l]=x.useState(!1);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i&&e.jsx("label",{style:{fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary},children:i}),e.jsx("input",{...r,onFocus:f=>{var c;l(!0),(c=r.onFocus)==null||c.call(r,f)},onBlur:f=>{var c;l(!1),(c=r.onBlur)==null||c.call(r,f)},style:{padding:"9px 12px",border:`1px solid ${n?t.purpleBright:t.borderGlass}`,borderRadius:"3px",background:"rgba(255,255,255,0.9)",color:t.textPrimary,fontFamily:r.type==="text"&&r.readOnly?t.mono:t.sans,fontSize:"13px",outline:"none",boxShadow:n?"0 0 0 3px rgba(107,90,158,0.12)":"none",transition:"border-color 0.15s, box-shadow 0.15s",width:"100%",boxSizing:"border-box",...r.style}})]})}function k({title:i,description:r}){return e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h2",{style:{fontFamily:t.serif,fontSize:22,fontWeight:300,margin:"0 0 6px",color:t.purpleAccent},children:i}),r&&e.jsx("p",{style:{color:t.textSecondary,fontSize:13,margin:0,lineHeight:1.6},children:r})]})}function b({children:i,style:r={}}){return e.jsx("div",{style:{background:t.cardSurface,border:`1px solid ${t.borderSubtle}`,borderRadius:4,padding:"20px 20px",marginBottom:16,...r},children:i})}function T({children:i}){return e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:16},children:i})}function z({onClick:i,saving:r,saved:n,label:l="Save Changes"}){return e.jsx("button",{onClick:i,disabled:r,style:{padding:"9px 22px",background:"transparent",border:"none",borderBottom:`1px solid ${n?t.accentGreen:t.purpleBright}`,color:n?t.accentGreen:t.purpleBright,fontFamily:t.mono,fontSize:11,letterSpacing:"1px",textTransform:"uppercase",cursor:r?"wait":"pointer",opacity:r?.7:1},children:n?"✓ Saved":r?"Saving…":l})}function F({user:i,toast:r}){const[n,l]=x.useState({full_name:(i==null?void 0:i.full_name)||"",organization:(i==null?void 0:i.organization)||""}),[f,c]=x.useState(!1),d=async()=>{var p,s;c(!0);try{await y.put("/api/auth/profile",n),r.show("Profile updated","success"),setTimeout(()=>window.location.reload(),600)}catch(a){r.show("Failed: "+(((s=(p=a.response)==null?void 0:p.data)==null?void 0:s.detail)||a.message),"error")}c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"My Profile",description:"Update your display name and organization affiliation."}),e.jsxs(b,{children:[e.jsx(T,{children:"Account Information"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:14,maxWidth:520},children:[e.jsx(m,{label:"Full Name",value:n.full_name,onChange:p=>l({...n,full_name:p.target.value})}),e.jsx(m,{label:"Organization",value:n.organization,onChange:p=>l({...n,organization:p.target.value})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:5},children:"Email"}),e.jsx("div",{style:{fontSize:13,color:t.textPrimary},children:(i==null?void 0:i.email)||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:5},children:"Role"}),e.jsx(Q,{role:i==null?void 0:i.role})]})]}),e.jsx("div",{style:{marginTop:20},children:e.jsx(z,{onClick:d,saving:f,label:"Save Profile"})})]}),e.jsx(Z,{toast:r}),e.jsx(J,{toast:r,user:i})]})}function Z({toast:i}){const[r,n]=x.useState({current:"",new_pw:"",confirm:""}),[l,f]=x.useState(!1),[c,d]=x.useState(""),p=async()=>{var s,a;if(d(""),!r.current||!r.new_pw||!r.confirm){d("All fields required");return}if(r.new_pw!==r.confirm){d("Passwords do not match");return}if(r.new_pw.length<8){d("Minimum 8 characters");return}f(!0);try{await y.post("/api/auth/change-password",{current_password:r.current,new_password:r.new_pw}),i.show("Password changed","success"),n({current:"",new_pw:"",confirm:""})}catch(o){d(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.detail)||"Failed to change password")}f(!1)};return e.jsxs(b,{children:[e.jsx(T,{children:"Change Password"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12,maxWidth:380},children:[e.jsx(m,{label:"Current Password",type:"password",value:r.current,onChange:s=>n({...r,current:s.target.value})}),e.jsx(m,{label:"New Password",type:"password",value:r.new_pw,onChange:s=>n({...r,new_pw:s.target.value})}),e.jsx(m,{label:"Confirm New",type:"password",value:r.confirm,onChange:s=>n({...r,confirm:s.target.value})}),c&&e.jsx("div",{style:{color:t.accentRed,fontSize:12},children:c}),e.jsx("div",{style:{fontSize:11,color:t.textTertiary},children:"Min 8 chars · 1 uppercase · 1 lowercase · 1 number"}),e.jsx("div",{children:e.jsx(z,{onClick:p,saving:l,label:"Change Password"})})]})]})}function J({toast:i,user:r}){var p;const[n,l]=x.useState({enabled:!1,loading:!0,setup:null,code:"",verifying:!1,disablePw:"",disabling:!1,backupCodes:[]});x.useEffect(()=>{y.get("/api/auth/me").then(s=>l(a=>({...a,enabled:s.data.totp_enabled||!1,loading:!1}))).catch(()=>l(s=>({...s,loading:!1})))},[]);const f=async()=>{var s,a;try{const o=await y.post("/api/auth/2fa/setup");l(g=>({...g,setup:o.data}))}catch(o){i.show("Setup failed: "+(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.detail)||o.message),"error")}},c=async()=>{var s,a;l(o=>({...o,verifying:!0}));try{const o=await y.post("/api/auth/2fa/enable",{code:n.code});i.show("Two-factor authentication enabled","success"),l(g=>({...g,enabled:!0,setup:null,code:"",verifying:!1,backupCodes:o.data.backup_codes||[]}))}catch(o){i.show(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.detail)||"Invalid code","error"),l(g=>({...g,verifying:!1}))}},d=async()=>{var s,a;l(o=>({...o,disabling:!0}));try{await y.post("/api/auth/2fa/disable",{current_password:n.disablePw}),i.show("Two-factor authentication disabled","success"),l(o=>({...o,enabled:!1,disablePw:"",disabling:!1}))}catch(o){i.show(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.detail)||"Failed","error"),l(g=>({...g,disabling:!1}))}};return e.jsxs(b,{children:[e.jsx(T,{children:"Two-Factor Authentication"}),n.loading?e.jsx("div",{style:{color:t.textTertiary,fontSize:13},children:"Loading…"}):n.enabled?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:t.accentGreen}}),e.jsx("span",{style:{color:t.accentGreen,fontFamily:t.mono,fontSize:12,letterSpacing:"1px"},children:"ENABLED"})]}),e.jsx("p",{style:{color:t.textSecondary,fontSize:13,marginBottom:14},children:"Your account is protected with TOTP authentication."}),((p=n.backupCodes)==null?void 0:p.length)>0&&e.jsxs("div",{style:{marginBottom:16,padding:16,background:"rgba(158,110,18,0.04)",border:"1px solid rgba(158,110,18,0.18)",borderRadius:4},children:[e.jsx("p",{style:{color:t.accentAmber,fontFamily:t.mono,fontSize:10,letterSpacing:"1.5px",marginBottom:8,textTransform:"uppercase"},children:"Save Your Backup Codes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:3,marginBottom:10},children:n.backupCodes.map((s,a)=>e.jsx("span",{style:{fontFamily:t.mono,fontSize:13,color:t.textPrimary,textAlign:"center",padding:"2px 0"},children:s},a))}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(n.backupCodes.join(`
`)),i.show("Backup codes copied")},style:{padding:"5px 14px",background:"transparent",border:"1px solid rgba(158,110,18,0.3)",color:t.accentAmber,fontFamily:t.mono,fontSize:10,cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase",borderRadius:3},children:"Copy All"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",maxWidth:380},children:[e.jsx(m,{type:"password",value:n.disablePw,onChange:s=>l(a=>({...a,disablePw:s.target.value})),placeholder:"Enter password to disable",style:{flex:1}}),e.jsx("button",{onClick:d,disabled:n.disabling,style:{padding:"9px 16px",background:"transparent",border:`1px solid ${t.accentRed}`,color:t.accentRed,fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:3,flexShrink:0},children:n.disabling?"…":"Disable"})]})]}):n.setup?e.jsxs("div",{style:{maxWidth:380},children:[e.jsx("p",{style:{color:t.textSecondary,fontSize:13,marginBottom:14},children:"Scan this QR code with your authenticator app:"}),n.setup.qr_base64&&e.jsx("div",{style:{textAlign:"center",marginBottom:14},children:e.jsx("img",{src:"data:image/png;base64,"+n.setup.qr_base64,alt:"2FA QR",style:{width:180,height:180}})}),e.jsxs("div",{style:{background:t.cardSurface,border:`1px solid ${t.borderGlass}`,padding:12,marginBottom:14,borderRadius:3},children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:5},children:"Manual Entry Key"}),e.jsx("div",{style:{fontFamily:t.mono,fontSize:13,color:t.purpleBright,letterSpacing:"2px",wordBreak:"break-all"},children:n.setup.secret})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",value:n.code,onChange:s=>l(a=>({...a,code:s.target.value.replace(/\D/g,"").slice(0,6)})),placeholder:"6-digit code",maxLength:6,style:{flex:1,background:t.cardSurface,border:`1px solid ${t.borderGlass}`,padding:"10px 12px",color:t.textPrimary,fontSize:20,fontFamily:t.mono,letterSpacing:"8px",textAlign:"center",borderRadius:3,outline:"none"}}),e.jsx("button",{onClick:c,disabled:n.verifying||n.code.length!==6,style:{padding:"10px 18px",background:n.code.length===6?t.purplePrimary:"transparent",border:`1px solid ${t.purpleBright}`,color:n.code.length===6?"#fff":t.purpleBright,fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:3,opacity:n.code.length!==6?.5:1},children:n.verifying?"…":"Verify"})]})]}):e.jsxs("div",{children:[e.jsx("p",{style:{color:t.textSecondary,fontSize:13,marginBottom:14},children:"Require a TOTP code from your authenticator app on every sign-in."}),e.jsx("button",{onClick:f,style:{padding:"9px 20px",background:"transparent",border:"none",borderBottom:`1px solid ${t.purpleBright}`,color:t.purpleBright,fontFamily:t.mono,fontSize:11,letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Enable 2FA"})]})]})}const ee=30;function te({k:i,onDelete:r,toast:n}){const[l,f]=x.useState(!1),[c,d]=x.useState(0),p=x.useRef(null),s=()=>{f(!0),d(ee),p.current&&clearInterval(p.current),p.current=setInterval(()=>{d(o=>o<=1?(clearInterval(p.current),f(!1),0):o-1)},1e3)};x.useEffect(()=>()=>clearInterval(p.current),[]);const a=()=>{navigator.clipboard.writeText(i.key_prefix+"…(hidden)"),n.show("Key prefix copied","success")};return e.jsxs("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:[e.jsx("td",{style:{padding:"13px 14px",fontSize:13,color:t.textPrimary,fontWeight:500},children:i.name||"API Key"}),e.jsx("td",{style:{padding:"13px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontFamily:t.mono,fontSize:12,color:t.textPrimary},children:l&&i.key_full||i.key_prefix+"••••••••••••"}),e.jsx("button",{onClick:s,title:l?`Auto-hides in ${c}s`:"Reveal for 30s",style:{background:"none",border:"none",cursor:"pointer",color:t.textDim,lineHeight:0,padding:0},children:l?e.jsx(V,{size:13}):e.jsx(M,{size:13})}),l&&e.jsxs("span",{style:{fontFamily:t.mono,fontSize:9,color:t.accentAmber},children:[c,"s"]})]})}),e.jsx("td",{style:{padding:"13px 14px"},children:e.jsx("span",{style:{fontFamily:t.mono,fontSize:10,fontWeight:600,letterSpacing:"1px",padding:"3px 8px",borderRadius:3,background:"rgba(22,135,62,0.08)",color:t.accentGreen,border:"1px solid rgba(22,135,62,0.20)"},children:"ACTIVE"})}),e.jsx("td",{style:{padding:"13px 14px",color:t.textTertiary,fontSize:12,fontFamily:t.mono},children:i.last_used_at?new Date(i.last_used_at).toLocaleDateString():"—"}),e.jsx("td",{style:{padding:"13px 14px",textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",gap:6,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:a,title:"Copy prefix",style:{background:"none",border:`1px solid ${t.borderGlass}`,borderRadius:3,cursor:"pointer",padding:"4px 8px",color:t.textTertiary},children:e.jsx(U,{size:12})}),e.jsx("button",{onClick:()=>r(i),title:"Revoke key",style:{background:"none",border:"1px solid rgba(180,52,52,0.25)",borderRadius:3,cursor:"pointer",padding:"4px 8px",color:t.accentRed},children:e.jsx(q,{size:12})})]})})]})}function B({toast:i}){const r=G(),[n,l]=x.useState([]),[f,c]=x.useState(!0),[d,p]=x.useState(!1),[s,a]=x.useState(""),[o,g]=x.useState(!1),h=()=>{c(!0),y.get("/api/apikeys/").then(u=>l(u.data||[])).catch(()=>l([])).finally(()=>c(!1))};x.useEffect(h,[]);const A=async()=>{var u,j;if(s.trim()){p(!0);try{await y.post("/api/apikeys/",{name:s.trim()}),i.show("API key created","success"),a(""),g(!1),h()}catch(S){i.show("Failed: "+(((j=(u=S.response)==null?void 0:u.data)==null?void 0:j.detail)||S.message),"error")}p(!1)}},E=async u=>{var j,S;if(await r({title:"Revoke API Key",message:`Permanently revoke "${u.name||"this key"}"? Any systems using it will lose access immediately.`,danger:!0,confirmLabel:"Revoke"}))try{await y.delete("/api/apikeys/"+u.id),i.show("Key revoked","success"),h()}catch(C){i.show("Failed: "+(((S=(j=C.response)==null?void 0:j.data)==null?void 0:S.detail)||C.message),"error")}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"API Access Keys",description:"Programmatic access to the Sentinel Conformance Registry. Keys authenticate the ENVELO Interlock and automated regulatory integrations."}),e.jsxs("div",{style:{display:"flex",gap:12,padding:"14px 16px",background:"rgba(29,26,59,0.04)",border:"1px solid rgba(29,26,59,0.18)",borderRadius:4,marginBottom:20},children:[e.jsx(D,{size:18,color:t.purplePrimary,style:{flexShrink:0,marginTop:1}}),e.jsxs("div",{style:{fontSize:13,color:t.purpleAccent,lineHeight:1.6},children:[e.jsx("strong",{children:"Security Advisory:"})," API keys grant full access to the Conformance Registry on behalf of your account. Never embed keys in client-side code or public repositories. Tokens are shown once — store them immediately."]})]}),e.jsxs(b,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:10},children:[e.jsx(T,{children:"Active Keys"}),e.jsxs("button",{onClick:()=>g(u=>!u),style:{display:"flex",alignItems:"center",gap:6,padding:"7px 14px",background:t.purplePrimary,border:"none",color:"#fff",fontFamily:t.mono,fontSize:10,letterSpacing:"1.5px",textTransform:"uppercase",cursor:"pointer",borderRadius:3},children:[e.jsx(H,{size:12})," Generate Key"]})]}),o&&e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,maxWidth:440},children:[e.jsx(m,{placeholder:"Key label (e.g. prod_auditor)",value:s,onChange:u=>a(u.target.value),onKeyDown:u=>u.key==="Enter"&&A(),style:{flex:1}}),e.jsx("button",{onClick:A,disabled:d||!s.trim(),style:{padding:"9px 16px",background:t.purplePrimary,border:"none",color:"#fff",fontFamily:t.mono,fontSize:10,cursor:"pointer",borderRadius:3,flexShrink:0,letterSpacing:"1px",textTransform:"uppercase",opacity:s.trim()?1:.5},children:d?"…":"Create"}),e.jsx("button",{onClick:()=>g(!1),style:{padding:"9px 12px",background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textTertiary,cursor:"pointer",borderRadius:3,fontFamily:t.mono,fontSize:11},children:"✕"})]}),f?e.jsx("div",{style:{color:t.textTertiary,fontSize:13,padding:"20px 0",textAlign:"center"},children:e.jsx(_,{size:16,style:{animation:"spin 1s linear infinite",display:"inline-block"}})}):n.length===0?e.jsx("div",{style:{color:t.textTertiary,fontSize:13,padding:"24px 0",textAlign:"center"},children:"No API keys. Generate one to begin programmatic access."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:["Key Label","Token","Status","Last Used",""].map(u=>e.jsx("th",{style:{padding:"9px 14px",textAlign:u===""?"right":"left",fontFamily:t.mono,fontSize:9,letterSpacing:"1.5px",textTransform:"uppercase",color:t.textTertiary,fontWeight:600},children:u},u))})}),e.jsx("tbody",{children:n.map(u=>e.jsx(te,{k:u,onDelete:E,toast:i},u.id))})]})})]}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}function P({toast:i}){const[r,n]=x.useState(null),[l,f]=x.useState(!1),[c,d]=x.useState(!1),p=[{key:"application_updates",label:"Application Updates",desc:"Submission confirmations, review status changes, approval notifications"},{key:"test_notifications",label:"CAT-72 Test Notifications",desc:"Test scheduled, started, passed, and failed alerts"},{key:"certificate_alerts",label:"Certificate Alerts",desc:"Certificate issued, expiry warnings (30-day / 7-day), expiration notices"},{key:"agent_alerts",label:"ENVELO Interlock Alerts",desc:"Agent offline warnings, high violation rate, suspension alerts"},{key:"marketing",label:"Product Updates",desc:"New features, platform updates, and industry news from Sentinel Authority"}];x.useEffect(()=>{y.get("/api/users/email-preferences").then(o=>n(o.data.preferences||{})).catch(()=>n({application_updates:!0,test_notifications:!0,certificate_alerts:!0,agent_alerts:!0,marketing:!1}))},[]);const s=o=>{n(g=>({...g,[o]:!g[o]})),d(!1)},a=async()=>{var o,g;f(!0);try{await y.put("/api/users/email-preferences",r),d(!0),setTimeout(()=>d(!1),3e3)}catch(h){i.show("Failed: "+(((g=(o=h.response)==null?void 0:o.data)==null?void 0:g.detail)||h.message),"error")}f(!1)};return r?e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Email Notifications",description:"Control which system events generate email alerts from notifications@sentinelauthority.org."}),e.jsxs(b,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:p.map(o=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:16,padding:"14px 12px",background:r[o.key]?"rgba(22,135,62,0.03)":"transparent",border:`1px solid ${r[o.key]?"rgba(22,135,62,0.10)":t.borderGlass}`,borderRadius:3,marginBottom:4,transition:"all 0.2s"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textPrimary,fontWeight:500,fontSize:14,marginBottom:3},children:o.label}),e.jsx("div",{style:{color:t.textTertiary,fontSize:12,lineHeight:1.5},children:o.desc})]}),e.jsx("button",{onClick:()=>s(o.key),style:{width:44,height:24,borderRadius:12,border:"none",cursor:"pointer",background:r[o.key]?t.accentGreen:"rgba(0,0,0,0.07)",position:"relative",transition:"background 0.2s",flexShrink:0},children:e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:r[o.key]?23:3,transition:"left 0.2s"}})})]},o.key))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:16,paddingTop:14,borderTop:`1px solid ${t.borderGlass}`,flexWrap:"wrap",gap:10},children:[e.jsx("span",{style:{fontSize:11,color:t.textTertiary},children:"Admin and security emails are always sent regardless of these settings."}),e.jsx(z,{onClick:a,saving:l,saved:c})]})]})]}):e.jsx("div",{style:{color:t.textTertiary,padding:40,textAlign:"center"},children:"Loading preferences…"})}function R({toast:i}){const[r,n]=x.useState([]),[l,f]=x.useState(!0);x.useEffect(()=>{y.get("/api/auth/audit-log").then(d=>n(d.data.events||d.data||[])).catch(()=>n([])).finally(()=>f(!1))},[]);const c={login:t.accentGreen,logout:t.textTertiary,password_change:t.accentAmber,key_created:t.purpleBright,key_revoked:t.accentRed,"2fa_enabled":t.accentGreen,"2fa_disabled":t.accentRed};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Security Audit Log",description:"Immutable record of security-relevant account events. All entries are hash-chained and tamper-evident."}),e.jsx(b,{children:l?e.jsx("div",{style:{textAlign:"center",padding:32,color:t.textTertiary},children:e.jsx(_,{size:18,style:{animation:"spin 1s linear infinite"}})}):r.length===0?e.jsx("div",{style:{textAlign:"center",padding:32,color:t.textTertiary,fontSize:13},children:"No security events recorded yet."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:["Timestamp","Event","IP Address","Details"].map(d=>e.jsx("th",{style:{padding:"9px 14px",textAlign:"left",fontFamily:t.mono,fontSize:9,letterSpacing:"1.5px",textTransform:"uppercase",color:t.textTertiary,fontWeight:600},children:d},d))})}),e.jsx("tbody",{children:r.map((d,p)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:[e.jsx("td",{style:{padding:"11px 14px",fontFamily:t.mono,fontSize:11,color:t.textTertiary},children:d.created_at?new Date(d.created_at).toISOString().replace("T"," ").substring(0,16)+"Z":"—"}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx("span",{style:{fontFamily:t.mono,fontSize:10,fontWeight:700,letterSpacing:"0.8px",textTransform:"uppercase",color:c[d.event_type]||t.textSecondary},children:(d.event_type||"EVENT").replace(/_/g," ")})}),e.jsx("td",{style:{padding:"11px 14px",fontFamily:t.mono,fontSize:11,color:t.textTertiary},children:d.ip_address||"—"}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:t.textSecondary},children:d.details||"—"})]},p))})]})})})]})}function re({id:i,label:r,icon:n,active:l,onClick:f,badge:c}){return e.jsxs("button",{onClick:()=>f(i),style:{width:"100%",display:"flex",alignItems:"center",gap:10,padding:"10px 20px",border:"none",cursor:"pointer",textAlign:"left",background:l?v:"transparent",color:l?t.purplePrimary:t.textSecondary,borderLeft:`3px solid ${l?t.purplePrimary:"transparent"}`,fontWeight:l?600:400,fontSize:13,fontFamily:t.sans,transition:"background 0.12s, color 0.12s",boxSizing:"border-box"},children:[e.jsx("span",{style:{flexShrink:0,lineHeight:0},children:n}),e.jsx("span",{style:{flex:1},children:r}),c>0&&e.jsx("span",{style:{fontFamily:t.mono,fontSize:9,background:t.purpleBright,color:"#fff",borderRadius:10,padding:"1px 6px",fontWeight:700},children:c})]})}function oe(){const{user:i}=I(),r=W(),[n,l]=x.useState("profile"),[f,c]=x.useState(typeof window<"u"?window.innerWidth:1024);L.useEffect(()=>{const a=()=>c(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const d=f<768,p=[{group:"Personal",items:[{id:"profile",label:"My Profile",icon:e.jsx($,{size:15})},{id:"notifications",label:"Notifications",icon:e.jsx(N,{size:15})}]},{group:"Security",items:[{id:"apikeys",label:"API Access Keys",icon:e.jsx(K,{size:15})},{id:"audit",label:"Security Audit Log",icon:e.jsx(O,{size:15})}]}],s=p.flatMap(a=>a.items);return e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("p",{style:{fontFamily:t.mono,fontSize:"10px",fontWeight:600,letterSpacing:"0.20em",textTransform:"uppercase",color:t.purpleBright,margin:"0 0 8px 0"},children:"Account"}),e.jsx("h1",{style:{fontFamily:t.serif,fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0,color:t.textPrimary},children:"Settings"}),e.jsx("p",{style:{color:t.textSecondary,marginTop:4,fontSize:14,margin:"4px 0 0"},children:"Account, security, and notification preferences"})]}),d?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",gap:"2px",overflowX:"auto",WebkitOverflowScrolling:"touch",marginBottom:16,paddingBottom:2,borderBottom:`1px solid ${w}`},children:s.map(a=>e.jsxs("button",{onClick:()=>l(a.id),style:{display:"flex",alignItems:"center",gap:6,padding:"10px 14px",border:"none",cursor:"pointer",background:n===a.id?v:"transparent",borderBottom:`2px solid ${n===a.id?t.purplePrimary:"transparent"}`,color:n===a.id?t.purplePrimary:t.textTertiary,fontFamily:t.mono,fontSize:10,fontWeight:n===a.id?700:400,letterSpacing:"1px",textTransform:"uppercase",whiteSpace:"nowrap",flexShrink:0},children:[a.icon,a.label.split(" ")[0]]},a.id))}),e.jsxs("div",{style:{background:v,border:`1px solid ${w}`,borderRadius:4,padding:"clamp(14px, 3vw, 28px)",minHeight:300},children:[n==="profile"&&e.jsx(F,{user:i,toast:r}),n==="notifications"&&e.jsx(P,{toast:r}),n==="apikeys"&&e.jsx(B,{toast:r}),n==="audit"&&e.jsx(R,{toast:r})]})]}):e.jsxs("div",{style:{display:"flex",background:v,border:`1px solid ${w}`,borderRadius:4,minHeight:"calc(100vh - 180px)",overflow:"hidden"},children:[e.jsx("aside",{style:{width:240,background:X,borderRight:`1px solid ${w}`,padding:"20px 0",flexShrink:0},children:p.map(a=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{padding:"0 20px 6px",fontFamily:t.mono,fontSize:9,fontWeight:700,letterSpacing:"2px",textTransform:"uppercase",color:t.textDim},children:a.group}),a.items.map(o=>e.jsx(re,{...o,active:n===o.id,onClick:l},o.id))]},a.group))}),e.jsxs("main",{style:{flex:1,padding:"28px 32px",overflowY:"auto"},children:[n==="profile"&&e.jsx(F,{user:i,toast:r}),n==="notifications"&&e.jsx(P,{toast:r}),n==="apikeys"&&e.jsx(B,{toast:r}),n==="audit"&&e.jsx(R,{toast:r})]})]})]})}export{oe as default};
