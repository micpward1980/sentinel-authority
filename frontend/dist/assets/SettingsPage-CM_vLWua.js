import{a as W,u as L,b as D,d as c,j as e}from"./index-DMZ0bU0x.js";import{r as o}from"./icons-DL0PQMVt.js";import{S as O}from"./SectionHeader-CkSb-CHj.js";import"./vendor-DYB3FAiG.js";function H(){const{user:r}=W();L();const d=D(),[x,f]=o.useState(null),[v,b]=o.useState(!1),[w,y]=o.useState(!1),[u,j]=o.useState({full_name:(r==null?void 0:r.full_name)||"",organization:(r==null?void 0:r.organization)||""}),[S,C]=o.useState(!1),[n,m]=o.useState({current:"",new_pw:"",confirm:""}),[N,k]=o.useState(!1),[P,h]=o.useState(""),[i,l]=o.useState({enabled:!1,loading:!0,setup:null,code:"",verifying:!1,disablePw:"",disabling:!1});o.useEffect(()=>{c.get("/api/auth/me").then(a=>{l(s=>({...s,enabled:a.data.totp_enabled||!1,loading:!1}))}).catch(()=>l(a=>({...a,loading:!1})))},[]);const A=async()=>{var a,s;try{const t=await c.post("/api/auth/2fa/setup");l(p=>({...p,setup:t.data}))}catch(t){d.show("Setup failed: "+(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||t.message),"error")}},_=async()=>{var a,s;l(t=>({...t,verifying:!0}));try{const t=await c.post("/api/auth/2fa/enable",{code:i.code});d.show("Two-factor authentication enabled","success"),l(p=>({...p,enabled:!0,setup:null,code:"",verifying:!1,backupCodes:t.data.backup_codes||[]}))}catch(t){d.show(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||"Invalid code","error"),l(p=>({...p,verifying:!1}))}},F=async()=>{var a,s;l(t=>({...t,disabling:!0}));try{await c.post("/api/auth/2fa/disable",{current_password:i.disablePw}),d.show("Two-factor authentication disabled","success"),l(t=>({...t,enabled:!1,disablePw:"",disabling:!1}))}catch(t){d.show(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||"Failed","error"),l(p=>({...p,disabling:!1}))}},B=async()=>{var a,s;C(!0);try{const t=await c.put("/api/auth/profile",u);d.show("Profile updated","success"),t.data.user&&window.location.reload()}catch(t){d.show("Failed to update profile: "+(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||t.message),"error")}C(!1)},T=async()=>{var a,s;if(h(""),n.current===""||n.new_pw===""||n.confirm===""){h("All fields required");return}if(n.new_pw!==n.confirm){h("Passwords do not match");return}if(n.new_pw.length<8){h("Min 8 characters");return}k(!0);try{await c.post("/api/auth/change-password",{current_password:n.current,new_password:n.new_pw}),d.show("Password changed successfully","success"),m({current:"",new_pw:"",confirm:""})}catch(t){h(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||"Failed to change password")}k(!1)};o.useEffect(()=>{c.get("/api/users/email-preferences").then(a=>f(a.data.preferences||{})).catch(()=>{f({application_updates:!0,test_notifications:!0,certificate_alerts:!0,agent_alerts:!0,marketing:!1})})},[]);const z=a=>{f(s=>({...s,[a]:!s[a]})),y(!1)},E=async()=>{var a,s;b(!0);try{await c.put("/api/users/email-preferences",x),y(!0),setTimeout(()=>y(!1),3e3)}catch(t){d.show("Failed to save: "+(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||t.message),"error")}b(!1)},I=[{key:"application_updates",label:"Application Updates",desc:"Submission confirmations, review status changes, approval notifications"},{key:"test_notifications",label:"CAT-72 Test Notifications",desc:"Test scheduled, started, passed, and failed alerts"},{key:"certificate_alerts",label:"Certificate Alerts",desc:"Certificate issued, expiry warnings (30-day / 7-day), expiration notices"},{key:"agent_alerts",label:"ENVELO Interlock Alerts",desc:"Agent offline warnings, high violation rate, suspension alerts"},{key:"marketing",label:"Product Updates",desc:"New features, platform updates, and industry news from Sentinel Authority"}];if(!x)return e.jsx("div",{style:{color:"rgba(255,255,255,.50)",padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:"Loading preferences..."});const g=a=>e.jsx("label",{className:"hud-label",style:{display:"block",marginBottom:"6px"},children:a});return e.jsxs(e.Fragment,{children:[e.jsx(O,{label:"Account",title:"Settings"}),e.jsxs("div",{style:{maxWidth:"min(700px, 95vw)",margin:"0 auto"},children:[e.jsxs("div",{style:{paddingTop:"32px"},children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"20px"},children:"Account Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",maxWidth:"min(400px, 90vw)"},children:[e.jsxs("div",{children:[g("Full Name"),e.jsx("input",{type:"text",value:u.full_name,onChange:a=>j({...u,full_name:a.target.value})})]}),e.jsxs("div",{children:[g("Organization"),e.jsx("input",{type:"text",value:u.organization,onChange:a=>j({...u,organization:a.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"hud-label",children:"Email"}),e.jsx("div",{style:{color:"rgba(255,255,255,.94)",marginTop:"6px",fontSize:"13px"},children:(r==null?void 0:r.email)||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"hud-label",children:"Role"}),e.jsx("div",{style:{color:"#a896d6",marginTop:"6px",fontFamily:"var(--mono)",fontSize:"12px",textTransform:"uppercase",letterSpacing:"1px"},children:(r==null?void 0:r.role)||"-"})]})]}),e.jsx("button",{onClick:B,disabled:S,className:"btn",style:{alignSelf:"flex-start"},children:S?"Saving...":"Save Profile"})]})]}),e.jsx("div",{className:"hud-scanline",style:{margin:"32px 0"}}),e.jsxs("div",{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"20px"},children:"Change Password"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",maxWidth:"min(400px, 90vw)"},children:[e.jsxs("div",{children:[g("Current Password"),e.jsx("input",{type:"password",value:n.current,onChange:a=>m({...n,current:a.target.value})})]}),e.jsxs("div",{children:[g("New Password"),e.jsx("input",{type:"password",value:n.new_pw,onChange:a=>m({...n,new_pw:a.target.value})})]}),e.jsxs("div",{children:[g("Confirm New Password"),e.jsx("input",{type:"password",value:n.confirm,onChange:a=>m({...n,confirm:a.target.value})})]}),P&&e.jsx("div",{style:{color:"var(--accent-red)",fontSize:"12px"},children:P}),e.jsx("div",{style:{fontSize:"11px",color:"rgba(255,255,255,.50)"},children:"Min 8 chars, 1 uppercase, 1 lowercase, 1 number"}),e.jsx("button",{onClick:T,disabled:N,className:"btn",style:{alignSelf:"flex-start"},children:N?"Changing...":"Change Password"})]})]}),e.jsx("div",{className:"hud-scanline",style:{margin:"32px 0"}}),e.jsxs("div",{children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"20px"},children:"Two-Factor Authentication"}),i.loading?e.jsx("div",{style:{color:"rgba(255,255,255,.50)",fontSize:"13px"},children:"Loading..."}):i.enabled?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("span",{className:"hud-dot hud-dot-green"}),e.jsx("span",{style:{color:"var(--accent-green)",fontFamily:"var(--mono)",fontSize:"11px",letterSpacing:"2px"},children:"ENABLED"})]}),e.jsx("p",{className:"hud-desc",style:{marginBottom:"12px"},children:"Your account is protected with TOTP two-factor authentication."}),i.backupCodes&&i.backupCodes.length>0&&e.jsxs("div",{className:"hud-frame hud-frame-amber",style:{marginBottom:"16px"},children:[e.jsx("i",{}),e.jsx("div",{className:"hud-label",style:{color:"var(--accent-amber)",marginBottom:"8px"},children:"Save Your Backup Codes"}),e.jsx("p",{className:"hud-desc",style:{marginBottom:"12px"},children:"Use these if you lose your authenticator. Each code works once."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:i.backupCodes.map((a,s)=>e.jsx("span",{style:{fontFamily:"var(--mono)",fontSize:"13px",color:"rgba(255,255,255,.94)",padding:"4px 8px",textAlign:"center"},children:a},s))}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(i.backupCodes.join(`
`)),d.show("Backup codes copied")},className:"btn",style:{marginTop:"12px"},children:"Copy All"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",maxWidth:"min(400px, 90vw)"},children:[e.jsx("input",{type:"password",value:i.disablePw,onChange:a=>l(s=>({...s,disablePw:a.target.value})),placeholder:"Enter password to disable",style:{flex:1}}),e.jsx("button",{onClick:F,disabled:i.disabling,className:"btn",style:{color:"var(--accent-red)",whiteSpace:"nowrap"},children:i.disabling?"...":"Disable 2FA"})]})]}):i.setup?e.jsxs("div",{style:{maxWidth:"min(400px, 90vw)"},children:[e.jsx("p",{className:"hud-desc",style:{marginBottom:"16px"},children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),i.setup.qr_base64&&e.jsx("div",{style:{textAlign:"center",marginBottom:"16px"},children:e.jsx("img",{src:"data:image/png;base64,"+i.setup.qr_base64,alt:"QR Code",style:{width:"200px",height:"200px"}})}),e.jsxs("div",{style:{marginBottom:"16px",paddingBottom:"16px",borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[e.jsx("div",{className:"hud-label",style:{marginBottom:"6px"},children:"Manual Entry Key"}),e.jsx("div",{style:{fontFamily:"var(--mono)",fontSize:"14px",color:"var(--purple-bright)",letterSpacing:"2px",wordBreak:"break-all"},children:i.setup.secret})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("input",{type:"text",value:i.code,onChange:a=>l(s=>({...s,code:a.target.value.replace(/\D/g,"").slice(0,6)})),placeholder:"6-digit code",maxLength:6,style:{flex:1,fontSize:"18px",letterSpacing:"6px",textAlign:"center"}}),e.jsx("button",{onClick:_,disabled:i.verifying||i.code.length!==6,className:"btn primary",children:i.verifying?"...":"Verify"})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"hud-desc",style:{marginBottom:"16px"},children:"Add an extra layer of security by requiring a code from your authenticator app when signing in."}),e.jsx("button",{onClick:A,className:"btn primary",children:"Enable 2FA"})]})]}),e.jsx("div",{className:"hud-scanline",style:{margin:"32px 0"}}),e.jsxs("div",{style:{paddingBottom:"40px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:[e.jsx("div",{className:"hud-label",children:"Email Notifications"}),e.jsx("span",{style:{fontSize:"11px",color:"rgba(255,255,255,.50)"},children:"from notifications@sentinelauthority.org"})]}),e.jsx("div",{children:I.map(a=>e.jsxs("div",{className:"hud-row",style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",padding:"16px 0"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{color:"rgba(255,255,255,.94)",fontSize:"14px",marginBottom:"4px"},children:a.label}),e.jsx("div",{style:{color:"rgba(255,255,255,.50)",fontSize:"12px",lineHeight:"1.5"},children:a.desc})]}),e.jsx("button",{onClick:()=>z(a.key),className:"btn",style:{padding:"6px 16px",color:x[a.key]?"var(--accent-green)":"var(--text-tertiary)",borderColor:x[a.key]?"rgba(92,214,133,0.2)":"rgba(255,255,255,0.06)",minWidth:"56px",justifyContent:"center"},children:x[a.key]?"ON":"OFF"})]},a.key))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginTop:"20px",paddingTop:"16px",borderTop:"1px solid rgba(255,255,255,0.04)"},children:[e.jsx("span",{style:{fontSize:"11px",color:"rgba(255,255,255,.50)"},children:"Admin and security emails are always sent."}),e.jsx("button",{onClick:E,disabled:v,className:"btn primary",style:{color:w?"var(--accent-green)":void 0},children:w?"âœ“ Saved":v?"Saving...":"Save Preferences"})]})]})]})]})}export{H as default};
