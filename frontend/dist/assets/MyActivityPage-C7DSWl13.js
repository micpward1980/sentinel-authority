import{a as E,b as I,j as t,d as S}from"./index-Wp5BDwYI.js";import{r as d}from"./icons-DL0PQMVt.js";import{P as w}from"./Panel-hUr_7zjj.js";import{S as M}from"./SectionHeader-DU_g2rre.js";import"./vendor-DYB3FAiG.js";function q(){const{user:O}=E(),x=I(),[f,v]=d.useState([]),[h,C]=d.useState(0),[k,y]=d.useState(!0),[s,g]=d.useState(0),[l,F]=d.useState("30"),u=30,b=()=>{if(l==="all")return"";const e=new Date;return e.setDate(e.getDate()-parseInt(l)),e.toISOString()},L=async()=>{y(!0);try{const e=new URLSearchParams;e.set("limit",u),e.set("offset",s*u);const a=b();a&&e.set("date_from",a);const o=await S.get(`/api/audit/my-logs?${e}`);v(o.data.logs||[]),C(o.data.total||0)}catch(e){console.error("Failed to load activity:",e)}y(!1)},R=async()=>{try{const e=new URLSearchParams,a=b();a&&e.set("date_from",a),e.set("limit",1e4),e.set("offset",0);const p=(await S.get(`/api/audit/my-logs?${e}`)).data.logs||[];if(p.length===0){x.show("No entries to export","warning");return}const D=["Timestamp,Action,Resource Type,Resource ID,Details",...p.map(i=>{const z=i.details?Object.entries(i.details).map(([P,T])=>P+"="+T).join("; "):"";return[i.timestamp||"",i.action||"",i.resource_type||"",i.resource_id||"",'"'+z.replace(/"/g,'""')+'"'].join(",")})].join(`
`),_=new Blob([D],{type:"text/csv"}),j=URL.createObjectURL(_),m=document.createElement("a");m.href=j,m.download="my-activity-"+new Date().toISOString().split("T")[0]+".csv",m.click(),URL.revokeObjectURL(j),x.show("CSV exported ("+p.length+" entries)","success")}catch{x.show("Export failed","error")}};d.useEffect(()=>{L()},[s,l]);const A=e=>e!=null&&e.includes("issued")||e!=null&&e.includes("approved")||e!=null&&e.includes("conformant")?"#5CD685":e!=null&&e.includes("suspended")||e!=null&&e.includes("revoked")||e!=null&&e.includes("failed")?"#D65C5C":e!=null&&e.includes("pending")||e!=null&&e.includes("under_review")?"#D6A05C":"#a896d6",n=Math.ceil(h/u),r="Consolas, 'IBM Plex Mono', monospace",c={padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:r,textTransform:"uppercase",letterSpacing:"1px",color:"rgba(255,255,255,.50)"};return t.jsxs(t.Fragment,{children:[t.jsx(M,{label:"Account",title:"My Activity"}),t.jsxs("div",{className:"space-y-6",style:{maxWidth:"min(900px, 95vw)",margin:"0 auto"},children:[t.jsx(w,{children:t.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[["7","30","90","all"].map(e=>t.jsx("button",{onClick:()=>{F(e),g(0)},style:{padding:"5px 10px",background:l===e?"rgba(168,150,214,0.15)":"transparent",border:`1px solid ${l===e?"rgba(168,150,214,0.4)":"rgba(255,255,255,.07)"}`,color:l===e?"#a896d6":"rgba(255,255,255,.50)",fontFamily:r,fontSize:"10px",cursor:"pointer",letterSpacing:"0.5px"},children:e==="all"?"All":e+"d"},e)),t.jsxs("span",{style:{fontFamily:r,fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[h.toLocaleString()," entries"]}),t.jsx("button",{onClick:R,style:{marginLeft:"auto",padding:"6px 14px",background:"rgba(157,140,207,0.12)",border:"1px solid rgba(157,140,207,0.3)",color:"#a896d6",fontFamily:r,fontSize:"10px",cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase"},children:"Export CSV"})]})}),t.jsxs(w,{noPad:!0,children:[k?t.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:"rgba(255,255,255,.50)"},children:"Loading..."}):f.length===0?t.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:"rgba(255,255,255,.50)"},children:"No activity yet"}):t.jsx("div",{style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:c,children:"Timestamp"}),t.jsx("th",{style:c,children:"Action"}),t.jsx("th",{style:c,children:"Resource"}),t.jsx("th",{style:c,children:"Details"})]})}),t.jsx("tbody",{children:f.map(e=>{var a;return t.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,.04)"},children:[t.jsx("td",{style:{padding:"12px 16px",fontFamily:r,fontSize:"11px",color:"rgba(255,255,255,.78)",whiteSpace:"nowrap"},children:e.timestamp?new Date(e.timestamp).toLocaleString():"-"}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("span",{style:{fontFamily:r,fontSize:"11px",color:A(e.action),letterSpacing:"0.5px"},children:(a=e.action)==null?void 0:a.replace(/_/g," ")})}),t.jsxs("td",{style:{padding:"12px 16px",fontFamily:r,fontSize:"11px",color:"rgba(255,255,255,.50)"},children:[e.resource_type,e.resource_id?` #${e.resource_id}`:""]}),t.jsx("td",{style:{padding:"12px 16px",fontSize:"12px",color:"rgba(255,255,255,.50)",maxWidth:"300px"},children:e.details?Object.entries(e.details).filter(([o])=>o!=="old_state").map(([o,p])=>t.jsxs("span",{style:{marginRight:"12px"},children:[t.jsxs("span",{style:{color:"rgba(255,255,255,.50)"},children:[o.replace(/_/g," "),":"]})," ",t.jsx("span",{style:{color:"rgba(255,255,255,.78)"},children:String(p)})]},o)):"-"})]},e.id)})})]})}),n>1&&t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"8px",padding:"16px",borderTop:"1px solid rgba(255,255,255,.04)"},children:[t.jsxs("button",{onClick:()=>g(Math.max(0,s-1)),disabled:s===0,style:{padding:"6px 12px",background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",color:s===0?"rgba(255,255,255,.50)":"rgba(255,255,255,.94)",cursor:s===0?"not-allowed":"pointer",fontFamily:r,fontSize:"11px"},children:["←"," Prev"]}),t.jsxs("span",{style:{padding:"6px 12px",fontFamily:r,fontSize:"11px",color:"rgba(255,255,255,.78)"},children:[s+1," / ",n]}),t.jsxs("button",{onClick:()=>g(Math.min(n-1,s+1)),disabled:s>=n-1,style:{padding:"6px 12px",background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",color:s>=n-1?"rgba(255,255,255,.50)":"rgba(255,255,255,.94)",cursor:s>=n-1?"not-allowed":"pointer",fontFamily:r,fontSize:"11px"},children:["Next ","→"]})]})]})]})]})}export{q as default};
