import{u as z,a as _,b as w,j as t,s as e,A,d as m}from"./index-BedPMBGb.js";import{r as f}from"./icons-BDb2Zpiz.js";import{P as h}from"./Panel-BxJjkWUN.js";import"./vendor-BY35fGmp.js";function k(){const y=z(),{user:n}=_(),[p,j]=f.useState([]),d=w(),[a,l]=f.useState({}),[C,T]=f.useState(Date.now()),c=()=>{m.get("/api/cat72/tests").then(r=>j(Array.isArray(r.data)?r.data:[])).catch(console.error)};f.useEffect(()=>{c();const r=setInterval(c,15e3),s=setInterval(()=>T(Date.now()),1e3);return()=>{clearInterval(r),clearInterval(s)}},[]);const v=async r=>{var s,i;if(await y({title:"Start Test",message:"Start this CAT-72 test? The 72-hour timer will begin."})){l(o=>({...o,[r]:"starting"}));try{await m.post(`/api/cat72/tests/${r}/start`),c()}catch(o){d.show("Failed to start test: "+(((i=(s=o.response)==null?void 0:s.data)==null?void 0:i.detail)||o.message),"error")}l(o=>({...o,[r]:null}))}},b=async r=>{var s,i;if(await y({title:"Stop Test",message:"Stop this CAT-72 test and evaluate results?"})){l(o=>({...o,[r]:"stopping"}));try{await m.post(`/api/cat72/tests/${r}/stop`),c()}catch(o){d.show("Failed to stop test: "+(((i=(s=o.response)==null?void 0:s.data)==null?void 0:i.detail)||o.message),"error")}l(o=>({...o,[r]:null}))}},F=async r=>{var s,i;if(await y({title:"Issue Certificate",message:"Issue ODDC certificate for this passed test?"})){l(o=>({...o,[r]:"issuing"}));try{const o=await m.post(`/api/certificates/issue/${r}`);d.show(`Certificate issued: ${o.data.certificate_number}`,"success"),c()}catch(o){d.show("Failed to issue certificate: "+(((i=(s=o.response)==null?void 0:s.data)==null?void 0:i.detail)||o.message),"error")}l(o=>({...o,[r]:null}))}},g=r=>{const s=Math.floor(r/3600),i=Math.floor(r%3600/60),o=Math.floor(r%60);return`${String(s).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(o).padStart(2,"0")}`},u=p.filter(r=>r.state==="running"),S=p.filter(r=>r.state==="scheduled"),x=p.filter(r=>r.state==="completed");return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("p",{style:{fontFamily:e.mono,fontSize:"10px",letterSpacing:"4px",textTransform:"uppercase",color:e.purpleBright,marginBottom:"8px"},children:"Testing"}),t.jsx("h1",{style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0},children:"CAT-72 Console"}),t.jsx("p",{style:{color:e.textSecondary,marginTop:"8px"},children:(n==null?void 0:n.role)==="admin"?"72-hour Convergence Authorization Tests · Auto-refreshes every 15s":"Monitor your 72-hour conformance test in real time"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px"},children:[t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.accentAmber},children:u.length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Running"})]}),t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.purpleBright},children:S.length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Scheduled"})]}),t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.accentGreen},children:x.filter(r=>r.result==="PASS").length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Passed"})]}),t.jsxs("div",{style:{padding:"16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,textAlign:"center"},children:[t.jsx("div",{style:{fontFamily:e.serif,fontSize:"clamp(18px, 4vw, 24px)",fontWeight:200,color:e.accentRed},children:x.filter(r=>r.result==="FAIL").length}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"9px",color:e.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"4px"},children:"Failed"})]})]}),u.length>0&&t.jsxs("div",{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.accentAmber,marginBottom:"12px"},children:"● Live Tests"}),t.jsx("div",{className:"space-y-4",children:u.map(r=>{const s=r.duration_hours*3600,i=Math.min(100,Math.round(r.elapsed_seconds/s*100)),o=Math.max(0,s-r.elapsed_seconds);return t.jsxs(h,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:500,fontSize:"16px",color:e.textPrimary,marginBottom:"4px"},children:[r.organization_name," — ",r.system_name]}),t.jsxs("div",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:["Test ID: ",r.test_id," · Duration: ",r.duration_hours,"h"]})]}),(n==null?void 0:n.role)==="admin"&&t.jsx("button",{onClick:()=>b(r.test_id),disabled:a[r.test_id],className:"px-4 py-2",style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:8},children:a[r.test_id]==="stopping"?"...":"Stop & Evaluate"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"8px"},children:[t.jsx("div",{style:{fontFamily:e.mono,fontSize:"clamp(20px, 4vw, 28px)",fontWeight:200,color:e.purpleBright,letterSpacing:"2px"},children:g(r.elapsed_seconds)}),t.jsx("div",{style:{flex:1},children:t.jsx("div",{className:"w-full h-3 overflow-hidden",style:{background:"transparent"},children:t.jsx("div",{className:"h-full transition-all",style:{width:`${i}%`,background:i>=100?e.accentGreen:e.purplePrimary}})})}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"14px",color:i>=100?e.accentGreen:e.textSecondary,fontWeight:500},children:[i,"%"]})]}),t.jsxs("div",{style:{display:"flex",gap:"24px"},children:[t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary},children:["Remaining: ",g(o)]}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary},children:["Telemetry: ",r.telemetry_count||0," events"]}),t.jsxs("span",{style:{fontFamily:e.mono,fontSize:"10px",color:r.violations_count>0?e.accentRed:e.textTertiary},children:["Violations: ",r.violations_count||0]})]})]},r.id)})})]}),S.length>0&&t.jsxs(h,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Scheduled"}),t.jsx("div",{className:"space-y-3",children:S.map(r=>t.jsxs("div",{style:{padding:"14px 16px",background:e.cardSurface,border:`1px solid ${e.borderGlass}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:500,color:e.textPrimary,marginBottom:"2px"},children:[r.organization_name," — ",r.system_name]}),t.jsxs("div",{style:{fontFamily:e.mono,fontSize:"11px",color:e.textTertiary},children:[r.test_id," · ",r.duration_hours,"h test"]})]}),(n==null?void 0:n.role)==="admin"&&t.jsx("button",{onClick:()=>v(r.test_id),disabled:a[r.test_id],className:"px-4 py-2",style:{background:e.cardSurface,border:"1px solid "+e.borderSubtle,color:e.accentGreen,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:8},children:a[r.test_id]==="starting"?"...":"Start Test"})]},r.id))})]}),x.length>0&&t.jsxs(h,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Completed"}),t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:`1px solid ${e.borderGlass}`},children:[t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"System"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Result"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Duration"}),t.jsx("th",{className:"px-4 py-3 text-left",style:{fontFamily:e.mono,fontSize:"9px",letterSpacing:"1.5px",textTransform:"uppercase",color:e.textTertiary,fontWeight:400},children:"Actions"})]})}),t.jsx("tbody",{children:x.map(r=>t.jsxs("tr",{style:{borderBottom:`1px solid ${e.borderGlass}`},children:[t.jsxs("td",{className:"px-4 py-4",children:[t.jsxs("div",{style:{fontWeight:500,color:e.textPrimary},children:[r.organization_name," — ",r.system_name]}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"10px",color:e.textTertiary,marginTop:"2px"},children:r.test_id})]}),t.jsx("td",{className:"px-4 py-4",children:t.jsx("span",{style:{fontFamily:e.mono,fontSize:"12px",fontWeight:500,color:r.result==="PASS"?e.accentGreen:e.accentRed,padding:"4px 10px",background:r.result==="PASS"?"rgba(22,135,62,0.06)":"rgba(180,52,52,0.06)"},children:r.result})}),t.jsx("td",{className:"px-4 py-4",style:{fontFamily:e.mono,fontSize:"12px",color:e.textSecondary},children:g(r.elapsed_seconds)}),t.jsx("td",{className:"px-4 py-4",children:t.jsxs("div",{className:"flex gap-2",children:[(n==null?void 0:n.role)==="admin"&&r.result==="PASS"&&!r.certificate_issued&&t.jsx("button",{onClick:()=>F(r.test_id),disabled:a[r.test_id],className:"px-3 py-1",style:{background:"transparent",border:"none",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:a[r.test_id]==="issuing"?"...":"Issue Certificate"}),r.certificate_issued&&t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{color:e.accentGreen,fontFamily:e.mono,fontSize:"10px"},children:"✓ Certified"}),t.jsx("a",{href:`${A}/api/certificates/${r.certificate_number||r.test_id}/pdf`,target:"_blank",rel:"noreferrer noopener",style:{marginLeft:"8px",padding:"2px 0",background:"transparent",borderBottom:`1px solid ${e.purpleBright}`,color:e.purpleBright,fontFamily:e.mono,fontSize:"9px",textDecoration:"none"},children:"PDF"})]})]})})]},r.id))})]})]}),p.length===0&&t.jsx(h,{children:t.jsxs("div",{className:"text-center py-12",style:{color:e.textTertiary},children:[t.jsx("p",{style:{marginBottom:"8px"},children:(n==null?void 0:n.role)==="admin"?"No tests yet":"No active tests"}),t.jsx("p",{style:{fontSize:"13px"},children:(n==null?void 0:n.role)==="admin"?"Approve an application and schedule a CAT-72 test to get started.":"When your application is approved and a CAT-72 test is scheduled, you can monitor its progress here in real time."})]})})]})}export{k as default};
