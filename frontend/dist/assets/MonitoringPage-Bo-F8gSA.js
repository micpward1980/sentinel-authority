import{e as K,a as Q,b as H,u as Z,j as e,s as t,d as u}from"./index-BedPMBGb.js";import{r as g,i as I,D as J,k as X}from"./icons-BDb2Zpiz.js";import{u as G}from"./useQuery-QkvP9CZV.js";import"./Panel-BxJjkWUN.js";import"./vendor-BY35fGmp.js";function oe(){var O;const[s,_]=g.useState(null),[k,L]=g.useState([]),[w,P]=g.useState(!0),[F,C]=g.useState(!1),v=K(),[z,W]=g.useState(""),[B,E]=g.useState(!1),[A,$]=g.useState(!0),{user:o}=Q(),f=H(),U=Z(),{data:D,isLoading:N,refetch:Y}=G({queryKey:["monitoring-overview"],queryFn:()=>u.get("/api/envelo/monitoring/overview").then(n=>n.data),refetchInterval:w?1e4:!1}),{data:T}=G({queryKey:["monitoring-alerts"],queryFn:()=>u.get("/api/envelo/monitoring/alerts").then(n=>n.data),refetchInterval:w?1e4:!1}),j=D??null,S=(T==null?void 0:T.alerts)??[],q=g.useCallback(async()=>{C(!0),await Promise.all([v.invalidateQueries({queryKey:["monitoring-overview"]}),v.invalidateQueries({queryKey:["monitoring-alerts"]})]),setTimeout(()=>C(!1),600)},[v]),V=async n=>{try{const i=await u.get(`/api/envelo/monitoring/session/${n}/timeline?hours=24`);L(i.data.timeline||[])}catch(i){console.error("Failed to fetch timeline:",i)}};g.useEffect(()=>{s&&V(s.id)},[s]);const M=()=>{const n=R.map(r=>{var m;const p=(r.pass_count||0)+(r.block_count||0),y=p>0?(r.pass_count/p*100).toFixed(2):"0.00";return{status:r.is_online?"Online":r.status==="ended"?"Ended":"Offline",organization:r.organization_name||"",system_name:r.system_name||"",certificate:r.certificate_id||"",session_id:r.session_id||"",started_at:r.started_at||"",ended_at:r.ended_at||"",uptime_hours:((m=r.uptime_hours)==null?void 0:m.toFixed(2))||"0",pass_count:r.pass_count||0,block_count:r.block_count||0,total_actions:p,pass_rate:y+"%",agent_version:r.agent_version||"",last_activity:r.last_activity||""}});if(n.length===0){f.show("No sessions to export","warning");return}const i=Object.keys(n[0]),c=[i.join(","),...n.map(r=>i.map(p=>{const y=String(r[p]).replace(/"/g,'""');return y.includes(",")||y.includes('"')||y.includes(`
`)?`"${y}"`:y}).join(","))].join(`
`),d=new Blob([c],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(d),l=document.createElement("a");l.href=a,l.download=`envelo-sessions-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)};if(N)return e.jsxs("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:[e.jsx(I,{size:24,style:{animation:"spin 1s linear infinite",color:t.purpleBright}}),e.jsx("p",{style:{marginTop:"16px",color:t.textSecondary},children:"Loading monitoring data..."})]});const x=(j==null?void 0:j.summary)||{},b=(j==null?void 0:j.sessions)||[],R=b.filter(n=>!(z&&n.organization_name!==z||B&&!n.is_online||A&&(n.status==="ended"||n.status==="completed"||n.status==="disconnected")));return e.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"sa-page-title",style:{fontFamily:"Georgia, 'Source Serif 4', serif",fontSize:"clamp(20px, 4vw, 28px)",fontWeight:300,margin:0},children:"System Monitoring"}),e.jsx("p",{style:{color:t.textSecondary,marginTop:"4px",fontSize:"14px"},children:(o==null?void 0:o.role)==="admin"?"Real-time ENVELO agent status and telemetry":"Track your certified systems' compliance status"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",color:t.textSecondary,fontSize:"13px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:n=>P(n.target.checked),style:{accentColor:t.purpleBright}}),"Auto-refresh"]}),e.jsxs("button",{onClick:q,style:{background:t.bgPanel,border:`1px solid ${t.borderGlass}`,padding:"8px 16px",color:t.textPrimary,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(I,{size:14,style:F?{animation:"spin 1s linear infinite"}:{}})," ",F?"Refreshing...":"Refresh"]}),(o==null?void 0:o.role)==="admin"&&e.jsxs("button",{onClick:M,style:{background:t.bgPanel,border:`1px solid ${t.borderGlass}`,padding:"8px 16px",color:t.textPrimary,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontFamily:t.mono,fontSize:"11px",letterSpacing:"0.5px"},children:[e.jsx(J,{size:14})," Export CSV"]})]})]}),S.length>0&&e.jsxs("div",{style:{background:"rgba(214, 92, 92, 0.1)",border:"1px solid "+t.borderGlass,padding:"16px",marginBottom:"24px",borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx(X,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,size:18,style:{color:t.accentRed}}),e.jsxs("span",{style:{fontWeight:500,color:t.accentRed},children:[S.length," Active Alert",S.length>1?"s":""]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:S.map((n,i)=>{var c;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",background:"transparent",padding:"10px 14px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:n.severity==="critical"?t.accentRed:t.accentAmber,marginRight:"12px"},children:n.severity}),e.jsx("span",{style:{color:t.textPrimary},children:n.message})]}),e.jsxs("span",{style:{color:t.textTertiary,fontSize:"12px",fontFamily:t.mono},children:[(c=n.session_id)==null?void 0:c.slice(0,8),"..."]})]},i)})})]}),(()=>{var p,y,m;const n=b.filter(h=>h.is_online).length,i=b.filter(h=>!h.is_online&&h.status!=="ended").length,c=n+i,d=c>0?n/c*100:0,a={background:t.cardSurface,border:"1px solid "+t.borderSubtle,padding:"20px"},l={fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"2px",color:t.textTertiary,marginBottom:"8px"},r={fontSize:"12px",color:t.textSecondary,marginTop:"4px"};return e.jsxs("div",{style:{marginBottom:"32px"},children:[c>0&&e.jsxs("div",{style:{marginBottom:"20px",padding:"16px 20px",...a},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"10px"},children:[e.jsx("div",{style:l,children:"Fleet Health"}),e.jsxs("div",{style:{fontFamily:t.mono,fontSize:"13px",color:d>=90?t.accentGreen:d>=70?t.accentAmber:t.accentRed,fontWeight:500},children:[d.toFixed(0),"% Online"]})]}),e.jsxs("div",{style:{height:"8px",background:"transparent",overflow:"hidden",display:"flex"},children:[n>0&&e.jsx("div",{style:{width:n/c*100+"%",background:t.accentGreen,transition:"width 0.5s"}}),i>0&&e.jsx("div",{style:{width:i/c*100+"%",background:t.accentRed,transition:"width 0.5s"}})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"8px"},children:[e.jsxs("span",{style:{fontSize:"11px",color:t.accentGreen,display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:t.accentGreen,display:"inline-block"}})," ",n," online"]}),e.jsxs("span",{style:{fontSize:"11px",color:t.accentRed,display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:t.accentRed,display:"inline-block"}})," ",i," offline"]}),e.jsxs("span",{style:{fontSize:"11px",color:t.textTertiary,display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:t.textTertiary,display:"inline-block"}})," ",x.ended||0," ended"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:a,children:[e.jsx("div",{style:l,children:(o==null?void 0:o.role)==="admin"?"Active Sessions":"Active Systems"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.accentGreen},children:x.active||0}),e.jsxs("div",{style:r,children:[x.offline||0," offline"]})]}),e.jsxs("div",{style:a,children:[e.jsx("div",{style:l,children:"Total Actions"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.textPrimary},children:(x.total_actions||0).toLocaleString()}),e.jsxs("div",{style:r,children:[((p=x.total_pass)==null?void 0:p.toLocaleString())||0," passed, ",((y=x.total_block)==null?void 0:y.toLocaleString())||0," blocked"]})]}),e.jsxs("div",{style:a,children:[e.jsx("div",{style:l,children:"Pass Rate"}),e.jsxs("div",{style:{fontSize:"32px",fontWeight:300,color:x.pass_rate>=99?t.accentGreen:x.pass_rate>=95?t.accentAmber:t.accentRed},children:[((m=x.pass_rate)==null?void 0:m.toFixed(1))||0,"%"]}),e.jsx("div",{style:r,children:"enforcement success"})]}),e.jsxs("div",{style:a,children:[e.jsx("div",{style:l,children:"Violations (24h)"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:(x.total_block||0)>0?t.accentRed:t.accentGreen},children:(x.total_block||0).toLocaleString()}),e.jsxs("div",{style:r,children:[((x.total_block||0)/Math.max(x.total_actions||1,1)*100).toFixed(2),"% of actions"]})]}),(o==null?void 0:o.role)==="admin"&&e.jsxs("div",{style:a,children:[e.jsx("div",{style:l,children:"Total Sessions"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.textPrimary},children:x.total||0}),e.jsxs("div",{style:r,children:[x.ended||0," completed"]})]}),(o==null?void 0:o.role)==="admin"&&e.jsxs("div",{style:a,children:[e.jsx("div",{style:l,children:"Unique Systems"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:300,color:t.purpleBright},children:[...new Set(b.map(h=>h.certificate_id).filter(Boolean))].length}),e.jsxs("div",{style:r,children:[[...new Set(b.map(h=>h.organization_name).filter(Boolean))].length," organizations"]})]})]})]})})(),e.jsxs("div",{style:{background:t.cardSurface,border:"1px solid "+t.borderSubtle,overflow:"hidden",borderRadius:8},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.borderGlass}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"14px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"2px",color:t.textTertiary},children:(o==null?void 0:o.role)==="admin"?"Agent Sessions":"System Monitoring"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[(o==null?void 0:o.role)==="admin"&&e.jsxs("select",{value:z,onChange:n=>W(n.target.value),style:{background:"rgba(0,0,0,0.04)",border:`1px solid ${t.borderGlass}`,padding:"6px 10px",color:t.textPrimary,fontSize:"12px"},children:[e.jsx("option",{value:"",children:"All Customers"}),[...new Set(b.map(n=>n.organization_name).filter(Boolean))].map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",color:t.textSecondary,fontSize:"12px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:A,onChange:n=>$(n.target.checked),style:{accentColor:t.purpleBright}}),"Hide ended"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",color:t.textSecondary,fontSize:"12px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:B,onChange:n=>E(n.target.checked),style:{accentColor:t.purpleBright}}),"Online only"]})]})]}),R.length===0?e.jsx("div",{style:{padding:"clamp(16px, 4vw, 40px)",textAlign:"center",color:t.textSecondary},children:(o==null?void 0:o.role)==="admin"?"No ENVELO sessions found. Deploy an agent to begin monitoring.":"No active systems. Once your system is ODDC certified and running the ENVELO agent, real-time monitoring data will appear here."}):e.jsx("div",{className:"table-scroll",style:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"transparent"},children:(()=>{const n={padding:"12px 16px",textAlign:"left",fontSize:"10px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:t.textTertiary},i={...n,textAlign:"right"};return e.jsxs(e.Fragment,{children:[e.jsx("th",{style:n,children:"Status"}),e.jsx("th",{style:n,children:"Organization"}),e.jsx("th",{style:n,children:"System / Certificate"}),e.jsx("th",{style:n,children:"Session"}),e.jsx("th",{style:n,children:"Uptime"}),e.jsx("th",{style:i,children:"Actions"}),e.jsx("th",{style:i,children:"Pass Rate"}),e.jsx("th",{style:n,children:"Last Activity"})]})})()})}),e.jsx("tbody",{children:R.map(n=>{var a,l;const i=n.pass_count+n.block_count,c=i>0?n.pass_count/i*100:0,d=(s==null?void 0:s.id)===n.id;return e.jsxs("tr",{onClick:()=>_(d?null:n),style:{borderBottom:`1px solid ${t.borderGlass}`,cursor:"pointer",background:d?"rgba(91, 75, 138, 0.15)":"transparent",transition:"background 0.15s"},onMouseEnter:r=>{d||(r.currentTarget.style.background="transparent")},onMouseLeave:r=>{d||(r.currentTarget.style.background="transparent")},children:[e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:n.is_online?t.accentGreen:n.status==="ended"?t.textTertiary:t.accentRed,boxShadow:"none"}}),e.jsx("span",{style:{fontSize:"11px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"1px",color:n.is_online?t.accentGreen:n.status==="ended"?t.textTertiary:t.accentRed},children:n.is_online?"Online":n.status==="ended"?"Ended":"Offline"})]})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsx("div",{style:{fontSize:"13px",color:t.textPrimary,fontWeight:500},children:n.organization_name||"Unknown"})}),e.jsxs("td",{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:"13px",color:t.textPrimary},children:n.system_name||"-"}),e.jsx("div",{style:{fontFamily:t.mono,fontSize:"10px",color:t.textTertiary,marginTop:"2px"},children:n.certificate_id||"-"})]}),e.jsxs("td",{style:{padding:"14px 16px",fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:[(a=n.session_id)==null?void 0:a.slice(0,12),"..."]}),e.jsxs("td",{style:{padding:"14px 16px",color:t.textSecondary,fontSize:"13px"},children:[(l=n.uptime_hours)==null?void 0:l.toFixed(1),"h"]}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right",color:t.textPrimary,fontFamily:t.mono,fontSize:"13px"},children:i.toLocaleString()}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:e.jsxs("span",{style:{color:c>=99?t.accentGreen:c>=95?t.accentAmber:t.accentRed,fontFamily:t.mono,fontSize:"13px"},children:[c.toFixed(1),"%"]})}),e.jsx("td",{style:{padding:"14px 16px",color:t.textTertiary,fontSize:"12px"},children:n.last_activity?new Date(n.last_activity).toISOString().replace("T"," ").substring(0,16)+"Z":"-"})]},n.id)})})]})})]}),s&&e.jsxs("div",{style:{marginTop:"24px",background:t.bgPanel,border:`1px solid ${t.borderGlass}`,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.borderGlass}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs("h2",{style:{margin:0,fontSize:"14px",fontFamily:t.mono,textTransform:"uppercase",letterSpacing:"2px",color:t.textTertiary},children:["Session Detail: ",s.session_id]}),e.jsx("button",{onClick:()=>_(null),style:{background:"none",border:"none",color:t.textTertiary,cursor:"pointer",fontSize:"18px"},children:"×"})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 4px 0",fontSize:"18px",fontWeight:400,color:t.textPrimary},children:s.organization_name||"Unknown Organization"}),e.jsxs("p",{style:{margin:0,fontSize:"13px",color:t.textSecondary},children:[s.system_name||"Unknown System"," · ",s.certificate_id||"No certificate"]}),e.jsxs("p",{style:{margin:"4px 0 0",fontFamily:t.mono,fontSize:"11px",color:t.textTertiary},children:["Agent v",s.agent_version||"1.0.0"," · Session ",s.session_id]})]}),s.is_online&&e.jsx("button",{onClick:async()=>{if(await U({title:"End Session",message:"Force-end this session?",danger:!0}))try{await u.post("/api/envelo/sessions/"+s.session_id+"/end",{ended_at:new Date().toISOString(),final_stats:{pass_count:s.pass_count,block_count:s.block_count}}),_(null),v.invalidateQueries({queryKey:["monitoring-overview"]})}catch(n){f.show("Failed: "+n.message,"error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderSubtle,color:t.accentRed,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",borderRadius:8},children:"Force End Session"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{background:"transparent",padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Started"}),e.jsx("div",{style:{color:t.textPrimary,fontSize:"13px"},children:s.started_at?new Date(s.started_at).toISOString().replace("T"," ").substring(0,16)+"Z":"-"})]}),e.jsxs("div",{style:{background:"transparent",padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Uptime"}),e.jsxs("div",{style:{color:t.textPrimary,fontFamily:t.mono,fontSize:"18px"},children:[((O=s.uptime_hours)==null?void 0:O.toFixed(1))||"0","h"]})]}),e.jsxs("div",{style:{background:"transparent",padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Passed"}),e.jsx("div",{style:{color:t.accentGreen,fontFamily:t.mono,fontSize:"18px"},children:(s.pass_count||0).toLocaleString()})]}),e.jsxs("div",{style:{background:"transparent",padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Blocked"}),e.jsx("div",{style:{color:t.accentRed,fontFamily:t.mono,fontSize:"18px"},children:(s.block_count||0).toLocaleString()})]}),e.jsxs("div",{style:{background:"transparent",padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Pass Rate"}),(()=>{const n=(s.pass_count||0)+(s.block_count||0),i=n>0?s.pass_count/n*100:0;return e.jsxs("div",{style:{color:i>=99?t.accentGreen:i>=95?t.accentAmber:t.accentRed,fontFamily:t.mono,fontSize:"18px"},children:[i.toFixed(1),"%"]})})()]}),e.jsxs("div",{style:{background:"transparent",padding:"14px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"6px"},children:"Certificate"}),e.jsx("div",{style:{color:t.purpleBright,fontFamily:t.mono,fontSize:"12px"},children:s.certificate_id||"-"})]})]}),(()=>{const n=(s.pass_count||0)+(s.block_count||0);if(n===0)return null;const i=s.pass_count/n*100;return e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"8px"},children:"Enforcement Distribution"}),e.jsxs("div",{style:{height:"12px",background:"transparent",overflow:"hidden",display:"flex"},children:[e.jsx("div",{style:{width:i+"%",background:t.accentGreen,transition:"width 0.5s"}}),e.jsx("div",{style:{width:100-i+"%",background:t.accentRed,transition:"width 0.5s"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",marginTop:"4px",fontSize:"11px"},children:[e.jsxs("span",{style:{color:t.accentGreen},children:["Pass: ",i.toFixed(1),"%"]}),e.jsxs("span",{style:{color:t.accentRed},children:["Block: ",(100-i).toFixed(1),"%"]})]})]})})(),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:async()=>{try{const i=(o==null?void 0:o.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",d=(await u.get(i+s.id+"/telemetry")).data.records||[];if(d.length===0){f.show("No telemetry data yet","info");return}const a=["timestamp","action_id","action_type","result","execution_time_ms"],l=[a.join(","),...d.map(y=>a.map(m=>JSON.stringify(y[m]??"")).join(","))].join(`
`),r=new Blob([l],{type:"text/csv"}),p=document.createElement("a");p.href=URL.createObjectURL(r),p.download=`telemetry-${s.session_id}.csv`,p.click()}catch{f.show("Failed to download telemetry","error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderSubtle,color:t.purpleBright,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"6px",borderRadius:8},children:"↓ Telemetry CSV"}),e.jsx("button",{onClick:async()=>{try{const i=(o==null?void 0:o.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",d=(await u.get(i+s.id+"/violations")).data.violations||[];if(d.length===0){f.show("No violations recorded","info");return}const a=["timestamp","boundary_name","violation_message"],l=[a.join(","),...d.map(y=>a.map(m=>JSON.stringify(y[m]??"")).join(","))].join(`
`),r=new Blob([l],{type:"text/csv"}),p=document.createElement("a");p.href=URL.createObjectURL(r),p.download=`violations-${s.session_id}.csv`,p.click()}catch{f.show("Failed to download violations","error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderSubtle,color:t.accentRed,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"6px",borderRadius:8},children:"↓ Violations CSV"}),e.jsx("button",{onClick:async()=>{try{const i=(o==null?void 0:o.role)==="admin"?"/api/envelo/admin/sessions/":"/api/envelo/my/sessions/",c=await u.get(i+s.id+"/report",{responseType:"blob"}),d=new Blob([c.data],{type:"application/pdf"}),a=document.createElement("a");a.href=URL.createObjectURL(d),a.download=`CAT72-Report-${s.session_id}.pdf`,a.click()}catch{f.show("Failed to download report","error")}},style:{padding:"8px 16px",background:t.cardSurface,border:"1px solid "+t.borderGlass,color:t.accentGreen,cursor:"pointer",fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",display:"flex",alignItems:"center",gap:"6px",borderRadius:8},children:"↓ CAT-72 Report PDF"})]}),k.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"12px"},children:"24-Hour Activity"}),e.jsx("div",{style:{display:"flex",gap:"2px",height:"60px",alignItems:"flex-end"},children:k.map((n,i)=>{const c=Math.max(...k.map(l=>l.total),1),d=n.total/c*100,a=n.total>0?n.pass/n.total:1;return e.jsx("div",{style:{flex:1,height:`${Math.max(d,2)}%`,background:a>=.99?t.accentGreen:a>=.95?t.accentAmber:t.accentRed,opacity:.8},title:`${new Date(n.hour).toISOString().substring(11,16)+"Z"}: ${n.total} actions (${n.pass} pass, ${n.block} block)`},i)})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"12px",marginTop:"4px",fontSize:"10px",color:t.textTertiary},children:[e.jsx("span",{children:"24h ago"}),e.jsx("span",{children:"Now"})]})]})]})]})]})}export{oe as default};
