import{u as X,b as K,d as x,j as e}from"./index-DvE4LfXv.js";import{r as d,P as Q,j as V,U as Y,h as Z,l as $,X as I}from"./icons-DL0PQMVt.js";import{P as E}from"./Panel-KSTCF72h.js";import{S as ee}from"./SectionHeader-B4UNrv6k.js";import{S as C}from"./StatCard-CDseVGlI.js";import"./vendor-DYB3FAiG.js";function ie(){var R,B;const m=X(),l=K(),[p,y]=d.useState([]),[g,j]=d.useState(!0),[c,v]=d.useState(""),[N,b]=d.useState(1),k=25,[S,T]=d.useState(""),[D,A]=d.useState(!1),[L,f]=d.useState(!1),[r,z]=d.useState(null),[i,h]=d.useState({email:"",full_name:"",company:"",role:"applicant"}),[U,F]=d.useState(!1);d.useEffect(()=>{u()},[]);const u=async()=>{try{const a=await x.get("/api/users/");y(a.data||[])}catch(a){console.error("Users API:",a),y([])}j(!1)},P=p.filter(a=>{if(c==="admin"&&a.role!=="admin"||c==="applicant"&&a.role!=="applicant"||c==="pending"&&a.role!=="pending"||c==="inactive"&&a.is_active!==!1)return!1;if(S){const s=S.toLowerCase();if(!(a.email||"").toLowerCase().includes(s)&&!(a.full_name||"").toLowerCase().includes(s)&&!(a.company||"").toLowerCase().includes(s))return!1}return!0}),w={total:p.length,admins:p.filter(a=>a.role==="admin").length,applicants:p.filter(a=>a.role==="applicant").length,pending:p.filter(a=>a.role==="pending").length,inactive:p.filter(a=>a.is_active===!1).length},W=async()=>{var a,s;if(!i.email||!i.full_name){l.show("Email and full name are required","warning");return}F(!0);try{const t=Math.random().toString(36).slice(-8)+"A1!";await x.post("/api/users/",{...i,password:t}),l.show("User created — share credentials securely","success"),A(!1),h({email:"",full_name:"",company:"",role:"applicant"}),u()}catch(t){l.show("Failed to create user: "+(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.detail)||t.message),"error")}F(!1)},_=async(a,s)=>{var t,n;if(await m({title:"Change Role",message:"Change user role to "+s.toUpperCase()+"?"}))try{await x.patch("/api/users/"+a,{role:s}),u(),f(!1)}catch(o){l.show("Failed to update role: "+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.detail)||o.message),"error")}},q=async(a,s)=>{var n,o;const t=s?"deactivate":"activate";if(await m({title:t.charAt(0).toUpperCase()+t.slice(1),message:t.charAt(0).toUpperCase()+t.slice(1)+" this user?"}))try{await x.patch("/api/users/"+a,{is_active:!s}),u(),f(!1)}catch(M){l.show("Failed to update user: "+(((o=(n=M.response)==null?void 0:n.data)==null?void 0:o.detail)||M.message),"error")}},G=async(a,s)=>{var t,n;if(await m({title:"Reset Password",message:"Reset password for "+s+"?"}))try{const o=Math.random().toString(36).slice(-8)+"A1!";await x.post("/api/users/"+a+"/reset-password"),l.show("Password reset — share credentials securely","success")}catch(o){l.show("Failed to reset password: "+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.detail)||o.message),"error")}},O=async(a,s)=>{var t,n;if(await m({title:"Approve User",message:"Approve "+s+" as an applicant?"}))try{await x.post("/api/users/"+a+"/approve"),u(),f(!1)}catch(o){l.show("Failed to approve: "+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.detail)||o.message),"error")}},H=async(a,s)=>{var t,n;if(await m({title:"Reject User",message:"Reject "+s+"? Their account will be deactivated.",danger:!0}))try{await x.post("/api/users/"+a+"/reject"),u(),f(!1)}catch(o){l.show("Failed to reject: "+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.detail)||o.message),"error")}},J=async(a,s)=>{var t,n;if(await m({title:"Delete User",message:"DELETE "+s+"? This cannot be undone.",danger:!0,confirmLabel:"Delete"}))try{await x.delete("/api/users/"+a),u(),f(!1)}catch(o){l.show("Failed to delete user: "+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.detail)||o.message),"error")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{label:"Administration",title:"User Management",description:"Manage admin and applicant accounts",action:e.jsxs("button",{onClick:()=>A(!0),className:"btn px-4 py-2 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"})," Invite User"]})}),e.jsxs("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))"},children:[e.jsx(C,{onClick:()=>{v(""),b(1)},label:"Total Users",value:w.total,color:c===""?"rgba(255,255,255,.94)":"rgba(255,255,255,.35)"}),e.jsx(C,{onClick:()=>{v(c==="admin"?"":"admin"),b(1)},label:"Admins",value:w.admins,color:c==="admin"?"#a896d6":"rgba(255,255,255,.35)"}),e.jsx(C,{onClick:()=>{v(c==="applicant"?"":"applicant"),b(1)},label:"Applicants",value:w.applicants,color:c==="applicant"?"#5CD685":"rgba(255,255,255,.35)"}),e.jsx(C,{onClick:()=>{v(c==="pending"?"":"pending"),b(1)},label:"Pending",value:w.pending,color:c==="pending"?"#D6A05C":"rgba(255,255,255,.35)"}),e.jsx(C,{onClick:()=>{v(c==="inactive"?"":"inactive"),b(1)},label:"Inactive",value:w.inactive,color:c==="inactive"?"#D65C5C":"rgba(255,255,255,.35)"})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5",style:{color:"rgba(255,255,255,.50)"}}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or company...",value:S,onChange:a=>T(a.target.value),className:"flex-1 px-4 py-3",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,.07)",color:"rgba(255,255,255,.94)",outline:"none"}})]})}),e.jsx(E,{children:g?e.jsx("div",{style:{color:"rgba(255,255,255,.50)",textAlign:"center",padding:"clamp(16px, 4vw, 40px)"},children:"Loading users..."}):P.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"clamp(24px, 5vw, 60px)"},children:[e.jsx(Y,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-12 h-12 mx-auto mb-4",style:{color:"rgba(255,255,255,.50)"}}),e.jsx("p",{style:{color:"rgba(255,255,255,.78)",marginBottom:"8px"},children:"No users found"}),e.jsx("p",{style:{color:"rgba(255,255,255,.50)",fontSize:"14px"},children:p.length===0?"The /api/users/ endpoint may not be configured.":"Try adjusting your search."})]}):e.jsx("div",{className:"space-y-2",children:P.slice((N-1)*k,N*k).map(a=>{var s,t;return e.jsxs("div",{onClick:()=>{z(a),f(!0)},className:"flex items-center gap-4 p-4 cursor-pointer transition-all",style:{background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,.07)"},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center flex-shrink-0",style:{background:"#5B4B8A",color:"rgba(255,255,255,.94)",fontWeight:"400"},children:((s=a.full_name)==null?void 0:s[0])||((t=a.email)==null?void 0:t[0])||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{style:{color:"rgba(255,255,255,.94)",fontWeight:"500"},children:a.full_name||"No Name"}),e.jsx("p",{style:{color:"rgba(255,255,255,.50)",fontSize:"13px"},children:a.email}),a.company&&e.jsx("p",{style:{color:"rgba(255,255,255,.50)",fontSize:"12px"},children:a.company})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 text-xs",style:{background:a.role==="admin"?"rgba(157,140,207,0.2)":a.role==="pending"?"rgba(245,158,11,0.15)":"rgba(255,255,255,0.1)",color:a.role==="admin"?"#a896d6":a.role==="pending"?"#f59e0b":"rgba(255,255,255,.50)",fontFamily:"Consolas, 'IBM Plex Mono', monospace",textTransform:"uppercase"},children:a.role}),a.role==="pending"&&e.jsxs("div",{className:"flex gap-1",onClick:n=>n.stopPropagation(),children:[e.jsx("button",{onClick:()=>O(a.id,a.email),className:"btn",style:{padding:"4px 12px",color:"var(--accent-green)"},children:"Approve"}),e.jsx("button",{onClick:()=>H(a.id,a.email),className:"btn",style:{padding:"4px 12px",color:"var(--accent-red)"},children:"Reject"})]}),a.is_active===!1&&e.jsx("span",{className:"px-2 py-1 text-xs",style:{background:"transparent",color:"#D65C5C"},children:"Inactive"})]})]},a.id||a.email)})})}),e.jsx(ae,{total:P.length,page:N,perPage:k,onChange:b}),D&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 sa-modal-overlay",children:e.jsxs("div",{className:"w-full max-w-md mx-4 p-6 sa-modal-panel",children:[e.jsx("h2",{style:{color:"rgba(255,255,255,.94)",fontSize:"20px",fontWeight:"400",marginBottom:"24px",textAlign:"center"},children:"Invite New User"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:"rgba(255,255,255,.78)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"Email *"}),e.jsx("input",{type:"email",value:i.email,onChange:a=>h({...i,email:a.target.value}),placeholder:"user@company.com",className:"w-full px-4 py-3",style:{background:"transparent",border:"1px solid rgba(255,255,255,.07)",color:"rgba(255,255,255,.94)",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:"rgba(255,255,255,.78)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"Full Name *"}),e.jsx("input",{type:"text",value:i.full_name,onChange:a=>h({...i,full_name:a.target.value}),placeholder:"John Smith",className:"w-full px-4 py-3",style:{background:"transparent",border:"1px solid rgba(255,255,255,.07)",color:"rgba(255,255,255,.94)",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:"rgba(255,255,255,.78)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"Company"}),e.jsx("input",{type:"text",value:i.company,onChange:a=>h({...i,company:a.target.value}),placeholder:"Company name",className:"w-full px-4 py-3",style:{background:"transparent",border:"1px solid rgba(255,255,255,.07)",color:"rgba(255,255,255,.94)",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:"rgba(255,255,255,.78)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"Role"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>h({...i,role:"applicant"}),className:"btn",style:{padding:"10px 16px",flex:1,justifyContent:"center",color:i.role==="applicant"?"var(--purple-bright)":"var(--text-tertiary)",borderColor:i.role==="applicant"?"rgba(157,140,207,.3)":"rgba(255,255,255,.06)"},children:"Applicant"}),e.jsx("button",{onClick:()=>h({...i,role:"admin"}),className:"btn",style:{padding:"10px 16px",flex:1,justifyContent:"center",color:i.role==="admin"?"var(--purple-bright)":"var(--text-tertiary)",borderColor:i.role==="admin"?"rgba(157,140,207,.3)":"rgba(255,255,255,.06)"},children:"Admin"})]})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("button",{onClick:W,disabled:U,className:"btn primary",style:{width:"100%",opacity:U?.7:1},children:U?"Creating...":"Create Account"}),e.jsx("button",{onClick:()=>{A(!1),h({email:"",full_name:"",company:"",role:"applicant"})},className:"w-full px-4 py-3",style:{background:"transparent",border:"none",color:"rgba(255,255,255,.50)"},children:"Cancel"})]})]})}),L&&r&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 sa-modal-overlay",children:e.jsxs("div",{className:"w-full max-w-md mx-4 p-6 sa-modal-panel",children:[e.jsx("h2",{style:{color:"rgba(255,255,255,.94)",fontSize:"20px",fontWeight:"400",marginBottom:"24px",textAlign:"center"},children:"Manage User"}),e.jsxs("div",{className:"text-center mb-6 p-4",style:{background:"rgba(255,255,255,0.03)"},children:[e.jsx("div",{className:"w-16 h-16 flex items-center justify-center mx-auto mb-3 sa-avatar",style:{background:"#5B4B8A",border:"2px solid #9d8ccf",borderRadius:"6px",color:"rgba(255,255,255,.94)",fontSize:"24px",fontWeight:"200",fontFamily:"Georgia, serif"},children:((R=r.full_name)==null?void 0:R[0])||((B=r.email)==null?void 0:B[0])||"?"}),e.jsx("p",{style:{color:"rgba(255,255,255,.94)",fontSize:"18px",fontWeight:"500"},children:r.full_name||"No Name"}),e.jsx("p",{style:{color:"rgba(255,255,255,.50)",fontSize:"14px"},children:r.email})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{style:{color:"rgba(255,255,255,.50)",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",display:"block",marginBottom:"8px"},children:"Role"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>_(r.id,"applicant"),className:"btn",style:{padding:"10px 16px",flex:1,justifyContent:"center",color:r.role==="applicant"?"var(--purple-bright)":"var(--text-tertiary)",borderColor:r.role==="applicant"?"rgba(157,140,207,.3)":"rgba(255,255,255,.06)"},children:"Applicant"}),e.jsx("button",{onClick:()=>_(r.id,"admin"),className:"btn",style:{padding:"10px 16px",flex:1,justifyContent:"center",color:r.role==="admin"?"var(--purple-bright)":"var(--text-tertiary)",borderColor:r.role==="admin"?"rgba(157,140,207,.3)":"rgba(255,255,255,.06)"},children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("label",{style:{color:"rgba(255,255,255,.50)",fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",display:"block",marginBottom:"8px"},children:"Actions"}),e.jsxs("button",{onClick:()=>G(r.id,r.email),className:"w-full px-4 py-3 flex items-center gap-3 btn",style:{justifyContent:"flex-start",width:"100%"},children:[e.jsx(Z,{className:"w-4 h-4",style:{color:"#a896d6"}}),"Reset Password"]}),e.jsx("button",{onClick:()=>q(r.id,r.is_active!==!1),className:"w-full px-4 py-3 flex items-center gap-3 btn",style:{justifyContent:"flex-start",width:"100%",color:r.is_active===!1?"var(--accent-green)":"var(--accent-red)"},children:r.is_active===!1?e.jsxs(e.Fragment,{children:[e.jsx($,{fill:"currentColor",fillOpacity:.15,strokeWidth:1.8,className:"w-4 h-4"})," Activate Account"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4"})," Deactivate Account"]})}),e.jsxs("button",{onClick:()=>J(r.id,r.email),className:"w-full px-4 py-3 flex items-center gap-3 btn",style:{justifyContent:"flex-start",width:"100%",color:"var(--accent-red)"},children:[e.jsx(I,{className:"w-4 h-4"})," Delete User"]})]}),e.jsx("button",{onClick:()=>{f(!1),z(null)},className:"w-full px-4 py-3",style:{background:"transparent",border:"none",color:"rgba(255,255,255,.50)"},children:"Close"})]})})]})}function ae({total:m,page:l,perPage:p,onChange:y}){const g=Math.ceil(m/p);if(g<=1)return null;const j="Consolas, 'IBM Plex Mono', monospace";return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"16px 0"},children:[e.jsx("button",{disabled:l<=1,onClick:()=>y(l-1),style:{padding:"6px 12px",background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",color:l<=1?"rgba(255,255,255,.50)":"rgba(255,255,255,.94)",cursor:l<=1?"not-allowed":"pointer",fontFamily:j,fontSize:"11px"},children:"Prev"}),e.jsxs("span",{style:{fontFamily:j,fontSize:"11px",color:"rgba(255,255,255,.78)"},children:["Page ",l," of ",g]}),e.jsx("button",{disabled:l>=g,onClick:()=>y(l+1),style:{padding:"6px 12px",background:"#2a2f3d",border:"1px solid rgba(255,255,255,.07)",color:l>=g?"rgba(255,255,255,.50)":"rgba(255,255,255,.94)",cursor:l>=g?"not-allowed":"pointer",fontFamily:j,fontSize:"11px"},children:"Next"})]})}export{ie as default};
