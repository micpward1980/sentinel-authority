import{u as B,a as _,j as e,s as t,c as y,d as R}from"./index-BVSGvWy8.js";import{r as p,v as E,i as I,K as G,w as W,I as L,P as $,l as C,j as N,k as K,x as D,y as O}from"./icons-BOtGoKI6.js";import"./vendor-CrGXBcEq.js";const V="#f5f5f7",A="#e2e5ea",F="#ffffff",H={admin:{label:"System Admin",color:t.purplePrimary},auditor:{label:"Independent Auditor",color:t.accentBlue},operator:{label:"System Operator",color:t.accentGreen},user:{label:"Certified Operator",color:t.accentGreen},customer:{label:"Certified Operator",color:t.accentGreen},viewer:{label:"Read-Only Viewer",color:t.textTertiary}};function M({role:i}){const r=H[(i||"").toLowerCase()]||{label:i||"User",color:t.textTertiary};return e.jsx("span",{style:{fontFamily:t.mono,fontSize:"10px",fontWeight:700,letterSpacing:"0.8px",padding:"3px 10px",borderRadius:"3px",border:`1px solid ${r.color}`,color:r.color,textTransform:"uppercase"},children:r.label})}function m({label:i,...r}){const[n,a]=p.useState(!1);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i&&e.jsx("label",{style:{fontFamily:t.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary},children:i}),e.jsx("input",{...r,onFocus:x=>{var d;a(!0),(d=r.onFocus)==null||d.call(r,x)},onBlur:x=>{var d;a(!1),(d=r.onBlur)==null||d.call(r,x)},style:{padding:"9px 12px",border:`1px solid ${n?t.purpleBright:t.borderGlass}`,borderRadius:"3px",background:"rgba(255,255,255,0.9)",color:t.textPrimary,fontFamily:r.type==="text"&&r.readOnly?t.mono:t.sans,fontSize:"13px",outline:"none",boxShadow:n?"0 0 0 3px rgba(107,90,158,0.12)":"none",transition:"border-color 0.15s, box-shadow 0.15s",width:"100%",boxSizing:"border-box",...r.style}})]})}function v({title:i,description:r}){return e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h2",{style:{fontFamily:t.serif,fontSize:22,fontWeight:300,margin:"0 0 6px",color:t.purpleAccent},children:i}),r&&e.jsx("p",{style:{color:t.textSecondary,fontSize:13,margin:0,lineHeight:1.6},children:r})]})}function b({children:i,style:r={}}){return e.jsx("div",{style:{background:t.cardSurface,border:`1px solid ${t.borderSubtle}`,borderRadius:4,padding:"20px 20px",marginBottom:16,...r},children:i})}function w({children:i}){return e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,letterSpacing:"2px",textTransform:"uppercase",color:t.textTertiary,marginBottom:16},children:i})}function k({onClick:i,saving:r,saved:n,label:a="Save Changes"}){return e.jsx("button",{onClick:i,disabled:r,style:{padding:"9px 22px",background:"transparent",border:"none",borderBottom:`1px solid ${n?t.accentGreen:t.purpleBright}`,color:n?t.accentGreen:t.purpleBright,fontFamily:t.mono,fontSize:11,letterSpacing:"1px",textTransform:"uppercase",cursor:r?"wait":"pointer",opacity:r?.7:1},children:n?"✓ Saved":r?"Saving…":a})}function U({user:i,toast:r}){const[n,a]=p.useState({full_name:(i==null?void 0:i.full_name)||"",organization:(i==null?void 0:i.organization)||""}),[x,d]=p.useState(!1),l=async()=>{var f,o;d(!0);try{await y.put("/api/auth/profile",n),r.show("Profile updated","success"),setTimeout(()=>window.location.reload(),600)}catch(c){r.show("Failed: "+(((o=(f=c.response)==null?void 0:f.data)==null?void 0:o.detail)||c.message),"error")}d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"My Profile",description:"Update your display name and organization affiliation."}),e.jsxs(b,{children:[e.jsx(w,{children:"Account Information"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,maxWidth:520},children:[e.jsx(m,{label:"Full Name",value:n.full_name,onChange:f=>a({...n,full_name:f.target.value})}),e.jsx(m,{label:"Organization",value:n.organization,onChange:f=>a({...n,organization:f.target.value})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:5},children:"Email"}),e.jsx("div",{style:{fontSize:13,color:t.textPrimary},children:(i==null?void 0:i.email)||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",color:t.textTertiary,marginBottom:5},children:"Role"}),e.jsx(M,{role:i==null?void 0:i.role})]})]}),e.jsx("div",{style:{marginTop:20},children:e.jsx(k,{onClick:l,saving:x,label:"Save Profile"})})]}),e.jsx(q,{toast:r}),e.jsx(Y,{toast:r,user:i})]})}function q({toast:i}){const[r,n]=p.useState({current:"",new_pw:"",confirm:""}),[a,x]=p.useState(!1),[d,l]=p.useState(""),f=async()=>{var o,c;if(l(""),!r.current||!r.new_pw||!r.confirm){l("All fields required");return}if(r.new_pw!==r.confirm){l("Passwords do not match");return}if(r.new_pw.length<8){l("Minimum 8 characters");return}x(!0);try{await y.post("/api/auth/change-password",{current_password:r.current,new_password:r.new_pw}),i.show("Password changed","success"),n({current:"",new_pw:"",confirm:""})}catch(s){l(((c=(o=s.response)==null?void 0:o.data)==null?void 0:c.detail)||"Failed to change password")}x(!1)};return e.jsxs(b,{children:[e.jsx(w,{children:"Change Password"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12,maxWidth:380},children:[e.jsx(m,{label:"Current Password",type:"password",value:r.current,onChange:o=>n({...r,current:o.target.value})}),e.jsx(m,{label:"New Password",type:"password",value:r.new_pw,onChange:o=>n({...r,new_pw:o.target.value})}),e.jsx(m,{label:"Confirm New",type:"password",value:r.confirm,onChange:o=>n({...r,confirm:o.target.value})}),d&&e.jsx("div",{style:{color:t.accentRed,fontSize:12},children:d}),e.jsx("div",{style:{fontSize:11,color:t.textTertiary},children:"Min 8 chars · 1 uppercase · 1 lowercase · 1 number"}),e.jsx("div",{children:e.jsx(k,{onClick:f,saving:a,label:"Change Password"})})]})]})}function Y({toast:i,user:r}){var f;const[n,a]=p.useState({enabled:!1,loading:!0,setup:null,code:"",verifying:!1,disablePw:"",disabling:!1,backupCodes:[]});p.useEffect(()=>{y.get("/api/auth/me").then(o=>a(c=>({...c,enabled:o.data.totp_enabled||!1,loading:!1}))).catch(()=>a(o=>({...o,loading:!1})))},[]);const x=async()=>{var o,c;try{const s=await y.post("/api/auth/2fa/setup");a(g=>({...g,setup:s.data}))}catch(s){i.show("Setup failed: "+(((c=(o=s.response)==null?void 0:o.data)==null?void 0:c.detail)||s.message),"error")}},d=async()=>{var o,c;a(s=>({...s,verifying:!0}));try{const s=await y.post("/api/auth/2fa/enable",{code:n.code});i.show("Two-factor authentication enabled","success"),a(g=>({...g,enabled:!0,setup:null,code:"",verifying:!1,backupCodes:s.data.backup_codes||[]}))}catch(s){i.show(((c=(o=s.response)==null?void 0:o.data)==null?void 0:c.detail)||"Invalid code","error"),a(g=>({...g,verifying:!1}))}},l=async()=>{var o,c;a(s=>({...s,disabling:!0}));try{await y.post("/api/auth/2fa/disable",{current_password:n.disablePw}),i.show("Two-factor authentication disabled","success"),a(s=>({...s,enabled:!1,disablePw:"",disabling:!1}))}catch(s){i.show(((c=(o=s.response)==null?void 0:o.data)==null?void 0:c.detail)||"Failed","error"),a(g=>({...g,disabling:!1}))}};return e.jsxs(b,{children:[e.jsx(w,{children:"Two-Factor Authentication"}),n.loading?e.jsx("div",{style:{color:t.textTertiary,fontSize:13},children:"Loading…"}):n.enabled?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:t.accentGreen}}),e.jsx("span",{style:{color:t.accentGreen,fontFamily:t.mono,fontSize:12,letterSpacing:"1px"},children:"ENABLED"})]}),e.jsx("p",{style:{color:t.textSecondary,fontSize:13,marginBottom:14},children:"Your account is protected with TOTP authentication."}),((f=n.backupCodes)==null?void 0:f.length)>0&&e.jsxs("div",{style:{marginBottom:16,padding:16,background:"rgba(158,110,18,0.04)",border:"1px solid rgba(158,110,18,0.18)",borderRadius:4},children:[e.jsx("p",{style:{color:t.accentAmber,fontFamily:t.mono,fontSize:10,letterSpacing:"1.5px",marginBottom:8,textTransform:"uppercase"},children:"Save Your Backup Codes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:3,marginBottom:10},children:n.backupCodes.map((o,c)=>e.jsx("span",{style:{fontFamily:t.mono,fontSize:13,color:t.textPrimary,textAlign:"center",padding:"2px 0"},children:o},c))}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(n.backupCodes.join(`
`)),i.show("Backup codes copied")},style:{padding:"5px 14px",background:"transparent",border:"1px solid rgba(158,110,18,0.3)",color:t.accentAmber,fontFamily:t.mono,fontSize:10,cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase",borderRadius:3},children:"Copy All"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",maxWidth:380},children:[e.jsx(m,{type:"password",value:n.disablePw,onChange:o=>a(c=>({...c,disablePw:o.target.value})),placeholder:"Enter password to disable",style:{flex:1}}),e.jsx("button",{onClick:l,disabled:n.disabling,style:{padding:"9px 16px",background:"transparent",border:`1px solid ${t.accentRed}`,color:t.accentRed,fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:3,flexShrink:0},children:n.disabling?"…":"Disable"})]})]}):n.setup?e.jsxs("div",{style:{maxWidth:380},children:[e.jsx("p",{style:{color:t.textSecondary,fontSize:13,marginBottom:14},children:"Scan this QR code with your authenticator app:"}),n.setup.qr_base64&&e.jsx("div",{style:{textAlign:"center",marginBottom:14},children:e.jsx("img",{src:"data:image/png;base64,"+n.setup.qr_base64,alt:"2FA QR",style:{width:180,height:180}})}),e.jsxs("div",{style:{background:t.cardSurface,border:`1px solid ${t.borderGlass}`,padding:12,marginBottom:14,borderRadius:3},children:[e.jsx("div",{style:{fontFamily:t.mono,fontSize:10,color:t.textTertiary,textTransform:"uppercase",letterSpacing:"1px",marginBottom:5},children:"Manual Entry Key"}),e.jsx("div",{style:{fontFamily:t.mono,fontSize:13,color:t.purpleBright,letterSpacing:"2px",wordBreak:"break-all"},children:n.setup.secret})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",value:n.code,onChange:o=>a(c=>({...c,code:o.target.value.replace(/\D/g,"").slice(0,6)})),placeholder:"6-digit code",maxLength:6,style:{flex:1,background:t.cardSurface,border:`1px solid ${t.borderGlass}`,padding:"10px 12px",color:t.textPrimary,fontSize:20,fontFamily:t.mono,letterSpacing:"8px",textAlign:"center",borderRadius:3,outline:"none"}}),e.jsx("button",{onClick:d,disabled:n.verifying||n.code.length!==6,style:{padding:"10px 18px",background:n.code.length===6?t.purplePrimary:"transparent",border:`1px solid ${t.purpleBright}`,color:n.code.length===6?"#fff":t.purpleBright,fontFamily:t.mono,fontSize:10,letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer",borderRadius:3,opacity:n.code.length!==6?.5:1},children:n.verifying?"…":"Verify"})]})]}):e.jsxs("div",{children:[e.jsx("p",{style:{color:t.textSecondary,fontSize:13,marginBottom:14},children:"Require a TOTP code from your authenticator app on every sign-in."}),e.jsx("button",{onClick:x,style:{padding:"9px 20px",background:"transparent",border:"none",borderBottom:`1px solid ${t.purpleBright}`,color:t.purpleBright,fontFamily:t.mono,fontSize:11,letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Enable 2FA"})]})]})}const Q=30;function X({k:i,onDelete:r,toast:n}){const[a,x]=p.useState(!1),[d,l]=p.useState(0),f=p.useRef(null),o=()=>{x(!0),l(Q),f.current&&clearInterval(f.current),f.current=setInterval(()=>{l(s=>s<=1?(clearInterval(f.current),x(!1),0):s-1)},1e3)};p.useEffect(()=>()=>clearInterval(f.current),[]);const c=()=>{navigator.clipboard.writeText(i.key_prefix+"…(hidden)"),n.show("Key prefix copied","success")};return e.jsxs("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:[e.jsx("td",{style:{padding:"13px 14px",fontSize:13,color:t.textPrimary,fontWeight:500},children:i.name||"API Key"}),e.jsx("td",{style:{padding:"13px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontFamily:t.mono,fontSize:12,color:t.textPrimary},children:a&&i.key_full||i.key_prefix+"••••••••••••"}),e.jsx("button",{onClick:o,title:a?`Auto-hides in ${d}s`:"Reveal for 30s",style:{background:"none",border:"none",cursor:"pointer",color:t.textDim,lineHeight:0,padding:0},children:a?e.jsx(N,{size:13}):e.jsx(K,{size:13})}),a&&e.jsxs("span",{style:{fontFamily:t.mono,fontSize:9,color:t.accentAmber},children:[d,"s"]})]})}),e.jsx("td",{style:{padding:"13px 14px"},children:e.jsx("span",{style:{fontFamily:t.mono,fontSize:10,fontWeight:600,letterSpacing:"1px",padding:"3px 8px",borderRadius:3,background:"rgba(22,135,62,0.08)",color:t.accentGreen,border:"1px solid rgba(22,135,62,0.20)"},children:"ACTIVE"})}),e.jsx("td",{style:{padding:"13px 14px",color:t.textTertiary,fontSize:12,fontFamily:t.mono},children:i.last_used_at?new Date(i.last_used_at).toLocaleDateString():"—"}),e.jsx("td",{style:{padding:"13px 14px",textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",gap:6,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:c,title:"Copy prefix",style:{background:"none",border:`1px solid ${t.borderGlass}`,borderRadius:3,cursor:"pointer",padding:"4px 8px",color:t.textTertiary},children:e.jsx(D,{size:12})}),e.jsx("button",{onClick:()=>r(i),title:"Revoke key",style:{background:"none",border:"1px solid rgba(180,52,52,0.25)",borderRadius:3,cursor:"pointer",padding:"4px 8px",color:t.accentRed},children:e.jsx(O,{size:12})})]})})]})}function Z({toast:i}){const r=R(),[n,a]=p.useState([]),[x,d]=p.useState(!0),[l,f]=p.useState(!1),[o,c]=p.useState(""),[s,g]=p.useState(!1),h=()=>{d(!0),y.get("/api/apikeys/").then(u=>a(u.data||[])).catch(()=>a([])).finally(()=>d(!1))};p.useEffect(h,[]);const T=async()=>{var u,j;if(o.trim()){f(!0);try{await y.post("/api/apikeys/",{name:o.trim()}),i.show("API key created","success"),c(""),g(!1),h()}catch(S){i.show("Failed: "+(((j=(u=S.response)==null?void 0:u.data)==null?void 0:j.detail)||S.message),"error")}f(!1)}},P=async u=>{var j,S;if(await r({title:"Revoke API Key",message:`Permanently revoke "${u.name||"this key"}"? Any systems using it will lose access immediately.`,danger:!0,confirmLabel:"Revoke"}))try{await y.delete("/api/apikeys/"+u.id),i.show("Key revoked","success"),h()}catch(z){i.show("Failed: "+(((S=(j=z.response)==null?void 0:j.data)==null?void 0:S.detail)||z.message),"error")}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"API Access Keys",description:"Programmatic access to the Sentinel Conformance Registry. Keys authenticate the ENVELO Interlock and automated regulatory integrations."}),e.jsxs("div",{style:{display:"flex",gap:12,padding:"14px 16px",background:"rgba(29,26,59,0.04)",border:"1px solid rgba(29,26,59,0.18)",borderRadius:4,marginBottom:20},children:[e.jsx(L,{size:18,color:t.purplePrimary,style:{flexShrink:0,marginTop:1}}),e.jsxs("div",{style:{fontSize:13,color:t.purpleAccent,lineHeight:1.6},children:[e.jsx("strong",{children:"Security Advisory:"})," API keys grant full access to the Conformance Registry on behalf of your account. Never embed keys in client-side code or public repositories. Tokens are shown once — store them immediately."]})]}),e.jsxs(b,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:10},children:[e.jsx(w,{children:"Active Keys"}),e.jsxs("button",{onClick:()=>g(u=>!u),style:{display:"flex",alignItems:"center",gap:6,padding:"7px 14px",background:t.purplePrimary,border:"none",color:"#fff",fontFamily:t.mono,fontSize:10,letterSpacing:"1.5px",textTransform:"uppercase",cursor:"pointer",borderRadius:3},children:[e.jsx($,{size:12})," Generate Key"]})]}),s&&e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,maxWidth:440},children:[e.jsx(m,{placeholder:"Key label (e.g. prod_auditor)",value:o,onChange:u=>c(u.target.value),onKeyDown:u=>u.key==="Enter"&&T(),style:{flex:1}}),e.jsx("button",{onClick:T,disabled:l||!o.trim(),style:{padding:"9px 16px",background:t.purplePrimary,border:"none",color:"#fff",fontFamily:t.mono,fontSize:10,cursor:"pointer",borderRadius:3,flexShrink:0,letterSpacing:"1px",textTransform:"uppercase",opacity:o.trim()?1:.5},children:l?"…":"Create"}),e.jsx("button",{onClick:()=>g(!1),style:{padding:"9px 12px",background:"transparent",border:`1px solid ${t.borderGlass}`,color:t.textTertiary,cursor:"pointer",borderRadius:3,fontFamily:t.mono,fontSize:11},children:"✕"})]}),x?e.jsx("div",{style:{color:t.textTertiary,fontSize:13,padding:"20px 0",textAlign:"center"},children:e.jsx(C,{size:16,style:{animation:"spin 1s linear infinite",display:"inline-block"}})}):n.length===0?e.jsx("div",{style:{color:t.textTertiary,fontSize:13,padding:"24px 0",textAlign:"center"},children:"No API keys. Generate one to begin programmatic access."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:["Key Label","Token","Status","Last Used",""].map(u=>e.jsx("th",{style:{padding:"9px 14px",textAlign:u===""?"right":"left",fontFamily:t.mono,fontSize:9,letterSpacing:"1.5px",textTransform:"uppercase",color:t.textTertiary,fontWeight:600},children:u},u))})}),e.jsx("tbody",{children:n.map(u=>e.jsx(X,{k:u,onDelete:P,toast:i},u.id))})]})})]}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}function J({toast:i}){const[r,n]=p.useState(null),[a,x]=p.useState(!1),[d,l]=p.useState(!1),f=[{key:"application_updates",label:"Application Updates",desc:"Submission confirmations, review status changes, approval notifications"},{key:"test_notifications",label:"CAT-72 Test Notifications",desc:"Test scheduled, started, passed, and failed alerts"},{key:"certificate_alerts",label:"Certificate Alerts",desc:"Certificate issued, expiry warnings (30-day / 7-day), expiration notices"},{key:"agent_alerts",label:"ENVELO Interlock Alerts",desc:"Agent offline warnings, high violation rate, suspension alerts"},{key:"marketing",label:"Product Updates",desc:"New features, platform updates, and industry news from Sentinel Authority"}];p.useEffect(()=>{y.get("/api/users/email-preferences").then(s=>n(s.data.preferences||{})).catch(()=>n({application_updates:!0,test_notifications:!0,certificate_alerts:!0,agent_alerts:!0,marketing:!1}))},[]);const o=s=>{n(g=>({...g,[s]:!g[s]})),l(!1)},c=async()=>{var s,g;x(!0);try{await y.put("/api/users/email-preferences",r),l(!0),setTimeout(()=>l(!1),3e3)}catch(h){i.show("Failed: "+(((g=(s=h.response)==null?void 0:s.data)==null?void 0:g.detail)||h.message),"error")}x(!1)};return r?e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Email Notifications",description:"Control which system events generate email alerts from notifications@sentinelauthority.org."}),e.jsxs(b,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:f.map(s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:16,padding:"14px 12px",background:r[s.key]?"rgba(22,135,62,0.03)":"transparent",border:`1px solid ${r[s.key]?"rgba(22,135,62,0.10)":t.borderGlass}`,borderRadius:3,marginBottom:4,transition:"all 0.2s"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textPrimary,fontWeight:500,fontSize:14,marginBottom:3},children:s.label}),e.jsx("div",{style:{color:t.textTertiary,fontSize:12,lineHeight:1.5},children:s.desc})]}),e.jsx("button",{onClick:()=>o(s.key),style:{width:44,height:24,borderRadius:12,border:"none",cursor:"pointer",background:r[s.key]?t.accentGreen:"rgba(0,0,0,0.07)",position:"relative",transition:"background 0.2s",flexShrink:0},children:e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:r[s.key]?23:3,transition:"left 0.2s"}})})]},s.key))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:16,paddingTop:14,borderTop:`1px solid ${t.borderGlass}`,flexWrap:"wrap",gap:10},children:[e.jsx("span",{style:{fontSize:11,color:t.textTertiary},children:"Admin and security emails are always sent regardless of these settings."}),e.jsx(k,{onClick:c,saving:a,saved:d})]})]})]}):e.jsx("div",{style:{color:t.textTertiary,padding:40,textAlign:"center"},children:"Loading preferences…"})}function ee({toast:i}){const[r,n]=p.useState([]),[a,x]=p.useState(!0);p.useEffect(()=>{y.get("/api/auth/audit-log").then(l=>n(l.data.events||l.data||[])).catch(()=>n([])).finally(()=>x(!1))},[]);const d={login:t.accentGreen,logout:t.textTertiary,password_change:t.accentAmber,key_created:t.purpleBright,key_revoked:t.accentRed,"2fa_enabled":t.accentGreen,"2fa_disabled":t.accentRed};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Security Audit Log",description:"Immutable record of security-relevant account events. All entries are hash-chained and tamper-evident."}),e.jsx(b,{children:a?e.jsx("div",{style:{textAlign:"center",padding:32,color:t.textTertiary},children:e.jsx(C,{size:18,style:{animation:"spin 1s linear infinite"}})}):r.length===0?e.jsx("div",{style:{textAlign:"center",padding:32,color:t.textTertiary,fontSize:13},children:"No security events recorded yet."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:["Timestamp","Event","IP Address","Details"].map(l=>e.jsx("th",{style:{padding:"9px 14px",textAlign:"left",fontFamily:t.mono,fontSize:9,letterSpacing:"1.5px",textTransform:"uppercase",color:t.textTertiary,fontWeight:600},children:l},l))})}),e.jsx("tbody",{children:r.map((l,f)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${t.borderGlass}`},children:[e.jsx("td",{style:{padding:"11px 14px",fontFamily:t.mono,fontSize:11,color:t.textTertiary},children:l.created_at?new Date(l.created_at).toISOString().replace("T"," ").substring(0,16)+"Z":"—"}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx("span",{style:{fontFamily:t.mono,fontSize:10,fontWeight:700,letterSpacing:"0.8px",textTransform:"uppercase",color:d[l.event_type]||t.textSecondary},children:(l.event_type||"EVENT").replace(/_/g," ")})}),e.jsx("td",{style:{padding:"11px 14px",fontFamily:t.mono,fontSize:11,color:t.textTertiary},children:l.ip_address||"—"}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:t.textSecondary},children:l.details||"—"})]},f))})]})})})]})}function te({id:i,label:r,icon:n,active:a,onClick:x,badge:d}){return e.jsxs("button",{onClick:()=>x(i),style:{width:"100%",display:"flex",alignItems:"center",gap:10,padding:"10px 20px",border:"none",cursor:"pointer",textAlign:"left",background:a?F:"transparent",color:a?t.purplePrimary:t.textSecondary,borderLeft:`3px solid ${a?t.purplePrimary:"transparent"}`,fontWeight:a?600:400,fontSize:13,fontFamily:t.sans,transition:"background 0.12s, color 0.12s",boxSizing:"border-box"},children:[e.jsx("span",{style:{flexShrink:0,lineHeight:0},children:n}),e.jsx("span",{style:{flex:1},children:r}),d>0&&e.jsx("span",{style:{fontFamily:t.mono,fontSize:9,background:t.purpleBright,color:"#fff",borderRadius:10,padding:"1px 6px",fontWeight:700},children:d})]})}function ae(){const{user:i}=B(),r=_(),[n,a]=p.useState("profile"),x=[{group:"Personal",items:[{id:"profile",label:"My Profile",icon:e.jsx(E,{size:15})},{id:"notifications",label:"Notifications",icon:e.jsx(I,{size:15})}]},{group:"Security",items:[{id:"apikeys",label:"API Access Keys",icon:e.jsx(G,{size:15})},{id:"audit",label:"Security Audit Log",icon:e.jsx(W,{size:15})}]}];return e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("p",{style:{fontFamily:t.mono,fontSize:"10px",fontWeight:600,letterSpacing:"0.20em",textTransform:"uppercase",color:t.purpleBright,margin:"0 0 8px 0"},children:"Account"}),e.jsx("h1",{style:{fontFamily:t.serif,fontSize:"clamp(24px, 5vw, 36px)",fontWeight:200,margin:0,color:t.textPrimary},children:"Settings"}),e.jsx("p",{style:{color:t.textSecondary,marginTop:4,fontSize:14,margin:"4px 0 0"},children:"Account, security, and notification preferences"})]}),e.jsxs("div",{style:{display:"flex",background:F,border:`1px solid ${A}`,borderRadius:4,minHeight:"calc(100vh - 180px)",overflow:"hidden"},children:[e.jsx("aside",{style:{width:240,background:V,borderRight:`1px solid ${A}`,padding:"20px 0",flexShrink:0},children:x.map(d=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{padding:"0 20px 6px",fontFamily:t.mono,fontSize:9,fontWeight:700,letterSpacing:"2px",textTransform:"uppercase",color:t.textDim},children:d.group}),d.items.map(l=>e.jsx(te,{...l,active:n===l.id,onClick:a},l.id))]},d.group))}),e.jsxs("main",{style:{flex:1,padding:"28px 32px",overflowY:"auto"},children:[n==="profile"&&e.jsx(U,{user:i,toast:r}),n==="notifications"&&e.jsx(J,{toast:r}),n==="apikeys"&&e.jsx(Z,{toast:r}),n==="audit"&&e.jsx(ee,{toast:r})]})]})]})}export{ae as default};
