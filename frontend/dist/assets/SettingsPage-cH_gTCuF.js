import{a as W,u as I,d,b as R,j as t,s as e}from"./index-yBtxF6iz.js";import{r as p}from"./icons-CHtaS-ny.js";import{P as S}from"./Panel-DzaT4GMG.js";import{S as D}from"./SectionHeader-CiDCzYXr.js";import"./vendor-Dzneq-kE.js";function V(){const{user:o}=W();I();const[f,v]=p.useState(null),[y,k]=p.useState(!1),[m,j]=p.useState(!1),[u,T]=p.useState({full_name:(o==null?void 0:o.full_name)||"",organization:(o==null?void 0:o.organization)||""}),[h,z]=p.useState(!1),[i,b]=p.useState({current:"",new_pw:"",confirm:""}),[w,P]=p.useState(!1),[C,g]=p.useState(""),[s,l]=p.useState({enabled:!1,loading:!0,setup:null,code:"",verifying:!1,disablePw:"",disabling:!1});p.useEffect(()=>{d.get("/api/auth/me").then(r=>{l(a=>({...a,enabled:r.data.totp_enabled||!1,loading:!1}))}).catch(()=>l(r=>({...r,loading:!1})))},[]);const F=async()=>{var r,a;try{const n=await d.post("/api/auth/2fa/setup");l(x=>({...x,setup:n.data}))}catch(n){c.show("Setup failed: "+(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.detail)||n.message),"error")}},A=async()=>{var r,a;l(n=>({...n,verifying:!0}));try{const n=await d.post("/api/auth/2fa/enable",{code:s.code});c.show("Two-factor authentication enabled","success"),l(x=>({...x,enabled:!0,setup:null,code:"",verifying:!1,backupCodes:n.data.backup_codes||[]}))}catch(n){c.show(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.detail)||"Invalid code","error"),l(x=>({...x,verifying:!1}))}},B=async()=>{var r,a;l(n=>({...n,disabling:!0}));try{await d.post("/api/auth/2fa/disable",{current_password:s.disablePw}),c.show("Two-factor authentication disabled","success"),l(n=>({...n,enabled:!1,disablePw:"",disabling:!1}))}catch(n){c.show(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.detail)||"Failed","error"),l(x=>({...x,disabling:!1}))}},c=R(),_=async()=>{var r,a;z(!0);try{const n=await d.put("/api/auth/profile",u);c.show("Profile updated","success"),n.data.user&&window.location.reload()}catch(n){c.show("Failed to update profile: "+(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.detail)||n.message),"error")}z(!1)},N=async()=>{var r,a;if(g(""),i.current===""||i.new_pw===""||i.confirm===""){g("All fields required");return}if(i.new_pw!==i.confirm){g("Passwords do not match");return}if(i.new_pw.length<8){g("Min 8 characters");return}P(!0);try{await d.post("/api/auth/change-password",{current_password:i.current,new_password:i.new_pw}),c.show("Password changed successfully","success"),b({current:"",new_pw:"",confirm:""})}catch(n){g(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.detail)||"Failed to change password")}P(!1)};p.useEffect(()=>{d.get("/api/users/email-preferences").then(r=>v(r.data.preferences||{})).catch(()=>{v({application_updates:!0,test_notifications:!0,certificate_alerts:!0,agent_alerts:!0,marketing:!1})})},[]);const E=r=>{v(a=>({...a,[r]:!a[r]})),j(!1)},G=async()=>{var r,a;k(!0);try{await d.put("/api/users/email-preferences",f),j(!0),setTimeout(()=>j(!1),3e3)}catch(n){c.show("Failed to save: "+(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.detail)||n.message),"error")}k(!1)},$=[{key:"application_updates",label:"Application Updates",desc:"Submission confirmations, review status changes, approval notifications"},{key:"test_notifications",label:"CAT-72 Test Notifications",desc:"Test scheduled, started, passed, and failed alerts"},{key:"certificate_alerts",label:"Certificate Alerts",desc:"Certificate issued, expiry warnings (30-day / 7-day), expiration notices"},{key:"agent_alerts",label:"ENVELO Interlock Alerts",desc:"Agent offline warnings, high violation rate, suspension alerts"},{key:"marketing",label:"Product Updates",desc:"New features, platform updates, and industry news from Sentinel Authority"}];return f?t.jsxs("div",{className:"space-y-6",style:{maxWidth:"min(700px, 95vw)",margin:"0 auto"},children:[t.jsx(D,{label:"Account",title:"Settings"}),t.jsxs(S,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Account Information"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",maxWidth:"min(400px, 90vw)"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Full Name"}),t.jsx("input",{type:"text",value:u.full_name,onChange:r=>T({...u,full_name:r.target.value}),className:"w-full px-4 py-3 outline-none sexy-input",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Organization"}),t.jsx("input",{type:"text",value:u.organization,onChange:r=>T({...u,organization:r.target.value}),className:"w-full px-4 py-3 outline-none sexy-input",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"16px"},children:[t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"Email"}),t.jsx("div",{style:{color:e.textPrimary,marginTop:"4px",fontSize:"13px"},children:(o==null?void 0:o.email)||"-"})]}),t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"Role"}),t.jsx("div",{style:{color:e.purpleBright,marginTop:"4px",fontFamily:e.mono,fontSize:"12px",textTransform:"uppercase",letterSpacing:"1px"},children:(o==null?void 0:o.role)||"-"})]})]}),t.jsx("button",{onClick:_,disabled:h,className:"sexy-btn",style:{padding:"10px 24px",background:e.purplePrimary,border:`1px solid ${e.purpleBright}`,color:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:h?"wait":"pointer",opacity:h?.7:1,alignSelf:"flex-start"},children:h?"Saving...":"Save Profile"})]})]}),t.jsxs(S,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Change Password"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",maxWidth:"min(400px, 90vw)"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Current Password"}),t.jsx("input",{type:"password",value:i.current,onChange:r=>b({...i,current:r.target.value}),className:"w-full px-4 py-3 outline-none sexy-input",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"New Password"}),t.jsx("input",{type:"password",value:i.new_pw,onChange:r=>b({...i,new_pw:r.target.value}),className:"w-full px-4 py-3 outline-none sexy-input",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"11px",color:e.textTertiary,display:"block",marginBottom:"4px"},children:"Confirm New Password"}),t.jsx("input",{type:"password",value:i.confirm,onChange:r=>b({...i,confirm:r.target.value}),className:"w-full px-4 py-3 outline-none sexy-input",style:{background:"transparent",border:`1px solid ${e.borderGlass}`,color:e.textPrimary,fontSize:"13px"}})]}),C&&t.jsx("div",{style:{color:e.accentRed,fontSize:"12px"},children:C}),t.jsx("div",{style:{fontSize:"11px",color:e.textTertiary},children:"Min 8 chars, 1 uppercase, 1 lowercase, 1 number"}),t.jsx("button",{onClick:N,disabled:w,className:"sexy-btn",style:{padding:"10px 24px",background:e.purplePrimary,border:`1px solid ${e.purpleBright}`,color:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:w?"wait":"pointer",opacity:w?.7:1,alignSelf:"flex-start"},children:w?"Changing...":"Change Password"})]})]}),t.jsxs(S,{children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,marginBottom:"16px"},children:"Two-Factor Authentication"}),s.loading?t.jsx("div",{style:{color:e.textTertiary,fontSize:"13px"},children:"Loading..."}):s.enabled?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:e.accentGreen}}),t.jsx("span",{style:{color:e.accentGreen,fontFamily:e.mono,fontSize:"12px"},children:"ENABLED"})]}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"13px",marginBottom:"12px"},children:"Your account is protected with TOTP two-factor authentication."}),s.backupCodes&&s.backupCodes.length>0&&t.jsxs("div",{style:{marginBottom:"16px",padding:"16px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)"},children:[t.jsx("p",{style:{color:e.accentAmber,fontFamily:e.mono,fontSize:"11px",marginBottom:"8px",fontWeight:600},children:"SAVE YOUR BACKUP CODES"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"12px",marginBottom:"12px"},children:"Use these if you lose your authenticator. Each code works once."}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:s.backupCodes.map((r,a)=>t.jsx("span",{style:{fontFamily:e.mono,fontSize:"13px",color:e.textPrimary,padding:"4px 8px",background:"transparent",textAlign:"center"},children:r},a))}),t.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.backupCodes.join(`
`)),c.show("Backup codes copied")},style:{marginTop:"12px",padding:"6px 16px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentAmber,fontFamily:e.mono,fontSize:"10px",cursor:"pointer",letterSpacing:"1px",textTransform:"uppercase"},children:"Copy All"})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",maxWidth:"min(400px, 90vw)"},children:[t.jsx("input",{type:"password",value:s.disablePw,onChange:r=>l(a=>({...a,disablePw:r.target.value})),placeholder:"Enter password to disable",className:"sexy-input",style:{flex:1,background:"transparent",border:`1px solid ${e.borderGlass}`,padding:"8px 12px",color:e.textPrimary,fontSize:"13px"}}),t.jsx("button",{onClick:B,disabled:s.disabling,style:{padding:"8px 16px",background:"transparent",border:"1px solid rgba(0,0,0,0.05)",color:e.accentRed,fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:s.disabling?"wait":"pointer",whiteSpace:"nowrap"},children:s.disabling?"...":"Disable 2FA"})]})]}):s.setup?t.jsxs("div",{style:{maxWidth:"min(400px, 90vw)"},children:[t.jsx("p",{style:{color:e.textSecondary,fontSize:"13px",marginBottom:"16px"},children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),s.setup.qr_base64&&t.jsx("div",{style:{textAlign:"center",marginBottom:"16px"},children:t.jsx("img",{src:"data:image/png;base64,"+s.setup.qr_base64,alt:"QR Code",style:{width:"200px",height:"200px"}})}),t.jsxs("div",{style:{background:"transparent",border:`1px solid ${e.borderGlass}`,padding:"12px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"10px",color:e.textTertiary,marginBottom:"4px",fontFamily:e.mono,textTransform:"uppercase",letterSpacing:"1px"},children:"Manual Entry Key"}),t.jsx("div",{style:{fontFamily:e.mono,fontSize:"14px",color:e.purpleBright,letterSpacing:"2px",wordBreak:"break-all"},children:s.setup.secret})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[t.jsx("input",{type:"text",value:s.code,onChange:r=>l(a=>({...a,code:r.target.value.replace(/\D/g,"").slice(0,6)})),placeholder:"6-digit code",maxLength:6,className:"sexy-input",style:{flex:1,background:"transparent",border:`1px solid ${e.borderGlass}`,padding:"10px 12px",color:e.textPrimary,fontSize:"18px",fontFamily:e.mono,letterSpacing:"6px",textAlign:"center"}}),t.jsx("button",{onClick:A,disabled:s.verifying||s.code.length!==6,className:"sexy-btn",style:{padding:"10px 20px",background:e.purplePrimary,border:`1px solid ${e.purpleBright}`,color:"#fff",fontFamily:e.mono,fontSize:"10px",letterSpacing:"1px",textTransform:"uppercase",cursor:s.verifying?"wait":"pointer",opacity:s.code.length!==6?.5:1},children:s.verifying?"...":"Verify"})]})]}):t.jsxs("div",{children:[t.jsx("p",{style:{color:e.textSecondary,fontSize:"13px",marginBottom:"16px"},children:"Add an extra layer of security by requiring a code from your authenticator app when signing in."}),t.jsx("button",{onClick:F,className:"sexy-btn",style:{padding:"10px 24px",background:e.purplePrimary,border:`1px solid ${e.purpleBright}`,color:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:"pointer"},children:"Enable 2FA"})]})]}),t.jsxs(S,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginBottom:"20px"},children:[t.jsx("h2",{style:{fontFamily:e.mono,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",color:e.textTertiary,margin:0},children:"Email Notifications"}),t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"from notifications@sentinelauthority.org"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:$.map(r=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",padding:"16px",background:f[r.key]?"rgba(22,135,62,0.03)":"transparent",border:`1px solid ${f[r.key]?"rgba(22,135,62,0.08)":e.borderGlass}`,transition:"all 0.2s"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{color:e.textPrimary,fontWeight:500,fontSize:"14px",marginBottom:"4px"},children:r.label}),t.jsx("div",{style:{color:e.textTertiary,fontSize:"12px",lineHeight:"1.5"},children:r.desc})]}),t.jsx("button",{onClick:()=>E(r.key),style:{width:"48px",height:"26px",border:"none",cursor:"pointer",background:f[r.key]?e.accentGreen:"rgba(0,0,0,0.04)",position:"relative",transition:"background 0.2s",flexShrink:0,marginLeft:"16px"},children:t.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"#fff",position:"absolute",top:"3px",left:f[r.key]?"25px":"3px",transition:"left 0.2s"}})})]},r.key))}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px",marginTop:"20px",paddingTop:"16px",borderTop:`1px solid ${e.borderGlass}`},children:[t.jsx("span",{style:{fontSize:"11px",color:e.textTertiary},children:"Admin and security emails are always sent."}),t.jsx("button",{onClick:G,disabled:y,className:"sexy-btn",style:{padding:"10px 24px",background:m?"rgba(22,135,62,0.06)":e.purplePrimary,border:`1px solid ${m?"rgba(22,135,62,0.25)":e.purpleBright}`,color:m?e.accentGreen:"#fff",fontFamily:e.mono,fontSize:"11px",letterSpacing:"1px",textTransform:"uppercase",cursor:y?"wait":"pointer",opacity:y?.7:1},children:m?"âœ“ Saved":y?"Saving...":"Save Preferences"})]})]})]}):t.jsx("div",{style:{color:e.textTertiary,padding:"clamp(16px, 4vw, 40px)",textAlign:"center"},children:"Loading preferences..."})}export{V as default};
