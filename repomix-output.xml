This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: node_modules, dist, .vercel, package-lock.json, .DS_Store, *.tar.gz
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
backend/
  app/
    api/
      routes/
        __init__.py
        apikeys.py
        applicants.py
        applications.py
        auth.py
        cat72.py
        certificates.py
        dashboard.py
        envelo.py
        licensees.py
        verification.py
      __init__.py
    core/
      __init__.py
      config.py
      database.py
      security.py
    models/
      __init__.py
      models.py
    services/
      __init__.py
      auto_evaluator.py
      background_tasks.py
      cat72_evaluator.py
      cat72_report_generator.py
      certificate_generator.py
      certificate_pdf.py
      email_service.py
    utils/
      __init__.py
    __init__.py
  add_columns_simple.py
  add_columns.py
  Dockerfile
  main.py
  migrate_certificate_pdf.py
  migrate_envelo.py
  requirements.txt
database/
  init.sql
docs/
  CUSTOMER_INTEGRATION_GUIDE.md
frontend/
  src/
    styles/
      index.css
    App.jsx
    main.jsx
  .gitignore
  Dockerfile
  fix_app_logo.py
  index.html
  package.json
  postcss.config.js
  tailwind.config.js
  vercel.json
  vite.config.js
website/
  docs/
    CAT-72_Procedure_v1.0.pdf
    ENVELO_Requirements_v1.0.pdf
    ODDC_Critical_QA_v1.0.pdf
    ODDC_Overview_v1.0.pdf
    ODDC_Scenarios_v1.0.pdf
  downloads/
    envelo-agent/
      envelo/
        __init__.py
        actions.py
        agent.py
        boundaries.py
        exceptions.py
      requirements.txt
      setup.py
    envelo-docker/
      envelo/
        __init__.py
        actions.py
        agent.py
        boundaries.py
        exceptions.py
      docker-compose.yml
      docker-entrypoint.py
      Dockerfile
      README.md
    envelo-agent-v1.0.0.zip
    envelo-docker.zip
  .gitignore
  apply.html
  conformance-agreement.html
  draft.html
  index.html
  install.sh
  privacy.html
  scenarios.html
  status.html
  terms.html
.env.example
.gitignore
docker-compose.yml
railway.toml
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/app/api/routes/licensees.py">
"""Licensee Portal routes - For ENVELO implementers."""

import secrets
from datetime import datetime, timedelta
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from pydantic import BaseModel, EmailStr
from typing import Optional

from app.core.database import get_db
from app.core.security import get_current_user, require_role
from app.models.models import Licensee, User, UserRole

router = APIRouter()


class LicenseeCreate(BaseModel):
    organization_name: str
    contact_name: str
    contact_email: EmailStr
    license_type: str = "implementer"  # implementer, integrator, reseller


async def generate_license_number(db: AsyncSession) -> str:
    """Generate unique license number."""
    year = datetime.utcnow().year
    result = await db.execute(
        select(func.count(Licensee.id)).where(Licensee.license_number.like(f"LIC-{year}-%"))
    )
    count = (result.scalar() or 0) + 1
    return f"LIC-{year}-{count:05d}"


@router.post("/")
async def create_licensee(
    data: LicenseeCreate,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin"]))
):
    """Create a new licensee (admin only)."""
    license_number = await generate_license_number(db)
    api_key = f"env_{secrets.token_urlsafe(32)}"
    
    licensee = Licensee(
        license_number=license_number,
        organization_name=data.organization_name,
        contact_name=data.contact_name,
        contact_email=data.contact_email,
        license_type=data.license_type,
        licensed_at=datetime.utcnow(),
        expires_at=datetime.utcnow() + timedelta(days=365),
        is_active=True,
        api_key=api_key,
    )
    
    db.add(licensee)
    await db.commit()
    await db.refresh(licensee)
    
    return {
        "license_number": licensee.license_number,
        "organization_name": licensee.organization_name,
        "license_type": licensee.license_type,
        "licensed_at": licensee.licensed_at.isoformat(),
        "expires_at": licensee.expires_at.isoformat(),
        "api_key": api_key,  # Only shown once at creation
        "message": "Licensee created. Save the API key - it will not be shown again."
    }


@router.get("/")
async def list_licensees(
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin"]))
):
    """List all licensees (admin only)."""
    result = await db.execute(select(Licensee).order_by(Licensee.licensed_at.desc()))
    licensees = result.scalars().all()
    
    return [
        {
            "id": l.id,
            "license_number": l.license_number,
            "organization_name": l.organization_name,
            "contact_name": l.contact_name,
            "contact_email": l.contact_email,
            "license_type": l.license_type,
            "licensed_at": l.licensed_at.isoformat() if l.licensed_at else None,
            "expires_at": l.expires_at.isoformat() if l.expires_at else None,
            "is_active": l.is_active,
        }
        for l in licensees
    ]


@router.get("/me")
async def get_my_license(
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    """Get current user's licensee info."""
    result = await db.execute(
        select(Licensee).where(Licensee.user_id == int(user["sub"]))
    )
    licensee = result.scalar_one_or_none()
    
    if not licensee:
        raise HTTPException(status_code=404, detail="No license found for this user")
    
    return {
        "license_number": licensee.license_number,
        "organization_name": licensee.organization_name,
        "license_type": licensee.license_type,
        "licensed_at": licensee.licensed_at.isoformat() if licensee.licensed_at else None,
        "expires_at": licensee.expires_at.isoformat() if licensee.expires_at else None,
        "is_active": licensee.is_active,
    }


@router.get("/docs")
async def get_documentation(
    user: dict = Depends(get_current_user)
):
    """Get ENVELO technical documentation (licensees only)."""
    if user.get("role") not in ["admin", "licensee"]:
        raise HTTPException(status_code=403, detail="Licensee access required")
    
    return {
        "title": "ENVELO Implementation Guide",
        "version": "1.0",
        "sections": [
            {
                "name": "Architecture Overview",
                "description": "Non-bypassable interlock architecture",
                "url": "/docs/architecture"
            },
            {
                "name": "Envelope Definition",
                "description": "How to define operational boundaries",
                "url": "/docs/envelope"
            },
            {
                "name": "Integration API",
                "description": "Runtime API for ENVELO enforcement",
                "url": "/docs/api"
            },
            {
                "name": "Certification Requirements",
                "description": "What you need for ODDC certification",
                "url": "/docs/certification"
            },
        ],
        "support": "licensee-support@sentinelauthority.org"
    }


@router.patch("/{license_number}/deactivate")
async def deactivate_licensee(
    license_number: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin"]))
):
    """Deactivate a licensee."""
    result = await db.execute(
        select(Licensee).where(Licensee.license_number == license_number)
    )
    licensee = result.scalar_one_or_none()
    
    if not licensee:
        raise HTTPException(status_code=404, detail="Licensee not found")
    
    licensee.is_active = False
    await db.commit()
    
    return {"message": "Licensee deactivated", "license_number": license_number}


@router.post("/{license_number}/rotate-key")
async def rotate_api_key(
    license_number: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin"]))
):
    """Rotate a licensee's API key."""
    result = await db.execute(
        select(Licensee).where(Licensee.license_number == license_number)
    )
    licensee = result.scalar_one_or_none()
    
    if not licensee:
        raise HTTPException(status_code=404, detail="Licensee not found")
    
    new_key = f"env_{secrets.token_urlsafe(32)}"
    licensee.api_key = new_key
    await db.commit()
    
    return {
        "message": "API key rotated",
        "license_number": license_number,
        "new_api_key": new_key,
        "warning": "Save this key - it will not be shown again"
    }
</file>

<file path="backend/app/api/__init__.py">

</file>

<file path="backend/app/core/__init__.py">

</file>

<file path="backend/app/core/config.py">
"""Core configuration."""

import os
from typing import List
from pydantic_settings import BaseSettings


class Settings(BaseSettings):
    ENVIRONMENT: str = "development"
    DEBUG: bool = False
    DATABASE_URL: str = "postgresql://localhost/sentinel_authority"
    REDIS_URL: str = "redis://localhost:6379"
    SECRET_KEY: str = "change-me-in-production"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24
    ALGORITHM: str = "HS256"
    CORS_ORIGINS: List[str] = [
        "http://localhost:3000",
        "http://localhost:5173",
        "https://app.sentinelauthority.org",
        "https://envelo.ai",
    ]
    CAT72_DURATION_HOURS: int = 72
    CAT72_CONVERGENCE_THRESHOLD: float = 0.95
    CAT72_DRIFT_THRESHOLD: float = 0.02
    CAT72_STABILITY_THRESHOLD: float = 0.90
    CERTIFICATE_PREFIX: str = "ODDC"
    
    class Config:
        env_file = ".env"


settings = Settings()
</file>

<file path="backend/app/core/security.py">
"""Authentication and security."""

from datetime import datetime, timedelta
from typing import Optional
from passlib.context import CryptContext
from jose import JWTError, jwt
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from app.core.config import settings

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
security = HTTPBearer()


def verify_password(plain: str, hashed: str) -> bool:
    return pwd_context.verify(plain, hashed)


def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)


def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:
    to_encode = data.copy()
    expire = datetime.utcnow() + (expires_delta or timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES))
    to_encode.update({"exp": expire})
    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)


def decode_token(token: str) -> dict:
    try:
        return jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
    except JWTError:
        raise HTTPException(status_code=401, detail="Invalid credentials")


async def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> dict:
    payload = decode_token(credentials.credentials)
    if not payload.get("sub"):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    return payload


def require_role(allowed_roles: list):
    async def checker(user: dict = Depends(get_current_user)):
        if user.get("role") not in allowed_roles:
            raise HTTPException(status_code=403, detail="Insufficient permissions")
        return user
    return checker
</file>

<file path="backend/app/models/__init__.py">

</file>

<file path="backend/app/services/__init__.py">

</file>

<file path="backend/app/services/certificate_pdf.py">
"""ODDC Certificate PDF Generator - Matching sentinelauthority.org branding"""
from reportlab.lib.pagesizes import letter
from reportlab.lib.units import inch
from reportlab.lib.colors import HexColor, white
from reportlab.pdfgen import canvas
from io import BytesIO
from datetime import datetime

# Colors matching sentinelauthority.org exactly
PURPLE_PRIMARY = HexColor('#5B4B8A')
PURPLE_BRIGHT = HexColor('#9d8ccf')
BG_DEEP = HexColor('#2a2f3d')
ACCENT_GREEN = HexColor('#5CD685')
TEXT_PRIMARY = HexColor('#f0f0f0')
TEXT_SECONDARY = HexColor('#bfbfbf')
TEXT_TERTIARY = HexColor('#808080')
BORDER_GLASS = HexColor('#333844')

def generate_certificate_pdf(certificate_id, organization_name, system_name, odd_specification, issued_date, expiry_date, test_id, convergence_score, stability_index, drift_rate, evidence_hash):
    buffer = BytesIO()
    c = canvas.Canvas(buffer, pagesize=letter)
    width, height = letter
    
    # Dark background matching website
    c.setFillColor(BG_DEEP)
    c.rect(0, 0, width, height, fill=True, stroke=False)
    
    # Outer border - subtle
    c.setStrokeColor(BORDER_GLASS)
    c.setLineWidth(1)
    c.rect(0.5*inch, 0.5*inch, width - inch, height - inch)
    
    # Inner border with purple accent
    c.setStrokeColor(PURPLE_BRIGHT)
    c.setLineWidth(0.5)
    c.rect(0.6*inch, 0.6*inch, width - 1.2*inch, height - 1.2*inch)
    
    # ODDC Mark box at top (matching website badge style)
    mark_width = 2.5*inch
    mark_height = 1.2*inch
    mark_x = (width - mark_width) / 2
    mark_y = height - 2*inch
    
    # Badge background
    c.setFillColor(PURPLE_PRIMARY)
    c.setStrokeColor(PURPLE_BRIGHT)
    c.setLineWidth(2)
    c.roundRect(mark_x, mark_y, mark_width, mark_height, 10, fill=True, stroke=True)
    
    # ODDC text
    c.setFillColor(white)
    c.setFont("Helvetica-Bold", 36)
    c.drawCentredString(width/2, mark_y + 0.65*inch, "ODDC")
    
    # SENTINEL AUTHORITY text
    c.setFillColor(PURPLE_BRIGHT)
    c.setFont("Helvetica", 9)
    c.drawCentredString(width/2, mark_y + 0.25*inch, "SENTINEL AUTHORITY")
    
    # Certificate ID below mark
    c.setFillColor(TEXT_TERTIARY)
    c.setFont("Courier", 9)
    c.drawCentredString(width/2, mark_y - 0.35*inch, certificate_id)
    
    # Title
    y = height - 3.1*inch
    c.setFillColor(TEXT_PRIMARY)
    c.setFont("Helvetica-Bold", 18)
    c.drawCentredString(width/2, y, "CONFORMANCE DETERMINATION")
    
    # Purple line
    c.setStrokeColor(PURPLE_BRIGHT)
    c.setLineWidth(1)
    c.line(2*inch, y - 0.2*inch, width - 2*inch, y - 0.2*inch)
    
    # Main content
    y -= 0.7*inch
    c.setFillColor(TEXT_SECONDARY)
    c.setFont("Helvetica", 11)
    c.drawCentredString(width/2, y, "This record attests that")
    
    y -= 0.4*inch
    c.setFillColor(TEXT_PRIMARY)
    c.setFont("Helvetica-Bold", 16)
    c.drawCentredString(width/2, y, organization_name)
    
    y -= 0.35*inch
    c.setFillColor(TEXT_SECONDARY)
    c.setFont("Helvetica", 11)
    c.drawCentredString(width/2, y, "has demonstrated conformance for the autonomous system")
    
    y -= 0.4*inch
    c.setFillColor(PURPLE_BRIGHT)
    c.setFont("Helvetica-Bold", 14)
    c.drawCentredString(width/2, y, system_name)
    
    y -= 0.35*inch
    c.setFillColor(TEXT_SECONDARY)
    c.setFont("Helvetica", 10)
    c.drawCentredString(width/2, y, f"Operational Design Domain: {odd_specification}")
    
    # CAT-72 Results box
    y -= 0.7*inch
    box_h = 1.4*inch
    box_w = 5*inch
    box_x = (width - box_w) / 2
    
    c.setFillColor(HexColor('#363d4d'))
    c.setStrokeColor(BORDER_GLASS)
    c.setLineWidth(1)
    c.roundRect(box_x, y - box_h, box_w, box_h, 5, fill=True, stroke=True)
    
    # Box header
    c.setFillColor(PURPLE_BRIGHT)
    c.setFont("Helvetica-Bold", 10)
    c.drawCentredString(width/2, y - 0.25*inch, f"CAT-72 EVIDENCE — {test_id}")
    
    # Metrics grid
    c.setFont("Helvetica", 9)
    col1_x = box_x + 0.4*inch
    col2_x = box_x + 2.6*inch
    
    row1_y = y - 0.55*inch
    row2_y = y - 0.85*inch
    
    c.setFillColor(TEXT_TERTIARY)
    c.drawString(col1_x, row1_y, "Convergence Score")
    c.drawString(col2_x, row1_y, "Stability Index")
    c.drawString(col1_x, row2_y, "Drift Rate")
    c.drawString(col2_x, row2_y, "Determination")
    
    c.setFillColor(TEXT_PRIMARY)
    c.setFont("Helvetica-Bold", 11)
    c.drawString(col1_x + 1.3*inch, row1_y, f"{convergence_score:.1%}")
    c.drawString(col2_x + 1.1*inch, row1_y, f"{stability_index:.1%}")
    c.drawString(col1_x + 1.3*inch, row2_y, f"{drift_rate:.4f}")
    
    c.setFillColor(ACCENT_GREEN)
    c.drawString(col2_x + 1.1*inch, row2_y, "CONFORMANT")
    
    # Validity period
    y -= 1.8*inch
    c.setFillColor(TEXT_TERTIARY)
    c.setFont("Helvetica", 9)
    c.drawCentredString(width/2, y, "VALIDITY PERIOD")
    
    y -= 0.25*inch
    c.setFillColor(TEXT_PRIMARY)
    c.setFont("Helvetica", 10)
    c.drawCentredString(width/2, y, f"{issued_date.strftime('%Y-%m-%d')}  →  {expiry_date.strftime('%Y-%m-%d')}")
    
    # ENVELO statement
    y -= 0.5*inch
    c.setFillColor(TEXT_SECONDARY)
    c.setFont("Helvetica", 8)
    c.drawCentredString(width/2, y, "ENVELO enforcement requirements verified present and auditable.")
    
    y -= 0.2*inch
    c.setFont("Helvetica-Oblique", 7)
    c.setFillColor(TEXT_TERTIARY)
    c.drawCentredString(width/2, y, "Enforcer for Non-Violable Execution & Limit Oversight")
    
    # Evidence hash
    y = 1.9*inch
    c.setFillColor(TEXT_TERTIARY)
    c.setFont("Helvetica", 7)
    c.drawCentredString(width/2, y, "EVIDENCE HASH")
    
    y -= 0.18*inch
    c.setFillColor(TEXT_PRIMARY)
    c.setFont("Courier", 6)
    c.drawCentredString(width/2, y, evidence_hash)
    
    # Verification URL
    y -= 0.25*inch
    c.setFillColor(PURPLE_BRIGHT)
    c.setFont("Helvetica", 8)
    c.drawCentredString(width/2, y, "Verify: sentinelauthority.org/verify")
    
    # Footer disclaimer
    y -= 0.3*inch
    c.setFillColor(TEXT_TERTIARY)
    c.setFont("Helvetica-Oblique", 6)
    c.drawCentredString(width/2, y, "ODDC attests conformance within declared ODD. Does not attest safety, regulatory compliance, or fitness for purpose.")
    
    y -= 0.12*inch
    c.drawCentredString(width/2, y, "Independent conformance determination. Not a regulator. Not legal advice.")
    
    y -= 0.15*inch
    c.setFont("Helvetica", 6)
    c.drawCentredString(width/2, y, "© 2026 Sentinel Authority")
    
    c.save()
    buffer.seek(0)
    return buffer.getvalue()
</file>

<file path="backend/app/utils/__init__.py">

</file>

<file path="backend/app/__init__.py">

</file>

<file path="database/init.sql">
-- Sentinel Authority Database Initialization
-- This script runs on first database creation

-- Create extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Grant permissions
GRANT ALL PRIVILEGES ON DATABASE sentinel_authority TO sentinel;

-- Insert default admin user (password: admin123 - CHANGE IN PRODUCTION)
-- Password hash for 'admin123' using bcrypt
INSERT INTO users (email, hashed_password, full_name, organization, role, is_active, created_at)
VALUES (
    'admin@sentinelauthority.org',
    '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/X4.HQZC1nK5KjKjKi',
    'System Administrator',
    'Sentinel Authority',
    'admin',
    true,
    NOW()
) ON CONFLICT (email) DO NOTHING;

-- Insert demo operator (password: operator123 - CHANGE IN PRODUCTION)
INSERT INTO users (email, hashed_password, full_name, organization, role, is_active, created_at)
VALUES (
    'operator@sentinelauthority.org',
    '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/X4.HQZC1nK5KjKjKi',
    'Test Operator',
    'Sentinel Authority',
    'operator',
    true,
    NOW()
) ON CONFLICT (email) DO NOTHING;

-- Log initialization
DO $$
BEGIN
    RAISE NOTICE 'Sentinel Authority database initialized successfully';
END $$;
</file>

<file path="docs/CUSTOMER_INTEGRATION_GUIDE.md">
# Sentinel Authority — CAT-72 Integration Guide

**ODDC Conformance for Autonomous Systems**

Version 1.0 | © 2026 Sentinel Authority

---

## Overview

The **Convergence Authorization Test (CAT-72)** is a 72-hour continuous evaluation that determines your autonomous system maintains operational conformance within its declared Operational Design Domain (ODD).

---

## API Integration

### Base URL
```
https://sentinel-authority-production.up.railway.app
```

### Telemetry Endpoint
```
POST /api/cat72/tests/{test_id}/telemetry
Content-Type: application/json
```

### Request Format
```json
{
  "state_vector": {
    "x": 125.5,
    "y": -42.3,
    "velocity": 8.7,
    "heading": 270.0
  },
  "timestamp": "2026-01-25T14:30:00.000Z"
}
```

### Response Format
```json
{
  "sample_number": 12847,
  "in_envelope": true,
  "envelope_distance": 2.3,
  "convergence_score": 0.9847,
  "interlock_triggered": false
}
```

---

## Python Example
```python
import requests
import time
from datetime import datetime, timezone

class CAT72Client:
    def __init__(self, test_id: str):
        self.endpoint = f"https://sentinel-authority-production.up.railway.app/api/cat72/tests/{test_id}/telemetry"
    
    def send_telemetry(self, state: dict) -> dict:
        payload = {
            "state_vector": state,
            "timestamp": datetime.now(timezone.utc).isoformat()
        }
        response = requests.post(self.endpoint, json=payload, timeout=10)
        return response.json()

# Usage
client = CAT72Client("CAT72-2026-00015")

while True:
    state = {
        "x": robot.position.x,
        "y": robot.position.y,
        "velocity": robot.velocity,
        "heading": robot.heading
    }
    result = client.send_telemetry(state)
    
    if result["interlock_triggered"]:
        print("ALERT: Safety interlock triggered!")
    
    time.sleep(1)
```

---

## Pass/Fail Criteria

| Metric | Threshold |
|--------|-----------|
| Convergence | ≥ 95% |
| Drift Rate | ≤ 0.02 |
| Stability | ≥ 90% |

---

## Contact

conformance@sentinelauthority.org
</file>

<file path="frontend/src/styles/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;
  color-scheme: dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #111827;
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  min-height: 100vh;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #1f2937;
}

::-webkit-scrollbar-thumb {
  background: #4b5563;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* Animations */
@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 5px rgba(147, 51, 234, 0.5); }
  50% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.8); }
}

.pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* Table styles */
table {
  border-collapse: collapse;
}

/* Form inputs */
input:focus, select:focus, textarea:focus {
  outline: none;
}

/* Transitions */
.transition-all {
  transition-property: all;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 150ms;
}
</file>

<file path="frontend/src/main.jsx">
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './styles/index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
</file>

<file path="frontend/Dockerfile">
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "run", "dev", "--", "--host"]
</file>

<file path="frontend/index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentinel Authority Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="frontend/package.json">
{
  "name": "sentinel-authority-frontend",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.21.0",
    "axios": "^1.6.0",
    "lucide-react": "^0.303.0",
    "recharts": "^2.10.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.2.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",
    "tailwindcss": "^3.4.0",
    "vite": "^5.0.0"
  }
}
</file>

<file path="frontend/postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="frontend/tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
</file>

<file path="frontend/vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: process.env.VITE_API_URL || 'http://localhost:8000',
        changeOrigin: true,
      }
    }
  }
})
</file>

<file path=".env.example">
# Sentinel Authority Platform - Environment Configuration
# Copy to .env and fill in values

# =============================================================================
# DATABASE
# =============================================================================
DATABASE_URL=postgresql://sentinel:password@localhost:5432/sentinel_authority

# =============================================================================
# REDIS
# =============================================================================
REDIS_URL=redis://localhost:6379

# =============================================================================
# SECURITY
# =============================================================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-secret-key-here

# =============================================================================
# ENVIRONMENT
# =============================================================================
ENVIRONMENT=development
DEBUG=true

# =============================================================================
# CORS
# =============================================================================
CORS_ORIGINS=["http://localhost:3000","http://localhost:5173"]

# =============================================================================
# CAT-72 SETTINGS
# =============================================================================
CAT72_DURATION_HOURS=72
CAT72_CONVERGENCE_THRESHOLD=0.95
CAT72_DRIFT_THRESHOLD=0.02
CAT72_STABILITY_THRESHOLD=0.90

# =============================================================================
# CERTIFICATE SETTINGS
# =============================================================================
CERTIFICATE_PREFIX=ODDC

# =============================================================================
# FRONTEND
# =============================================================================
VITE_API_URL=http://localhost:8000
</file>

<file path=".gitignore">
# Environment
.env
.env.local
.env.*.local

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
.venv/
ENV/

# Node
node_modules/
dist/
.cache/

# IDE
.idea/
.vscode/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Logs
*.log
logs/

# Test
.coverage
htmlcov/
.pytest_cache/

# Build
build/
*.egg-info/

# Docker
*.pid
</file>

<file path="railway.toml">
[build]
builder = "dockerfile"
dockerfilePath = "backend/Dockerfile"
watchPatterns = ["backend/**"]

[deploy]
startCommand = "cd /app && uvicorn main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
</file>

<file path="README.md">
# Sentinel Authority Platform

**Independent Conformance Determination for Autonomous Systems**

Unified platform for ODDC (Operational Design Domain Conformance) determination with ENVELO enforcement requirements (Enforcer for Non-Violable Execution & Limit Oversight).

ENVELO is a method designation describing non-bypassable enforcement requirements, not a product or platform.

© 2026 Sentinel Authority. All rights reserved.

---

## Live URLs

- **Platform:** https://sentinel-authority.vercel.app
- **API:** https://sentinel-authority-production.up.railway.app
- **API Docs:** https://sentinel-authority-production.up.railway.app/docs

---

## Platform Modules

| Module | Description | Users |
|--------|-------------|-------|
| **Applicant Portal** | Submit ODD specs, track status | Customers |
| **CAT-72 Console** | Run 72-hour conformance tests | Operators |
| **Conformance Registry** | Issue, manage, revoke determinations | Admin |
| **Public Verification** | Third-party verification | Anyone |
| **Licensee Portal** | Technical documentation | Licensed implementers |

---

## CAT-72 Pass Criteria

| Metric | Threshold | Description |
|--------|-----------|-------------|
| Convergence | ≥ 95% | % of samples within envelope |
| Drift Rate | ≤ 0.02 | Rate of approach to boundaries |
| Stability | ≥ 90% | Consistency over time |

---

## Tech Stack

- **Backend:** FastAPI + PostgreSQL
- **Frontend:** React + Vite
- **Hosting:** Railway (API) + Vercel (UI) + Neon (DB)
</file>

<file path="backend/app/api/routes/__init__.py">
"""API Routes package."""
from app.api.routes import auth, dashboard, applicants, cat72, certificates, verification, licensees, envelo, apikeys

__all__ = ["auth", "dashboard", "applicants", "cat72", "certificates", "verification", "licensees", "envelo", "apikeys"]
</file>

<file path="backend/app/api/routes/dashboard.py">
"""Dashboard routes."""

from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from pydantic import BaseModel
from typing import List

from app.core.database import get_db
from app.core.security import get_current_user
from app.models.models import Application, CAT72Test, Certificate, CertificationState, TestState

router = APIRouter()


class DashboardStats(BaseModel):
    total_applications: int
    pending_applications: int
    active_tests: int
    certificates_issued: int
    certificates_active: int


@router.get("/stats")
async def get_stats(db: AsyncSession = Depends(get_db), user: dict = Depends(get_current_user)):
    if user.get("role") == "applicant":
        org = user.get("organization")
        total_apps = await db.execute(select(func.count(Application.id)).where(Application.organization_name == org))
        pending_apps = await db.execute(select(func.count(Application.id)).where(Application.state == CertificationState.PENDING, Application.organization_name == org))
        active_tests = await db.execute(select(func.count(CAT72Test.id)).where(CAT72Test.state == TestState.RUNNING))
        total_certs = await db.execute(select(func.count(Certificate.id)).where(Certificate.organization_name == org))
        active_certs = await db.execute(select(func.count(Certificate.id)).where(Certificate.state == CertificationState.CONFORMANT, Certificate.organization_name == org))
    else:
        total_apps = await db.execute(select(func.count(Application.id)))
        pending_apps = await db.execute(select(func.count(Application.id)).where(Application.state == CertificationState.PENDING))
        active_tests = await db.execute(select(func.count(CAT72Test.id)).where(CAT72Test.state == TestState.RUNNING))
        total_certs = await db.execute(select(func.count(Certificate.id)))
        active_certs = await db.execute(select(func.count(Certificate.id)).where(Certificate.state == CertificationState.CONFORMANT))
    
    return {
        "total_applications": total_apps.scalar() or 0,
        "pending_applications": pending_apps.scalar() or 0,
        "active_tests": active_tests.scalar() or 0,
        "certificates_issued": total_certs.scalar() or 0,
        "certificates_active": active_certs.scalar() or 0,
    }


@router.get("/recent-applications")
async def get_recent_applications(db: AsyncSession = Depends(get_db), user: dict = Depends(get_current_user)):
    if user.get("role") == "applicant":
        result = await db.execute(
            select(Application).where(Application.organization_name == user.get("organization")).order_by(Application.created_at.desc()).limit(10)
        )
    else:
        result = await db.execute(
            select(Application).order_by(Application.created_at.desc()).limit(10)
        )
    return [
        {
            "id": a.id,
            "application_number": a.application_number,
            "organization_name": a.organization_name,
            "system_name": a.system_name,
            "state": a.state.value,
            "submitted_at": a.submitted_at.isoformat() if a.submitted_at else None,
        }
        for a in result.scalars().all()
    ]


@router.get("/active-tests")
async def get_active_tests(db: AsyncSession = Depends(get_db), user: dict = Depends(get_current_user)):
    result = await db.execute(
        select(CAT72Test, Application).join(Application, CAT72Test.application_id == Application.id).where(CAT72Test.state == TestState.RUNNING).order_by(CAT72Test.started_at.desc())
    )
    rows = result.all()
    return [
        {
            "id": t.id,
            "test_id": t.test_id,
            "organization_name": a.organization_name if hasattr(a, "organization_name") else "",
            "system_name": a.system_name if hasattr(a, "system_name") else "",
            "state": t.state.value,
            "elapsed_seconds": t.elapsed_seconds,
            "duration_hours": t.duration_hours,
            "convergence_score": t.convergence_score,
            "interlock_activations": t.interlock_activations,
        }
        for t, a in rows
    ]


@router.get("/recent-certificates")
async def get_recent_certificates(db: AsyncSession = Depends(get_db), user: dict = Depends(get_current_user)):
    if user.get("role") == "applicant":
        result = await db.execute(
            select(Certificate).where(Certificate.organization_name == user.get("organization")).order_by(Certificate.issued_at.desc()).limit(10)
        )
    else:
        result = await db.execute(
            select(Certificate).order_by(Certificate.issued_at.desc()).limit(10)
        )
    return [
        {
            "id": c.id,
            "certificate_number": c.certificate_number,
            "organization_name": c.organization_name,
            "system_name": c.system_name,
            "state": c.state.value,
            "issued_at": c.issued_at.isoformat() if c.issued_at else None,
            "expires_at": c.expires_at.isoformat() if c.expires_at else None,
        }
        for c in result.scalars().all()
    ]
</file>

<file path="backend/app/core/database.py">
"""Database configuration."""

from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker
from sqlalchemy.orm import declarative_base
from sqlalchemy.pool import NullPool
from app.core.config import settings

DATABASE_URL = settings.DATABASE_URL
if DATABASE_URL.startswith("postgresql://"):
    DATABASE_URL = DATABASE_URL.replace("postgresql://", "postgresql+asyncpg://", 1)

engine = create_async_engine(
    DATABASE_URL, 
    echo=settings.DEBUG, 
    future=True,
    poolclass=NullPool,  # Disable connection pooling to prevent stale connections
)
AsyncSessionLocal = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)
Base = declarative_base()


async def init_db():
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)


async def get_db():
    async with AsyncSessionLocal() as session:
        try:
            yield session
            await session.commit()
        except Exception:
            await session.rollback()
            raise
        finally:
            await session.close()
</file>

<file path="backend/app/services/auto_evaluator.py">
"""
Auto-Evaluator Service
Checks for tests that have run 72+ hours and auto-evaluates them
"""

import asyncio
from datetime import datetime, timedelta
from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession
from app.core.database import async_session_maker
from app.models.models import CAT72Test, Application, EnveloSession
from app.services.cat72_evaluator import complete_test_and_issue_certificate
import logging

logger = logging.getLogger(__name__)

MIN_TEST_DURATION_HOURS = 72


async def check_and_evaluate_tests():
    """Check for tests that need auto-evaluation"""
    async with async_session_maker() as db:
        # Find tests that are running and started more than 72 hours ago
        cutoff_time = datetime.utcnow() - timedelta(hours=MIN_TEST_DURATION_HOURS)
        
        result = await db.execute(
            select(CAT72Test).where(
                CAT72Test.status == 'running',
                CAT72Test.started_at <= cutoff_time
            )
        )
        tests = result.scalars().all()
        
        for test in tests:
            logger.info(f"Auto-evaluating test {test.id} (started {test.started_at})")
            try:
                evaluation = await complete_test_and_issue_certificate(db, test.id, notify_applicant=True)
                logger.info(f"Test {test.id} evaluation complete: {evaluation.get('passed', False)}")
            except Exception as e:
                logger.error(f"Failed to evaluate test {test.id}: {e}")


async def run_auto_evaluator():
    """Background task that runs every hour"""
    while True:
        try:
            await check_and_evaluate_tests()
        except Exception as e:
            logger.error(f"Auto-evaluator error: {e}")
        
        # Wait 1 hour before next check
        await asyncio.sleep(3600)
</file>

<file path="backend/app/services/background_tasks.py">
"""Background tasks for monitoring"""
import asyncio
from datetime import datetime, timedelta
from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession

async def check_offline_agents_task(get_db_func):
    """Background task to check for offline agents every 5 minutes"""
    from app.models.models import EnveloSession, APIKey, User, Certificate
    from app.services.email_service import notify_agent_offline, notify_admin_agent_offline
    
    while True:
        try:
            await asyncio.sleep(300)  # Wait 5 minutes
            
            async for db in get_db_func():
                try:
                    now = datetime.utcnow()
                    
                    # Get active sessions
                    result = await db.execute(
                        select(EnveloSession).where(EnveloSession.status == "active")
                    )
                    sessions = result.scalars().all()
                    
                    for session in sessions:
                        last_activity = session.last_heartbeat_at or session.last_telemetry_at
                        if not last_activity:
                            continue
                        
                        minutes_offline = int((now - last_activity).total_seconds() / 60)
                        
                        # Only alert if offline >5 min and haven't alerted recently
                        last_offline_alert = getattr(session, 'last_offline_alert_at', None)
                        already_alerted = last_offline_alert and (now - last_offline_alert).total_seconds() < 3600
                        
                        if minutes_offline >= 5 and not already_alerted:
                            # Get user info
                            api_key_result = await db.execute(
                                select(APIKey).where(APIKey.id == session.api_key_id)
                            )
                            api_key = api_key_result.scalar_one_or_none()
                            
                            if api_key:
                                user_result = await db.execute(
                                    select(User).where(User.id == api_key.user_id)
                                )
                                user = user_result.scalar_one_or_none()
                                
                                if user:
                                    cert_result = await db.execute(
                                        select(Certificate).where(Certificate.id == session.certificate_id)
                                    )
                                    cert = cert_result.scalar_one_or_none()
                                    
                                    system_name = cert.system_name if cert else "Unknown System"
                                    org_name = cert.organization_name if cert else user.organization or "Unknown"
                                    
                                    try:
                                        await notify_agent_offline(
                                            user.email, system_name, session.session_id, org_name, minutes_offline
                                        )
                                        await notify_admin_agent_offline(
                                            system_name, org_name, session.session_id, minutes_offline, user.email
                                        )
                                        print(f"[MONITOR] Sent offline alert for {org_name} - {system_name}")
                                    except Exception as e:
                                        print(f"[MONITOR] Failed to send offline alert: {e}")
                    
                    await db.commit()
                except Exception as e:
                    print(f"[MONITOR] Error in offline check: {e}")
                finally:
                    await db.close()
                break  # Only need one db session
                    
        except Exception as e:
            print(f"[MONITOR] Background task error: {e}")
            await asyncio.sleep(60)  # Wait a minute before retrying
</file>

<file path="backend/app/services/cat72_evaluator.py">
"""
CAT-72 Test Evaluator
Automatically evaluates test results and issues certificates
"""

from datetime import datetime, timedelta
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from app.models.models import Application, Certificate, EnveloSession, TelemetryRecord, CAT72Test
from app.services.certificate_generator import generate_certificate_pdf
from app.services import email_service
import uuid


# Certification criteria
MIN_TEST_DURATION_HOURS = 72
MIN_PASS_RATE = 95.0  # Percentage
MIN_TOTAL_ACTIONS = 100
REQUIRE_BLOCKING_VERIFIED = True


async def evaluate_test(db: AsyncSession, test_id: int) -> dict:
    """
    Evaluate a CAT-72 test and determine pass/fail
    Returns evaluation results
    """
    
    # Get test and application
    result = await db.execute(select(CAT72Test).where(CAT72Test.id == test_id))
    test = result.scalar_one_or_none()
    if not test:
        return {"error": "Test not found"}
    
    result = await db.execute(select(Application).where(Application.id == test.application_id))
    application = result.scalar_one_or_none()
    if not application:
        return {"error": "Application not found"}
    
    # Get all sessions for this test/certificate
    cert_id = f"ODDC-{datetime.now().year}-{test.application_id:04d}"
    result = await db.execute(
        select(EnveloSession).where(EnveloSession.certificate_id == cert_id)
    )
    sessions = result.scalars().all()
    
    # Calculate metrics
    total_pass = sum(s.pass_count or 0 for s in sessions)
    total_block = sum(s.block_count or 0 for s in sessions)
    total_actions = total_pass + total_block
    
    pass_rate = (total_pass / total_actions * 100) if total_actions > 0 else 0
    
    # Calculate test duration
    if test.started_at:
        if test.ended_at:
            duration_hours = (test.ended_at - test.started_at).total_seconds() / 3600
        else:
            duration_hours = (datetime.utcnow() - test.started_at).total_seconds() / 3600
    else:
        duration_hours = 0
    
    blocking_verified = total_block > 0
    
    # Build evaluation result
    evaluation = {
        "test_id": test_id,
        "application_id": test.application_id,
        "system_name": application.system_name,
        "duration_hours": round(duration_hours, 1),
        "total_actions": total_actions,
        "pass_count": total_pass,
        "block_count": total_block,
        "pass_rate": round(pass_rate, 1),
        "blocking_verified": blocking_verified,
        "criteria": {
            "duration_met": duration_hours >= MIN_TEST_DURATION_HOURS,
            "pass_rate_met": pass_rate >= MIN_PASS_RATE,
            "min_actions_met": total_actions >= MIN_TOTAL_ACTIONS,
            "blocking_verified": blocking_verified or not REQUIRE_BLOCKING_VERIFIED,
        }
    }
    
    # Determine overall pass/fail
    all_criteria_met = all(evaluation["criteria"].values())
    evaluation["passed"] = all_criteria_met
    
    if not all_criteria_met:
        reasons = []
        if not evaluation["criteria"]["duration_met"]:
            reasons.append(f"Test duration ({duration_hours:.1f}h) below required {MIN_TEST_DURATION_HOURS}h")
        if not evaluation["criteria"]["pass_rate_met"]:
            reasons.append(f"Pass rate ({pass_rate:.1f}%) below required {MIN_PASS_RATE}%")
        if not evaluation["criteria"]["min_actions_met"]:
            reasons.append(f"Total actions ({total_actions}) below required {MIN_TOTAL_ACTIONS}")
        if not evaluation["criteria"]["blocking_verified"]:
            reasons.append("No boundary violations were blocked (enforcement not verified)")
        evaluation["failure_reasons"] = reasons
    
    return evaluation


async def complete_test_and_issue_certificate(
    db: AsyncSession, 
    test_id: int,
    notify_applicant: bool = True
) -> dict:
    """
    Complete a test, evaluate it, and issue certificate if passed
    """
    
    # Get test
    result = await db.execute(select(CAT72Test).where(CAT72Test.id == test_id))
    test = result.scalar_one_or_none()
    if not test:
        return {"error": "Test not found"}
    
    # Mark test as ended
    test.ended_at = datetime.utcnow()
    test.status = "evaluating"
    await db.commit()
    
    # Evaluate
    evaluation = await evaluate_test(db, test_id)
    
    if evaluation.get("error"):
        return evaluation
    
    # Get application for contact info
    result = await db.execute(select(Application).where(Application.id == test.application_id))
    application = result.scalar_one_or_none()
    
    if evaluation["passed"]:
        # Issue certificate
        cert_number = f"ODDC-{datetime.now().year}-{test.application_id:04d}"
        issue_date = datetime.utcnow()
        expiry_date = issue_date + timedelta(days=365)
        
        # Generate PDF
        pdf_bytes = generate_certificate_pdf(
            certificate_number=cert_number,
            system_name=application.system_name,
            organization=application.organization,
            odd_description=application.odd_description or "As declared in application",
            issue_date=issue_date,
            expiry_date=expiry_date,
            pass_rate=evaluation["pass_rate"],
            total_actions=evaluation["total_actions"]
        )
        
        # Create certificate record
        certificate = Certificate(
            certificate_number=cert_number,
            application_id=test.application_id,
            issued_at=issue_date,
            expires_at=expiry_date,
            status="active",
            pdf_data=pdf_bytes,
            signature=f"SA-SIG-{uuid.uuid4().hex[:8].upper()}",
            audit_log_ref=f"AUDIT-{test_id}-{datetime.now().strftime('%Y%m%d')}"
        )
        db.add(certificate)
        
        # Update test and application status
        test.status = "passed"
        test.result = "PASS"
        application.status = "certified"
        
        await db.commit()
        
        evaluation["certificate_number"] = cert_number
        evaluation["certificate_issued"] = True
        
        # Send notification
        if notify_applicant and application.contact_email:
            await email_service.send_certificate_issued(
                to=application.contact_email,
                app_name=application.system_name,
                cert_number=cert_number,
                expiry_date=expiry_date.strftime("%B %d, %Y")
            )
    else:
        # Test failed
        test.status = "failed"
        test.result = "FAIL"
        application.status = "test_failed"
        await db.commit()
        
        evaluation["certificate_issued"] = False
        
        # Send notification
        if notify_applicant and application.contact_email:
            await email_service.send_test_failed(
                to=application.contact_email,
                app_name=application.system_name,
                reason="; ".join(evaluation.get("failure_reasons", ["Did not meet criteria"])),
                pass_rate=evaluation["pass_rate"]
            )
    
    return evaluation
</file>

<file path="backend/app/services/cat72_report_generator.py">
"""
CAT-72 Test Report Generator
Creates detailed PDF reports for certification tests
"""

import io
from datetime import datetime
from reportlab.lib import colors
from reportlab.lib.pagesizes import letter
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
from reportlab.lib.units import inch
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
from reportlab.lib.enums import TA_CENTER, TA_LEFT, TA_RIGHT

PURPLE = colors.Color(91/255, 75/255, 138/255)


def generate_cat72_report(
    test_id: str,
    system_name: str,
    organization: str,
    started_at: datetime,
    ended_at: datetime,
    total_actions: int,
    pass_count: int,
    block_count: int,
    pass_rate: float,
    result: str,
    telemetry_records: list = None,
    violations: list = None,
) -> bytes:
    """Generate a CAT-72 test report PDF"""
    
    buffer = io.BytesIO()
    doc = SimpleDocTemplate(buffer, pagesize=letter, topMargin=0.5*inch, bottomMargin=0.5*inch)
    
    styles = getSampleStyleSheet()
    
    title_style = ParagraphStyle('Title', parent=styles['Heading1'], fontSize=24, textColor=PURPLE, alignment=TA_CENTER, spaceAfter=6)
    subtitle_style = ParagraphStyle('Subtitle', parent=styles['Normal'], fontSize=11, textColor=colors.gray, alignment=TA_CENTER, spaceAfter=20)
    section_style = ParagraphStyle('Section', parent=styles['Heading2'], fontSize=14, textColor=PURPLE, spaceBefore=20, spaceAfter=10)
    
    story = []
    
    # Header
    story.append(Paragraph("SENTINEL AUTHORITY", title_style))
    story.append(Paragraph("CAT-72 Conformance Test Report", subtitle_style))
    
    # Test result banner
    result_color = colors.Color(92/255, 214/255, 133/255) if result == "PASS" else colors.Color(214/255, 92/255, 92/255)
    result_table = Table([[f"TEST RESULT: {result}"]], colWidths=[6*inch])
    result_table.setStyle(TableStyle([
        ('BACKGROUND', (0, 0), (-1, -1), result_color),
        ('TEXTCOLOR', (0, 0), (-1, -1), colors.white),
        ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
        ('FONTNAME', (0, 0), (-1, -1), 'Helvetica-Bold'),
        ('FONTSIZE', (0, 0), (-1, -1), 16),
        ('TOPPADDING', (0, 0), (-1, -1), 12),
        ('BOTTOMPADDING', (0, 0), (-1, -1), 12),
    ]))
    story.append(result_table)
    story.append(Spacer(1, 0.3*inch))
    
    # Test Information
    story.append(Paragraph("Test Information", section_style))
    
    duration_hours = (ended_at - started_at).total_seconds() / 3600 if ended_at and started_at else 0
    
    info_data = [
        ["Test ID:", test_id or "N/A"],
        ["System Name:", system_name or "N/A"],
        ["Organization:", organization or "N/A"],
        ["Start Time:", started_at.strftime("%Y-%m-%d %H:%M:%S UTC") if started_at else "N/A"],
        ["End Time:", ended_at.strftime("%Y-%m-%d %H:%M:%S UTC") if ended_at else "N/A"],
        ["Duration:", f"{duration_hours:.1f} hours"],
    ]
    
    info_table = Table(info_data, colWidths=[1.5*inch, 4.5*inch])
    info_table.setStyle(TableStyle([
        ('FONTNAME', (0, 0), (0, -1), 'Helvetica-Bold'),
        ('FONTSIZE', (0, 0), (-1, -1), 10),
        ('BOTTOMPADDING', (0, 0), (-1, -1), 6),
        ('VALIGN', (0, 0), (-1, -1), 'TOP'),
    ]))
    story.append(info_table)
    
    # Metrics
    story.append(Paragraph("Test Metrics", section_style))
    
    metrics_data = [
        ["Metric", "Value", "Requirement", "Status"],
        ["Total Actions", str(total_actions), ">= 100", "PASS" if total_actions >= 100 else "FAIL"],
        ["Actions Passed", str(pass_count), "-", "-"],
        ["Actions Blocked", str(block_count), "> 0", "PASS" if block_count > 0 else "PENDING"],
        ["Pass Rate", f"{pass_rate:.1f}%", ">= 95%", "PASS" if pass_rate >= 95 else "FAIL"],
        ["Test Duration", f"{duration_hours:.1f}h", ">= 72h", "PASS" if duration_hours >= 72 else "PENDING"],
    ]
    
    metrics_table = Table(metrics_data, colWidths=[2*inch, 1.5*inch, 1.5*inch, 1*inch])
    metrics_table.setStyle(TableStyle([
        ('BACKGROUND', (0, 0), (-1, 0), PURPLE),
        ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
        ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
        ('FONTSIZE', (0, 0), (-1, -1), 9),
        ('ALIGN', (1, 0), (-1, -1), 'CENTER'),
        ('GRID', (0, 0), (-1, -1), 0.5, colors.gray),
        ('TOPPADDING', (0, 0), (-1, -1), 6),
        ('BOTTOMPADDING', (0, 0), (-1, -1), 6),
    ]))
    story.append(metrics_table)
    
    # Violations
    if violations:
        story.append(Paragraph(f"Boundary Violations ({len(violations)} blocked)", section_style))
        
        violation_data = [["Time", "Boundary", "Details"]]
        for v in violations[:20]:
            violation_data.append([
                str(v.get('timestamp', 'N/A'))[:19] if v.get('timestamp') else 'N/A',
                str(v.get('boundary_name', 'Unknown')),
                str(v.get('violation_message', ''))[:50]
            ])
        
        v_table = Table(violation_data, colWidths=[1.5*inch, 1.5*inch, 3*inch])
        v_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.Color(214/255, 92/255, 92/255)),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 8),
            ('GRID', (0, 0), (-1, -1), 0.5, colors.gray),
            ('TOPPADDING', (0, 0), (-1, -1), 4),
            ('BOTTOMPADDING', (0, 0), (-1, -1), 4),
        ]))
        story.append(v_table)
    
    # Footer
    story.append(Spacer(1, 0.5*inch))
    story.append(Paragraph(
        f"Report generated: {datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S UTC')}",
        ParagraphStyle('Footer', fontSize=8, textColor=colors.gray, alignment=TA_CENTER)
    ))
    story.append(Paragraph(
        "Sentinel Authority - sentinelauthority.org",
        ParagraphStyle('Footer2', fontSize=8, textColor=PURPLE, alignment=TA_CENTER)
    ))
    
    doc.build(story)
    return buffer.getvalue()
</file>

<file path="backend/app/services/certificate_generator.py">
"""
Certificate PDF Generator
Creates professional ODDC certificates with QR codes
"""

import io
import qrcode
from datetime import datetime, timedelta
from reportlab.lib import colors
from reportlab.lib.pagesizes import letter
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
from reportlab.lib.units import inch
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Image
from reportlab.lib.enums import TA_CENTER, TA_LEFT

PURPLE = colors.Color(91/255, 75/255, 138/255)
PURPLE_LIGHT = colors.Color(157/255, 140/255, 207/255)

def generate_certificate_pdf(
    certificate_number: str,
    system_name: str,
    organization: str,
    odd_description: str,
    issue_date: datetime,
    expiry_date: datetime = None,
    pass_rate: float = 100.0,
    total_actions: int = 0,
) -> bytes:
    """Generate a professional ODDC certificate PDF"""
    
    if expiry_date is None:
        expiry_date = issue_date + timedelta(days=365)
    
    buffer = io.BytesIO()
    doc = SimpleDocTemplate(buffer, pagesize=letter, topMargin=0.5*inch, bottomMargin=0.5*inch)
    
    styles = getSampleStyleSheet()
    
    # Custom styles
    title_style = ParagraphStyle(
        'Title',
        parent=styles['Heading1'],
        fontSize=28,
        textColor=PURPLE,
        alignment=TA_CENTER,
        spaceAfter=6
    )
    
    subtitle_style = ParagraphStyle(
        'Subtitle',
        parent=styles['Normal'],
        fontSize=12,
        textColor=colors.gray,
        alignment=TA_CENTER,
        spaceAfter=30
    )
    
    cert_number_style = ParagraphStyle(
        'CertNumber',
        parent=styles['Normal'],
        fontSize=14,
        textColor=PURPLE,
        alignment=TA_CENTER,
        fontName='Helvetica-Bold',
        spaceAfter=20
    )
    
    body_style = ParagraphStyle(
        'Body',
        parent=styles['Normal'],
        fontSize=11,
        alignment=TA_CENTER,
        spaceAfter=12
    )
    
    label_style = ParagraphStyle(
        'Label',
        parent=styles['Normal'],
        fontSize=9,
        textColor=colors.gray,
        alignment=TA_LEFT
    )
    
    value_style = ParagraphStyle(
        'Value',
        parent=styles['Normal'],
        fontSize=11,
        alignment=TA_LEFT,
        fontName='Helvetica-Bold'
    )
    
    story = []
    
    # Header
    story.append(Spacer(1, 0.3*inch))
    story.append(Paragraph("SENTINEL AUTHORITY", title_style))
    story.append(Paragraph("Operational Design Domain Conformance Certificate", subtitle_style))
    
    # Certificate number
    story.append(Paragraph(f"Certificate No. {certificate_number}", cert_number_style))
    
    # Main certification statement
    story.append(Paragraph(
        "This certifies that the autonomous system identified below has successfully completed "
        "CAT-72 conformance testing and demonstrated continuous compliance with its declared "
        "Operational Design Domain boundaries through ENVELO runtime enforcement.",
        body_style
    ))
    story.append(Spacer(1, 0.3*inch))
    
    # Certificate details table
    details = [
        ["CERTIFIED SYSTEM", system_name],
        ["ORGANIZATION", organization],
        ["ODD DESCRIPTION", odd_description[:100] + "..." if len(odd_description) > 100 else odd_description],
        ["ISSUE DATE", issue_date.strftime("%B %d, %Y")],
        ["EXPIRATION DATE", expiry_date.strftime("%B %d, %Y")],
        ["CAT-72 PASS RATE", f"{pass_rate:.1f}%"],
        ["TOTAL ACTIONS EVALUATED", f"{total_actions:,}"],
    ]
    
    detail_table = Table(details, colWidths=[2*inch, 4*inch])
    detail_table.setStyle(TableStyle([
        ('FONTNAME', (0, 0), (0, -1), 'Helvetica'),
        ('FONTNAME', (1, 0), (1, -1), 'Helvetica-Bold'),
        ('FONTSIZE', (0, 0), (-1, -1), 10),
        ('TEXTCOLOR', (0, 0), (0, -1), colors.gray),
        ('ALIGN', (0, 0), (0, -1), 'RIGHT'),
        ('ALIGN', (1, 0), (1, -1), 'LEFT'),
        ('BOTTOMPADDING', (0, 0), (-1, -1), 8),
        ('TOPPADDING', (0, 0), (-1, -1), 8),
    ]))
    story.append(detail_table)
    story.append(Spacer(1, 0.4*inch))
    
    # QR Code for verification
    qr = qrcode.QRCode(version=1, box_size=10, border=2)
    qr.add_data(f"https://sentinelauthority.org/verify?cert={certificate_number}")
    qr.make(fit=True)
    qr_img = qr.make_image(fill_color="#5B4B8A", back_color="white")
    
    qr_buffer = io.BytesIO()
    qr_img.save(qr_buffer, format='PNG')
    qr_buffer.seek(0)
    
    qr_image = Image(qr_buffer, width=1.2*inch, height=1.2*inch)
    
    # Footer with QR and signature
    footer_data = [
        [qr_image, Paragraph(
            "<b>Verification</b><br/>"
            f"Scan QR code or visit:<br/>"
            f"sentinelauthority.org/verify<br/><br/>"
            f"<font size=8 color=gray>This certificate remains valid while the certified system "
            f"maintains active ENVELO enforcement and continuous telemetry reporting.</font>",
            ParagraphStyle('Footer', fontSize=9, leading=12)
        )]
    ]
    
    footer_table = Table(footer_data, colWidths=[1.5*inch, 4.5*inch])
    footer_table.setStyle(TableStyle([
        ('VALIGN', (0, 0), (-1, -1), 'TOP'),
        ('LEFTPADDING', (1, 0), (1, 0), 20),
    ]))
    story.append(footer_table)
    
    story.append(Spacer(1, 0.5*inch))
    
    # Signature line
    sig_style = ParagraphStyle('Sig', fontSize=10, alignment=TA_CENTER)
    story.append(Paragraph("_" * 40, sig_style))
    story.append(Paragraph("Sentinel Authority Certification Board", sig_style))
    
    doc.build(story)
    return buffer.getvalue()
</file>

<file path="backend/add_columns_simple.py">
import psycopg2

conn = psycopg2.connect(
    host="ep-late-shape-ah6v1szf-pooler.c-3.us-east-1.aws.neon.tech",
    database="neondb",
    user="neondb_owner",
    password="npg_2Jmst3rvlnxI",
    sslmode="require"
)

cur = conn.cursor()
cur.execute("ALTER TABLE certificates ADD COLUMN IF NOT EXISTS signature VARCHAR(50)")
cur.execute("ALTER TABLE certificates ADD COLUMN IF NOT EXISTS audit_log_ref VARCHAR(50)")
conn.commit()
cur.close()
conn.close()
print("Columns added successfully")
</file>

<file path="backend/add_columns.py">
# DB migration scripts
</file>

<file path="backend/migrate_certificate_pdf.py">
"""Add pdf_data column to certificates table"""
import asyncio
from sqlalchemy import text
from app.core.database import engine

async def migrate():
    async with engine.begin() as conn:
        await conn.execute(text("""
            ALTER TABLE certificates 
            ADD COLUMN IF NOT EXISTS pdf_data BYTEA
        """))
        print("Added pdf_data column")

if __name__ == "__main__":
    asyncio.run(migrate())
</file>

<file path="backend/requirements.txt">
# Sentinel Authority Platform - Backend Dependencies

# Web Framework
fastapi==0.109.0
uvicorn[standard]==0.27.0
python-multipart==0.0.6

# Database
sqlalchemy[asyncio]==2.0.25
asyncpg==0.29.0
alembic==1.13.1

# Settings & Validation
pydantic==2.5.3
pydantic-settings==2.1.0
python-dotenv==1.0.0

# Authentication
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
bcrypt==4.0.1

# Redis (for real-time telemetry)
redis==5.0.1
aioredis==2.0.1

# PDF Generation
reportlab==4.0.9
PyPDF2==3.0.1

# Utilities
httpx==0.26.0
python-dateutil==2.8.2

# Testing
pytest==7.4.4
pytest-asyncio==0.23.3
httpx==0.26.0
email-validator==2.1.0
resend
qrcode[pil]
</file>

<file path="frontend/.gitignore">
.vercel
.env*.local
</file>

<file path="frontend/fix_app_logo.py">
import re

with open('src/App.jsx', 'r') as f:
    content = f.read()

# 1. Fix BrandMark component to match website exactly (with animation)
old_brandmark = '''// Brand Mark Component - matches website exactly
function BrandMark({ size = 24 }) {
  return (
    <div 
      className="flex items-center justify-center flex-shrink-0"
      style={{
        width: size,
        height: size,
        background: '#5B4B8A',
        border: '2px solid #9d8ccf',
        borderRadius: 6,
      }}
    >
      <div 
        className="rounded-full animate-pulse"
        style={{
          width: size * 0.33,
          height: size * 0.33,
          background: '#c4b8e8',
          boxShadow: '0 0 10px rgba(157,140,207,0.5)',
        }}
      />
    </div>
  );
}'''

new_brandmark = '''// Brand Mark Component - matches website exactly
function BrandMark({ size = 24 }) {
  return (
    <div 
      className="flex items-center justify-center flex-shrink-0"
      style={{
        width: size,
        height: size,
        background: '#5B4B8A',
        border: '2px solid #9d8ccf',
        borderRadius: 6,
      }}
    >
      <div 
        className="rounded-full"
        style={{
          width: size * 0.33,
          height: size * 0.33,
          background: '#c4b8e8',
          animation: 'eyePulse 7s ease-in-out infinite',
        }}
      />
      <style>{`
        @keyframes eyePulse {
          0%, 100% { opacity: 0.75; transform: scale(0.98); box-shadow: 0 0 0 rgba(196,184,232,0); }
          50% { opacity: 1; transform: scale(1.02); box-shadow: 0 0 10px rgba(157,140,207,0.22); }
        }
      `}</style>
    </div>
  );
}'''

content = content.replace(old_brandmark, new_brandmark)

# 2. Fix sidebar logo text to match website (IBM Plex Mono, 10px, uppercase, letter-spacing)
old_sidebar_logo = '''<Link to="/dashboard" className="flex items-center gap-3 no-underline">
            <BrandMark size={24} />
            <span style={{fontFamily: "'Inter', sans-serif", fontWeight: 400, color: styles.textPrimary}}>Sentinel Authority</span>
          </Link>'''

new_sidebar_logo = '''<Link to="/dashboard" className="flex items-center gap-3 no-underline">
            <BrandMark size={24} />
            <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', fontWeight: 500, letterSpacing: '3px', textTransform: 'uppercase', color: styles.textPrimary}}>Sentinel Authority</span>
          </Link>'''

content = content.replace(old_sidebar_logo, new_sidebar_logo)

with open('src/App.jsx', 'w') as f:
    f.write(content)

print("✓ Fixed App.jsx - BrandMark and sidebar logo now match website")
print("\nDeploy the frontend to see changes.")
</file>

<file path="frontend/vercel.json">
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    { "source": "/(.*)", "destination": "/" }
  ]
}
</file>

<file path="website/downloads/envelo-agent/envelo/__init__.py">
"""
ENVELO Agent - Enforcer for Non-Violable Execution & Limit Oversight
Provided by Sentinel Authority for ODDC Conformance
"""

__version__ = "1.0.0"
__author__ = "Sentinel Authority"

from .agent import EnveloAgent, EnveloConfig
from .boundaries import Boundary, NumericBoundary, GeoBoundary, RateLimitBoundary, StateBoundary, CustomBoundary
from .actions import Action, ActionResult
from .exceptions import BoundaryViolation, EnveloError

__all__ = [
    "EnveloAgent", "EnveloConfig",
    "Boundary", "NumericBoundary", "GeoBoundary", "RateLimitBoundary", "StateBoundary", "CustomBoundary",
    "Action", "ActionResult",
    "BoundaryViolation", "EnveloError",
]
</file>

<file path="website/downloads/envelo-agent/envelo/actions.py">
"""ENVELO Actions"""
from dataclasses import dataclass, field
from typing import Any, Dict, List

@dataclass
class Action:
    action_type: str
    parameters: Dict[str, Any]
    source: str = "unknown"
    priority: int = 0
    metadata: Dict[str, Any] = field(default_factory=dict)

@dataclass
class ActionResult:
    allowed: bool
    action_id: str
    evaluations: List[Dict[str, Any]]
    violations: List[str]
    timestamp: str
    
    def __bool__(self): return self.allowed
    
    def raise_if_blocked(self):
        if not self.allowed:
            from .exceptions import BoundaryViolation
            raise BoundaryViolation(f"Blocked: {', '.join(self.violations)}")
</file>

<file path="website/downloads/envelo-agent/envelo/boundaries.py">
"""ENVELO Boundaries - Constraint definitions"""

from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import Any, Dict, List, Optional, Tuple
import time

@dataclass
class BoundaryResult:
    passed: bool
    actual_value: Any
    limit_value: Any
    message: str

class Boundary(ABC):
    def __init__(self, name: str, description: str = ""):
        self.name = name
        self.description = description
        self.boundary_type = self.__class__.__name__
    
    @abstractmethod
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult: pass
    
    def to_dict(self) -> dict:
        return {"name": self.name, "type": self.boundary_type, "description": self.description}

class NumericBoundary(Boundary):
    def __init__(self, name: str, parameter: Optional[str] = None, min: Optional[float] = None, 
                 max: Optional[float] = None, unit: str = "", description: str = ""):
        super().__init__(name, description)
        self.parameter = parameter or name
        self.min, self.max, self.unit = min, max, unit
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        value = parameters.get(self.parameter)
        if value is None:
            return BoundaryResult(True, None, f"[{self.min}, {self.max}]", "Parameter not present")
        try:
            value = float(value)
        except:
            return BoundaryResult(False, value, f"[{self.min}, {self.max}]", f"Invalid numeric: {value}")
        if self.min is not None and value < self.min:
            return BoundaryResult(False, value, self.min, f"{self.parameter}={value}{self.unit} below min {self.min}{self.unit}")
        if self.max is not None and value > self.max:
            return BoundaryResult(False, value, self.max, f"{self.parameter}={value}{self.unit} above max {self.max}{self.unit}")
        return BoundaryResult(True, value, f"[{self.min}, {self.max}]", f"{self.parameter}={value}{self.unit} OK")
    
    def to_dict(self):
        d = super().to_dict()
        d.update({"parameter": self.parameter, "min": self.min, "max": self.max, "unit": self.unit})
        return d

class GeoBoundary(Boundary):
    def __init__(self, name: str, lat_param: str = "latitude", lon_param: str = "longitude",
                 allowed_zones: Optional[List[dict]] = None, forbidden_zones: Optional[List[dict]] = None, description: str = ""):
        super().__init__(name, description)
        self.lat_param, self.lon_param = lat_param, lon_param
        self.allowed_zones = allowed_zones or []
        self.forbidden_zones = forbidden_zones or []
    
    def _in_circle(self, lat, lon, center, radius_m):
        import math
        lat1, lon1, lat2, lon2 = map(math.radians, [lat, lon, center[0], center[1]])
        a = math.sin((lat2-lat1)/2)**2 + math.cos(lat1)*math.cos(lat2)*math.sin((lon2-lon1)/2)**2
        return 6371000 * 2 * math.asin(math.sqrt(a)) <= radius_m
    
    def _in_polygon(self, lat, lon, points):
        n, inside, j = len(points), False, len(points)-1
        for i in range(n):
            if ((points[i][0] > lat) != (points[j][0] > lat) and
                lon < (points[j][1]-points[i][1])*(lat-points[i][0])/(points[j][0]-points[i][0]) + points[i][1]):
                inside = not inside
            j = i
        return inside
    
    def _in_zone(self, lat, lon, zone):
        if zone["type"] == "circle": return self._in_circle(lat, lon, zone["center"], zone["radius_m"])
        if zone["type"] == "polygon": return self._in_polygon(lat, lon, zone["points"])
        return False
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        lat, lon = parameters.get(self.lat_param), parameters.get(self.lon_param)
        if lat is None or lon is None:
            return BoundaryResult(True, None, "geo zones", "Position not present")
        try:
            lat, lon = float(lat), float(lon)
        except:
            return BoundaryResult(False, (lat, lon), "valid coords", f"Invalid: ({lat}, {lon})")
        for zone in self.forbidden_zones:
            if self._in_zone(lat, lon, zone):
                return BoundaryResult(False, (lat, lon), f"outside {zone.get('name', 'forbidden')}", f"In forbidden zone")
        if self.allowed_zones and not any(self._in_zone(lat, lon, z) for z in self.allowed_zones):
            return BoundaryResult(False, (lat, lon), "within allowed", f"Outside allowed zones")
        return BoundaryResult(True, (lat, lon), "geo zones", f"Position OK")

class RateLimitBoundary(Boundary):
    def __init__(self, name: str, action_type: Optional[str] = None, max_per_second: Optional[float] = None,
                 max_per_minute: Optional[float] = None, max_per_hour: Optional[float] = None, description: str = ""):
        super().__init__(name, description)
        self.action_type = action_type
        self.max_per_second, self.max_per_minute, self.max_per_hour = max_per_second, max_per_minute, max_per_hour
        self._timestamps: List[float] = []
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        if self.action_type and parameters.get("_action_type") != self.action_type:
            return BoundaryResult(True, 0, "N/A", "Action type mismatch")
        now = time.time()
        if self.max_per_second:
            self._timestamps = [t for t in self._timestamps if t > now - 1]
            if len(self._timestamps) >= self.max_per_second:
                return BoundaryResult(False, len(self._timestamps), self.max_per_second, f"Rate exceeded: {len(self._timestamps)}/s")
        if self.max_per_minute:
            self._timestamps = [t for t in self._timestamps if t > now - 60]
            if len(self._timestamps) >= self.max_per_minute:
                return BoundaryResult(False, len(self._timestamps), self.max_per_minute, f"Rate exceeded: {len(self._timestamps)}/min")
        self._timestamps.append(now)
        return BoundaryResult(True, len(self._timestamps), "OK", "Within limits")

class StateBoundary(Boundary):
    def __init__(self, name: str, required_states: Optional[Dict[str, Any]] = None,
                 forbidden_states: Optional[Dict[str, Any]] = None, description: str = ""):
        super().__init__(name, description)
        self.required_states = required_states or {}
        self.forbidden_states = forbidden_states or {}
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        violations = []
        for k, v in self.required_states.items():
            if parameters.get(k) != v: violations.append(f"{k} must be {v}")
        for k, v in self.forbidden_states.items():
            if parameters.get(k) == v: violations.append(f"{k} must not be {v}")
        if violations:
            return BoundaryResult(False, parameters, self.required_states, "; ".join(violations))
        return BoundaryResult(True, parameters, "OK", "All states OK")

class CustomBoundary(Boundary):
    def __init__(self, name: str, evaluator: callable, description: str = ""):
        super().__init__(name, description)
        self.evaluator = evaluator
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        try:
            result = self.evaluator(parameters)
            if isinstance(result, bool): return BoundaryResult(result, parameters, "custom", "OK" if result else "Failed")
            if isinstance(result, tuple): return BoundaryResult(result[0], parameters, "custom", result[1])
            return BoundaryResult(bool(result), parameters, "custom", str(result))
        except Exception as e:
            return BoundaryResult(False, parameters, "custom", f"Error: {e}")
</file>

<file path="website/downloads/envelo-agent/envelo/exceptions.py">
"""ENVELO Exceptions"""

class EnveloError(Exception):
    """Base exception for ENVELO errors"""
    pass

class BoundaryViolation(EnveloError):
    """Raised when an action violates a boundary"""
    pass

class ConfigurationError(EnveloError):
    """Raised when agent is misconfigured"""
    pass
</file>

<file path="website/downloads/envelo-agent/requirements.txt">
httpx>=0.24.0
</file>

<file path="website/downloads/envelo-agent/setup.py">
from setuptools import setup, find_packages

setup(
    name="envelo-agent",
    version="1.0.0",
    author="Sentinel Authority",
    author_email="conformance@sentinelauthority.org",
    description="ENVELO Agent - Runtime enforcement for autonomous systems",
    url="https://sentinelauthority.org",
    packages=find_packages(),
    python_requires=">=3.9",
    install_requires=["httpx>=0.24.0"],
)
</file>

<file path="website/downloads/envelo-docker/envelo/__init__.py">
"""
ENVELO Agent - Enforcer for Non-Violable Execution & Limit Oversight
Provided by Sentinel Authority for ODDC Conformance
"""

__version__ = "1.0.0"
__author__ = "Sentinel Authority"

from .agent import EnveloAgent, EnveloConfig
from .boundaries import Boundary, NumericBoundary, GeoBoundary, RateLimitBoundary, StateBoundary, CustomBoundary
from .actions import Action, ActionResult
from .exceptions import BoundaryViolation, EnveloError

__all__ = [
    "EnveloAgent", "EnveloConfig",
    "Boundary", "NumericBoundary", "GeoBoundary", "RateLimitBoundary", "StateBoundary", "CustomBoundary",
    "Action", "ActionResult",
    "BoundaryViolation", "EnveloError",
]
</file>

<file path="website/downloads/envelo-docker/envelo/actions.py">
"""ENVELO Actions"""
from dataclasses import dataclass, field
from typing import Any, Dict, List

@dataclass
class Action:
    action_type: str
    parameters: Dict[str, Any]
    source: str = "unknown"
    priority: int = 0
    metadata: Dict[str, Any] = field(default_factory=dict)

@dataclass
class ActionResult:
    allowed: bool
    action_id: str
    evaluations: List[Dict[str, Any]]
    violations: List[str]
    timestamp: str
    
    def __bool__(self): return self.allowed
    
    def raise_if_blocked(self):
        if not self.allowed:
            from .exceptions import BoundaryViolation
            raise BoundaryViolation(f"Blocked: {', '.join(self.violations)}")
</file>

<file path="website/downloads/envelo-docker/envelo/agent.py">
"""ENVELO Agent - Core enforcement engine"""

import hashlib, json, time, threading, queue
from datetime import datetime, timezone
from typing import Any, Callable, Dict, List, Optional
from dataclasses import dataclass, field
import httpx

from .boundaries import Boundary
from .actions import ActionResult
from .exceptions import BoundaryViolation, EnveloError

@dataclass
class EnveloConfig:
    certificate_id: str
    api_key: str
    api_endpoint: str = "https://api.sentinelauthority.org"
    telemetry_interval: float = 1.0
    fail_closed: bool = True
    safe_state_callback: Optional[Callable] = None
    log_local: bool = True
    local_log_path: str = "./envelo_logs"

@dataclass 
class TelemetryRecord:
    timestamp: str
    action_id: str
    action_type: str
    parameters: Dict[str, Any]
    boundary_evaluations: List[Dict[str, Any]]
    result: str
    execution_time_ms: float
    system_state: Dict[str, Any] = field(default_factory=dict)

class EnveloAgent:
    def __init__(self, config: EnveloConfig):
        self.config = config
        self.boundaries: List[Boundary] = []
        self.telemetry_queue: queue.Queue = queue.Queue()
        self._running = False
        self._telemetry_thread: Optional[threading.Thread] = None
        self._action_counter = 0
        self._session_id = self._generate_session_id()
        self._start_time = datetime.now(timezone.utc)
        self._violation_count = 0
        self._pass_count = 0
        self._block_count = 0
        self._system_state: Dict[str, Any] = {}
        self._state_lock = threading.Lock()
        self._start_telemetry_stream()
        self._register_session()
    
    def _generate_session_id(self) -> str:
        data = f"{self.config.certificate_id}:{time.time()}:{id(self)}"
        return hashlib.sha256(data.encode()).hexdigest()[:16]
    
    def _register_session(self):
        try:
            with httpx.Client(timeout=10) as client:
                client.post(f"{self.config.api_endpoint}/api/envelo/sessions",
                    headers={"Authorization": f"Bearer {self.config.api_key}"},
                    json={"certificate_id": self.config.certificate_id, "session_id": self._session_id,
                          "started_at": self._start_time.isoformat(), "agent_version": "1.0.0",
                          "boundaries": [b.to_dict() for b in self.boundaries]})
        except Exception as e:
            print(f"[ENVELO] Warning: Could not connect to Sentinel Authority: {e}")
            if self.config.fail_closed:
                raise EnveloError("Cannot start: Unable to connect to Sentinel Authority")
    
    def _start_telemetry_stream(self):
        self._running = True
        self._telemetry_thread = threading.Thread(target=self._telemetry_worker, daemon=True)
        self._telemetry_thread.start()
    
    def _telemetry_worker(self):
        batch, last_send = [], time.time()
        while self._running:
            try:
                try:
                    batch.append(self.telemetry_queue.get(timeout=0.1))
                except queue.Empty:
                    pass
                if (time.time() - last_send >= self.config.telemetry_interval and batch) or len(batch) >= 100:
                    self._send_telemetry_batch(batch)
                    batch, last_send = [], time.time()
            except Exception as e:
                print(f"[ENVELO] Telemetry error: {e}")
    
    def _send_telemetry_batch(self, batch):
        if not batch: return
        try:
            with httpx.Client(timeout=10) as client:
                client.post(f"{self.config.api_endpoint}/api/envelo/telemetry",
                    headers={"Authorization": f"Bearer {self.config.api_key}"},
                    json={"certificate_id": self.config.certificate_id, "session_id": self._session_id,
                          "records": [self._record_to_dict(r) for r in batch],
                          "stats": {"pass_count": self._pass_count, "block_count": self._block_count}})
        except Exception as e:
            print(f"[ENVELO] Could not send telemetry: {e}")
            if self.config.log_local: self._log_locally(batch)
    
    def _record_to_dict(self, r): 
        return {"timestamp": r.timestamp, "action_id": r.action_id, "action_type": r.action_type,
                "parameters": r.parameters, "boundary_evaluations": r.boundary_evaluations,
                "result": r.result, "execution_time_ms": r.execution_time_ms, "system_state": r.system_state}
    
    def _log_locally(self, batch):
        import os
        os.makedirs(self.config.local_log_path, exist_ok=True)
        with open(f"{self.config.local_log_path}/envelo_{datetime.now().strftime('%Y%m%d')}.jsonl", "a") as f:
            for r in batch: f.write(json.dumps(self._record_to_dict(r)) + "\n")
    
    def add_boundary(self, boundary: Boundary):
        self.boundaries.append(boundary)
        print(f"[ENVELO] Boundary added: {boundary.name}")
    
    def update_state(self, state: Dict[str, Any]):
        with self._state_lock: self._system_state.update(state)
    
    def evaluate(self, parameters: Dict[str, Any]) -> ActionResult:
        start_time = time.time()
        self._action_counter += 1
        action_id = f"{self._session_id}-{self._action_counter:08d}"
        evaluations, all_passed, violation_details = [], True, []
        
        for boundary in self.boundaries:
            try:
                result = boundary.evaluate(parameters)
                evaluations.append({"boundary": boundary.name, "type": boundary.boundary_type,
                                   "passed": result.passed, "value": result.actual_value,
                                   "limit": result.limit_value, "message": result.message})
                if not result.passed:
                    all_passed = False
                    violation_details.append(f"{boundary.name}: {result.message}")
            except Exception as e:
                evaluations.append({"boundary": boundary.name, "passed": False, "error": str(e)})
                all_passed = False
                violation_details.append(f"{boundary.name}: Error - {e}")
        
        if all_passed:
            self._pass_count += 1
        else:
            self._block_count += 1
            self._violation_count += 1
            if self.config.safe_state_callback:
                try: self.config.safe_state_callback(parameters, violation_details)
                except: pass
        
        with self._state_lock: current_state = self._system_state.copy()
        record = TelemetryRecord(datetime.now(timezone.utc).isoformat(), action_id,
                                parameters.get("_action_type", "unknown"), parameters, evaluations,
                                "PASS" if all_passed else "BLOCK", (time.time() - start_time) * 1000, current_state)
        self.telemetry_queue.put(record)
        
        return ActionResult(all_passed, action_id, evaluations, violation_details, record.timestamp)
    
    def enforce(self, func: Callable) -> Callable:
        def wrapper(*args, **kwargs):
            kwargs["_action_type"] = func.__name__
            result = self.evaluate(kwargs)
            if not result.allowed:
                raise BoundaryViolation(f"Action blocked: {', '.join(result.violations)}")
            return func(*args, **kwargs)
        wrapper.__name__ = func.__name__
        return wrapper
    
    def shutdown(self):
        print("[ENVELO] Shutting down...")
        self._running = False
        if self._telemetry_thread: self._telemetry_thread.join(timeout=5)
        remaining = []
        while not self.telemetry_queue.empty():
            try: remaining.append(self.telemetry_queue.get_nowait())
            except: break
        if remaining: self._send_telemetry_batch(remaining)
        try:
            with httpx.Client(timeout=10) as client:
                client.post(f"{self.config.api_endpoint}/api/envelo/sessions/{self._session_id}/end",
                    headers={"Authorization": f"Bearer {self.config.api_key}"},
                    json={"ended_at": datetime.now(timezone.utc).isoformat(),
                          "final_stats": {"pass_count": self._pass_count, "block_count": self._block_count}})
        except: pass
        print("[ENVELO] Shutdown complete")
    
    def __enter__(self): return self
    def __exit__(self, *args): self.shutdown(); return False
</file>

<file path="website/downloads/envelo-docker/envelo/boundaries.py">
"""ENVELO Boundaries - Constraint definitions"""

from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import Any, Dict, List, Optional, Tuple
import time

@dataclass
class BoundaryResult:
    passed: bool
    actual_value: Any
    limit_value: Any
    message: str

class Boundary(ABC):
    def __init__(self, name: str, description: str = ""):
        self.name = name
        self.description = description
        self.boundary_type = self.__class__.__name__
    
    @abstractmethod
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult: pass
    
    def to_dict(self) -> dict:
        return {"name": self.name, "type": self.boundary_type, "description": self.description}

class NumericBoundary(Boundary):
    def __init__(self, name: str, parameter: Optional[str] = None, min: Optional[float] = None, 
                 max: Optional[float] = None, unit: str = "", description: str = ""):
        super().__init__(name, description)
        self.parameter = parameter or name
        self.min, self.max, self.unit = min, max, unit
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        value = parameters.get(self.parameter)
        if value is None:
            return BoundaryResult(True, None, f"[{self.min}, {self.max}]", "Parameter not present")
        try:
            value = float(value)
        except:
            return BoundaryResult(False, value, f"[{self.min}, {self.max}]", f"Invalid numeric: {value}")
        if self.min is not None and value < self.min:
            return BoundaryResult(False, value, self.min, f"{self.parameter}={value}{self.unit} below min {self.min}{self.unit}")
        if self.max is not None and value > self.max:
            return BoundaryResult(False, value, self.max, f"{self.parameter}={value}{self.unit} above max {self.max}{self.unit}")
        return BoundaryResult(True, value, f"[{self.min}, {self.max}]", f"{self.parameter}={value}{self.unit} OK")
    
    def to_dict(self):
        d = super().to_dict()
        d.update({"parameter": self.parameter, "min": self.min, "max": self.max, "unit": self.unit})
        return d

class GeoBoundary(Boundary):
    def __init__(self, name: str, lat_param: str = "latitude", lon_param: str = "longitude",
                 allowed_zones: Optional[List[dict]] = None, forbidden_zones: Optional[List[dict]] = None, description: str = ""):
        super().__init__(name, description)
        self.lat_param, self.lon_param = lat_param, lon_param
        self.allowed_zones = allowed_zones or []
        self.forbidden_zones = forbidden_zones or []
    
    def _in_circle(self, lat, lon, center, radius_m):
        import math
        lat1, lon1, lat2, lon2 = map(math.radians, [lat, lon, center[0], center[1]])
        a = math.sin((lat2-lat1)/2)**2 + math.cos(lat1)*math.cos(lat2)*math.sin((lon2-lon1)/2)**2
        return 6371000 * 2 * math.asin(math.sqrt(a)) <= radius_m
    
    def _in_polygon(self, lat, lon, points):
        n, inside, j = len(points), False, len(points)-1
        for i in range(n):
            if ((points[i][0] > lat) != (points[j][0] > lat) and
                lon < (points[j][1]-points[i][1])*(lat-points[i][0])/(points[j][0]-points[i][0]) + points[i][1]):
                inside = not inside
            j = i
        return inside
    
    def _in_zone(self, lat, lon, zone):
        if zone["type"] == "circle": return self._in_circle(lat, lon, zone["center"], zone["radius_m"])
        if zone["type"] == "polygon": return self._in_polygon(lat, lon, zone["points"])
        return False
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        lat, lon = parameters.get(self.lat_param), parameters.get(self.lon_param)
        if lat is None or lon is None:
            return BoundaryResult(True, None, "geo zones", "Position not present")
        try:
            lat, lon = float(lat), float(lon)
        except:
            return BoundaryResult(False, (lat, lon), "valid coords", f"Invalid: ({lat}, {lon})")
        for zone in self.forbidden_zones:
            if self._in_zone(lat, lon, zone):
                return BoundaryResult(False, (lat, lon), f"outside {zone.get('name', 'forbidden')}", f"In forbidden zone")
        if self.allowed_zones and not any(self._in_zone(lat, lon, z) for z in self.allowed_zones):
            return BoundaryResult(False, (lat, lon), "within allowed", f"Outside allowed zones")
        return BoundaryResult(True, (lat, lon), "geo zones", f"Position OK")

class RateLimitBoundary(Boundary):
    def __init__(self, name: str, action_type: Optional[str] = None, max_per_second: Optional[float] = None,
                 max_per_minute: Optional[float] = None, max_per_hour: Optional[float] = None, description: str = ""):
        super().__init__(name, description)
        self.action_type = action_type
        self.max_per_second, self.max_per_minute, self.max_per_hour = max_per_second, max_per_minute, max_per_hour
        self._timestamps: List[float] = []
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        if self.action_type and parameters.get("_action_type") != self.action_type:
            return BoundaryResult(True, 0, "N/A", "Action type mismatch")
        now = time.time()
        if self.max_per_second:
            self._timestamps = [t for t in self._timestamps if t > now - 1]
            if len(self._timestamps) >= self.max_per_second:
                return BoundaryResult(False, len(self._timestamps), self.max_per_second, f"Rate exceeded: {len(self._timestamps)}/s")
        if self.max_per_minute:
            self._timestamps = [t for t in self._timestamps if t > now - 60]
            if len(self._timestamps) >= self.max_per_minute:
                return BoundaryResult(False, len(self._timestamps), self.max_per_minute, f"Rate exceeded: {len(self._timestamps)}/min")
        self._timestamps.append(now)
        return BoundaryResult(True, len(self._timestamps), "OK", "Within limits")

class StateBoundary(Boundary):
    def __init__(self, name: str, required_states: Optional[Dict[str, Any]] = None,
                 forbidden_states: Optional[Dict[str, Any]] = None, description: str = ""):
        super().__init__(name, description)
        self.required_states = required_states or {}
        self.forbidden_states = forbidden_states or {}
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        violations = []
        for k, v in self.required_states.items():
            if parameters.get(k) != v: violations.append(f"{k} must be {v}")
        for k, v in self.forbidden_states.items():
            if parameters.get(k) == v: violations.append(f"{k} must not be {v}")
        if violations:
            return BoundaryResult(False, parameters, self.required_states, "; ".join(violations))
        return BoundaryResult(True, parameters, "OK", "All states OK")

class CustomBoundary(Boundary):
    def __init__(self, name: str, evaluator: callable, description: str = ""):
        super().__init__(name, description)
        self.evaluator = evaluator
    
    def evaluate(self, parameters: Dict[str, Any]) -> BoundaryResult:
        try:
            result = self.evaluator(parameters)
            if isinstance(result, bool): return BoundaryResult(result, parameters, "custom", "OK" if result else "Failed")
            if isinstance(result, tuple): return BoundaryResult(result[0], parameters, "custom", result[1])
            return BoundaryResult(bool(result), parameters, "custom", str(result))
        except Exception as e:
            return BoundaryResult(False, parameters, "custom", f"Error: {e}")
</file>

<file path="website/downloads/envelo-docker/envelo/exceptions.py">
"""ENVELO Exceptions"""

class EnveloError(Exception):
    """Base exception for ENVELO errors"""
    pass

class BoundaryViolation(EnveloError):
    """Raised when an action violates a boundary"""
    pass

class ConfigurationError(EnveloError):
    """Raised when agent is misconfigured"""
    pass
</file>

<file path="website/downloads/envelo-docker/docker-compose.yml">
version: '3.8'

services:
  envelo:
    build: .
    environment:
      - ENVELO_CERTIFICATE_ID=${ENVELO_CERTIFICATE_ID}
      - ENVELO_API_KEY=${ENVELO_API_KEY}
      - ENVELO_API_ENDPOINT=https://api.sentinelauthority.org
    volumes:
      - ./your-app:/app/your-app  # Mount your application here
    restart: unless-stopped
</file>

<file path="website/downloads/envelo-docker/docker-entrypoint.py">
#!/usr/bin/env python3
"""
ENVELO Agent Docker Entrypoint
Sentinel Authority
"""

import os
import sys
import time
import signal

sys.path.insert(0, '/app')

from envelo import EnveloAgent, EnveloConfig

def main():
    cert_id = os.environ.get('ENVELO_CERTIFICATE_ID')
    api_key = os.environ.get('ENVELO_API_KEY')
    endpoint = os.environ.get('ENVELO_API_ENDPOINT', 'https://api.sentinelauthority.org')

    if not cert_id or not api_key:
        print("ERROR: ENVELO_CERTIFICATE_ID and ENVELO_API_KEY environment variables required")
        print("")
        print("Usage:")
        print("  docker run -e ENVELO_CERTIFICATE_ID=ODDC-2026-XXXXX -e ENVELO_API_KEY=your-key sentinelauthority/envelo")
        sys.exit(1)

    print("╔═══════════════════════════════════════════════════════════╗")
    print("║           ENVELO Agent v1.0 - Docker                      ║")
    print("║           Sentinel Authority                              ║")
    print("╚═══════════════════════════════════════════════════════════╝")
    print("")
    print(f"Certificate: {cert_id}")
    print(f"Endpoint:    {endpoint}")
    print("")

    config = EnveloConfig(
        certificate_id=cert_id,
        api_key=api_key,
        api_endpoint=endpoint
    )

    agent = EnveloAgent(config)
    print("✓ Agent initialized and connected")
    print("")
    print("Agent is running. Mount your application and import:")
    print("  from envelo import EnveloAgent, EnveloConfig, NumericBoundary")
    print("")

    # Keep running
    def shutdown(sig, frame):
        print("\nShutting down...")
        agent.shutdown()
        sys.exit(0)

    signal.signal(signal.SIGINT, shutdown)
    signal.signal(signal.SIGTERM, shutdown)

    while True:
        time.sleep(1)

if __name__ == '__main__':
    main()
</file>

<file path="website/downloads/envelo-docker/Dockerfile">
FROM python:3.11-slim

WORKDIR /app

# Install dependencies
RUN pip install --no-cache-dir httpx

# Copy agent
COPY envelo-agent/envelo /app/envelo

# Copy entrypoint
COPY docker-entrypoint.py /app/entrypoint.py

ENV ENVELO_CERTIFICATE_ID=""
ENV ENVELO_API_KEY=""
ENV ENVELO_API_ENDPOINT="https://api.sentinelauthority.org"

ENTRYPOINT ["python", "/app/entrypoint.py"]
</file>

<file path="website/downloads/envelo-docker/README.md">
# ENVELO Agent - Docker

Run the ENVELO Agent as a Docker container.

## Quick Start
```bash
docker run -d \
  -e ENVELO_CERTIFICATE_ID=ODDC-2026-XXXXX \
  -e ENVELO_API_KEY=your-api-key \
  sentinelauthority/envelo
```

## Using Docker Compose

1. Create a `.env` file:
```
ENVELO_CERTIFICATE_ID=ODDC-2026-XXXXX
ENVELO_API_KEY=your-api-key
```

2. Run:
```bash
docker-compose up -d
```

## Building Locally
```bash
docker build -t envelo-agent .
docker run -e ENVELO_CERTIFICATE_ID=... -e ENVELO_API_KEY=... envelo-agent
```

## Integrating with Your Application

Mount your application directory and import the agent:
```bash
docker run -d \
  -e ENVELO_CERTIFICATE_ID=ODDC-2026-XXXXX \
  -e ENVELO_API_KEY=your-api-key \
  -v $(pwd)/my-app:/app/my-app \
  sentinelauthority/envelo
```

Then in your Python code:
```python
from envelo import EnveloAgent, EnveloConfig, NumericBoundary

config = EnveloConfig(
    certificate_id="ODDC-2026-XXXXX",
    api_key="your-api-key"
)
agent = EnveloAgent(config)
```

## Support

- Documentation: https://sentinelauthority.org/agent.html
- Email: conformance@sentinelauthority.org
</file>

<file path="website/.gitignore">
.vercel
</file>

<file path="website/apply.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="refresh" content="0; url=https://app.sentinelauthority.org/applications/new" />
  <title>Apply — Sentinel Authority</title>
</head>
<body>
  <p>Redirecting to application portal...</p>
  <script>window.location.href = "https://app.sentinelauthority.org/applications/new";</script>
</body>
</html>
</file>

<file path="backend/app/api/routes/applications.py">
# Certificate and evaluation endpoints

@router.post("/{app_id}/tests/{test_id}/evaluate")
async def evaluate_cat72_test(
    app_id: int,
    test_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Evaluate a CAT-72 test (admin only)"""
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    from app.services.cat72_evaluator import evaluate_test
    result = await evaluate_test(db, test_id)
    return result


@router.post("/{app_id}/tests/{test_id}/complete")
async def complete_cat72_test(
    app_id: int,
    test_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Complete a CAT-72 test and issue certificate if passed (admin only)"""
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    from app.services.cat72_evaluator import complete_test_and_issue_certificate
    result = await complete_test_and_issue_certificate(db, test_id)
    return result


@router.get("/{app_id}/certificate/download")
async def download_certificate(
    app_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Download certificate PDF"""
    from fastapi.responses import Response
    
    result = await db.execute(
        select(Certificate).where(Certificate.application_id == app_id)
    )
    certificate = result.scalar_one_or_none()
    
    if not certificate:
        raise HTTPException(status_code=404, detail="Certificate not found")
    
    if not certificate.pdf_data:
        raise HTTPException(status_code=404, detail="Certificate PDF not generated")
    
    return Response(
        content=certificate.pdf_data,
        media_type="application/pdf",
        headers={
            "Content-Disposition": f"attachment; filename={certificate.certificate_number}.pdf"
        }
    )

@router.post("/document-download")
async def document_download_lead(request: Request):
    """Capture lead info when someone downloads a document"""
    from app.services.email_service import send_email
    
    data = await request.json()
    email = data.get("email", "Unknown")
    org = data.get("organization", "Not provided")
    role = data.get("role", "Not provided")
    document = data.get("document", "Unknown")
    
    html = f"""
    <h2>Document Download Lead</h2>
    <p><strong>Document:</strong> {document}</p>
    <p><strong>Email:</strong> {email}</p>
    <p><strong>Organization:</strong> {org}</p>
    <p><strong>Role:</strong> {role}</p>
    """
    
    await send_email("info@sentinelauthority.org", f"Document Download: {document}", html)
    
    return {"status": "ok"}
</file>

<file path="backend/app/api/routes/cat72.py">
"""CAT-72 Console routes - Core conformance testing engine."""

import hashlib
import json
from datetime import datetime
from typing import Dict, Any, Optional, List
from fastapi import APIRouter, Depends, HTTPException, WebSocket, WebSocketDisconnect
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from pydantic import BaseModel

from app.core.database import get_db
from app.core.security import get_current_user, require_role
from app.core.config import settings
from app.services.email_service import send_test_setup_instructions
from app.models.models import (
    CAT72Test, Application, Telemetry, InterlockEvent, 
    TestState, CertificationState, UserRole
)

router = APIRouter()


# =============================================================================
# SCHEMAS
# =============================================================================

class TestCreate(BaseModel):
    application_id: int
    duration_hours: int = 72


class TelemetryInput(BaseModel):
    state_vector: Dict[str, float]
    timestamp: Optional[datetime] = None


# =============================================================================
# HELPER FUNCTIONS
# =============================================================================

def compute_hash(data: dict, prev_hash: str = "") -> str:
    """Compute SHA-256 hash for evidence chain."""
    payload = json.dumps(data, sort_keys=True, default=str) + prev_hash
    return hashlib.sha256(payload.encode()).hexdigest()


def check_envelope(state_vector: Dict[str, float], envelope: Dict[str, Any]) -> tuple:
    """Check if state vector is within envelope boundaries."""
    boundaries = envelope.get("boundaries", {})
    min_distance = float("inf")
    in_envelope = True
    violations = []
    
    for var, value in state_vector.items():
        if var in boundaries:
            bounds = boundaries[var]
            min_val = bounds.get("min", float("-inf"))
            max_val = bounds.get("max", float("inf"))
            
            if value < min_val:
                in_envelope = False
                violations.append({"var": var, "value": value, "bound": "min", "threshold": min_val})
                distance = min_val - value
            elif value > max_val:
                in_envelope = False
                violations.append({"var": var, "value": value, "bound": "max", "threshold": max_val})
                distance = value - max_val
            else:
                # Distance to nearest boundary
                distance = min(value - min_val, max_val - value)
            
            min_distance = min(min_distance, distance)
    
    return in_envelope, min_distance if min_distance != float("inf") else 0, violations


def compute_metrics(telemetry_samples: List[Telemetry]) -> Dict[str, float]:
    """Compute convergence, drift, and stability metrics."""
    if not telemetry_samples:
        return {"convergence": 0, "drift": 0, "stability": 0, "margin": 0}
    
    conformant = sum(1 for t in telemetry_samples if t.in_envelope)
    convergence = conformant / len(telemetry_samples) if telemetry_samples else 0
    
    # Drift: rate of envelope distance change
    if len(telemetry_samples) >= 2:
        distances = [t.envelope_distance for t in telemetry_samples[-100:]]  # Last 100 samples
        if len(distances) >= 2:
            drift = abs(distances[-1] - distances[0]) / len(distances)
        else:
            drift = 0
    else:
        drift = 0
    
    # Stability: variance in convergence over recent samples
    recent = telemetry_samples[-100:]
    if recent:
        recent_conformant = [1 if t.in_envelope else 0 for t in recent]
        mean = sum(recent_conformant) / len(recent_conformant)
        variance = sum((x - mean) ** 2 for x in recent_conformant) / len(recent_conformant)
        stability = 1 - min(variance, 1)  # Higher = more stable
    else:
        stability = 0
    
    # Margin: average distance to boundary
    margin = sum(t.envelope_distance for t in telemetry_samples) / len(telemetry_samples) if telemetry_samples else 0
    
    return {"convergence": convergence, "drift": drift, "stability": stability, "margin": margin}


async def generate_test_id(db: AsyncSession) -> str:
    """Generate unique test ID."""
    year = datetime.utcnow().year
    result = await db.execute(
        select(func.count(CAT72Test.id)).where(CAT72Test.test_id.like(f"CAT72-{year}-%"))
    )
    count = (result.scalar() or 0) + 1
    return f"CAT72-{year}-{count:05d}"


# =============================================================================
# ROUTES
# =============================================================================

@router.post("/tests")
async def create_test(
    data: TestCreate,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin", "operator"]))
):
    """Create a new CAT-72 test."""
    # Get application
    result = await db.execute(select(Application).where(Application.id == data.application_id))
    application = result.scalar_one_or_none()
    
    if not application:
        raise HTTPException(status_code=404, detail="Application not found")
    
    if application.state not in [CertificationState.UNDER_REVIEW, CertificationState.OBSERVE]:
        raise HTTPException(status_code=400, detail=f"Application must be in UNDER_REVIEW or OBSERVE state")
    
    test_id = await generate_test_id(db)
    
    test = CAT72Test(
        test_id=test_id,
        application_id=application.id,
        duration_hours=data.duration_hours,
        envelope_definition=application.envelope_definition,
        state=TestState.SCHEDULED,
        operator_id=int(user["sub"]),
        evidence_chain=[],
    )
    
    db.add(test)
    
    # Update application state
    application.state = CertificationState.BOUNDED
    
    await db.commit()
    await db.refresh(test)
    
    return {
        "id": test.id,
        "test_id": test.test_id,
        "state": test.state.value,
        "duration_hours": test.duration_hours,
        "message": "Test created and scheduled"
    }


@router.get("/tests")
async def list_tests(
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    """List all tests."""
    result = await db.execute(select(CAT72Test, Application).join(Application, CAT72Test.application_id == Application.id).order_by(CAT72Test.created_at.desc()))
    rows = result.all()
    
    return [
        {
            "id": t.id,
            "test_id": t.test_id,
            "organization_name": a.organization_name,
            "system_name": a.system_name,
            "application_id": t.application_id,
            "state": t.state.value,
            "duration_hours": t.duration_hours,
            "elapsed_seconds": t.elapsed_seconds,
            "total_samples": t.total_samples,
            "conformant_samples": t.conformant_samples,
            "convergence_score": t.convergence_score,
            "interlock_activations": t.interlock_activations,
            "started_at": t.started_at.isoformat() if t.started_at else None,
            "result": t.result,
        }
        for t in tests
    ]


@router.get("/tests/{test_id}")
async def get_test(
    test_id: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    """Get test details."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    return {
        "id": test.id,
        "test_id": test.test_id,
        "application_id": test.application_id,
        "state": test.state.value,
        "duration_hours": test.duration_hours,
        "elapsed_seconds": test.elapsed_seconds,
        "started_at": test.started_at.isoformat() if test.started_at else None,
        "ended_at": test.ended_at.isoformat() if test.ended_at else None,
        "total_samples": test.total_samples,
        "conformant_samples": test.conformant_samples,
        "interlock_activations": test.interlock_activations,
        "convergence_score": test.convergence_score,
        "drift_rate": test.drift_rate,
        "stability_index": test.stability_index,
        "envelope_margin": test.envelope_margin,
        "evidence_hash": test.evidence_hash,
        "result": test.result,
        "envelope_definition": test.envelope_definition,
    }


@router.post("/tests/{test_id}/start")
async def start_test(
    test_id: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin", "operator"]))
):
    """Start a CAT-72 test."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    if test.state != TestState.SCHEDULED:
        raise HTTPException(status_code=400, detail=f"Test must be SCHEDULED to start, currently {test.state.value}")
    
    test.state = TestState.RUNNING
    test.started_at = datetime.utcnow()
    
    # Initialize evidence chain with genesis block
    genesis = {
        "type": "genesis",
        "test_id": test.test_id,
        "started_at": test.started_at.isoformat(),
        "operator_id": int(user["sub"]),
        "envelope_definition": test.envelope_definition,
    }
    genesis_hash = compute_hash(genesis)
    test.evidence_chain = [{"block": 0, "hash": genesis_hash, "data": genesis}]
    test.evidence_hash = genesis_hash
    
    await db.commit()
    
    return {
        "test_id": test.test_id,
        "state": test.state.value,
        "started_at": test.started_at.isoformat(),
        "genesis_hash": genesis_hash,
        "message": "Test started - 72-hour timer running"
    }


@router.post("/tests/{test_id}/telemetry")
async def ingest_telemetry(
    test_id: str,
    data: TelemetryInput,
    db: AsyncSession = Depends(get_db),
):
    """Ingest telemetry data point."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    if test.state != TestState.RUNNING:
        raise HTTPException(status_code=400, detail="Test is not running")
    
    timestamp = (data.timestamp.replace(tzinfo=None) if data.timestamp else datetime.utcnow())
    elapsed = int((timestamp.replace(tzinfo=None) - test.started_at).total_seconds()) if test.started_at else 0
    
    # Check if test duration exceeded
    max_seconds = test.duration_hours * 3600
    if elapsed >= max_seconds:
        test.state = TestState.COMPLETED
        test.ended_at = timestamp
        await db.commit()
        raise HTTPException(status_code=400, detail="Test duration exceeded")
    
    # Check envelope
    in_envelope, distance, violations = check_envelope(data.state_vector, test.envelope_definition or {})
    
    # Get previous hash
    prev_hash = test.evidence_hash or ""
    
    # Create telemetry record
    sample_data = {
        "timestamp": timestamp.isoformat(),
        "elapsed": elapsed,
        "state_vector": data.state_vector,
        "in_envelope": in_envelope,
        "distance": distance,
    }
    sample_hash = compute_hash(sample_data, prev_hash)
    
    telemetry = Telemetry(
        test_id=test.id,
        timestamp=timestamp,
        elapsed_seconds=elapsed,
        state_vector=data.state_vector,
        in_envelope=in_envelope,
        envelope_distance=distance,
        sample_hash=sample_hash,
        prev_hash=prev_hash,
    )
    db.add(telemetry)
    
    # Update test stats
    test.total_samples = (test.total_samples or 0) + 1
    if in_envelope:
        test.conformant_samples = (test.conformant_samples or 0) + 1
    test.elapsed_seconds = elapsed
    test.evidence_hash = sample_hash
    
    # Handle interlock events (violations)
    interlock_event = None
    if violations:
        test.interlock_activations = (test.interlock_activations or 0) + 1
        
        # Create interlock event
        v = violations[0]  # Primary violation
        event_data = {
            "timestamp": timestamp.isoformat(),
            "trigger": v,
            "action": "constrain",
        }
        event_hash = compute_hash(event_data, sample_hash)
        
        interlock_event = InterlockEvent(
            test_id=test.id,
            timestamp=timestamp,
            elapsed_seconds=elapsed,
            trigger_type="boundary_violation",
            trigger_parameter=v["var"],
            trigger_value=v["value"],
            threshold_value=v["threshold"],
            action_type="constrain",
            state_before=data.state_vector,
            event_hash=event_hash,
        )
        db.add(interlock_event)
    
    # Compute running metrics
    if test.total_samples > 0:
        test.convergence_score = test.conformant_samples / test.total_samples
    
    await db.commit()
    
    return {
        "sample_number": test.total_samples,
        "timestamp": timestamp.isoformat(),
        "elapsed_seconds": elapsed,
        "in_envelope": in_envelope,
        "envelope_distance": distance,
        "sample_hash": sample_hash,
        "convergence_score": test.convergence_score,
        "interlock_triggered": interlock_event is not None,
    }


@router.post("/tests/{test_id}/stop")
async def stop_test(
    test_id: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(require_role(["admin", "operator"]))
):
    """Stop a running test and compute final results."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    if test.state != TestState.RUNNING:
        raise HTTPException(status_code=400, detail="Test is not running")
    
    test.state = TestState.COMPLETED
    test.ended_at = datetime.utcnow()
    
    # Compute final metrics
    telemetry_result = await db.execute(
        select(Telemetry).where(Telemetry.test_id == test.id).order_by(Telemetry.timestamp)
    )
    samples = telemetry_result.scalars().all()
    
    metrics = compute_metrics(samples)
    test.convergence_score = metrics["convergence"]
    test.drift_rate = metrics["drift"]
    test.stability_index = metrics["stability"]
    test.envelope_margin = metrics["margin"]
    
    # Determine result
    if (test.convergence_score >= settings.CAT72_CONVERGENCE_THRESHOLD and
        test.drift_rate <= settings.CAT72_DRIFT_THRESHOLD and
        test.stability_index >= settings.CAT72_STABILITY_THRESHOLD):
        test.result = "PASS"
    else:
        test.result = "FAIL"
    
    # Final evidence block
    final_block = {
        "type": "final",
        "test_id": test.test_id,
        "ended_at": test.ended_at.isoformat(),
        "total_samples": test.total_samples,
        "conformant_samples": test.conformant_samples,
        "convergence_score": test.convergence_score,
        "drift_rate": test.drift_rate,
        "stability_index": test.stability_index,
        "result": test.result,
    }
    final_hash = compute_hash(final_block, test.evidence_hash or "")
    
    chain = test.evidence_chain or []
    chain.append({"block": len(chain), "hash": final_hash, "data": final_block})
    test.evidence_chain = chain
    test.evidence_hash = final_hash
    
    await db.commit()
    
    return {
        "test_id": test.test_id,
        "state": test.state.value,
        "result": test.result,
        "ended_at": test.ended_at.isoformat(),
        "total_samples": test.total_samples,
        "conformant_samples": test.conformant_samples,
        "convergence_score": test.convergence_score,
        "drift_rate": test.drift_rate,
        "stability_index": test.stability_index,
        "envelope_margin": test.envelope_margin,
        "evidence_hash": test.evidence_hash,
    }


@router.get("/tests/{test_id}/metrics")
async def get_test_metrics(
    test_id: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    """Get real-time test metrics."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    max_seconds = test.duration_hours * 3600
    remaining = max(0, max_seconds - (test.elapsed_seconds or 0))
    progress = (test.elapsed_seconds or 0) / max_seconds * 100 if max_seconds > 0 else 0
    
    # Get latest telemetry
    latest_result = await db.execute(
        select(Telemetry).where(Telemetry.test_id == test.id).order_by(Telemetry.timestamp.desc()).limit(1)
    )
    latest = latest_result.scalar_one_or_none()
    
    return {
        "test_id": test.test_id,
        "state": test.state.value,
        "elapsed_seconds": test.elapsed_seconds or 0,
        "remaining_seconds": remaining,
        "progress_percent": round(progress, 2),
        "total_samples": test.total_samples or 0,
        "conformant_samples": test.conformant_samples or 0,
        "conformance_rate": test.convergence_score or 0,
        "interlock_activations": test.interlock_activations or 0,
        "current_convergence": test.convergence_score or 0,
        "current_drift": test.drift_rate or 0,
        "current_stability": test.stability_index or 0,
        "envelope_margin": test.envelope_margin or 0,
        "latest_state_vector": latest.state_vector if latest else None,
        "evidence_hash": test.evidence_hash,
    }


@router.get("/tests/{test_id}/interlock-events")
async def get_interlock_events(
    test_id: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    """Get interlock events for a test."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    events_result = await db.execute(
        select(InterlockEvent).where(InterlockEvent.test_id == test.id).order_by(InterlockEvent.timestamp.desc()).limit(100)
    )
    events = events_result.scalars().all()
    
    return [
        {
            "id": e.id,
            "timestamp": e.timestamp.isoformat(),
            "elapsed_seconds": e.elapsed_seconds,
            "trigger_type": e.trigger_type,
            "trigger_parameter": e.trigger_parameter,
            "trigger_value": e.trigger_value,
            "threshold_value": e.threshold_value,
            "action_type": e.action_type,
            "event_hash": e.event_hash,
        }
        for e in events
    ]


@router.get("/tests/{test_id}/evidence")
async def get_evidence_chain(
    test_id: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    """Get evidence hash chain for a test."""
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    
    if not test:
        raise HTTPException(status_code=404, detail="Test not found")
    
    return {
        "test_id": test.test_id,
        "current_hash": test.evidence_hash,
        "chain": test.evidence_chain or [],
        "total_samples": test.total_samples,
    }
</file>

<file path="backend/app/api/routes/certificates.py">
"""Certificate Registry routes."""
from app.services.email_service import notify_certificate_issued
from datetime import datetime, timedelta
from fastapi import APIRouter, Depends, HTTPException
from fastapi.responses import Response
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from app.core.database import get_db
from app.core.security import get_current_user, require_role
from app.core.config import settings
from app.models.models import Certificate, CAT72Test, Application, CertificationState, TestState
from app.services.certificate_pdf import generate_certificate_pdf

router = APIRouter()

async def generate_certificate_number(db: AsyncSession) -> str:
    year = datetime.utcnow().year
    result = await db.execute(select(func.count(Certificate.id)).where(Certificate.certificate_number.like(f"{settings.CERTIFICATE_PREFIX}-{year}-%")))
    count = (result.scalar() or 0) + 1
    return f"{settings.CERTIFICATE_PREFIX}-{year}-{count:05d}"

@router.post("/issue/{test_id}")
async def issue_certificate(test_id: str, db: AsyncSession = Depends(get_db), user: dict = Depends(require_role(["admin", "operator"]))):
    result = await db.execute(select(CAT72Test).where(CAT72Test.test_id == test_id))
    test = result.scalar_one_or_none()
    if not test: raise HTTPException(status_code=404, detail="Test not found")
    if test.state != TestState.COMPLETED: raise HTTPException(status_code=400, detail="Test must be completed")
    if test.result != "PASS": raise HTTPException(status_code=400, detail="Cannot issue certificate for failed test")
    app_result = await db.execute(select(Application).where(Application.id == test.application_id))
    application = app_result.scalar_one_or_none()
    if not application: raise HTTPException(status_code=404, detail="Application not found")
    existing = await db.execute(select(Certificate).where(Certificate.application_id == application.id))
    if existing.scalar_one_or_none(): raise HTTPException(status_code=400, detail="Certificate already issued")
    cert_number = await generate_certificate_number(db)
    now = datetime.utcnow()
    # Generate signature and audit log reference
    sig_count = await db.execute(select(func.count(Certificate.id)))
    sig_num = (sig_count.scalar() or 0) + 1
    signature = f"SA-SIG-{sig_num}"
    audit_log_ref = f"SA-LOG-{now.year}-{sig_num:04d}"
    
    certificate = Certificate(certificate_number=cert_number, application_id=application.id, organization_name=application.organization_name, system_name=application.system_name, system_version=application.system_version, odd_specification=application.odd_specification, envelope_definition=application.envelope_definition, state=CertificationState.CONFORMANT, issued_at=now, expires_at=now + timedelta(days=365), issued_by=int(user["sub"]), test_id=test.id, convergence_score=test.convergence_score, evidence_hash=test.evidence_hash, signature=signature, audit_log_ref=audit_log_ref, verification_url=f"https://sentinelauthority.org/verify.html?cert={cert_number}", history=[{"action": "issued", "timestamp": now.isoformat(), "by": user["email"]}])
    db.add(certificate)
    application.state = CertificationState.CONFORMANT
    await db.commit()
    await db.refresh(certificate)
    # Send notification email
    await notify_certificate_issued(application.contact_email, certificate.system_name, certificate.certificate_number, certificate.organization_name)
    return {"certificate_number": certificate.certificate_number, "organization_name": certificate.organization_name, "system_name": certificate.system_name, "state": certificate.state.value, "issued_at": certificate.issued_at.isoformat(), "expires_at": certificate.expires_at.isoformat(), "verification_url": certificate.verification_url}

@router.get("/")
async def list_certificates(db: AsyncSession = Depends(get_db), user: dict = Depends(get_current_user)):
    # Admins see all, applicants see only their organization's certificates
    if user.get("role") in ["admin", "operator"]:
        result = await db.execute(select(Certificate).order_by(Certificate.issued_at.desc()))
    else:
        # Get user's applications to find their organization
        app_result = await db.execute(
            select(Application).where(Application.applicant_id == int(user["sub"]))
        )
        user_apps = app_result.scalars().all()
        app_ids = [a.id for a in user_apps]
        
        if app_ids:
            result = await db.execute(
                select(Certificate)
                .where(Certificate.application_id.in_(app_ids))
                .order_by(Certificate.issued_at.desc())
            )
        else:
            return []
    
    return [{"id": c.id, "certificate_number": c.certificate_number, "organization_name": c.organization_name, "system_name": c.system_name, "state": c.state.value, "issued_at": c.issued_at.isoformat() if c.issued_at else None, "expires_at": c.expires_at.isoformat() if c.expires_at else None} for c in result.scalars().all()]

@router.get("/{certificate_number}")
async def get_certificate(certificate_number: str, db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(Certificate).where(Certificate.certificate_number == certificate_number))
    cert = result.scalar_one_or_none()
    if not cert: raise HTTPException(status_code=404, detail="Certificate not found")
    return {"certificate_number": cert.certificate_number, "organization_name": cert.organization_name, "system_name": cert.system_name, "state": cert.state.value, "issued_at": cert.issued_at.isoformat() if cert.issued_at else None, "expires_at": cert.expires_at.isoformat() if cert.expires_at else None, "convergence_score": cert.convergence_score, "evidence_hash": cert.evidence_hash}

@router.get("/{certificate_number}/pdf")
async def download_pdf(certificate_number: str, db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(Certificate).where(Certificate.certificate_number == certificate_number))
    cert = result.scalar_one_or_none()
    if not cert: raise HTTPException(status_code=404, detail="Certificate not found")
    if cert.state == CertificationState.REVOKED: raise HTTPException(status_code=400, detail="Cannot download revoked certificate")
    test_result = await db.execute(select(CAT72Test).where(CAT72Test.id == cert.test_id))
    test = test_result.scalar_one_or_none()
    odd_spec = cert.odd_specification or {}
    odd_string = odd_spec.get("environment_type", "General") if isinstance(odd_spec, dict) else str(odd_spec)
    pdf_bytes = generate_certificate_pdf(cert.certificate_number, cert.organization_name, cert.system_name, odd_string, cert.issued_at, cert.expires_at, test.test_id if test else "N/A", cert.convergence_score or 0.95, test.stability_index if test else 0.95, test.drift_rate if test else 0.01, cert.evidence_hash or "N/A")
    return Response(content=pdf_bytes, media_type="application/pdf", headers={"Content-Disposition": f"attachment; filename=ODDC-{cert.certificate_number}.pdf"})

@router.patch("/{certificate_number}/suspend")
async def suspend_certificate(certificate_number: str, reason: str, db: AsyncSession = Depends(get_db), user: dict = Depends(require_role(["admin"]))):
    result = await db.execute(select(Certificate).where(Certificate.certificate_number == certificate_number))
    cert = result.scalar_one_or_none()
    if not cert: raise HTTPException(status_code=404, detail="Certificate not found")
    cert.state = CertificationState.SUSPENDED
    cert.history = (cert.history or []) + [{"action": "suspended", "timestamp": datetime.utcnow().isoformat(), "by": user["email"], "reason": reason}]
    await db.commit()
    return {"message": "Certificate suspended", "state": cert.state.value}

@router.patch("/{certificate_number}/revoke")
async def revoke_certificate(certificate_number: str, reason: str, db: AsyncSession = Depends(get_db), user: dict = Depends(require_role(["admin"]))):
    result = await db.execute(select(Certificate).where(Certificate.certificate_number == certificate_number))
    cert = result.scalar_one_or_none()
    if not cert: raise HTTPException(status_code=404, detail="Certificate not found")
    cert.state = CertificationState.REVOKED
    cert.history = (cert.history or []) + [{"action": "revoked", "timestamp": datetime.utcnow().isoformat(), "by": user["email"], "reason": reason}]
    await db.commit()
    return {"message": "Certificate revoked", "state": cert.state.value}

@router.patch("/{certificate_number}/reinstate")
async def reinstate_certificate(certificate_number: str, db: AsyncSession = Depends(get_db), user: dict = Depends(require_role(["admin"]))):
    result = await db.execute(select(Certificate).where(Certificate.certificate_number == certificate_number))
    cert = result.scalar_one_or_none()
    if not cert: raise HTTPException(status_code=404, detail="Certificate not found")
    if cert.state != CertificationState.SUSPENDED: raise HTTPException(status_code=400, detail="Only suspended certificates can be reinstated")
    cert.state = CertificationState.CONFORMANT
    cert.history = (cert.history or []) + [{"action": "reinstated", "timestamp": datetime.utcnow().isoformat(), "by": user["email"]}]
    await db.commit()
    return {"message": "Certificate reinstated", "state": cert.state.value}
</file>

<file path="backend/migrate_envelo.py">
"""
Migration script to add ENVELO tables
Run with: python migrate_envelo.py
"""

import asyncio
import os
from sqlalchemy import text
from sqlalchemy.ext.asyncio import create_async_engine

DATABASE_URL = os.environ.get("DATABASE_URL", "")
if DATABASE_URL.startswith("postgres://"):
    DATABASE_URL = DATABASE_URL.replace("postgres://", "postgresql+asyncpg://", 1)
elif DATABASE_URL.startswith("postgresql://") and "asyncpg" not in DATABASE_URL:
    DATABASE_URL = DATABASE_URL.replace("postgresql://", "postgresql+asyncpg://", 1)

async def migrate():
    if not DATABASE_URL:
        print("No DATABASE_URL found, skipping migration")
        return
        
    engine = create_async_engine(DATABASE_URL)
    
    async with engine.begin() as conn:
        # API Keys table
        await conn.execute(text("""
            CREATE TABLE IF NOT EXISTS api_keys (
                id SERIAL PRIMARY KEY,
                key_hash VARCHAR(64) UNIQUE NOT NULL,
                key_prefix VARCHAR(12) NOT NULL,
                certificate_id INTEGER REFERENCES certificates(id),
                user_id INTEGER REFERENCES users(id) NOT NULL,
                name VARCHAR(100),
                created_at TIMESTAMP DEFAULT NOW(),
                last_used_at TIMESTAMP,
                revoked_at TIMESTAMP,
                is_active BOOLEAN DEFAULT TRUE
            )
        """))
        print("✓ Created api_keys table")
        
        # ENVELO Sessions table
        await conn.execute(text("""
            CREATE TABLE IF NOT EXISTS envelo_sessions (
                id SERIAL PRIMARY KEY,
                session_id VARCHAR(64) UNIQUE NOT NULL,
                certificate_id INTEGER REFERENCES certificates(id),
                api_key_id INTEGER REFERENCES api_keys(id),
                started_at TIMESTAMP DEFAULT NOW(),
                ended_at TIMESTAMP,
                agent_version VARCHAR(20),
                status VARCHAR(20) DEFAULT 'active',
                last_telemetry_at TIMESTAMP,
                pass_count INTEGER DEFAULT 0,
                block_count INTEGER DEFAULT 0
            )
        """))
        print("✓ Created envelo_sessions table")
        
        # Telemetry Records table
        await conn.execute(text("""
            CREATE TABLE IF NOT EXISTS telemetry_records (
                id SERIAL PRIMARY KEY,
                session_id INTEGER REFERENCES envelo_sessions(id) NOT NULL,
                timestamp TIMESTAMP NOT NULL,
                action_id VARCHAR(50),
                action_type VARCHAR(100),
                result VARCHAR(10),
                execution_time_ms FLOAT,
                parameters TEXT,
                boundary_evaluations TEXT,
                system_state TEXT
            )
        """))
        print("✓ Created telemetry_records table")
        
        # Create index on telemetry timestamp
        await conn.execute(text("""
            CREATE INDEX IF NOT EXISTS idx_telemetry_timestamp 
            ON telemetry_records(timestamp DESC)
        """))
        print("✓ Created telemetry timestamp index")
        
        # Violations table
        await conn.execute(text("""
            CREATE TABLE IF NOT EXISTS violations (
                id SERIAL PRIMARY KEY,
                session_id INTEGER REFERENCES envelo_sessions(id) NOT NULL,
                telemetry_id INTEGER REFERENCES telemetry_records(id),
                timestamp TIMESTAMP NOT NULL,
                boundary_name VARCHAR(100),
                violation_message TEXT,
                parameters TEXT
            )
        """))
        print("✓ Created violations table")
        
        # Create index on violations
        await conn.execute(text("""
            CREATE INDEX IF NOT EXISTS idx_violations_session 
            ON violations(session_id)
        """))
        print("✓ Created violations index")
        
    await engine.dispose()
    print("\n✅ Migration complete!")

if __name__ == "__main__":
    asyncio.run(migrate())
</file>

<file path="website/downloads/envelo-agent/envelo/agent.py">
"""ENVELO Agent - Core enforcement engine with continuous monitoring"""

import hashlib, json, time, threading, queue
from datetime import datetime, timezone
from typing import Any, Callable, Dict, List, Optional
from dataclasses import dataclass, field
import httpx

from .boundaries import Boundary
from .actions import ActionResult
from .exceptions import BoundaryViolation, EnveloError

@dataclass
class EnveloConfig:
    certificate_id: str
    api_key: str
    api_endpoint: str = "https://sentinel-authority-production.up.railway.app"
    telemetry_interval: float = 1.0
    heartbeat_interval: float = 30.0  # Send heartbeat every 30 seconds
    fail_closed: bool = True
    safe_state_callback: Optional[Callable] = None
    log_local: bool = True
    local_log_path: str = "./envelo_logs"
    reconnect_attempts: int = 5
    reconnect_delay: float = 5.0

@dataclass 
class TelemetryRecord:
    timestamp: str
    action_id: str
    action_type: str
    parameters: Dict[str, Any]
    boundary_evaluations: List[Dict[str, Any]]
    result: str
    execution_time_ms: float
    system_state: Dict[str, Any] = field(default_factory=dict)

class EnveloAgent:
    def __init__(self, config: EnveloConfig):
        self.config = config
        self.boundaries: List[Boundary] = []
        self.telemetry_queue: queue.Queue = queue.Queue()
        self._running = False
        self._connected = False
        self._telemetry_thread: Optional[threading.Thread] = None
        self._heartbeat_thread: Optional[threading.Thread] = None
        self._action_counter = 0
        self._session_id = self._generate_session_id()
        self._start_time = datetime.now(timezone.utc)
        self._violation_count = 0
        self._pass_count = 0
        self._block_count = 0
        self._system_state: Dict[str, Any] = {}
        self._state_lock = threading.Lock()
        self._connection_lock = threading.Lock()
        self._last_telemetry_success = None
        self._reconnect_count = 0
        self._start_telemetry_stream()
        self._start_heartbeat()
        self._register_session()
    
    def _generate_session_id(self) -> str:
        data = f"{self.config.certificate_id}:{time.time()}:{id(self)}"
        return hashlib.sha256(data.encode()).hexdigest()[:16]
    
    def _register_session(self):
        for attempt in range(self.config.reconnect_attempts):
            try:
                with httpx.Client(timeout=10) as client:
                    response = client.post(
                        f"{self.config.api_endpoint}/api/envelo/sessions",
                        headers={"Authorization": f"Bearer {self.config.api_key}"},
                        json={
                            "certificate_id": self.config.certificate_id,
                            "session_id": self._session_id,
                            "started_at": self._start_time.isoformat(),
                            "agent_version": "1.1.0",
                            "boundaries": [b.to_dict() for b in self.boundaries]
                        }
                    )
                    if response.status_code == 200:
                        self._connected = True
                        self._reconnect_count = 0
                        print(f"[ENVELO] Session registered: {self._session_id}")
                        return
            except Exception as e:
                print(f"[ENVELO] Connection attempt {attempt + 1} failed: {e}")
                if attempt < self.config.reconnect_attempts - 1:
                    time.sleep(self.config.reconnect_delay)
        
        print(f"[ENVELO] Warning: Could not connect to Sentinel Authority after {self.config.reconnect_attempts} attempts")
        if self.config.fail_closed:
            raise EnveloError("Cannot start: Unable to connect to Sentinel Authority")
        self._connected = False
    
    def _start_telemetry_stream(self):
        self._running = True
        self._telemetry_thread = threading.Thread(target=self._telemetry_worker, daemon=True)
        self._telemetry_thread.start()
    
    def _start_heartbeat(self):
        self._heartbeat_thread = threading.Thread(target=self._heartbeat_worker, daemon=True)
        self._heartbeat_thread.start()
    
    def _heartbeat_worker(self):
        """Send periodic heartbeats to confirm agent is alive"""
        while self._running:
            try:
                time.sleep(self.config.heartbeat_interval)
                if not self._running:
                    break
                self._send_heartbeat()
            except Exception as e:
                print(f"[ENVELO] Heartbeat error: {e}")
    
    def _send_heartbeat(self):
        try:
            with httpx.Client(timeout=5) as client:
                response = client.post(
                    f"{self.config.api_endpoint}/api/envelo/heartbeat",
                    headers={"Authorization": f"Bearer {self.config.api_key}"},
                    json={"session_id": self._session_id}
                )
                if response.status_code == 200:
                    with self._connection_lock:
                        self._connected = True
                        self._reconnect_count = 0
                else:
                    self._handle_connection_issue()
        except Exception as e:
            self._handle_connection_issue()
    
    def _handle_connection_issue(self):
        with self._connection_lock:
            self._reconnect_count += 1
            if self._reconnect_count >= 3:
                self._connected = False
                print(f"[ENVELO] Connection lost - will retry")
    
    def _telemetry_worker(self):
        batch, last_send = [], time.time()
        while self._running:
            try:
                try:
                    batch.append(self.telemetry_queue.get(timeout=0.1))
                except queue.Empty:
                    pass
                if (time.time() - last_send >= self.config.telemetry_interval and batch) or len(batch) >= 100:
                    self._send_telemetry_batch(batch)
                    batch, last_send = [], time.time()
            except Exception as e:
                print(f"[ENVELO] Telemetry error: {e}")
    
    def _send_telemetry_batch(self, batch):
        if not batch:
            return
        try:
            with httpx.Client(timeout=10) as client:
                response = client.post(
                    f"{self.config.api_endpoint}/api/envelo/telemetry",
                    headers={"Authorization": f"Bearer {self.config.api_key}"},
                    json={
                        "certificate_id": self.config.certificate_id,
                        "session_id": self._session_id,
                        "records": [self._record_to_dict(r) for r in batch],
                        "stats": {"pass_count": self._pass_count, "block_count": self._block_count}
                    }
                )
                if response.status_code == 200:
                    self._last_telemetry_success = datetime.now(timezone.utc)
                    with self._connection_lock:
                        self._connected = True
        except Exception as e:
            print(f"[ENVELO] Could not send telemetry: {e}")
            if self.config.log_local:
                self._log_locally(batch)
    
    def _record_to_dict(self, r): 
        return {
            "timestamp": r.timestamp, "action_id": r.action_id, "action_type": r.action_type,
            "parameters": r.parameters, "boundary_evaluations": r.boundary_evaluations,
            "result": r.result, "execution_time_ms": r.execution_time_ms, "system_state": r.system_state
        }
    
    def _log_locally(self, batch):
        import os
        os.makedirs(self.config.local_log_path, exist_ok=True)
        with open(f"{self.config.local_log_path}/envelo_{datetime.now().strftime('%Y%m%d')}.jsonl", "a") as f:
            for r in batch:
                f.write(json.dumps(self._record_to_dict(r)) + "\n")
    
    def add_boundary(self, boundary: Boundary):
        self.boundaries.append(boundary)
        print(f"[ENVELO] Boundary added: {boundary.name}")
    
    def update_state(self, state: Dict[str, Any]):
        with self._state_lock:
            self._system_state.update(state)
    
    def is_connected(self) -> bool:
        """Check if agent is connected to Sentinel Authority"""
        with self._connection_lock:
            return self._connected
    
    def get_stats(self) -> Dict[str, Any]:
        """Get current agent statistics"""
        return {
            "session_id": self._session_id,
            "connected": self.is_connected(),
            "uptime_seconds": (datetime.now(timezone.utc) - self._start_time).total_seconds(),
            "pass_count": self._pass_count,
            "block_count": self._block_count,
            "total_actions": self._pass_count + self._block_count,
            "pass_rate": (self._pass_count / max(self._pass_count + self._block_count, 1)) * 100,
            "boundaries": len(self.boundaries)
        }
    
    def evaluate(self, parameters: Dict[str, Any]) -> ActionResult:
        start_time = time.time()
        self._action_counter += 1
        action_id = f"{self._session_id}-{self._action_counter:08d}"
        evaluations, all_passed, violation_details = [], True, []
        
        for boundary in self.boundaries:
            try:
                result = boundary.evaluate(parameters)
                evaluations.append({
                    "boundary": boundary.name, "type": boundary.boundary_type,
                    "passed": result.passed, "value": result.actual_value,
                    "limit": result.limit_value, "message": result.message
                })
                if not result.passed:
                    all_passed = False
                    violation_details.append(f"{boundary.name}: {result.message}")
            except Exception as e:
                evaluations.append({"boundary": boundary.name, "passed": False, "error": str(e)})
                all_passed = False
                violation_details.append(f"{boundary.name}: Error - {e}")
        
        if all_passed:
            self._pass_count += 1
        else:
            self._block_count += 1
            self._violation_count += 1
            if self.config.safe_state_callback:
                try:
                    self.config.safe_state_callback(parameters, violation_details)
                except:
                    pass
        
        with self._state_lock:
            current_state = self._system_state.copy()
        
        record = TelemetryRecord(
            datetime.now(timezone.utc).isoformat(), action_id,
            parameters.get("_action_type", "unknown"), parameters, evaluations,
            "PASS" if all_passed else "BLOCK", (time.time() - start_time) * 1000, current_state
        )
        self.telemetry_queue.put(record)
        
        return ActionResult(all_passed, action_id, evaluations, violation_details, record.timestamp)
    
    def enforce(self, func: Callable) -> Callable:
        def wrapper(*args, **kwargs):
            kwargs["_action_type"] = func.__name__
            result = self.evaluate(kwargs)
            if not result.allowed:
                raise BoundaryViolation(f"Action blocked: {', '.join(result.violations)}")
            return func(*args, **kwargs)
        wrapper.__name__ = func.__name__
        return wrapper
    
    def shutdown(self):
        print("[ENVELO] Shutting down...")
        self._running = False
        if self._telemetry_thread:
            self._telemetry_thread.join(timeout=5)
        if self._heartbeat_thread:
            self._heartbeat_thread.join(timeout=2)
        
        # Flush remaining telemetry
        remaining = []
        while not self.telemetry_queue.empty():
            try:
                remaining.append(self.telemetry_queue.get_nowait())
            except:
                break
        if remaining:
            self._send_telemetry_batch(remaining)
        
        # End session
        try:
            with httpx.Client(timeout=10) as client:
                client.post(
                    f"{self.config.api_endpoint}/api/envelo/sessions/{self._session_id}/end",
                    headers={"Authorization": f"Bearer {self.config.api_key}"},
                    json={
                        "ended_at": datetime.now(timezone.utc).isoformat(),
                        "final_stats": {"pass_count": self._pass_count, "block_count": self._block_count}
                    }
                )
        except:
            pass
        print("[ENVELO] Shutdown complete")
    
    def __enter__(self):
        return self
    
    def __exit__(self, *args):
        self.shutdown()
        return False
</file>

<file path="website/draft.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Specification Status — Sentinel Authority</title>
  <meta name="description" content="ODDC specification status, version history, and errata log." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root{
      color-scheme:dark;
      --purple-primary:#5B4B8A;--purple-bright:#9d8ccf;--purple-glow:rgba(157,140,207,.20);
      --bg-deep:#2a2f3d;--bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;--accent-amber:#D6A05C;--accent-red:#D65C5C;
      --text-primary:rgba(255,255,255,.94);--text-secondary:rgba(255,255,255,.75);--text-tertiary:rgba(255,255,255,.50);
      --border-glass:rgba(255,255,255,.10);--border-subtle:rgba(255,255,255,.06);
      --serif:'Source Serif 4',serif;--mono:'IBM Plex Mono',monospace;--sans:'Inter',system-ui,-apple-system,sans-serif;
      --ease:cubic-bezier(0.16,1,0.3,1);
      --space-1:10px;--space-2:20px;--space-3:30px;--space-4:40px;--space-6:60px;--space-8:80px;
      --max:1200px;--nav-height:72px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth;background:var(--bg-deep)}
    body{margin:0;font-family:var(--sans);background:radial-gradient(ellipse at 20% 0%, rgba(91,75,138,.18) 0%, transparent 50%),radial-gradient(ellipse at 80% 100%, rgba(92,214,133,.06) 0%, transparent 50%),var(--bg-deep);color:var(--text-primary);overflow-x:hidden;-webkit-font-smoothing:antialiased;min-height:100vh}
    a{color:inherit;text-decoration:none}a:hover{text-decoration:underline;text-underline-offset:4px}
    ::selection{background:var(--purple-primary);color:#fff}
    
    /* Grid overlay */
    .grid-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background-image:linear-gradient(rgba(255,255,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.03) 1px,transparent 1px);background-size:60px 60px;opacity:.4}
    
    /* Header */
    .site-header{position:fixed;top:0;width:100%;z-index:50;padding:0 var(--space-2);height:var(--nav-height);border-bottom:1px solid rgba(255,255,255,.08);background:rgba(42,47,61,.85);backdrop-filter:blur(20px);display:flex;align-items:center}
    .nav-inner{max-width:var(--max);margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between;gap:var(--space-2)}
    .brand{display:flex;align-items:center;gap:var(--space-1);flex-shrink:0;text-decoration:none}.brand:hover{text-decoration:none}
    .brand-mark{width:24px;height:24px;background:var(--purple-primary);border:2px solid var(--purple-bright);border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .brand-mark-inner{width:8px;height:8px;background:#c4b8e8;border-radius:50%;animation:pulse 3s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.7;transform:scale(.95)}50%{opacity:1;transform:scale(1.05);box-shadow:0 0 12px rgba(157,140,207,.3)}}
    .brand-name{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.86);white-space:nowrap}
    .back-link{font-family:var(--mono);font-size:10px;font-weight:500;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary);text-decoration:none;transition:color 0.2s;display:flex;align-items:center;gap:8px}.back-link:hover{color:var(--text-primary);text-decoration:none}
    
    /* Main */
    main{position:relative;z-index:1;max-width:800px;margin:0 auto;padding:calc(var(--nav-height) + 80px) var(--space-2) 80px}
    
    /* Hero */
    .page-hero{margin-bottom:var(--space-6)}
    .page-label{font-family:var(--mono);font-size:10px;letter-spacing:5px;text-transform:uppercase;color:var(--purple-bright);display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .page-label::before{content:'';width:40px;height:1px;background:var(--purple-bright)}
    .page-title{font-family:var(--serif);font-size:clamp(36px,5vw,56px);font-weight:200;line-height:1.1;margin:0 0 20px;letter-spacing:-0.03em}
    .page-desc{font-size:17px;color:var(--text-secondary);line-height:1.7;max-width:60ch;font-weight:300}
    
    /* Status Card */
    .status-card{background:linear-gradient(135deg,rgba(214,160,92,0.1) 0%,rgba(214,160,92,0.02) 100%);border:1px solid rgba(214,160,92,0.3);border-radius:20px;padding:32px;margin-bottom:var(--space-4);position:relative;overflow:hidden}
    .status-card::before{content:'';position:absolute;top:-50px;right:-50px;width:150px;height:150px;background:radial-gradient(circle,rgba(214,160,92,0.15) 0%,transparent 70%);pointer-events:none}
    .status-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:20px;margin-bottom:24px}
    .status-badge{display:flex;align-items:center;gap:8px;padding:10px 16px;background:rgba(214,160,92,0.15);border:1px solid rgba(214,160,92,0.4);border-radius:30px}
    .status-dot{width:8px;height:8px;border-radius:50%;background:var(--accent-amber);animation:pulse 2s ease-in-out infinite}
    .status-text{font-family:var(--mono);font-size:11px;letter-spacing:2px;color:var(--accent-amber)}
    .status-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px}
    .status-item{padding:16px;background:rgba(0,0,0,0.15);border-radius:12px}
    .status-label{font-family:var(--mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary);margin-bottom:6px}
    .status-value{font-size:15px;color:var(--text-primary)}
    .status-value a{color:var(--purple-bright)}
    
    /* Timeline */
    .timeline{position:relative;padding-left:32px;margin:var(--space-4) 0}
    .timeline::before{content:'';position:absolute;left:7px;top:8px;bottom:8px;width:2px;background:linear-gradient(to bottom,rgba(157,140,207,0.4),rgba(157,140,207,0.1))}
    .timeline-item{position:relative;padding-bottom:32px}
    .timeline-item:last-child{padding-bottom:0}
    .timeline-dot{position:absolute;left:-28px;top:4px;width:16px;height:16px;background:var(--bg-deep);border:2px solid var(--purple-bright);border-radius:50%;z-index:1}
    .timeline-item:first-child .timeline-dot{background:var(--purple-bright)}
    .timeline-version{font-family:var(--mono);font-size:13px;color:var(--purple-bright);margin-bottom:4px}
    .timeline-date{font-size:12px;color:var(--text-tertiary);margin-bottom:8px}
    .timeline-desc{font-size:14px;color:var(--text-secondary);line-height:1.6}
    
    /* Panel */
    .panel{background:rgba(255,255,255,0.03);border:1px solid var(--border-glass);border-radius:18px;padding:28px;margin-bottom:var(--space-3);position:relative;overflow:hidden}
    .panel::before{content:'';position:absolute;top:-30%;right:-30%;width:60%;height:60%;background:radial-gradient(circle,rgba(157,140,207,0.06) 0%,transparent 70%);pointer-events:none}
    .panel h3{font-family:var(--mono);font-size:11px;letter-spacing:4px;text-transform:uppercase;color:rgba(255,255,255,.85);margin:0 0 20px;position:relative}
    .panel p{color:var(--text-secondary);font-size:14px;line-height:1.7;margin:0;position:relative}
    
    /* Errata */
    .errata-empty{color:var(--text-tertiary);font-style:italic;font-size:14px;padding:20px;text-align:center;background:rgba(92,214,133,0.05);border:1px solid rgba(92,214,133,0.15);border-radius:12px}
    .errata-empty::before{content:'✓';display:block;font-size:24px;margin-bottom:8px;font-style:normal}
    
    /* Report Card */
    .report-card{background:linear-gradient(135deg,rgba(157,140,207,0.08) 0%,rgba(157,140,207,0.02) 100%);border:1px solid rgba(157,140,207,0.25);border-radius:16px;padding:24px;display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .report-icon{width:48px;height:48px;background:rgba(157,140,207,0.15);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .report-content{flex:1;min-width:200px}
    .report-title{font-size:15px;color:var(--text-primary);margin-bottom:4px}
    .report-desc{font-size:13px;color:var(--text-tertiary)}
    .report-link{font-family:var(--mono);font-size:11px;letter-spacing:1px;color:var(--purple-bright);padding:10px 18px;border:1px solid rgba(157,140,207,0.4);border-radius:8px;transition:all 0.2s;white-space:nowrap}
    .report-link:hover{background:rgba(157,140,207,0.1);border-color:rgba(157,140,207,0.6);text-decoration:none}
    
    /* Footer */
    footer{margin-top:var(--space-8);padding:var(--space-4) var(--space-2);border-top:1px solid var(--border-glass);text-align:center}
    .footer-copy{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary)}
    .footer-links{margin-top:16px;display:flex;justify-content:center;gap:24px;flex-wrap:wrap}
    .footer-links a{font-family:var(--mono);font-size:10px;letter-spacing:1px;color:var(--text-tertiary);text-decoration:none;transition:color 0.2s}.footer-links a:hover{color:var(--text-primary);text-decoration:none}
  </style>
</head>
<body>
  <div class="grid-overlay" aria-hidden="true"></div>
  
  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark" aria-hidden="true"><div class="brand-mark-inner"></div></div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back to Home
      </a>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <div class="page-hero">
      <div class="page-label">Specification Status</div>
      <h1 class="page-title">ODDC v1.0</h1>
      <p class="page-desc">Current specification status, version history, and errata log for the ODD Conformance Determination program.</p>
    </div>

    <!-- Status Card -->
    <div class="status-card">
      <div class="status-header">
        <div>
          <div style="font-size:13px;color:var(--text-tertiary);margin-bottom:4px;">Current Status</div>
          <div style="font-family:var(--serif);font-size:28px;color:var(--text-primary);">Draft Specification</div>
        </div>
        <div class="status-badge">
          <div class="status-dot"></div>
          <span class="status-text">DRAFT</span>
        </div>
      </div>
      <div class="status-grid">
        <div class="status-item">
          <div class="status-label">Program</div>
          <div class="status-value">ODDC Conformance</div>
        </div>
        <div class="status-item">
          <div class="status-label">Version</div>
          <div class="status-value">v1.0</div>
        </div>
        <div class="status-item">
          <div class="status-label">Effective</div>
          <div class="status-value">January 2026</div>
        </div>
        <div class="status-item">
          <div class="status-label">Change Control</div>
          <div class="status-value">Errata + Versioning</div>
        </div>
      </div>
    </div>

    <!-- Version History -->
    <div class="panel">
      <h3>Version History</h3>
      <div class="timeline">
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-version">v1.0</div>
          <div class="timeline-date">January 2026</div>
          <div class="timeline-desc">Initial draft release. ODDC Overview, ENVELO Requirements, and CAT-72 Procedure published. Framework enters public review period.</div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-version">v0.9</div>
          <div class="timeline-date">December 2025</div>
          <div class="timeline-desc">Internal review draft. Core framework finalized. ENVELO enforcement requirements defined.</div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-version">v0.1</div>
          <div class="timeline-date">October 2025</div>
          <div class="timeline-desc">Initial concept development. ODD conformance framework proposed.</div>
        </div>
      </div>
    </div>

    <!-- Errata Log -->
    <div class="panel">
      <h3>Errata Log</h3>
      <div class="errata-empty">
        No errata reported for v1.0
      </div>
    </div>

    <!-- Report Issue -->
    <div class="report-card">
      <div class="report-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.9)" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      </div>
      <div class="report-content">
        <div class="report-title">Report an Issue</div>
        <div class="report-desc">Found an error or inconsistency? Help us improve the specification.</div>
      </div>
      <a href="mailto:conformance@sentinelauthority.org?subject=ODDC%20Errata" class="report-link">Submit Errata →</a>
    </div>
  </main>

  <footer>
    <div style="max-width:var(--max);margin:0 auto;">
      <div class="footer-copy">© <span id="yr"></span> Sentinel Authority</div>
      <div class="footer-links">
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
        <a href="index.html#artifacts">Documents</a>
        <a href="conformance-agreement.html">Conformance</a>
      </div>
    </div>
  </footer>
  <script>document.getElementById("yr").textContent=new Date().getFullYear();</script>
</body>
</html>
</file>

<file path="website/install.sh">
#!/bin/bash
# ENVELO Agent Installer
# Sentinel Authority - https://sentinelauthority.org

set -e

clear
echo ""
echo "  ╔═══════════════════════════════════════════════════════════╗"
echo "  ║                                                           ║"
echo "  ║             ENVELO Agent Installer v1.0                   ║"
echo "  ║                  Sentinel Authority                       ║"
echo "  ║                                                           ║"
echo "  ║     Runtime enforcement for ODDC-certified systems        ║"
echo "  ║                                                           ║"
echo "  ╚═══════════════════════════════════════════════════════════╝"
echo ""

# Check Python
echo "  Checking requirements..."
echo ""

if ! command -v python3 &> /dev/null; then
    echo "  ❌ Python 3 is required but not installed."
    echo ""
    echo "     Please install Python 3.9 or higher and try again."
    echo "     Visit: https://www.python.org/downloads/"
    echo ""
    exit 1
fi

PYTHON_VERSION=$(python3 -c 'import sys; print(f"{sys.version_info.major}.{sys.version_info.minor}")')
echo "  ✓ Python $PYTHON_VERSION detected"
echo ""

# Get configuration
echo "  ─────────────────────────────────────────────────────────────"
echo ""
echo "  Enter your credentials from the Sentinel Authority dashboard."
echo "  (Find these at: https://app.sentinelauthority.org/envelo)"
echo ""

read -p "  Certificate ID: " CERT_ID
echo ""
read -p "  API Key: " API_KEY
echo ""

if [ -z "$CERT_ID" ] || [ -z "$API_KEY" ]; then
    echo "  ❌ Both Certificate ID and API Key are required."
    echo ""
    exit 1
fi

# Validate API key format
if [[ ! "$API_KEY" =~ ^sa_live_ ]]; then
    echo "  ⚠️  Warning: API key should start with 'sa_live_'"
    echo ""
fi

# Create install directory
INSTALL_DIR="$HOME/.envelo"
echo "  ─────────────────────────────────────────────────────────────"
echo ""
echo "  Installing ENVELO Agent..."
echo ""

mkdir -p "$INSTALL_DIR"
cd "$INSTALL_DIR"

echo "  📦 Downloading agent package..."
curl -sSL https://www.sentinelauthority.org/downloads/envelo-agent-v1.0.0.zip -o envelo-agent.zip 2>/dev/null
unzip -q -o envelo-agent.zip
rm envelo-agent.zip

echo "  📦 Installing dependencies..."
pip3 install httpx --quiet 2>/dev/null || pip3 install httpx --quiet --break-system-packages 2>/dev/null

# Create config file
cat > config.env << CONF
ENVELO_CERTIFICATE_ID=$CERT_ID
ENVELO_API_KEY=$API_KEY
ENVELO_API_ENDPOINT=https://sentinel-authority-production.up.railway.app
CONF

# Create example script
cat > example.py << 'EXAMPLE'
#!/usr/bin/env python3
"""
ENVELO Agent - Example Usage
Run this file to test your ENVELO Agent installation.
"""

import sys
import os

# Add ENVELO to path
sys.path.insert(0, os.path.expanduser('~/.envelo/envelo-agent'))

# Load config
from dotenv import load_dotenv
load_dotenv(os.path.expanduser('~/.envelo/config.env'))

from envelo import EnveloAgent, EnveloConfig, NumericBoundary

# Initialize agent
config = EnveloConfig(
    certificate_id=os.environ.get('ENVELO_CERTIFICATE_ID'),
    api_key=os.environ.get('ENVELO_API_KEY'),
    api_endpoint=os.environ.get('ENVELO_API_ENDPOINT', 'https://sentinel-authority-production.up.railway.app')
)

agent = EnveloAgent(config)

# Define boundaries (your ODD)
agent.add_boundary(NumericBoundary("speed", min=0, max=100, unit="km/h"))
agent.add_boundary(NumericBoundary("temperature", min=-20, max=50, unit="celsius"))

print("ENVELO Agent initialized!")
print(f"Certificate: {config.certificate_id}")
print("")

# Example: Enforce a function
@agent.enforce
def move_vehicle(speed, temperature):
    """This function is protected by ENVELO"""
    print(f"  Moving at {speed} km/h, temp: {temperature}°C")
    return True

# Test within boundaries (should PASS)
print("Test 1: Within boundaries (speed=50, temp=25)")
try:
    move_vehicle(speed=50, temperature=25)
    print("  ✓ Action allowed\n")
except Exception as e:
    print(f"  ✗ Blocked: {e}\n")

# Test outside boundaries (should BLOCK)
print("Test 2: Outside boundaries (speed=150, temp=25)")
try:
    move_vehicle(speed=150, temperature=25)
    print("  ✓ Action allowed\n")
except Exception as e:
    print(f"  ✗ Blocked: {e}\n")

# Shutdown
print("Shutting down agent...")
agent.shutdown()
print("Done! Check your dashboard for telemetry.")
EXAMPLE

chmod +x example.py

echo ""
echo "  ═══════════════════════════════════════════════════════════"
echo ""
echo "  ✅ ENVELO Agent installed successfully!"
echo ""
echo "  ─────────────────────────────────────────────────────────────"
echo "  Location:     ~/.envelo"
echo "  Certificate:  $CERT_ID"
echo "  ─────────────────────────────────────────────────────────────"
echo ""
echo "  QUICK TEST:"
echo ""
echo "    pip3 install python-dotenv"
echo "    python3 ~/.envelo/example.py"
echo ""
echo "  ─────────────────────────────────────────────────────────────"
echo ""
echo "  INTEGRATE INTO YOUR CODE:"
echo ""
echo "    import sys"
echo "    sys.path.insert(0, '$INSTALL_DIR/envelo-agent')"
echo "    from envelo import EnveloAgent, EnveloConfig, NumericBoundary"
echo ""
echo "  ─────────────────────────────────────────────────────────────"
echo ""
echo "  📊 Dashboard:  https://app.sentinelauthority.org/envelo"
echo "  📚 Docs:       https://sentinelauthority.org/agent.html"
echo "  📧 Support:    conformance@sentinelauthority.org"
echo ""
echo "  ═══════════════════════════════════════════════════════════"
echo ""
</file>

<file path="website/privacy.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Privacy Policy — Sentinel Authority</title>
  <meta name="description" content="Privacy Policy for Sentinel Authority ODDC conformance services." />
  <link rel="canonical" href="https://sentinelauthority.org/privacy.html" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root{
      color-scheme:dark;
      --purple-primary:#5B4B8A;--purple-bright:#9d8ccf;
      --bg-deep:#2a2f3d;--bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;--accent-amber:#D6A05C;
      --text-primary:rgba(255,255,255,.94);--text-secondary:rgba(255,255,255,.75);--text-tertiary:rgba(255,255,255,.50);
      --border-glass:rgba(255,255,255,.10);--border-subtle:rgba(255,255,255,.06);
      --serif:'Source Serif 4',serif;--mono:'IBM Plex Mono',monospace;--sans:'Inter',system-ui,-apple-system,sans-serif;
      --space-1:10px;--space-2:20px;--space-3:30px;--space-4:40px;--space-6:60px;--space-8:80px;
      --max:900px;--nav-height:72px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth;background:var(--bg-deep)}
    body{margin:0;font-family:var(--sans);background:radial-gradient(ellipse at 20% 0%,rgba(91,75,138,.15) 0%,transparent 50%),var(--bg-deep);color:var(--text-primary);-webkit-font-smoothing:antialiased;min-height:100vh;line-height:1.7}
    a{color:var(--purple-bright);text-decoration:none}a:hover{text-decoration:underline}
    ::selection{background:var(--purple-primary);color:#fff}
    
    .grid-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background-image:linear-gradient(rgba(255,255,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.03) 1px,transparent 1px);background-size:60px 60px;opacity:.3}
    
    .site-header{position:fixed;top:0;width:100%;z-index:50;padding:0 var(--space-2);height:var(--nav-height);border-bottom:1px solid rgba(255,255,255,.08);background:rgba(42,47,61,.85);backdrop-filter:blur(20px);display:flex;align-items:center}
    .nav-inner{max-width:1200px;margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:var(--space-1);text-decoration:none}.brand:hover{text-decoration:none}
    .brand-mark{width:24px;height:24px;background:var(--purple-primary);border:2px solid var(--purple-bright);border-radius:6px;display:flex;align-items:center;justify-content:center}
    .brand-mark-inner{width:8px;height:8px;background:#c4b8e8;border-radius:50%;animation:pulse 3s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.7;transform:scale(.95)}50%{opacity:1;transform:scale(1.05)}}
    .brand-name{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.86)}
    .back-link{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary);text-decoration:none;display:flex;align-items:center;gap:8px;transition:color .2s}.back-link:hover{color:var(--text-primary);text-decoration:none}
    
    main{position:relative;z-index:1;max-width:var(--max);margin:0 auto;padding:calc(var(--nav-height) + 60px) var(--space-2) 80px}
    
    .page-hero{margin-bottom:var(--space-6);padding-bottom:var(--space-4);border-bottom:1px solid var(--border-glass)}
    .page-label{font-family:var(--mono);font-size:10px;letter-spacing:5px;text-transform:uppercase;color:var(--purple-bright);display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .page-label::before{content:'';width:40px;height:1px;background:var(--purple-bright)}
    .page-title{font-family:var(--serif);font-size:clamp(36px,5vw,52px);font-weight:200;line-height:1.1;margin:0 0 16px}
    .page-meta{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .effective{font-family:var(--mono);font-size:11px;color:var(--text-tertiary);padding:8px 14px;background:rgba(255,255,255,.03);border:1px solid var(--border-subtle);border-radius:8px}
    .page-intro{font-size:17px;color:var(--text-secondary);max-width:65ch;margin-top:var(--space-2)}
    
    .content-section{margin-bottom:var(--space-4)}
    .content-section h2{font-family:var(--serif);font-size:24px;font-weight:300;margin:0 0 var(--space-2);padding-top:var(--space-2);display:flex;align-items:center;gap:12px}
    .content-section h2::before{content:'';width:4px;height:24px;background:var(--purple-bright);border-radius:2px}
    .content-section p{color:var(--text-secondary);margin:0 0 var(--space-2);font-size:15px}
    .content-section strong{color:var(--text-primary)}
    
    .info-card{background:rgba(255,255,255,.03);border:1px solid var(--border-glass);border-radius:14px;padding:20px 24px;margin:var(--space-2) 0}
    .info-card ul{margin:0;padding:0 0 0 20px;color:var(--text-secondary)}
    .info-card li{margin-bottom:10px;font-size:14px}
    .info-card li:last-child{margin-bottom:0}
    
    .highlight-box{background:linear-gradient(135deg,rgba(92,214,133,.08) 0%,rgba(92,214,133,.02) 100%);border:1px solid rgba(92,214,133,.25);border-radius:14px;padding:20px 24px;margin:var(--space-3) 0}
    .highlight-box p{color:var(--text-secondary);margin:0;font-size:14px}
    .highlight-box strong{color:rgba(92,214,133,.95)}
    
    .contact-card{background:linear-gradient(135deg,rgba(157,140,207,.1) 0%,rgba(157,140,207,.03) 100%);border:1px solid rgba(157,140,207,.25);border-radius:16px;padding:24px;margin-top:var(--space-4);display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .contact-icon{width:48px;height:48px;background:rgba(157,140,207,.15);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .contact-content{flex:1;min-width:200px}
    .contact-title{font-size:15px;color:var(--text-primary);margin-bottom:4px}
    .contact-desc{font-size:13px;color:var(--text-tertiary)}
    .contact-link{font-family:var(--mono);font-size:11px;letter-spacing:1px;color:var(--purple-bright);padding:10px 18px;border:1px solid rgba(157,140,207,.4);border-radius:8px;text-decoration:none;transition:all .2s;white-space:nowrap}
    .contact-link:hover{background:rgba(157,140,207,.1);border-color:rgba(157,140,207,.6);text-decoration:none}
    
    footer{margin-top:var(--space-8);padding:var(--space-4) var(--space-2);border-top:1px solid var(--border-glass);text-align:center}
    .footer-copy{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary)}
    .footer-links{margin-top:16px;display:flex;justify-content:center;gap:24px;flex-wrap:wrap}
    .footer-links a{font-family:var(--mono);font-size:10px;letter-spacing:1px;color:var(--text-tertiary);text-decoration:none}.footer-links a:hover{color:var(--text-primary)}
  </style>
</head>
<body>
  <div class="grid-overlay" aria-hidden="true"></div>
  
  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark"><div class="brand-mark-inner"></div></div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back
      </a>
    </div>
  </header>

  <main>
    <div class="page-hero">
      <div class="page-label">Legal</div>
      <h1 class="page-title">Privacy Policy</h1>
      <div class="page-meta">
        <div class="effective">Effective: January 2026</div>
      </div>
      <p class="page-intro">
        Sentinel Authority operates the sentinelauthority.org website and the ODDC certification platform. This policy describes how we collect, use, and protect your information.
      </p>
    </div>

    <div class="content-section">
      <h2>Information We Collect</h2>
      <p><strong>Information you provide:</strong></p>
      <div class="info-card">
        <ul>
          <li>Contact information (name, email, phone, organization)</li>
          <li>Application data (system descriptions, ODD specifications, technical documentation)</li>
          <li>Account credentials for the certification portal</li>
          <li>Payment information (processed by third-party providers)</li>
        </ul>
      </div>
      <p><strong>Information collected automatically:</strong></p>
      <div class="info-card">
        <ul>
          <li>ENVELO Agent telemetry data from systems undergoing certification</li>
          <li>Log data (IP address, browser type, pages visited)</li>
          <li>Cookies for session management</li>
        </ul>
      </div>
    </div>

    <div class="content-section">
      <h2>How We Use Your Information</h2>
      <div class="info-card">
        <ul>
          <li>Process and evaluate certification applications</li>
          <li>Conduct CAT-72 conformance testing</li>
          <li>Issue and manage ODDC certificates</li>
          <li>Communicate about your application or certification status</li>
          <li>Maintain audit records as required for certification integrity</li>
          <li>Improve our services and platform</li>
        </ul>
      </div>
    </div>

    <div class="content-section">
      <h2>Data Retention</h2>
      <p>We retain certification records, including CAT-72 evidence and audit logs, for the duration of your certification plus seven (7) years, as required for regulatory and evidentiary purposes.</p>
      <p>Account information is retained while your account is active and for a reasonable period thereafter for legal and business purposes.</p>
    </div>

    <div class="content-section">
      <h2>Data Security</h2>
      <div class="highlight-box">
        <p><strong>All data is encrypted in transit (TLS 1.3) and at rest.</strong> We implement industry-standard security measures including access controls, audit logging, and regular security assessments.</p>
      </div>
    </div>

    <div class="content-section">
      <h2>Your Rights</h2>
      <p>Depending on your jurisdiction, you may have rights to access, correct, delete, or port your personal data. Note that certification records may be subject to retention requirements that limit deletion rights.</p>
    </div>

    <div class="content-section">
      <h2>Third Parties</h2>
      <p>We do not sell your personal information. We may share data with service providers who assist in operating our platform, subject to confidentiality obligations.</p>
    </div>

    <div class="content-section">
      <h2>Updates</h2>
      <p>We may update this policy periodically. Material changes will be communicated via email or platform notification.</p>
    </div>

    <div class="contact-card">
      <div class="contact-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.9)" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      </div>
      <div class="contact-content">
        <div class="contact-title">Privacy Questions?</div>
        <div class="contact-desc">Contact us about your data or privacy concerns.</div>
      </div>
      <a href="mailto:conformance@sentinelauthority.org" class="contact-link">conformance@sentinelauthority.org →</a>
    </div>
  </main>

  <footer>
    <div class="footer-copy">© <span id="yr"></span> Sentinel Authority</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="index.html#artifacts">Documents</a>
      <a href="conformance-agreement.html">Conformance</a>
    </div>
  </footer>
  <script>document.getElementById("yr").textContent=new Date().getFullYear();</script>
</body>
</html>
</file>

<file path="website/scenarios.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ODDC Conformance Scenarios — Sentinel Authority</title>
  <meta name="description" content="Representative ODDC conformance scenarios across industries including data centers, autonomous vehicles, healthcare, financial services, manufacturing, and aerospace." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>

    :root{
      color-scheme: dark;
      
      /* Core palette */
      --purple-primary:#5B4B8A;
      --purple-bright:#9d8ccf;
      --purple-glow:rgba(157,140,207,.20);
      --bg-deep:#2a2f3d;
      --bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;
      --accent-amber:#D6A05C;
      --accent-red:#D65C5C;

      /* Text hierarchy */
      --text-primary:rgba(255,255,255,.94);
      --text-secondary:rgba(255,255,255,.75);
      --text-tertiary:rgba(255,255,255,.50);

      /* Borders */
      --border-glass:rgba(255,255,255,.10);
      --border-subtle:rgba(255,255,255,.06);

      /* Typography */
      --serif:'Source Serif 4',serif;
      --mono:'IBM Plex Mono',monospace;
      --sans:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

      /* Timing */
      --ease: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
      
      /* Spacing scale (10px base) */
      --space-1: 10px;
      --space-2: 20px;
      --space-3: 30px;
      --space-4: 40px;
      --space-5: 50px;
      --space-6: 60px;
      --space-8: 80px;
      --space-10: 100px;
      --space-12: 120px;
      
      /* Layout */
      --max: 1200px;
      --nav-height: 72px;
    }

    *{ box-sizing:border-box; }
    
    /* Skip link for accessibility */
    .skip-link{
      position:absolute;
      left:-9999px;
      top:auto;
      width:1px;
      height:1px;
      overflow:hidden;
      z-index:999;
    }
    .skip-link:focus{
      position:fixed;
      top:var(--space-1);
      left:var(--space-1);
      width:auto;
      height:auto;
      padding:12px 18px;
      background:var(--bg-deep);
      border:1px solid var(--purple-bright);
      border-radius:8px;
      color:var(--text-primary);
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:2px;
      text-transform:uppercase;
      text-decoration:none;
    }
    
    /* Screen reader only */
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
    
    /* Focus styles for accessibility */
    a:focus-visible, button:focus-visible {
      outline: 2px solid rgba(157,140,207,.75);
      outline-offset: 3px;
      border-radius: 10px;
    }
    
    html{ scroll-behavior:smooth; background:var(--bg-deep); }
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 15% 10%, rgba(91,75,138,.15), transparent 55%),
                  radial-gradient(900px 600px at 85% 80%, rgba(92,214,133,.06), transparent 55%),
                  var(--bg-deep);
      color:var(--text-primary);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; text-underline-offset:4px; }
    ::selection{ background:var(--purple-primary); color:#fff; }

    /* Subtle grid overlay */
    .grid-overlay{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      background-image:
        linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
      background-size: var(--space-12) var(--space-12);
      opacity:.15;
      mask-image: radial-gradient(ellipse at center, rgba(0,0,0,.95) 20%, transparent 70%);
    }

    /* ============================================
       NAVIGATION
       ============================================ */
    .site-header{
      position:fixed;
      top:0;
      width:100%;
      z-index:50;
      padding:0 var(--space-2, 20px);
      height: var(--nav-height, 72px);
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(42,47,61,.88);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      display: flex;
      align-items: center;
    }
    .nav-inner{
      max-width: var(--max, 1200px);
      margin:0 auto;
      width: 100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--space-2, 20px);
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      gap: var(--space-1, 10px);
      flex-shrink: 0;
      text-decoration: none;
      visibility: visible;
      opacity: 1;
    }
    .brand:hover{ text-decoration: none; }
    .brand-mark{
      width: 24px;
      height: 24px;
      background: #5B4B8A;
      background: var(--purple-primary, #5B4B8A);
      border: 2px solid #9d8ccf;
      border: 2px solid var(--purple-bright, #9d8ccf);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .brand-mark-inner{
      width: 8px;
      height: 8px;
      background: #c4b8e8;
      border-radius: 50%;
      animation: eye-pulse 7s ease-in-out infinite;
      will-change: transform, opacity, box-shadow;
    }
    @keyframes eye-pulse {
      0%, 100% {
        opacity: .75;
        transform: scale(.98);
        box-shadow: 0 0 0 rgba(196,184,232,0);
      }
      50% {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 10px rgba(157,140,207,.22);
      }
    }
    @media (prefers-reduced-motion: reduce){
      .brand-mark-inner{ animation: none; opacity: .9; }
    }
    .brand-name{
      font-family: 'IBM Plex Mono', monospace;
      font-family: var(--mono, 'IBM Plex Mono', monospace);
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #dbdbdb;
      color: rgba(255,255,255,.86);
      white-space: nowrap;
    }
    /* Back link for sub-pages */
    .back-link{
      font-family: var(--mono, 'IBM Plex Mono', monospace);
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-tertiary, rgba(255,255,255,.50));
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .back-link:hover{
      color: var(--text-primary, rgba(255,255,255,.94));
      text-decoration: none;
    }


    .nav-links{
      display:flex;
      align-items:center;
      gap: 14px;
      flex-wrap: nowrap;
      justify-content:center;
    }
    .nav-links a{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      color: var(--text-tertiary);
      padding: 8px 4px;
      position: relative;
      transition: color .25s ease;
      white-space: nowrap;
    }
    .nav-links a:hover{ color: var(--text-primary); text-decoration:none; }
    .nav-links a::after{
      content:"";
      position:absolute;
      left:4px; right:4px; bottom:4px;
      height:1px;
      background: var(--purple-bright);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .35s var(--ease);
      opacity:.9;
    }
    .nav-links a:hover::after{ transform: scaleX(1); }
    
    /* Active section indicator */
    .nav-links a.active{
      color: var(--text-primary);
    }
    .nav-links a.active::after{
      transform: scaleX(1);
      opacity: .6;
    }

    .nav-badge{
      display:flex;
      align-items:center;
      gap:6px;
      font-family: var(--mono);
      font-size: 8px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: rgba(214,160,92,.95);
      border: 1px solid rgba(214,160,92,.25);
      background: rgba(214,160,92,.08);
      padding: 6px 8px;
      border-radius: 999px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Mobile nav toggle */
    .nav-toggle{
      display: none;
      appearance: none;
      border: 1px solid var(--border-glass);
      background: rgba(255,255,255,.03);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      position: relative;
      transition: border-color .2s ease, background .2s ease;
    }
    .nav-toggle:hover{
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
    }
    .nav-toggle span{
      position: absolute;
      left: 50%;
      width: 16px;
      height: 1px;
      background: var(--text-secondary);
      transform: translateX(-50%);
      transition: all .18s var(--ease-out);
    }
    .nav-toggle span:nth-child(1){ top: 14px; }
    .nav-toggle span:nth-child(2){ top: 19px; }
    .nav-toggle span:nth-child(3){ top: 24px; }
    
    .nav-toggle[aria-expanded="true"] span:nth-child(1){
      top: 19px;
      transform: translateX(-50%) rotate(45deg);
    }
    .nav-toggle[aria-expanded="true"] span:nth-child(2){
      opacity: 0;
      transform: translateX(-50%) scaleX(0);
    }
    .nav-toggle[aria-expanded="true"] span:nth-child(3){
      top: 19px;
      transform: translateX(-50%) rotate(-45deg);
    }

    /* Mobile drawer */
    .nav-drawer{
      display: none;
      position: fixed;
      top: var(--nav-height);
      right: 0;
      width: 280px;
      max-width: calc(100vw - var(--space-4));
      height: calc(100vh - var(--nav-height));
      background: rgba(42,47,61,.96);
      backdrop-filter: blur(24px);
      border-left: 1px solid var(--border-glass);
      transform: translateX(100%);
      transition: transform .18s var(--ease-out);
      z-index: 49;
      padding: var(--space-3) var(--space-2);
      overflow-y: auto;
    }
    .nav-drawer.open{
      transform: translateX(0);
    }
    .nav-drawer a{
      display: flex;
      align-items: center;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-secondary);
      padding: 14px 0;
      border-bottom: 1px solid var(--border-subtle);
      transition: color .2s ease;
    }
    .nav-drawer a:hover{
      color: var(--text-primary);
      text-decoration: none;
    }
    .nav-drawer a.active{
      color: var(--purple-bright);
    }
    
    .drawer-overlay{
      display: none;
      position: fixed;
      inset: 0;
      top: var(--nav-height);
      background: rgba(0,0,0,.4);
      z-index: 48;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events: none;
    }
    .drawer-overlay.open{
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 860px){
      .nav-links{ display:none; }
      .nav-toggle{ display: block; }
      .nav-drawer{ display: block; }
      .drawer-overlay{ display: block; }
    }

    /* ============================================
       MAIN CONTENT
       ============================================ */
    main{
      position: relative;
      z-index: 1;
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--space-2);
    }

    /* ============================================
       HERO
       ============================================ */
    .hero{
      min-height: 100vh;
      padding: calc(var(--nav-height) + var(--space-8)) 0 var(--space-6);
      display:flex;
      flex-direction: column;
      justify-content: center;
      gap: var(--space-2);
      position: relative;
    }
    
    /* Hero anchor line */
    .hero::before{
      content: "";
      position: absolute;
      left: 0;
      top: calc(var(--nav-height) + var(--space-6));
      bottom: var(--space-6);
      width: 1px;
      background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(157,140,207,.15) 10%,
        rgba(157,140,207,.15) 90%,
        transparent 100%
      );
    }
    
    @media (max-width: 860px){
      .hero{
        padding-top: calc(var(--nav-height) + var(--space-4));
        justify-content: flex-start;
      }
      .hero::before{ display: none; }
    }
    
    .hero-kicker{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--purple-bright);
      display:flex;
      align-items:center;
      gap:14px;
    }
    .hero-kicker::before{
      content:"";
      width:var(--space-4);
      height:1px;
      background: var(--purple-bright);
      opacity:.95;
    }
    
    h1{
      font-family: var(--serif);
      font-size: clamp(44px, 7vw, 92px);
      font-weight: 200;
      line-height: .95;
      margin: 0;
      letter-spacing: -0.04em;
    }
    h1 .accent{
      font-style: italic;
      color: var(--purple-bright);
      position: relative;
      text-shadow: 
        -1px 0 rgba(255,100,100,0.08), 
        1px 0 rgba(100,255,255,0.08),
        0 0 20px var(--purple-glow);
    }
    
    /* Hero stamp line */
    .hero-stamp{
      width: 60px;
      height: 1px;
      background: var(--purple-bright);
      opacity: .15;
      margin: var(--space-1) 0;
    }
    
    .hero-notice{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
      color: var(--purple-bright);
      border: 1px solid rgba(157,140,207,.22);
      background: rgba(91,75,138,.05);
      padding: 8px 12px;
      border-radius: 8px;
      width: fit-content;
      margin: var(--space-1) 0 var(--space-2);
    }
    
    .hero-desc{
      max-width: 62ch;
      font-size: 18px;
      font-weight: 200;
      line-height: 1.75;
      color: var(--text-secondary);
      border-left: 2px solid rgba(91,75,138,.65);
      padding-left: var(--space-2);
      margin: 0;
    }
    
    .hero-disclaimer{
      font-size: 11px;
      color: var(--text-tertiary);
      font-weight: 200;
      font-family: var(--mono);
      letter-spacing: 0.5px;
      margin: 0;
      line-height: 1.7;
    }
    .hero-disclaimer + .hero-disclaimer{
      margin-top: 6px;
    }
    
    .hero-subline{
      font-size: 15px;
      color: var(--text-secondary);
      font-weight: 200;
      margin: var(--space-1) 0 0;
    }

    .hero-actions{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: var(--space-1);
    }
    
    .hero-footnote{
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-tertiary);
      letter-spacing: 1px;
      margin-top: var(--space-2);
    }
    
    @media (max-width: 600px){
      h1{ font-weight: 300; line-height: 1.0; }
    }
    
    /* ============================================
       BUTTONS
       ============================================ */
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: transparent;
      color: var(--text-primary);
      padding: 14px 18px;
      border-radius: 14px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .2s var(--ease), border-color .2s ease, background .2s ease;
      position: relative;
      overflow:hidden;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.28);
      background: rgba(255,255,255,.04);
      text-decoration: none;
    }
    .btn.primary{
      border-color: rgba(157,140,207,.55);
      background: rgba(91,75,138,.18);
      box-shadow: 0 18px 50px rgba(0,0,0,.30);
    }
    .btn.primary:hover{
      border-color: rgba(157,140,207,.85);
      background: rgba(91,75,138,.26);
    }

    /* ============================================
       SECTIONS
       ============================================ */
    .section{
      padding: var(--space-10) 0;
      border-top: 1px solid var(--border-glass);
      scroll-margin-top: calc(var(--nav-height) + 24px);
    }
    .section-head{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: var(--space-2);
      flex-wrap: wrap;
      margin-bottom: var(--space-4);
    }
    .section-label{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 5px;
      text-transform: uppercase;
      color: var(--purple-bright);
      display:block;
      margin-bottom: 12px;
    }
    .section-title{
      font-family: var(--serif);
      font-size: clamp(30px, 4vw, 50px);
      font-weight: 200;
      line-height: 1.1;
      margin: 0;
      letter-spacing: -0.03em;
    }
    @media (max-width: 600px){
      .section-title{ font-weight: 300; }
    }
    .section-lead{
      max-width: 70ch;
      color: var(--text-secondary);
      font-weight: 200;
      line-height: 1.85;
      margin: var(--space-2) 0 0;
      font-size: 16px;
    }

    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-3);
      align-items: start;
    }
    @media (max-width: 980px){
      .grid-2{ grid-template-columns: 1fr; }
    }

    /* ============================================
       PANELS
       ============================================ */
    .panel{
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: var(--space-3) 28px;
      backdrop-filter: blur(18px);
      position: relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-20%;
      background: radial-gradient(circle at 20% 20%, rgba(157,140,207,.10), transparent 55%);
      pointer-events:none;
      transform: rotate(-8deg);
      opacity:.8;
    }
    .panel > *{ position: relative; z-index: 1; }

    .panel h3{
      margin: 0 0 14px;
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.85);
    }
    .panel p{
      margin: 0 0 var(--space-2);
      color: var(--text-secondary);
      font-weight: 200;
      line-height: 1.85;
    }
    
    .panel-note{
      font-size: 12px;
      color: var(--text-tertiary);
      font-weight: 400;
      font-family: var(--mono);
      letter-spacing: 0.5px;
      margin-bottom: 14px;
    }
    .panel-detail{
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 200;
      margin-bottom: 8px;
    }
    .panel-fine{
      font-size: 11px;
      color: var(--text-tertiary);
      font-weight: 200;
      margin-bottom: 14px;
    }
    
    .list{
      list-style: none;
      padding: 0;
      margin: 0;
      border-top: 1px solid var(--border-glass);
    }
    .list li{
      padding: 12px 0;
      border-bottom: 1px solid var(--border-glass);
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
    }
    .list li:last-child{ border-bottom:none; }
    .list b{ color: var(--text-primary); font-weight: 600; }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.82);
      width: fit-content;
    }

    /* Document download links */
    .doc-links {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .doc-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(91, 75, 138, 0.15);
      border: 1px solid rgba(157, 140, 207, 0.25);
      border-radius: 4px;
      color: var(--purple-bright);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.5px;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    .doc-link:hover {
      background: rgba(91, 75, 138, 0.3);
      border-color: rgba(157, 140, 207, 0.5);
      color: #fff;
      text-decoration: none;
    }
    .doc-icon {
      padding: 2px 5px;
      background: rgba(157, 140, 207, 0.2);
      border-radius: 2px;
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 1px;
    }
    .tag .dot{
      width:6px;height:6px;border-radius:50%;
      background: var(--accent-green);
      box-shadow: 0 0 0 6px rgba(92,214,133,.10);
    }

    /* ============================================
       CRITERIA CHECKLIST
       ============================================ */
    .checklist{
      display:grid;
      gap: 12px;
      margin-top: var(--space-2);
    }
    .check{
      display:flex;
      gap: 12px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.025);
      align-items:flex-start;
    }
    .check svg{ flex:0 0 auto; margin-top: 2px; }
    .check-title{
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 2px;
    }
    .check-desc{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 200;
    }

    /* ============================================
       MECHANISM NODES
       ============================================ */
    .mechanism{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-1);
    }
    @media (max-width: 980px){
      .mechanism{ grid-template-columns: 1fr; }
    }
    .node{
      border: 1px solid var(--border-glass);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 28px 22px;
      position: relative;
      overflow:hidden;
      min-height: 165px;
    }
    .node::before{
      content:"";
      position:absolute;
      inset:-30%;
      background: radial-gradient(circle at 30% 20%, rgba(157,140,207,.08), transparent 55%);
      opacity:.85;
      pointer-events:none;
    }
    .node > *{ position: relative; z-index: 1; }
    .node-num{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 4px;
      color: var(--purple-bright);
      text-transform: uppercase;
      margin-bottom: 12px;
    }
    .node-title{
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 200;
      margin: 0 0 var(--space-1);
      letter-spacing: -0.02em;
    }
    @media (max-width: 600px){
      .node-title{ font-weight: 300; }
    }
    .node-desc{
      color: var(--text-tertiary);
      line-height: 1.65;
      font-size: 13px;
      font-weight: 200;
      margin: 0;
    }

    /* ============================================
       RECORD BLOCK
       ============================================ */
    .record{
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      overflow:hidden;
    }
    .record-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: var(--space-2) 18px;
      background: rgba(91,75,138,.12);
      border-bottom: 1px solid rgba(255,255,255,.10);
      gap: 12px;
      flex-wrap: wrap;
    }
    .record-title{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.88);
    }
    .record-status{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(92,214,133,.92);
      border: 1px solid rgba(92,214,133,.20);
      background: rgba(92,214,133,.06);
      padding: 6px 10px;
      border-radius: 999px;
      display:flex; align-items:center; gap: 8px;
    }
    .record-status .s-dot{
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--accent-green);
    }
    .record-status.illustrative{
      color: rgba(214,160,92,.95);
      border-color: rgba(214,160,92,.25);
      background: rgba(214,160,92,.08);
    }
    .record-status.illustrative .s-dot{
      background: var(--accent-amber);
    }
    .record-head-right{
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }
    .verify-link{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--purple-bright);
      border: 1px solid rgba(157,140,207,.35);
      background: rgba(91,75,138,.08);
      padding: 6px 10px;
      border-radius: 6px;
      transition: all .2s ease;
    }
    .verify-link:hover{
      border-color: rgba(157,140,207,.55);
      background: rgba(91,75,138,.15);
      text-decoration: none;
    }
    .record-body{
      padding: 18px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.86);
    }
    .kv{
      display:grid;
      grid-template-columns: 150px 1fr;
      gap: 12px;
      padding: var(--space-1) 0;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .kv:last-child{ border-bottom:none; }
    .k{
      color: rgba(255,255,255,.42);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .v{
      color: rgba(255,255,255,.90);
      word-break: break-word;
    }
    .hash-row{
      display:flex;
      align-items:center;
      gap:var(--space-1);
    }
    .copy-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.65);
      padding:4px 8px;
      border-radius:6px;
      font-family:var(--mono);
      font-size:9px;
      letter-spacing:1px;
      text-transform:uppercase;
      cursor:pointer;
      transition:all .2s ease;
    }
    .copy-btn:hover{
      border-color:rgba(157,140,207,.55);
      background:rgba(91,75,138,.18);
      color:rgba(255,255,255,.90);
    }
    .copy-btn.copied{
      border-color:rgba(92,214,133,.35);
      background:rgba(92,214,133,.12);
      color:rgba(92,214,133,.95);
    }
    .record-note{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.62);
      font-size: 11.5px;
      line-height: 1.7;
      font-weight: 200;
      font-family: var(--sans);
    }
    
    /* Copy toast */
    .copy-toast{
      position: fixed;
      bottom: var(--space-3);
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(92,214,133,.12);
      border: 1px solid rgba(92,214,133,.35);
      color: rgba(92,214,133,.95);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 12px 18px;
      border-radius: 10px;
      backdrop-filter: blur(12px);
      opacity: 0;
      transition: opacity .18s ease, transform .18s var(--ease-out);
      pointer-events: none;
      z-index: 100;
    }
    .copy-toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ============================================
       STATES
       ============================================ */
    .states{
      display:grid;
      gap: var(--space-1);
      margin-top: var(--space-2);
    }
    .state{
      padding: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      align-items:flex-start;
    }
    .state-left{
      display:flex; flex-direction: column; gap: 2px;
    }
    .state-name{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: rgba(255,255,255,.86);
    }
    .state-desc{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 200;
      margin:0;
    }
    .badge{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.80);
      white-space: nowrap;
    }
    .badge.green{ border-color: rgba(92,214,133,.22); color: rgba(92,214,133,.90); background: rgba(92,214,133,.06); }
    .badge.amber{ border-color: rgba(214,160,92,.22); color: rgba(214,160,92,.95); background: rgba(214,160,92,.06); }
    .badge.red{ border-color: rgba(214,92,92,.22); color: rgba(214,92,92,.95); background: rgba(214,92,92,.06); }

    /* ============================================
       ENFORCEMENT DIAGRAM
       ============================================ */
    .diagram-container{
      display:flex;
      flex-direction: column;
      align-items: center;
      margin: var(--space-3) 0 var(--space-5);
    }
    .enforcement-diagram{
      max-width: 400px;
      width: 100%;
      height: auto;
    }
    .diagram-caption{
      font-size: 11px;
      color: var(--text-tertiary);
      text-align: center;
      margin-top: var(--space-2);
      font-family: var(--mono);
      letter-spacing: 0.5px;
    }
    
    /* Subtle interlock pulse */
    @keyframes interlock-pulse {
      0%, 100% { 
        stroke: rgba(157,140,207,0.65);
        filter: drop-shadow(0 0 0 rgba(157,140,207,0));
      }
      50% { 
        stroke: rgba(157,140,207,0.85);
        filter: drop-shadow(0 0 8px rgba(157,140,207,0.25));
      }
    }
    .interlock-bg{
      animation: interlock-pulse 3s ease-in-out infinite;
    }
    
    @media (prefers-reduced-motion: reduce){
      .interlock-bg{ animation: none; }
    }
    
    /* ============================================
       CONTACT
       ============================================ */
    /* Process Timeline */
    .process-timeline{ display: flex; flex-direction: column; gap: 0; }
    .process-step{ display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border-glass); }
    .process-step:last-child{ border-bottom: none; }
    .process-step-num{ 
      width: 28px; height: 28px; flex-shrink: 0;
      background: rgba(91,75,138,.18); border: 1px solid rgba(157,140,207,.35);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-size: 11px; color: var(--purple-bright);
    }
    .process-step-content b{ display: block; margin-bottom: 4px; }
    .process-step-content p{ color: var(--text-secondary); font-size: 13px; line-height: 1.6; margin: 0; }

    .contact-card{
      max-width: 540px;
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: 8px 0;
      backdrop-filter: blur(18px);
    }
    .contact-row{
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 28px;
      border-bottom: 1px solid var(--border-glass);
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .contact-row:last-child{ border-bottom: none; }
    .contact-label{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-tertiary);
    }
    .contact-link{
      font-family: var(--sans);
      font-size: 14px;
      color: var(--purple-bright);
      transition: color .2s ease;
    }
    .contact-link:hover{
      color: var(--text-primary);
      text-decoration: none;
    }

    /* ============================================
       DEFINITION CALLOUT
       ============================================ */
    .definition-callout{
      background: rgba(91,75,138,.08);
      border: 1px solid rgba(157,140,207,.25);
      border-radius: 12px;
      padding: var(--space-2) 18px;
      margin-top: var(--space-2);
    }
    .definition-term{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--purple-bright);
      margin-bottom: 6px;
    }
    .definition-text{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.65;
      font-weight: 200;
      margin: 0;
    }
    
    /* ============================================
       PROGRAM IDENTITY
       ============================================ */
    .program-grid{
      display: grid;
      gap: 8px;
      font-size: 13px;
    }
    .program-row{
      display: flex;
      justify-content: space-between;
      gap: var(--space-2);
      flex-wrap: wrap;
      padding: 6px 0;
      border-bottom: 1px solid var(--border-glass);
    }
    .program-row:last-child{ border-bottom: none; }
    .program-label{
      color: var(--text-tertiary);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .program-value{
      color: var(--text-primary);
    }
    .program-value.amber{
      color: var(--accent-amber);
    }
    .program-value a{
      color: var(--purple-bright);
    }
    
    /* ============================================
       FOOTER
       ============================================ */
    footer{
      border-top: 1px solid var(--border-glass);
      padding: var(--space-6) 0 var(--space-4);
      margin-top: var(--space-4);
      color: rgba(255,255,255,.45);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
    }
    .footer-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--space-2);
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .footer-spec{
      margin-top: 8px;
      color: rgba(255,255,255,.38);
      font-size: 9px;
      letter-spacing: 1px;
    }
    .footer-disclaimer{
      margin-top: 12px;
      color: rgba(255,255,255,.42);
      font-size: 10px;
      max-width: 480px;
      line-height: 1.7;
    }
    .foot-links{ display:flex; gap: var(--space-4); flex-wrap: wrap; }
    .foot-col{ display:flex; flex-direction:column; gap:8px; min-width:120px; }
    .foot-col-title{ font-family:var(--mono); font-size:9px; letter-spacing:2px; color:var(--purple-bright); margin-bottom:4px; }
    .foot-links a{ color: rgba(255,255,255,.48); font-size:13px; }
    .foot-links a:hover{ color: rgba(255,255,255,.82); text-decoration:none; }
    .old-foot-links{
      display:flex; gap: var(--space-2); flex-wrap: wrap;
    }
    .foot-links a{ color: rgba(255,255,255,.48); }
    .foot-links a:hover{ color: rgba(255,255,255,.82); text-decoration:none; }

    /* ============================================
       REVEAL ANIMATION
       ============================================ */
    .reveal{ 
      opacity: 0; 
      transform: translateY(var(--space-3)); 
      transition: opacity .9s var(--ease), transform .9s var(--ease); 
    }
    .reveal.active{ opacity: 1; transform: translateY(0); }
    
    @media (prefers-reduced-motion: reduce){
      .reveal{ opacity: 1; transform: none; transition: none; }
    }

    /* Download Modal */
    .download-modal{
      display: none;
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(6px);
      align-items: center;
      justify-content: center;
      padding: var(--space-2);
    }
    .download-modal.open{ display: flex; }
    .download-modal-card{
      background: var(--bg-deep);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: var(--space-3);
      max-width: 420px;
      width: 100%;
      position: relative;
    }
    .download-modal-close{
      position: absolute;
      top: 14px;
      right: 14px;
      appearance: none;
      border: none;
      background: none;
      color: var(--text-tertiary);
      font-size: 24px;
      cursor: pointer;
      line-height: 1;
    }
    .download-modal-close:hover{ color: var(--text-primary); }
    .download-modal-card h3{
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 200;
      margin: 0 0 8px;
    }
    .download-modal-card > p{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.7;
      margin: 0 0 var(--space-2);
    }
    .download-form-group{ margin-bottom: 14px; }
    .download-form-label{
      display: block;
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-tertiary);
      margin-bottom: 6px;
    }
    .download-form-input, .download-form-select{
      width: 100%;
      padding: 12px 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border-glass);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: var(--sans);
      font-size: 14px;
    }
    .download-form-input:focus, .download-form-select:focus{
      outline: none;
      border-color: rgba(157,140,207,.55);
    }
    .download-form-select{
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }
    .download-form-btn{
      appearance: none;
      width: 100%;
      border: 1px solid rgba(157,140,207,.55);
      background: rgba(91,75,138,.18);
      color: var(--text-primary);
      padding: 14px 24px;
      border-radius: 12px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .2s var(--ease), border-color .2s ease, background .2s ease;
    }
    .download-form-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(157,140,207,.85);
      background: rgba(91,75,138,.26);
    }
    .download-form-fine{
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: var(--space-2);
      line-height: 1.6;
      text-align: center;
    }

    .scenario{background:var(--bg-panel);border:1px solid var(--border-glass);border-radius:18px;padding:var(--space-3);margin-bottom:var(--space-3)}
    .scenario h2{font-family:var(--serif);font-size:26px;font-weight:200;margin:0 0 var(--space-2)}
    .scenario p{color:var(--text-secondary);font-size:15px;line-height:1.75;margin:0 0 var(--space-2)}
    .scenario h4{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary);margin:var(--space-2) 0 var(--space-1)}
    .scenario ul{margin:0;padding-left:20px;color:var(--text-secondary);font-size:14px;line-height:1.8}
    .scenario-download{display:inline-block;margin-top:var(--space-2);padding:12px 20px;background:rgba(91,75,138,.18);border:1px solid rgba(157,140,207,.55);border-radius:10px;color:var(--text-primary);font-family:var(--mono);font-size:11px;letter-spacing:1px;text-decoration:none;cursor:pointer;transition:transform .2s ease,border-color .2s ease,background .2s ease}
    .scenario-download:hover{transform:translateY(-1px);border-color:rgba(157,140,207,.85);background:rgba(91,75,138,.26);text-decoration:none}
    @keyframes eye-pulse {
      0%, 100% {
        opacity: .75;
        transform: scale(.98);
        box-shadow: 0 0 0 rgba(196,184,232,0);
      }
      50% {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 10px rgba(157,140,207,.22);
      }
    @media (prefers-reduced-motion: reduce){
      .brand-mark-inner{ animation: none; opacity: .9; }
  
  </style>
</head>
<body>
  <!-- Grid overlay -->
  <div class="grid-overlay" aria-hidden="true"></div>
  
  <!-- Site header -->
  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark" aria-hidden="true">
          <div class="brand-mark-inner"></div>
        </div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">← Back to Home</a>
    </div>
  </header>

  <main style="position: relative; z-index: 1; max-width: var(--max, 1200px); margin: 0 auto; padding: calc(var(--nav-height, 72px) + 60px) var(--space-2, 20px) 60px;">
    <div class="page-header reveal">
      <div class="page-kicker">ODDC Conformance Scenarios</div>
      <h1 class="page-title">Industry Applications</h1>
      <p class="page-desc">Representative scenarios illustrating how ODDC conformance with ENVELO-compliant enforcement applies across industries. These examples are illustrative and non-normative.</p>
    </div>

    <div class="tiles-header reveal">Representative Scenarios — Conformance by Industry</div>
    <div class="tiles reveal">
      <a href="#datacenters" class="tile"><h3>Data Centers & Hyperscale Computing</h3><span>View scenario →</span></a>
      <a href="#vehicles" class="tile"><h3>Autonomous Vehicles</h3><span>View scenario →</span></a>
      <a href="#healthcare" class="tile"><h3>Healthcare & Medical AI</h3><span>View scenario →</span></a>
      <a href="#finance" class="tile"><h3>Financial Services & Trading</h3><span>View scenario →</span></a>
      <a href="#manufacturing" class="tile"><h3>Industrial Manufacturing</h3><span>View scenario →</span></a>
      <a href="#aerospace" class="tile"><h3>Aerospace & Defense</h3><span>View scenario →</span></a>
    </div>

    <section id="datacenters" class="scenario reveal">
      <h2>Data Centers & Hyperscale Computing</h2>
      <p>Hyperscale environments increasingly rely on autonomous systems to allocate power, optimize cooling, place workloads, and orchestrate AI-on-AI stacks. ODDC conformance scenarios illustrate facility-level and stack-level envelope boundaries (power draw, thermal ceilings, isolation requirements, recursion limits), enforced via ENVELO-compliant non-bypassable runtime interlocks.</p>
      <h4>Representative interlock behavior (modeled)</h4>
      <ul>
        <li>Hard-cap interlocks on CPU throttling to prevent TDP overruns during load spikes</li>
        <li>Automatic workload shedding to non-critical queues as facility power approaches envelope limits</li>
        <li>Maximum recursion depth for AI managing AI without human checkpoint</li>
      </ul>
      <h4>Evidence outputs</h4>
      <ul>
        <li>Append-only envelope adherence logs</li>
        <li>Cryptographic attestations suitable for underwriting review and incident reconstruction</li>
      </ul>
      <a href="#" class="scenario-download" onclick="openModal(); return false;">↓ Download Full ODDC Scenarios PDF</a>
    </section>

    <section id="vehicles" class="scenario reveal">
      <h2>Autonomous Vehicles</h2>
      <p>ODDC conformance scenarios illustrate mathematically specified authorization parameters governing vehicle behavior across conditions (zone speed ceilings, confidence thresholds, weather degradation protocols, emergency override rules), with ENVELO-compliant enforcement preventing boundary violations regardless of model intent.</p>
      <h4>Representative interlock behavior (modeled)</h4>
      <ul>
        <li>Non-bypassable speed interlock tied to zone authorization</li>
        <li>Mandatory stop/slowdown when detection confidence falls below envelope threshold</li>
        <li>Weather-tier degradation limits on velocity and acceleration</li>
      </ul>
      <h4>Evidence outputs</h4>
      <ul>
        <li>Cryptographic, time-indexed record of envelope compliance and override triggers</li>
      </ul>
      <a href="#" class="scenario-download" onclick="openModal(); return false;">↓ Download Full ODDC Scenarios PDF</a>
    </section>

    <section id="healthcare" class="scenario reveal">
      <h2>Healthcare & Medical AI</h2>
      <p>Medical AI operates in life-critical environments where auditability and bounded autonomy are required. ODDC conformance scenarios illustrate operational boundaries for diagnostic recommendations and clinical interventions, including mandatory human checkpoints for high-impact actions, with ENVELO-compliant enforcement present and auditable.</p>
      <h4>Representative interlock behavior (modeled)</h4>
      <ul>
        <li>Mandatory confirmation interlock for Stage 3+ interventions</li>
        <li>Hard deviation thresholds on surgical trajectories or procedure assistance</li>
        <li>Automatic escalation on anomalous vital signs beyond envelope thresholds</li>
      </ul>
      <h4>Evidence outputs</h4>
      <ul>
        <li>Append-only clinical decision trace aligned to audit requirements (separate from regulatory approval)</li>
      </ul>
      <a href="#" class="scenario-download" onclick="openModal(); return false;">↓ Download Full ODDC Scenarios PDF</a>
    </section>

    <section id="finance" class="scenario reveal">
      <h2>Financial Services & Trading</h2>
      <p>High-frequency automated decision systems can create cascading failures if limits are bypassable. ODDC conformance scenarios illustrate quantifiable risk envelopes (position concentration, volatility deviation thresholds, drawdown caps) enforced independently of the trading algorithms via ENVELO-compliant mechanisms.</p>
      <h4>Representative interlock behavior (modeled)</h4>
      <ul>
        <li>Volatility-triggered circuit breaker disconnecting order submission channels</li>
        <li>Real-time enforcement of position limits and concentration thresholds</li>
        <li>Mandatory review triggers on envelope-defined drawdown events</li>
      </ul>
      <h4>Evidence outputs</h4>
      <ul>
        <li>Cryptographic attestation of order gating and circuit-breaker events</li>
      </ul>
      <a href="#" class="scenario-download" onclick="openModal(); return false;">↓ Download Full ODDC Scenarios PDF</a>
    </section>

    <section id="manufacturing" class="scenario reveal">
      <h2>Industrial Manufacturing</h2>
      <p>Autonomous robotics and AI-driven production systems operate alongside humans in hazardous environments. ODDC conformance scenarios illustrate safety envelopes for force output, proximity response, speed reduction zones, and anomaly thresholds with ENVELO-compliant isolated enforcement mechanisms.</p>
      <h4>Representative interlock behavior (modeled)</h4>
      <ul>
        <li>Proximity-triggered force limiters and full-stop thresholds</li>
        <li>Non-bypassable caps on actuator torque or force output</li>
        <li>Independent enforcement layer separated from control logic</li>
      </ul>
      <h4>Evidence outputs</h4>
      <ul>
        <li>Audit-ready boundary adherence record supporting incident review and safety assurance</li>
      </ul>
      <a href="#" class="scenario-download" onclick="openModal(); return false;">↓ Download Full ODDC Scenarios PDF</a>
    </section>

    <section id="aerospace" class="scenario reveal">
      <h2>Aerospace & Defense</h2>
      <p>Autonomous aircraft and mission systems require strict operational certainty. ODDC conformance scenarios illustrate mission envelopes (geofencing, altitude ceilings, comm-loss protocols, payload authorization levels) with ENVELO-compliant chain-of-custody enforcement.</p>
      <h4>Representative interlock behavior (modeled)</h4>
      <ul>
        <li>Geofence-triggered return-to-base initiation</li>
        <li>Mandatory RTB after defined comm-loss duration</li>
        <li>Multi-party cryptographic release for payload authorization</li>
      </ul>
      <h4>Evidence outputs</h4>
      <ul>
        <li>Cryptographically signed compliance logs for post-mission audit</li>
      </ul>
      <a href="#" class="scenario-download" onclick="openModal(); return false;">↓ Download Full ODDC Scenarios PDF</a>
    </section>
  </main>

  <!-- Footer -->
  <footer style="margin-top: var(--space-8, 80px); padding: var(--space-4, 40px) var(--space-2, 20px); border-top: 1px solid var(--border-glass, rgba(255,255,255,.10)); text-align: center;">
    <div style="max-width: var(--max, 1200px); margin: 0 auto;">
      <div style="font-family: var(--mono, 'IBM Plex Mono', monospace); font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-tertiary, rgba(255,255,255,.50));">
        © <span id="footer-year"></span> SENTINEL AUTHORITY
      </div>
      <div style="margin-top: 16px; display: flex; justify-content: center; gap: 24px; flex-wrap: wrap; font-family: var(--mono, 'IBM Plex Mono', monospace); font-size: 10px; letter-spacing: 1px;">
        <a href="privacy.html" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Privacy</a>
        <a href="terms.html" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Terms</a>
        <a href="index.html#artifacts" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Documents</a>
        <a href="conformance-agreement.html" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Conformance</a>
      </div>
    </div>
  </footer>
  <script>document.getElementById("footer-year").textContent = new Date().getFullYear();</script>
  <script>
document.getElementById("year").textContent = new Date().getFullYear();

    const modal = document.getElementById('downloadModal');

    function openModal() {
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('open')) closeModal();
    });

    function handleSubmit(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      
      fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        closeModal();
        window.open('docs/ODDC_Scenarios_v1.0.pdf', '_blank');
        form.reset();
      })
      .catch(error => {
        console.error('Form error:', error);
        closeModal();
        window.open('docs/ODDC_Scenarios_v1.0.pdf', '_blank');
        form.reset();
      });
    }

    // Reveal on scroll
    function checkReveal() {
      document.querySelectorAll('.reveal').forEach(el => {
        const rect = el.getBoundingClientRect();
        if (rect.top < window.innerHeight - 60) {
          el.classList.add('active');
        }
      });
    }
    window.addEventListener('scroll', checkReveal, { passive: true });
    window.addEventListener('load', checkReveal);
    checkReveal();
  </script>
</body>
</html>
</file>

<file path="website/terms.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Terms of Service — Sentinel Authority</title>
  <meta name="description" content="Terms of Service for Sentinel Authority ODDC conformance services." />
  <link rel="canonical" href="https://sentinelauthority.org/terms.html" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root{
      color-scheme:dark;
      --purple-primary:#5B4B8A;--purple-bright:#9d8ccf;
      --bg-deep:#2a2f3d;--bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;--accent-amber:#D6A05C;--accent-red:#D65C5C;
      --text-primary:rgba(255,255,255,.94);--text-secondary:rgba(255,255,255,.75);--text-tertiary:rgba(255,255,255,.50);
      --border-glass:rgba(255,255,255,.10);--border-subtle:rgba(255,255,255,.06);
      --serif:'Source Serif 4',serif;--mono:'IBM Plex Mono',monospace;--sans:'Inter',system-ui,-apple-system,sans-serif;
      --space-1:10px;--space-2:20px;--space-3:30px;--space-4:40px;--space-6:60px;--space-8:80px;
      --max:900px;--nav-height:72px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth;background:var(--bg-deep)}
    body{margin:0;font-family:var(--sans);background:radial-gradient(ellipse at 20% 0%,rgba(91,75,138,.15) 0%,transparent 50%),var(--bg-deep);color:var(--text-primary);-webkit-font-smoothing:antialiased;min-height:100vh;line-height:1.7}
    a{color:var(--purple-bright);text-decoration:none}a:hover{text-decoration:underline}
    ::selection{background:var(--purple-primary);color:#fff}
    
    .grid-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background-image:linear-gradient(rgba(255,255,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.03) 1px,transparent 1px);background-size:60px 60px;opacity:.3}
    
    .site-header{position:fixed;top:0;width:100%;z-index:50;padding:0 var(--space-2);height:var(--nav-height);border-bottom:1px solid rgba(255,255,255,.08);background:rgba(42,47,61,.85);backdrop-filter:blur(20px);display:flex;align-items:center}
    .nav-inner{max-width:1200px;margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:var(--space-1);text-decoration:none}.brand:hover{text-decoration:none}
    .brand-mark{width:24px;height:24px;background:var(--purple-primary);border:2px solid var(--purple-bright);border-radius:6px;display:flex;align-items:center;justify-content:center}
    .brand-mark-inner{width:8px;height:8px;background:#c4b8e8;border-radius:50%;animation:pulse 3s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.7;transform:scale(.95)}50%{opacity:1;transform:scale(1.05)}}
    .brand-name{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.86)}
    .back-link{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary);text-decoration:none;display:flex;align-items:center;gap:8px;transition:color .2s}.back-link:hover{color:var(--text-primary);text-decoration:none}
    
    main{position:relative;z-index:1;max-width:var(--max);margin:0 auto;padding:calc(var(--nav-height) + 60px) var(--space-2) 80px}
    
    .page-hero{margin-bottom:var(--space-6);padding-bottom:var(--space-4);border-bottom:1px solid var(--border-glass)}
    .page-label{font-family:var(--mono);font-size:10px;letter-spacing:5px;text-transform:uppercase;color:var(--purple-bright);display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .page-label::before{content:'';width:40px;height:1px;background:var(--purple-bright)}
    .page-title{font-family:var(--serif);font-size:clamp(36px,5vw,52px);font-weight:200;line-height:1.1;margin:0 0 16px}
    .page-meta{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .effective{font-family:var(--mono);font-size:11px;color:var(--text-tertiary);padding:8px 14px;background:rgba(255,255,255,.03);border:1px solid var(--border-subtle);border-radius:8px}
    .page-intro{font-size:17px;color:var(--text-secondary);max-width:65ch;margin-top:var(--space-2)}
    
    .content-section{margin-bottom:var(--space-4)}
    .content-section h2{font-family:var(--serif);font-size:22px;font-weight:300;margin:0 0 var(--space-2);padding-top:var(--space-2);display:flex;align-items:center;gap:12px}
    .content-section h2 .num{font-family:var(--mono);font-size:11px;color:var(--purple-bright);letter-spacing:1px}
    .content-section p{color:var(--text-secondary);margin:0 0 var(--space-2);font-size:15px}
    .content-section strong{color:var(--text-primary)}
    
    .info-card{background:rgba(255,255,255,.03);border:1px solid var(--border-glass);border-radius:14px;padding:20px 24px;margin:var(--space-2) 0}
    .info-card ul{margin:0;padding:0 0 0 20px;color:var(--text-secondary)}
    .info-card li{margin-bottom:10px;font-size:14px}
    .info-card li:last-child{margin-bottom:0}
    
    .warning-box{background:linear-gradient(135deg,rgba(214,160,92,.12) 0%,rgba(214,160,92,.03) 100%);border:1px solid rgba(214,160,92,.3);border-radius:14px;padding:24px;margin:var(--space-3) 0}
    .warning-box h3{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--accent-amber);margin:0 0 12px;display:flex;align-items:center;gap:10px}
    .warning-box h3::before{content:'⚠';font-size:14px}
    .warning-box p{color:var(--text-secondary);margin:0;font-size:14px;line-height:1.7}
    .warning-box strong{color:rgba(214,160,92,.95)}
    
    .highlight-box{background:linear-gradient(135deg,rgba(214,92,92,.08) 0%,rgba(214,92,92,.02) 100%);border:1px solid rgba(214,92,92,.25);border-radius:14px;padding:24px;margin:var(--space-3) 0}
    .highlight-box h3{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--accent-red);margin:0 0 12px}
    .highlight-box p{color:var(--text-secondary);margin:0;font-size:14px;line-height:1.7}
    .highlight-box strong{color:rgba(214,92,92,.95)}
    
    .contact-card{background:linear-gradient(135deg,rgba(157,140,207,.1) 0%,rgba(157,140,207,.03) 100%);border:1px solid rgba(157,140,207,.25);border-radius:16px;padding:24px;margin-top:var(--space-4);display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .contact-icon{width:48px;height:48px;background:rgba(157,140,207,.15);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .contact-content{flex:1;min-width:200px}
    .contact-title{font-size:15px;color:var(--text-primary);margin-bottom:4px}
    .contact-desc{font-size:13px;color:var(--text-tertiary)}
    .contact-link{font-family:var(--mono);font-size:11px;letter-spacing:1px;color:var(--purple-bright);padding:10px 18px;border:1px solid rgba(157,140,207,.4);border-radius:8px;text-decoration:none;transition:all .2s;white-space:nowrap}
    .contact-link:hover{background:rgba(157,140,207,.1);border-color:rgba(157,140,207,.6);text-decoration:none}
    
    /* TOC */
    .toc{background:rgba(255,255,255,.02);border:1px solid var(--border-glass);border-radius:14px;padding:20px 24px;margin-bottom:var(--space-4)}
    .toc-title{font-family:var(--mono);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--text-tertiary);margin-bottom:12px}
    .toc-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px 20px;margin:0;padding:0;list-style:none}
    .toc-list a{font-size:13px;color:var(--text-secondary);display:flex;align-items:center;gap:8px;padding:6px 0;transition:color .2s}
    .toc-list a:hover{color:var(--text-primary);text-decoration:none}
    .toc-list .num{font-family:var(--mono);font-size:10px;color:var(--purple-bright)}
    
    footer{margin-top:var(--space-8);padding:var(--space-4) var(--space-2);border-top:1px solid var(--border-glass);text-align:center}
    .footer-copy{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary)}
    .footer-links{margin-top:16px;display:flex;justify-content:center;gap:24px;flex-wrap:wrap}
    .footer-links a{font-family:var(--mono);font-size:10px;letter-spacing:1px;color:var(--text-tertiary);text-decoration:none}.footer-links a:hover{color:var(--text-primary)}
  </style>
</head>
<body>
  <div class="grid-overlay" aria-hidden="true"></div>
  
  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark"><div class="brand-mark-inner"></div></div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back
      </a>
    </div>
  </header>

  <main>
    <div class="page-hero">
      <div class="page-label">Legal</div>
      <h1 class="page-title">Terms of Service</h1>
      <div class="page-meta">
        <div class="effective">Effective: January 2026</div>
      </div>
      <p class="page-intro">
        These Terms govern your use of the Sentinel Authority website, certification portal, and related services. By accessing or using our Services, you agree to these Terms.
      </p>
    </div>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul class="toc-list">
        <li><a href="#services"><span class="num">01</span> Services Description</a></li>
        <li><a href="#account"><span class="num">02</span> Account Registration</a></li>
        <li><a href="#applications"><span class="num">03</span> Certification Applications</a></li>
        <li><a href="#fees"><span class="num">04</span> Fees and Payment</a></li>
        <li><a href="#license"><span class="num">05</span> ENVELO Agent License</a></li>
        <li><a href="#liability"><span class="num">06</span> Limitation of Liability</a></li>
        <li><a href="#indemnification"><span class="num">07</span> Indemnification</a></li>
        <li><a href="#confidentiality"><span class="num">08</span> Confidentiality</a></li>
        <li><a href="#revocation"><span class="num">09</span> Revocation</a></li>
        <li><a href="#termination"><span class="num">10</span> Termination</a></li>
        <li><a href="#modifications"><span class="num">11</span> Modifications</a></li>
        <li><a href="#governing"><span class="num">12</span> Governing Law</a></li>
      </ul>
    </div>

    <div id="services" class="content-section">
      <h2><span class="num">01</span> Services Description</h2>
      <p>Sentinel Authority provides ODD Conformance Determination (ODDC) services for autonomous systems:</p>
      <div class="info-card">
        <ul>
          <li>Application review and scope assessment</li>
          <li>CAT-72 conformance testing</li>
          <li>ODDC certificate issuance</li>
          <li>ENVELO Agent software for runtime enforcement</li>
          <li>Certificate verification services</li>
        </ul>
      </div>
    </div>

    <div id="account" class="content-section">
      <h2><span class="num">02</span> Account Registration</h2>
      <p>To access certain Services, you must create an account. You agree to:</p>
      <div class="info-card">
        <ul>
          <li>Provide accurate and complete information</li>
          <li>Maintain the security of your account credentials</li>
          <li>Promptly notify us of any unauthorized access</li>
          <li>Accept responsibility for all activities under your account</li>
        </ul>
      </div>
    </div>

    <div id="applications" class="content-section">
      <h2><span class="num">03</span> Certification Applications</h2>
      <p>By submitting a certification application, you represent that:</p>
      <div class="info-card">
        <ul>
          <li>All information provided is accurate and complete</li>
          <li>You have authority to submit the application on behalf of your organization</li>
          <li>You will cooperate with the certification process</li>
          <li>You understand that incomplete or inaccurate information may result in application denial</li>
        </ul>
      </div>
    </div>

    <div id="fees" class="content-section">
      <h2><span class="num">04</span> Fees and Payment</h2>
      <p>Certification fees are specified during scope assessment. Payment terms:</p>
      <div class="info-card">
        <ul>
          <li>50% due upon documentation submission</li>
          <li>50% due upon conformance determination</li>
          <li>Fees are non-refundable upon failed determination</li>
          <li>Re-attempt fees apply for subsequent certification attempts</li>
        </ul>
      </div>
    </div>

    <div id="license" class="content-section">
      <h2><span class="num">05</span> ENVELO Agent License</h2>
      <p>Subject to these Terms and valid certification, we grant you a limited, non-exclusive, non-transferable license to use the ENVELO Agent software solely for:</p>
      <div class="info-card">
        <ul>
          <li>Systems covered by your ODDC certification</li>
          <li>The duration of your conformance term</li>
        </ul>
      </div>
      <p>You may not reverse engineer, modify, or distribute the ENVELO Agent software.</p>
      
      <div class="highlight-box">
        <h3>Important Limitation</h3>
        <p><strong>ODDC certification does not constitute:</strong> regulatory approval, safety certification (e.g., IEC 61508, ISO 26262), product certification, guarantee of system performance, insurance, or warranty. Operators remain solely responsible for system behavior, regulatory compliance, and all consequences of system operation.</p>
      </div>
    </div>

    <div id="liability" class="content-section">
      <h2><span class="num">06</span> Limitation of Liability</h2>
      <p>To the maximum extent permitted by law:</p>
      <div class="info-card">
        <ul>
          <li>Sentinel Authority's total liability shall not exceed the fees paid for the specific certification at issue</li>
          <li>We are not liable for indirect, incidental, consequential, or punitive damages</li>
          <li>We are not liable for any damages arising from system operation, whether certified or not</li>
        </ul>
      </div>
    </div>

    <div id="indemnification" class="content-section">
      <h2><span class="num">07</span> Indemnification</h2>
      <p>You agree to indemnify and hold harmless Sentinel Authority from any claims, damages, or expenses arising from:</p>
      <div class="info-card">
        <ul>
          <li>Your use of the Services</li>
          <li>Operation of your certified systems</li>
          <li>Violation of these Terms</li>
          <li>Infringement of third-party rights</li>
        </ul>
      </div>
    </div>

    <div id="confidentiality" class="content-section">
      <h2><span class="num">08</span> Confidentiality</h2>
      <p>We will treat your application materials and technical documentation as confidential, except:</p>
      <div class="info-card">
        <ul>
          <li>Certificate information (number, organization, system name, status) is publicly verifiable</li>
          <li>Aggregate, anonymized data may be used for research or reporting</li>
          <li>Disclosure may be required by law or valid legal process</li>
        </ul>
      </div>
    </div>

    <div id="revocation" class="content-section">
      <h2><span class="num">09</span> Revocation</h2>
      <p>We may revoke certification if:</p>
      <div class="warning-box">
        <h3>Grounds for Revocation</h3>
        <p>Information provided was materially false or misleading • System modifications invalidate conformance • ENVELO Agent is disabled, bypassed, or tampered with • Payment obligations are not met • Terms of Service are violated</p>
      </div>
    </div>

    <div id="termination" class="content-section">
      <h2><span class="num">10</span> Termination</h2>
      <p>We may suspend or terminate your access to Services for violation of these Terms. You may close your account at any time, but this does not affect any obligations incurred prior to termination.</p>
    </div>

    <div id="modifications" class="content-section">
      <h2><span class="num">11</span> Modifications</h2>
      <p>We may modify these Terms at any time. We will notify you of material changes. Continued use of Services after changes constitutes acceptance of modified Terms.</p>
    </div>

    <div id="governing" class="content-section">
      <h2><span class="num">12</span> Governing Law</h2>
      <p>These Terms are governed by the laws of the Province of Ontario, Canada. Any disputes shall be resolved in the courts of Ontario, Canada.</p>
      <p style="font-size:13px;color:var(--text-tertiary);margin-top:var(--space-2);">If any provision of these Terms is found unenforceable, the remaining provisions remain in effect.</p>
    </div>

    <div class="contact-card">
      <div class="contact-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.9)" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      </div>
      <div class="contact-content">
        <div class="contact-title">Questions about these terms?</div>
        <div class="contact-desc">Contact our team for clarification.</div>
      </div>
      <a href="mailto:conformance@sentinelauthority.org" class="contact-link">conformance@sentinelauthority.org →</a>
    </div>
  </main>

  <footer>
    <div class="footer-copy">© <span id="yr"></span> Sentinel Authority</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="index.html#artifacts">Documents</a>
      <a href="conformance-agreement.html">Conformance</a>
    </div>
  </footer>
  <script>document.getElementById("yr").textContent=new Date().getFullYear();</script>
</body>
</html>
</file>

<file path="website/conformance-agreement.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Conformance Agreement — Sentinel Authority</title>
  <meta name="description" content="ODDC Conformance Agreement terms and conditions for Sentinel Authority certification." />
  <link rel="canonical" href="https://sentinelauthority.org/conformance-agreement.html" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root{
      color-scheme:dark;
      --purple-primary:#5B4B8A;--purple-bright:#9d8ccf;
      --bg-deep:#2a2f3d;--bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;--accent-amber:#D6A05C;--accent-red:#D65C5C;
      --text-primary:rgba(255,255,255,.94);--text-secondary:rgba(255,255,255,.75);--text-tertiary:rgba(255,255,255,.50);
      --border-glass:rgba(255,255,255,.10);--border-subtle:rgba(255,255,255,.06);
      --serif:'Source Serif 4',serif;--mono:'IBM Plex Mono',monospace;--sans:'Inter',system-ui,-apple-system,sans-serif;
      --space-1:10px;--space-2:20px;--space-3:30px;--space-4:40px;--space-6:60px;--space-8:80px;
      --max:900px;--nav-height:72px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth;background:var(--bg-deep)}
    body{margin:0;font-family:var(--sans);background:radial-gradient(ellipse at 20% 0%,rgba(91,75,138,.15) 0%,transparent 50%),var(--bg-deep);color:var(--text-primary);-webkit-font-smoothing:antialiased;min-height:100vh;line-height:1.7}
    a{color:var(--purple-bright);text-decoration:none}a:hover{text-decoration:underline}
    ::selection{background:var(--purple-primary);color:#fff}
    
    .grid-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background-image:linear-gradient(rgba(255,255,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.03) 1px,transparent 1px);background-size:60px 60px;opacity:.3}
    
    .site-header{position:fixed;top:0;width:100%;z-index:50;padding:0 var(--space-2);height:var(--nav-height);border-bottom:1px solid rgba(255,255,255,.08);background:rgba(42,47,61,.85);backdrop-filter:blur(20px);display:flex;align-items:center}
    .nav-inner{max-width:1200px;margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:var(--space-1);text-decoration:none}.brand:hover{text-decoration:none}
    .brand-mark{width:24px;height:24px;background:var(--purple-primary);border:2px solid var(--purple-bright);border-radius:6px;display:flex;align-items:center;justify-content:center}
    .brand-mark-inner{width:8px;height:8px;background:#c4b8e8;border-radius:50%;animation:pulse 3s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.7;transform:scale(.95)}50%{opacity:1;transform:scale(1.05)}}
    .brand-name{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.86)}
    .back-link{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary);text-decoration:none;display:flex;align-items:center;gap:8px;transition:color .2s}.back-link:hover{color:var(--text-primary);text-decoration:none}
    
    main{position:relative;z-index:1;max-width:var(--max);margin:0 auto;padding:calc(var(--nav-height) + 60px) var(--space-2) 80px}
    
    .page-hero{margin-bottom:var(--space-4);padding-bottom:var(--space-4);border-bottom:1px solid var(--border-glass)}
    .page-label{font-family:var(--mono);font-size:10px;letter-spacing:5px;text-transform:uppercase;color:var(--purple-bright);display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .page-label::before{content:'';width:40px;height:1px;background:var(--purple-bright)}
    .page-title{font-family:var(--serif);font-size:clamp(32px,5vw,48px);font-weight:200;line-height:1.1;margin:0 0 8px}
    .page-subtitle{font-size:15px;color:var(--text-tertiary);margin-bottom:16px}
    .page-meta{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .effective{font-family:var(--mono);font-size:11px;color:var(--text-tertiary);padding:8px 14px;background:rgba(255,255,255,.03);border:1px solid var(--border-subtle);border-radius:8px}
    .page-intro{font-size:16px;color:var(--text-secondary);max-width:65ch;margin-top:var(--space-2);line-height:1.8}
    
    /* Critical box */
    .critical-box{background:linear-gradient(135deg,rgba(214,92,92,.12) 0%,rgba(214,92,92,.03) 100%);border:1px solid rgba(214,92,92,.35);border-radius:16px;padding:24px;margin:var(--space-3) 0}
    .critical-box h3{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--accent-red);margin:0 0 12px;display:flex;align-items:center;gap:10px}
    .critical-box h3::before{content:'⚠';font-size:14px}
    .critical-box p{color:var(--text-secondary);margin:0;font-size:14px;line-height:1.8}
    .critical-box strong{color:rgba(214,92,92,.95)}
    
    /* TOC */
    .toc{background:rgba(255,255,255,.02);border:1px solid var(--border-glass);border-radius:14px;padding:20px 24px;margin-bottom:var(--space-4);position:relative}
    .toc-title{font-family:var(--mono);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--text-tertiary);margin-bottom:12px}
    .toc-list{display:flex;flex-direction:column;gap:6px;margin:0;padding:0;list-style:none}
    .toc-list a{font-size:12px;color:var(--text-secondary);display:flex;align-items:center;gap:8px;padding:6px 0;transition:color .2s;border-bottom:1px solid var(--border-subtle)}
    .toc-list a:last-child{border-bottom:none}
    .toc-list a:hover{color:var(--text-primary);text-decoration:none}
    .toc-list .num{font-family:var(--mono);font-size:9px;color:var(--purple-bright);min-width:20px}
    @media(max-width:768px){.toc{position:relative;top:0}}
    
    .content-section{margin-bottom:var(--space-4);scroll-margin-top:calc(var(--nav-height) + 20px)}
    .content-section h2{font-family:var(--serif);font-size:22px;font-weight:300;margin:0 0 var(--space-2);padding-top:var(--space-2);display:flex;align-items:center;gap:12px;border-top:1px solid var(--border-glass)}
    .content-section h2 .num{font-family:var(--mono);font-size:11px;color:var(--purple-bright);letter-spacing:1px}
    .content-section h3{font-family:var(--mono);font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--text-primary);margin:var(--space-2) 0 var(--space-1)}
    .content-section p{color:var(--text-secondary);margin:0 0 var(--space-2);font-size:14px;line-height:1.8}
    .content-section strong{color:var(--text-primary)}
    
    .info-card{background:rgba(255,255,255,.03);border:1px solid var(--border-glass);border-radius:14px;padding:20px 24px;margin:var(--space-2) 0}
    .info-card ul{margin:0;padding:0 0 0 20px;color:var(--text-secondary)}
    .info-card li{margin-bottom:10px;font-size:13px;line-height:1.7}
    .info-card li:last-child{margin-bottom:0}
    .info-card li strong{color:var(--text-primary)}
    
    .info-box{background:linear-gradient(135deg,rgba(157,140,207,.1) 0%,rgba(157,140,207,.03) 100%);border:1px solid rgba(157,140,207,.25);border-radius:14px;padding:24px;margin:var(--space-3) 0}
    .info-box h3{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--purple-bright);margin:0 0 12px}
    .info-box p{color:var(--text-secondary);margin:0 0 12px;font-size:14px;line-height:1.7}
    .info-box ul{margin:0;padding:0 0 0 20px;color:var(--text-secondary);font-size:13px}
    .info-box li{margin-bottom:6px}
    
    .warning-box{background:linear-gradient(135deg,rgba(214,160,92,.1) 0%,rgba(214,160,92,.03) 100%);border:1px solid rgba(214,160,92,.3);border-radius:14px;padding:24px;margin:var(--space-3) 0}
    .warning-box h3{font-family:var(--mono);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--accent-amber);margin:0 0 12px}
    .warning-box p{color:var(--text-secondary);margin:0;font-size:14px;line-height:1.7}
    
    .contact-card{background:linear-gradient(135deg,rgba(157,140,207,.1) 0%,rgba(157,140,207,.03) 100%);border:1px solid rgba(157,140,207,.25);border-radius:16px;padding:24px;margin-top:var(--space-4);display:flex;align-items:center;gap:20px;flex-wrap:wrap}
    .contact-icon{width:48px;height:48px;background:rgba(157,140,207,.15);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .contact-content{flex:1;min-width:200px}
    .contact-title{font-size:15px;color:var(--text-primary);margin-bottom:4px}
    .contact-desc{font-size:13px;color:var(--text-tertiary)}
    .contact-link{font-family:var(--mono);font-size:11px;letter-spacing:1px;color:var(--purple-bright);padding:10px 18px;border:1px solid rgba(157,140,207,.4);border-radius:8px;text-decoration:none;transition:all .2s;white-space:nowrap}
    .contact-link:hover{background:rgba(157,140,207,.1);border-color:rgba(157,140,207,.6);text-decoration:none}
    
    footer{margin-top:var(--space-8);padding:var(--space-4) var(--space-2);border-top:1px solid var(--border-glass);text-align:center}
    .footer-copy{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-tertiary)}
    .footer-links{margin-top:16px;display:flex;justify-content:center;gap:24px;flex-wrap:wrap}
    .footer-links a{font-family:var(--mono);font-size:10px;letter-spacing:1px;color:var(--text-tertiary);text-decoration:none}.footer-links a:hover{color:var(--text-primary)}
  </style>
</head>
<body>
  <div class="grid-overlay" aria-hidden="true"></div>
  
  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark"><div class="brand-mark-inner"></div></div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back
      </a>
    </div>
  </header>

  <main>
    <div class="page-hero">
      <div class="page-label">Certification Terms</div>
      <h1 class="page-title">Conformance Agreement</h1>
      <div class="page-subtitle">ODD Conformance Determination Terms and Conditions</div>
      <div class="page-meta">
        <div class="effective">Effective: January 2026</div>
      </div>
      <p class="page-intro">
        This Agreement governs the relationship between Sentinel Authority ("SA") and organizations seeking ODD Conformance Determination (ODDC) for autonomous systems. By submitting a certification application, you agree to these terms.
      </p>
    </div>

    <!-- Critical Understanding -->
    <div class="critical-box">
      <h3>Critical Understanding</h3>
      <p>ODDC attests that a system operates within declared boundaries with non-bypassable enforcement at the time of determination. <strong>ODDC is NOT:</strong> regulatory approval, safety certification, product certification, a guarantee of performance, insurance, or warranty. Applicant remains solely responsible for system behavior, regulatory compliance, and all consequences of operation.</p>
    </div>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul class="toc-list">
        <li><a href="#scope"><span class="num">1</span> Scope of Determination</a></li>
        <li><a href="#obligations"><span class="num">2</span> Applicant Obligations</a></li>
        <li><a href="#sa-obligations"><span class="num">3</span> SA Obligations</a></li>
        <li><a href="#terms"><span class="num">4</span> Conformance Terms</a></li>
        <li><a href="#revocation"><span class="num">5</span> Revocation</a></li>
        <li><a href="#suspension"><span class="num">6</span> Suspension & Reinstatement</a></li>
        <li><a href="#liability"><span class="num">7</span> Liability & Indemnification</a></li>
        <li><a href="#confidentiality"><span class="num">8</span> Confidentiality</a></li>
        <li><a href="#ip"><span class="num">9</span> Intellectual Property</a></li>
        <li><a href="#general"><span class="num">10</span> General Provisions</a></li>
      </ul>
    </div>

    <div id="scope" class="content-section">
      <h2><span class="num">1</span> Scope of Determination</h2>
      <p>SA will evaluate and determine conformance based on:</p>
      <div class="info-card">
        <ul>
          <li><strong>ODD Specification:</strong> The Operational Design Domain as declared by Applicant</li>
          <li><strong>ENVELO Compliance:</strong> Runtime enforcement architecture meeting ENVELO requirements</li>
          <li><strong>CAT-72 Evidence:</strong> Successful completion of 72+ hour convergence test</li>
          <li><strong>Architectural Consonance:</strong> Training data and safety envelope derived from common simulation</li>
        </ul>
      </div>
    </div>

    <div id="obligations" class="content-section">
      <h2><span class="num">2</span> Applicant Obligations</h2>
      
      <h3>2.1 Application Requirements</h3>
      <div class="info-card">
        <ul>
          <li>Provide complete and accurate application materials</li>
          <li>Disclose all relevant system specifications and operational parameters</li>
          <li>Identify all boundaries, tolerances, and constraints in the ODD specification</li>
          <li>Submit documentation of ENVELO-compliant enforcement architecture</li>
        </ul>
      </div>

      <h3>2.2 Testing Requirements</h3>
      <div class="info-card">
        <ul>
          <li>Deploy the ENVELO Agent as configured by SA</li>
          <li>Conduct CAT-72 testing under normal operational conditions</li>
          <li>Not modify system configuration, ODD parameters, or enforcement settings during testing</li>
          <li>Report any test interruptions, violations, or anomalies</li>
        </ul>
      </div>

      <h3>2.3 Post-Certification Requirements</h3>
      <div class="warning-box">
        <h3>Uptime Requirements</h3>
        <p><strong>ENVELO Agent Uptime:</strong> Minimum 99% monthly uptime required. Outages under 1 hour require no action. Extended outages exceeding 1 hour trigger automated notification. Cumulative downtime exceeding 24 hours per calendar month may result in certificate suspension.</p>
      </div>
      <div class="info-card">
        <ul>
          <li>Maintain ENVELO Agent in continuous operation during certified system operation</li>
          <li>Not bypass, disable, or tamper with enforcement mechanisms</li>
          <li>Notify SA of any system modifications affecting ODD or enforcement</li>
          <li>Complete renewal testing prior to conformance expiration</li>
          <li>Use the ODDC mark only in accordance with mark usage guidelines</li>
        </ul>
      </div>
    </div>

    <div id="sa-obligations" class="content-section">
      <h2><span class="num">3</span> SA Obligations</h2>
      <div class="info-card">
        <ul>
          <li>Review applications within stated timelines</li>
          <li>Conduct scope assessment and provide fee quotation</li>
          <li>Administer CAT-72 testing per documented procedures</li>
          <li>Issue conformance determination based on evidentiary record</li>
          <li>Maintain certification records per retention requirements</li>
          <li>Provide certificate verification services</li>
        </ul>
      </div>

      <div class="info-box">
        <h3>What SA Does Not Do</h3>
        <ul>
          <li>Implement, operate, or monitor runtime systems</li>
          <li>Certify implementation correctness or validate code</li>
          <li>Warrant system behavior or performance</li>
          <li>Provide regulatory approval or compliance certification</li>
          <li>Assume any operational responsibility for certified systems</li>
        </ul>
      </div>
    </div>

    <div id="terms" class="content-section">
      <h2><span class="num">4</span> Conformance Terms</h2>
      
      <h3>4.1 Term Duration</h3>
      <p>Conformance terms range from 6-24 months based on operational domain risk profile, ODD complexity, and applicant conformance history. Term duration is specified in the conformance determination.</p>

      <h3>4.2 Renewal</h3>
      <p>Renewal requires CAT-72 re-completion. Streamlined renewal (48-hour test duration) may be available for applicants with clean conformance history and no modifications.</p>

      <h3>4.3 Modifications</h3>
      <p>Any modification to the certified system's ODD specification, enforcement architecture, or underlying simulation requires:</p>
      <div class="info-card">
        <ul>
          <li>Notification to SA within 5 business days</li>
          <li>Evaluation of modification impact</li>
          <li>Potential re-certification if modification affects conformance basis</li>
        </ul>
      </div>
    </div>

    <div id="revocation" class="content-section">
      <h2><span class="num">5</span> Revocation</h2>
      <p>SA may revoke conformance for:</p>
      <div class="critical-box" style="background:linear-gradient(135deg,rgba(214,92,92,.08) 0%,rgba(214,92,92,.02) 100%);">
        <h3>Grounds for Revocation</h3>
        <p>Material misrepresentation in application materials • Unauthorized modification to certified system • Disabling, bypassing, or tampering with ENVELO enforcement • Failure to maintain ENVELO Agent operation • Non-payment of fees • Violation of this Agreement</p>
      </div>
      <p>Revocation is recorded in the SA registry and reflected in verification results.</p>
    </div>

    <div id="suspension" class="content-section">
      <h2><span class="num">6</span> Suspension & Reinstatement</h2>
      
      <h3>6.1 Automatic Suspension</h3>
      <p>Certificates may be automatically suspended when:</p>
      <div class="info-card">
        <ul>
          <li>ENVELO Agent downtime exceeds 24 cumulative hours in a calendar month</li>
          <li>Violation rate exceeds 10% of total actions over a 24-hour period</li>
          <li>Agent is unreachable for more than 72 consecutive hours</li>
        </ul>
      </div>

      <h3>6.2 Reinstatement</h3>
      <div class="info-card">
        <ul>
          <li><strong>First suspension:</strong> Restore agent operation and pass 24-hour verification check</li>
          <li><strong>Second suspension:</strong> Above plus written remediation plan</li>
          <li><strong>Third suspension:</strong> Full CAT-72 re-certification required</li>
        </ul>
      </div>

      <h3>6.3 Reinstatement Fee</h3>
      <p>A reinstatement fee of $500 applies after the first suspension. This fee covers SA verification and administrative costs. Certification fees are non-refundable during suspension periods.</p>
    </div>

    <div id="liability" class="content-section">
      <h2><span class="num">7</span> Liability & Indemnification</h2>
      
      <h3>7.1 Limitation of Liability</h3>
      <p>SA's total liability under this Agreement shall not exceed the fees paid for the specific certification at issue. SA is not liable for indirect, incidental, consequential, special, or punitive damages.</p>

      <h3>7.2 No Liability for System Behavior</h3>
      <p>SA has no liability for the behavior, performance, or consequences of operation of any system, whether certified or not. Certification attests to bounded operation at time of determination; it does not guarantee future behavior.</p>

      <h3>7.3 Indemnification</h3>
      <p>Applicant shall indemnify, defend, and hold harmless SA from any claims, damages, losses, or expenses arising from operation of Applicant's systems, violation of this Agreement, or claims by third parties related to Applicant's products or services.</p>
    </div>

    <div id="confidentiality" class="content-section">
      <h2><span class="num">8</span> Confidentiality</h2>
      <p>SA will maintain confidentiality of Applicant's technical documentation and application materials, except:</p>
      <div class="info-card">
        <ul>
          <li>Certificate information is publicly verifiable</li>
          <li>Disclosure required by law or valid legal process</li>
          <li>Aggregate, anonymized data for research or reporting</li>
        </ul>
      </div>
    </div>

    <div id="ip" class="content-section">
      <h2><span class="num">9</span> Intellectual Property</h2>
      <p>Applicant retains all rights to its systems, documentation, and intellectual property. SA retains all rights to ODDC methodology, ENVELO specifications, CAT-72 procedures, and related intellectual property. Nothing in this Agreement grants either party rights to the other's intellectual property except as expressly stated.</p>
    </div>

    <div id="general" class="content-section">
      <h2><span class="num">10</span> General Provisions</h2>
      
      <h3>10.1 Governing Law</h3>
      <p>This Agreement is governed by the laws of the Province of Ontario, Canada. Disputes shall be resolved in the courts of Ontario, Canada.</p>

      <h3>10.2 Entire Agreement</h3>
      <p>This Agreement, together with the Terms of Service and applicable fee schedules, constitutes the entire agreement between the parties.</p>

      <h3>10.3 Amendments</h3>
      <p>SA may amend this Agreement with notice to Applicant. Continued participation in certification after amendment constitutes acceptance.</p>

      <h3>10.4 Severability</h3>
      <p>If any provision is found unenforceable, the remaining provisions remain in effect.</p>
    </div>

    <div class="contact-card">
      <div class="contact-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.9)" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      </div>
      <div class="contact-content">
        <div class="contact-title">Questions about this agreement?</div>
        <div class="contact-desc">Contact our conformance team for clarification.</div>
      </div>
      <a href="mailto:conformance@sentinelauthority.org" class="contact-link">conformance@sentinelauthority.org →</a>
    </div>
  </main>

  <footer>
    <div class="footer-copy">© <span id="yr"></span> Sentinel Authority</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="index.html#artifacts">Documents</a>
      <a href="conformance-agreement.html">Conformance</a>
    </div>
  </footer>
  <script>document.getElementById("yr").textContent=new Date().getFullYear();</script>
</body>
</html>
</file>

<file path="backend/app/api/routes/applicants.py">
"""Applicant Portal routes."""

from datetime import datetime
from fastapi import APIRouter, Depends, HTTPException, Request
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from pydantic import BaseModel, EmailStr
from typing import Optional, Dict, Any

from app.core.database import get_db
from app.core.security import get_current_user
from app.models.models import Application, User, CertificationState
from app.services.email_service import notify_admin_new_application

router = APIRouter()


class ApplicationCreate(BaseModel):
    organization_name: str
    contact_name: Optional[str] = None
    contact_email: EmailStr
    contact_phone: Optional[str] = None
    system_name: str
    system_description: str
    system_version: Optional[str] = None
    manufacturer: Optional[str] = None
    odd_specification: Optional[Any] = None
    envelope_definition: Optional[Dict[str, Any]] = None
    preferred_test_date: Optional[datetime] = None
    facility_location: Optional[str] = None
    notes: Optional[str] = None


async def generate_application_number(db: AsyncSession) -> str:
    year = datetime.utcnow().year
    result = await db.execute(
        select(func.count(Application.id)).where(
            Application.application_number.like(f"APP-{year}-%")
        )
    )
    count = (result.scalar() or 0) + 1
    return f"APP-{year}-{count:05d}"


@router.post("/")
async def create_application(
    app_data: ApplicationCreate,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    app_number = await generate_application_number(db)
    
    # Handle odd_specification - convert string to dict if needed
    odd_spec = app_data.odd_specification
    if isinstance(odd_spec, str):
        odd_spec = {"description": odd_spec}
    elif odd_spec is None:
        odd_spec = {}
    
    application = Application(
        application_number=app_number,
        applicant_id=int(user["sub"]),
        organization_name=app_data.organization_name,
        contact_name=app_data.contact_name or user.get("full_name", ""),
        contact_email=app_data.contact_email,
        contact_phone=app_data.contact_phone,
        system_name=app_data.system_name,
        system_description=app_data.system_description,
        system_version=app_data.system_version or "1.0",
        manufacturer=app_data.manufacturer or app_data.organization_name,
        odd_specification=odd_spec,
        envelope_definition=app_data.envelope_definition or {},
        preferred_test_date=app_data.preferred_test_date,
        facility_location=app_data.facility_location,
        notes=app_data.notes,
        state=CertificationState.PENDING,
        submitted_at=datetime.utcnow(),
    )
    
    db.add(application)
    await db.commit()
    await db.refresh(application)
    
    await notify_admin_new_application(
        app_data.organization_name,
        app_data.system_name,
        app_data.contact_email
    )
    
    return {
        "id": application.id,
        "application_number": application.application_number,
        "state": application.state.value,
        "submitted_at": application.submitted_at.isoformat() + "Z",
        "message": "Application submitted successfully"
    }


@router.get("/")
async def list_applications(
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    if user.get("role") in ["admin", "operator"]:
        result = await db.execute(select(Application).order_by(Application.created_at.desc()))
    else:
        result = await db.execute(
            select(Application)
            .where(Application.applicant_id == int(user["sub"]))
            .order_by(Application.created_at.desc())
        )
    
    apps = result.scalars().all()
    return [
        {
            "id": a.id,
            "application_number": a.application_number,
            "organization_name": a.organization_name,
            "system_name": a.system_name,
            "system_version": a.system_version,
            "state": a.state.value,
            "submitted_at": a.submitted_at.isoformat() + "Z" if a.submitted_at else None,
        }
        for a in apps
    ]


@router.get("/{application_id}")
async def get_application(
    application_id: int,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    result = await db.execute(select(Application).where(Application.id == application_id))
    app = result.scalar_one_or_none()
    
    if not app:
        raise HTTPException(status_code=404, detail="Application not found")
    
    if user.get("role") not in ["admin", "operator"] and app.applicant_id != int(user["sub"]):
        raise HTTPException(status_code=403, detail="Access denied")
    
    return {
        "id": app.id,
        "application_number": app.application_number,
        "organization_name": app.organization_name,
        "contact_name": app.contact_name,
        "contact_email": app.contact_email,
        "contact_phone": app.contact_phone,
        "system_name": app.system_name,
        "system_description": app.system_description,
        "system_version": app.system_version,
        "manufacturer": app.manufacturer,
        "odd_specification": app.odd_specification,
        "envelope_definition": app.envelope_definition,
        "state": app.state.value,
        "submitted_at": app.submitted_at.isoformat() + "Z" if app.submitted_at else None,
        "preferred_test_date": app.preferred_test_date.isoformat() + "Z" if app.preferred_test_date else None,
        "facility_location": app.facility_location,
        "notes": app.notes,
    }


@router.patch("/{application_id}/state")
async def update_application_state(
    application_id: int,
    new_state: str,
    db: AsyncSession = Depends(get_db),
    user: dict = Depends(get_current_user)
):
    if user.get("role") not in ["admin", "operator"]:
        raise HTTPException(status_code=403, detail="Only operators can update state")
    
    result = await db.execute(select(Application).where(Application.id == application_id))
    app = result.scalar_one_or_none()
    
    if not app:
        raise HTTPException(status_code=404, detail="Application not found")
    
    try:
        app.state = CertificationState(new_state)
        app.reviewed_at = datetime.utcnow()
        await db.commit()
        return {"message": f"State updated to {new_state}", "state": new_state}
    except ValueError:
        raise HTTPException(status_code=400, detail=f"Invalid state: {new_state}")


@router.post("/document-download")
async def document_download(
    request: Request,
    db: AsyncSession = Depends(get_db)
):
    """Track document downloads and notify admin"""
    from app.services.email_service import send_email
    import os
    
    data = await request.json()
    email = data.get("email", "")
    organization = data.get("organization", "")
    role = data.get("role", "")
    document = data.get("document", "")
    
    # Send notification email to admin
    ADMIN_EMAIL = os.getenv("ADMIN_EMAIL", "info@sentinelauthority.org")
    
    subject = f"Document Download: {document}"
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">Document Download</h1>
        </div>
        <div style="padding: 20px; background: #f9f9f9;">
            <h2 style="color: #5B4B8A;">Someone downloaded a document</h2>
            <table style="width: 100%; border-collapse: collapse;">
                <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Document:</strong></td><td style="padding: 8px; border-bottom: 1px solid #ddd;">{document}</td></tr>
                <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Email:</strong></td><td style="padding: 8px; border-bottom: 1px solid #ddd;">{email}</td></tr>
                <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Organization:</strong></td><td style="padding: 8px; border-bottom: 1px solid #ddd;">{organization or 'Not provided'}</td></tr>
                <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Role:</strong></td><td style="padding: 8px; border-bottom: 1px solid #ddd;">{role or 'Not provided'}</td></tr>
            </table>
        </div>
        <div style="padding: 15px; background: #5B4B8A; text-align: center;">
            <span style="color: rgba(255,255,255,0.7); font-size: 12px;">Sentinel Authority</span>
        </div>
    </div>
    """
    
    try:
        await send_email(ADMIN_EMAIL, subject, html)
        return {"success": True, "message": "Download tracked"}
    except Exception as e:
        print(f"Email error: {e}")
        return {"success": True, "message": "Download tracked (email failed)"}


@router.delete("/{app_id}")
async def delete_application(
    app_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Delete an application (admin only)"""
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    result = await db.execute(select(Application).where(Application.id == app_id))
    application = result.scalar_one_or_none()
    
    if not application:
        raise HTTPException(status_code=404, detail="Application not found")
    
    await db.delete(application)
    await db.commit()
    
    return {"message": "Application deleted"}
</file>

<file path="backend/app/api/routes/auth.py">
"""Authentication routes."""
from app.services.email_service import notify_admin_new_registration

from datetime import datetime
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from pydantic import BaseModel, EmailStr

from app.core.database import get_db
from app.core.security import get_password_hash, verify_password, create_access_token, get_current_user
from app.models.models import User, UserRole

router = APIRouter()


class UserCreate(BaseModel):
    email: EmailStr
    password: str
    full_name: str
    organization: str = None


class UserLogin(BaseModel):
    email: EmailStr
    password: str


class TokenResponse(BaseModel):
    access_token: str
    token_type: str = "bearer"
    user: dict


@router.post("/register", response_model=TokenResponse)
async def register(user_data: UserCreate, db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(User).where(User.email == user_data.email))
    if result.scalar_one_or_none():
        raise HTTPException(status_code=400, detail="Email already registered")
    
    user = User(
        email=user_data.email,
        hashed_password=get_password_hash(user_data.password),
        full_name=user_data.full_name,
        organization=user_data.organization,
        role=UserRole.APPLICANT,
    )
    db.add(user)
    await db.commit()
    await db.refresh(user)
    
    await notify_admin_new_registration(user.email, user.full_name)
    
    token = create_access_token({"sub": str(user.id), "email": user.email, "role": user.role.value, "organization": user.organization})
    return {
        "access_token": token,
        "token_type": "bearer",
        "user": {"id": user.id, "email": user.email, "full_name": user.full_name, "role": user.role.value, "organization": user.organization}
    }


@router.post("/login", response_model=TokenResponse)
async def login(credentials: UserLogin, db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(User).where(User.email == credentials.email))
    user = result.scalar_one_or_none()
    
    if not user or not verify_password(credentials.password, user.hashed_password):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    
    if not user.is_active:
        raise HTTPException(status_code=401, detail="Account disabled")
    
    token = create_access_token({"sub": str(user.id), "email": user.email, "role": user.role.value, "organization": user.organization})
    return {
        "access_token": token,
        "token_type": "bearer",
        "user": {"id": user.id, "email": user.email, "full_name": user.full_name, "role": user.role.value, "organization": user.organization}
    }


@router.get("/me")
async def get_me(current_user: dict = Depends(get_current_user), db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(User).where(User.id == int(current_user["sub"])))
    user = result.scalar_one_or_none()
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    return {"id": user.id, "email": user.email, "full_name": user.full_name, "organization": user.organization, "role": user.role.value}
</file>

<file path="backend/app/api/routes/verification.py">
"""Public Verification API - No authentication required."""

from datetime import datetime
from fastapi import APIRouter, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from pydantic import BaseModel

from app.core.database import get_db
from fastapi import Depends
from app.models.models import Certificate, EnveloSession, CertificationState

router = APIRouter()


class VerificationResponse(BaseModel):
    valid: bool
    certificate_number: str
    status: str
    organization_name: str = None
    system_name: str = None
    system_version: str = None
    issued_at: str = None
    expires_at: str = None
    convergence_score: float = None
    evidence_hash: str = None
    signature: str = None
    audit_log_ref: str = None
    message: str


@router.get("/{certificate_number}", response_model=VerificationResponse)
async def verify_certificate(
    certificate_number: str,
    db: AsyncSession = Depends(get_db)
):
    """
    Public endpoint to verify a certificate.
    No authentication required - anyone can check certification status.
    """
    result = await db.execute(
        select(Certificate).where(Certificate.certificate_number == certificate_number)
    )
    cert = result.scalar_one_or_none()
    
    if not cert:
        return VerificationResponse(
            valid=False,
            certificate_number=certificate_number,
            status="NOT_FOUND",
            message="No certificate found with this number"
        )
    
    # Check expiration
    now = datetime.utcnow()
    is_expired = cert.expires_at and cert.expires_at < now
    
    if is_expired and cert.state == CertificationState.CONFORMANT:
        cert.state = CertificationState.EXPIRED
    
    # Determine validity
    is_valid = cert.state == CertificationState.CONFORMANT and not is_expired
    
    # Status messages
    status_messages = {
        CertificationState.CONFORMANT: "Certificate is valid and active",
        CertificationState.SUSPENDED: "Certificate has been suspended - contact issuer for details",
        CertificationState.REVOKED: "Certificate has been permanently revoked",
        CertificationState.EXPIRED: "Certificate has expired",
    }
    
    return VerificationResponse(
        valid=is_valid,
        certificate_number=cert.certificate_number,
        status=cert.state.value.upper(),
        organization_name=cert.organization_name,
        system_name=cert.system_name,
        system_version=cert.system_version,
        issued_at=cert.issued_at.isoformat() if cert.issued_at else None,
        expires_at=cert.expires_at.isoformat() if cert.expires_at else None,
        convergence_score=cert.convergence_score,
        evidence_hash=cert.evidence_hash,
        signature=cert.signature,
        audit_log_ref=cert.audit_log_ref,
        message=status_messages.get(cert.state, "Unknown status")
    )


@router.get("/{certificate_number}/evidence")
async def get_public_evidence(
    certificate_number: str,
    db: AsyncSession = Depends(get_db)
):
    """
    Get public evidence summary for a certificate.
    Returns only non-sensitive evidence data.
    """
    result = await db.execute(
        select(Certificate).where(Certificate.certificate_number == certificate_number)
    )
    cert = result.scalar_one_or_none()
    
    if not cert:
        raise HTTPException(status_code=404, detail="Certificate not found")
    
    return {
        "certificate_number": cert.certificate_number,
        "evidence_hash": cert.evidence_hash,
        "convergence_score": cert.convergence_score,
        "issued_at": cert.issued_at.isoformat() if cert.issued_at else None,
        "odd_scope": {
            "environment_type": cert.odd_specification.get("environment_type") if cert.odd_specification else None,
        },
        "verification_instructions": (
            "To verify the integrity of this certificate:\n"
            "1. Compare the evidence_hash with your records\n"
            "2. The hash is a SHA-256 digest of the complete CAT-72 evidence chain\n"
            "3. Contact Sentinel Authority for full evidence audit"
        )
    }


@router.get("/")
async def verification_info():
    """Information about the verification API."""
    return {
        "service": "Sentinel Authority Public Verification API",
        "version": "1.0",
        "description": "Verify ODDC certificates for autonomous systems",
        "usage": {
            "verify": "GET /api/verify/{certificate_number}",
            "evidence": "GET /api/verify/{certificate_number}/evidence",
        },
        "contact": "https://sentinelauthority.org",
    }


@router.get("/status/{certificate_number}")
async def get_test_status(
    certificate_number: str,
    db: AsyncSession = Depends(get_db)
):
    """Public endpoint for customers to check their test status"""
    
    # First find the certificate by its number
    cert_result = await db.execute(
        select(Certificate).where(Certificate.certificate_number == certificate_number)
    )
    certificate = cert_result.scalar_one_or_none()
    
    # Find sessions - either by certificate FK or check session_id contains cert number
    if certificate:
        result = await db.execute(
            select(EnveloSession).where(
                EnveloSession.certificate_id == certificate.id
            ).order_by(EnveloSession.started_at.desc())
        )
    else:
        # Fallback: search by session_id containing the cert number (for demo sessions)
        result = await db.execute(
            select(EnveloSession).order_by(EnveloSession.started_at.desc()).limit(10)
        )
    sessions = result.scalars().all()
    
    if not sessions:
        # Check if certificate exists
        result = await db.execute(
            select(Certificate).where(Certificate.certificate_number == certificate_id)
        )
        cert = result.scalar_one_or_none()
        
        if cert:
            return {
                "status": "certified",
                "certificate_number": cert.certificate_number,
                "issued_at": cert.issued_at.isoformat() if cert.issued_at else None,
                "expires_at": cert.expires_at.isoformat() if cert.expires_at else None,
            }
        
        return {
            "status": "not_found",
            "message": "No test data found for this certificate ID. Make sure your ENVELO Agent is configured and running."
        }
    
    # Calculate totals
    total_pass = sum(s.pass_count or 0 for s in sessions)
    total_block = sum(s.block_count or 0 for s in sessions)
    total_actions = total_pass + total_block
    pass_rate = (total_pass / total_actions * 100) if total_actions > 0 else 0
    
    # Get earliest start time
    sessions_with_start = [s.started_at for s in sessions if s.started_at]
    earliest_start = min(sessions_with_start) if sessions_with_start else None
    hours_elapsed = (datetime.utcnow() - earliest_start).total_seconds() / 3600 if earliest_start else 0
    hours_remaining = max(0, 72 - hours_elapsed)
    
    # Determine status
    active_sessions = [s for s in sessions if s.status == 'active']
    
    return {
        "status": "running" if active_sessions else "waiting",
        "certificate_id": certificate_number,
        "started_at": earliest_start.isoformat() if earliest_start else None,
        "hours_elapsed": round(hours_elapsed, 1),
        "hours_remaining": round(hours_remaining, 1),
        "total_actions": total_actions,
        "pass_count": total_pass,
        "block_count": total_block,
        "pass_rate": round(pass_rate, 1),
        "active_sessions": len(active_sessions),
        "criteria": {
            "duration_met": hours_elapsed >= 72,
            "actions_met": total_actions >= 100,
            "pass_rate_met": pass_rate >= 95,
            "blocking_verified": total_block > 0
        }
    }
</file>

<file path="website/status.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Test Status — Sentinel Authority</title>
  <meta name="description" content="Check your CAT-72 conformance test status" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>

    :root{
      color-scheme: dark;
      
      /* Core palette */
      --purple-primary:#5B4B8A;
      --purple-bright:#9d8ccf;
      --purple-glow:rgba(157,140,207,.20);
      --bg-deep:#2a2f3d;
      --bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;
      --accent-amber:#D6A05C;
      --accent-red:#D65C5C;

      /* Text hierarchy */
      --text-primary:rgba(255,255,255,.94);
      --text-secondary:rgba(255,255,255,.75);
      --text-tertiary:rgba(255,255,255,.50);

      /* Borders */
      --border-glass:rgba(255,255,255,.10);
      --border-subtle:rgba(255,255,255,.06);

      /* Typography */
      --serif:'Source Serif 4',serif;
      --mono:'IBM Plex Mono',monospace;
      --sans:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

      /* Timing */
      --ease: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
      
      /* Spacing scale (10px base) */
      --space-1: 10px;
      --space-2: 20px;
      --space-3: 30px;
      --space-4: 40px;
      --space-5: 50px;
      --space-6: 60px;
      --space-8: 80px;
      --space-10: 100px;
      --space-12: 120px;
      
      /* Layout */
      --max: 1200px;
      --nav-height: 72px;
    }

    *{ box-sizing:border-box; }
    
    /* Skip link for accessibility */
    .skip-link{
      position:absolute;
      left:-9999px;
      top:auto;
      width:1px;
      height:1px;
      overflow:hidden;
      z-index:999;
    }
    .skip-link:focus{
      position:fixed;
      top:var(--space-1);
      left:var(--space-1);
      width:auto;
      height:auto;
      padding:12px 18px;
      background:var(--bg-deep);
      border:1px solid var(--purple-bright);
      border-radius:8px;
      color:var(--text-primary);
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:2px;
      text-transform:uppercase;
      text-decoration:none;
    }
    
    /* Screen reader only */
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
    
    /* Focus styles for accessibility */
    a:focus-visible, button:focus-visible {
      outline: 2px solid rgba(157,140,207,.75);
      outline-offset: 3px;
      border-radius: 10px;
    }
    
    html{ scroll-behavior:smooth; background:var(--bg-deep); }
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 15% 10%, rgba(91,75,138,.15), transparent 55%),
                  radial-gradient(900px 600px at 85% 80%, rgba(92,214,133,.06), transparent 55%),
                  var(--bg-deep);
      color:var(--text-primary);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; text-underline-offset:4px; }
    ::selection{ background:var(--purple-primary); color:#fff; }

    /* Subtle grid overlay */
    .grid-overlay{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      background-image:
        linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
      background-size: var(--space-12) var(--space-12);
      opacity:.15;
      mask-image: radial-gradient(ellipse at center, rgba(0,0,0,.95) 20%, transparent 70%);
    }

    /* ============================================
       NAVIGATION
       ============================================ */
    .site-header{
      position:fixed;
      top:0;
      width:100%;
      z-index:50;
      padding:0 var(--space-2, 20px);
      height: var(--nav-height, 72px);
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(42,47,61,.88);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      display: flex;
      align-items: center;
    }
    .nav-inner{
      max-width: var(--max, 1200px);
      margin:0 auto;
      width: 100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--space-2, 20px);
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      gap: var(--space-1, 10px);
      flex-shrink: 0;
      text-decoration: none;
      visibility: visible;
      opacity: 1;
    }
    .brand:hover{ text-decoration: none; }
    .brand-mark{
      width: 24px;
      height: 24px;
      background: #5B4B8A;
      background: var(--purple-primary, #5B4B8A);
      border: 2px solid #9d8ccf;
      border: 2px solid var(--purple-bright, #9d8ccf);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .brand-mark-inner{
      width: 8px;
      height: 8px;
      background: #c4b8e8;
      border-radius: 50%;
      animation: eye-pulse 7s ease-in-out infinite;
      will-change: transform, opacity, box-shadow;
    }
    @keyframes eye-pulse {
      0%, 100% {
        opacity: .75;
        transform: scale(.98);
        box-shadow: 0 0 0 rgba(196,184,232,0);
      }
      50% {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 10px rgba(157,140,207,.22);
      }
    }
    @media (prefers-reduced-motion: reduce){
      .brand-mark-inner{ animation: none; opacity: .9; }
    }
    .brand-name{
      font-family: 'IBM Plex Mono', monospace;
      font-family: var(--mono, 'IBM Plex Mono', monospace);
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #dbdbdb;
      color: rgba(255,255,255,.86);
      white-space: nowrap;
    }
    /* Back link for sub-pages */
    .back-link{
      font-family: var(--mono, 'IBM Plex Mono', monospace);
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-tertiary, rgba(255,255,255,.50));
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .back-link:hover{
      color: var(--text-primary, rgba(255,255,255,.94));
      text-decoration: none;
    }


    .nav-links{
      display:flex;
      align-items:center;
      gap: 14px;
      flex-wrap: nowrap;
      justify-content:center;
    }
    .nav-links a{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      color: var(--text-tertiary);
      padding: 8px 4px;
      position: relative;
      transition: color .25s ease;
      white-space: nowrap;
    }
    .nav-links a:hover{ color: var(--text-primary); text-decoration:none; }
    .nav-links a::after{
      content:"";
      position:absolute;
      left:4px; right:4px; bottom:4px;
      height:1px;
      background: var(--purple-bright);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .35s var(--ease);
      opacity:.9;
    }
    .nav-links a:hover::after{ transform: scaleX(1); }
    
    /* Active section indicator */
    .nav-links a.active{
      color: var(--text-primary);
    }
    .nav-links a.active::after{
      transform: scaleX(1);
      opacity: .6;
    }

    .nav-badge{
      display:flex;
      align-items:center;
      gap:6px;
      font-family: var(--mono);
      font-size: 8px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: rgba(214,160,92,.95);
      border: 1px solid rgba(214,160,92,.25);
      background: rgba(214,160,92,.08);
      padding: 6px 8px;
      border-radius: 999px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Mobile nav toggle */
    .nav-toggle{
      display: none;
      appearance: none;
      border: 1px solid var(--border-glass);
      background: rgba(255,255,255,.03);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      position: relative;
      transition: border-color .2s ease, background .2s ease;
    }
    .nav-toggle:hover{
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
    }
    .nav-toggle span{
      position: absolute;
      left: 50%;
      width: 16px;
      height: 1px;
      background: var(--text-secondary);
      transform: translateX(-50%);
      transition: all .18s var(--ease-out);
    }
    .nav-toggle span:nth-child(1){ top: 14px; }
    .nav-toggle span:nth-child(2){ top: 19px; }
    .nav-toggle span:nth-child(3){ top: 24px; }
    
    .nav-toggle[aria-expanded="true"] span:nth-child(1){
      top: 19px;
      transform: translateX(-50%) rotate(45deg);
    }
    .nav-toggle[aria-expanded="true"] span:nth-child(2){
      opacity: 0;
      transform: translateX(-50%) scaleX(0);
    }
    .nav-toggle[aria-expanded="true"] span:nth-child(3){
      top: 19px;
      transform: translateX(-50%) rotate(-45deg);
    }

    /* Mobile drawer */
    .nav-drawer{
      display: none;
      position: fixed;
      top: var(--nav-height);
      right: 0;
      width: 280px;
      max-width: calc(100vw - var(--space-4));
      height: calc(100vh - var(--nav-height));
      background: rgba(42,47,61,.96);
      backdrop-filter: blur(24px);
      border-left: 1px solid var(--border-glass);
      transform: translateX(100%);
      transition: transform .18s var(--ease-out);
      z-index: 49;
      padding: var(--space-3) var(--space-2);
      overflow-y: auto;
    }
    .nav-drawer.open{
      transform: translateX(0);
    }
    .nav-drawer a{
      display: flex;
      align-items: center;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-secondary);
      padding: 14px 0;
      border-bottom: 1px solid var(--border-subtle);
      transition: color .2s ease;
    }
    .nav-drawer a:hover{
      color: var(--text-primary);
      text-decoration: none;
    }
    .nav-drawer a.active{
      color: var(--purple-bright);
    }
    
    .drawer-overlay{
      display: none;
      position: fixed;
      inset: 0;
      top: var(--nav-height);
      background: rgba(0,0,0,.4);
      z-index: 48;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events: none;
    }
    .drawer-overlay.open{
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 860px){
      .nav-links{ display:none; }
      .nav-toggle{ display: block; }
      .nav-drawer{ display: block; }
      .drawer-overlay{ display: block; }
    }

    /* ============================================
       MAIN CONTENT
       ============================================ */
    main{
      position: relative;
      z-index: 1;
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--space-2);
    }

    /* ============================================
       HERO
       ============================================ */
    .hero{
      min-height: 100vh;
      padding: calc(var(--nav-height) + var(--space-8)) 0 var(--space-6);
      display:flex;
      flex-direction: column;
      justify-content: center;
      gap: var(--space-2);
      position: relative;
    }
    
    /* Hero anchor line */
    .hero::before{
      content: "";
      position: absolute;
      left: 0;
      top: calc(var(--nav-height) + var(--space-6));
      bottom: var(--space-6);
      width: 1px;
      background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(157,140,207,.15) 10%,
        rgba(157,140,207,.15) 90%,
        transparent 100%
      );
    }
    
    @media (max-width: 860px){
      .hero{
        padding-top: calc(var(--nav-height) + var(--space-4));
        justify-content: flex-start;
      }
      .hero::before{ display: none; }
    }
    
    .hero-kicker{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--purple-bright);
      display:flex;
      align-items:center;
      gap:14px;
    }
    .hero-kicker::before{
      content:"";
      width:var(--space-4);
      height:1px;
      background: var(--purple-bright);
      opacity:.95;
    }
    
    h1{
      font-family: var(--serif);
      font-size: clamp(44px, 7vw, 92px);
      font-weight: 200;
      line-height: .95;
      margin: 0;
      letter-spacing: -0.04em;
    }
    h1 .accent{
      font-style: italic;
      color: var(--purple-bright);
      position: relative;
      text-shadow: 
        -1px 0 rgba(255,100,100,0.08), 
        1px 0 rgba(100,255,255,0.08),
        0 0 20px var(--purple-glow);
    }
    
    /* Hero stamp line */
    .hero-stamp{
      width: 60px;
      height: 1px;
      background: var(--purple-bright);
      opacity: .15;
      margin: var(--space-1) 0;
    }
    
    .hero-notice{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
      color: var(--purple-bright);
      border: 1px solid rgba(157,140,207,.22);
      background: rgba(91,75,138,.05);
      padding: 8px 12px;
      border-radius: 8px;
      width: fit-content;
      margin: var(--space-1) 0 var(--space-2);
    }
    
    .hero-desc{
      max-width: 62ch;
      font-size: 18px;
      font-weight: 200;
      line-height: 1.75;
      color: var(--text-secondary);
      border-left: 2px solid rgba(91,75,138,.65);
      padding-left: var(--space-2);
      margin: 0;
    }
    
    .hero-disclaimer{
      font-size: 11px;
      color: var(--text-tertiary);
      font-weight: 200;
      font-family: var(--mono);
      letter-spacing: 0.5px;
      margin: 0;
      line-height: 1.7;
    }
    .hero-disclaimer + .hero-disclaimer{
      margin-top: 6px;
    }
    
    .hero-subline{
      font-size: 15px;
      color: var(--text-secondary);
      font-weight: 200;
      margin: var(--space-1) 0 0;
    }

    .hero-actions{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: var(--space-1);
    }
    
    .hero-footnote{
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-tertiary);
      letter-spacing: 1px;
      margin-top: var(--space-2);
    }
    
    @media (max-width: 600px){
      h1{ font-weight: 300; line-height: 1.0; }
    }
    
    /* ============================================
       BUTTONS
       ============================================ */
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: transparent;
      color: var(--text-primary);
      padding: 14px 18px;
      border-radius: 14px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .2s var(--ease), border-color .2s ease, background .2s ease;
      position: relative;
      overflow:hidden;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.28);
      background: rgba(255,255,255,.04);
      text-decoration: none;
    }
    .btn.primary{
      border-color: rgba(157,140,207,.55);
      background: rgba(91,75,138,.18);
      box-shadow: 0 18px 50px rgba(0,0,0,.30);
    }
    .btn.primary:hover{
      border-color: rgba(157,140,207,.85);
      background: rgba(91,75,138,.26);
    }

    /* ============================================
       SECTIONS
       ============================================ */
    .section{
      padding: var(--space-10) 0;
      border-top: 1px solid var(--border-glass);
      scroll-margin-top: calc(var(--nav-height) + 24px);
    }
    .section-head{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: var(--space-2);
      flex-wrap: wrap;
      margin-bottom: var(--space-4);
    }
    .section-label{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 5px;
      text-transform: uppercase;
      color: var(--purple-bright);
      display:block;
      margin-bottom: 12px;
    }
    .section-title{
      font-family: var(--serif);
      font-size: clamp(30px, 4vw, 50px);
      font-weight: 200;
      line-height: 1.1;
      margin: 0;
      letter-spacing: -0.03em;
    }
    @media (max-width: 600px){
      .section-title{ font-weight: 300; }
    }
    .section-lead{
      max-width: 70ch;
      color: var(--text-secondary);
      font-weight: 200;
      line-height: 1.85;
      margin: var(--space-2) 0 0;
      font-size: 16px;
    }

    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-3);
      align-items: start;
    }
    @media (max-width: 980px){
      .grid-2{ grid-template-columns: 1fr; }
    }

    /* ============================================
       PANELS
       ============================================ */
    .panel{
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: var(--space-3) 28px;
      backdrop-filter: blur(18px);
      position: relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-20%;
      background: radial-gradient(circle at 20% 20%, rgba(157,140,207,.10), transparent 55%);
      pointer-events:none;
      transform: rotate(-8deg);
      opacity:.8;
    }
    .panel > *{ position: relative; z-index: 1; }

    .panel h3{
      margin: 0 0 14px;
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.85);
    }
    .panel p{
      margin: 0 0 var(--space-2);
      color: var(--text-secondary);
      font-weight: 200;
      line-height: 1.85;
    }
    
    .panel-note{
      font-size: 12px;
      color: var(--text-tertiary);
      font-weight: 400;
      font-family: var(--mono);
      letter-spacing: 0.5px;
      margin-bottom: 14px;
    }
    .panel-detail{
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 200;
      margin-bottom: 8px;
    }
    .panel-fine{
      font-size: 11px;
      color: var(--text-tertiary);
      font-weight: 200;
      margin-bottom: 14px;
    }
    
    .list{
      list-style: none;
      padding: 0;
      margin: 0;
      border-top: 1px solid var(--border-glass);
    }
    .list li{
      padding: 12px 0;
      border-bottom: 1px solid var(--border-glass);
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
    }
    .list li:last-child{ border-bottom:none; }
    .list b{ color: var(--text-primary); font-weight: 600; }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.82);
      width: fit-content;
    }

    /* Document download links */
    .doc-links {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .doc-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(91, 75, 138, 0.15);
      border: 1px solid rgba(157, 140, 207, 0.25);
      border-radius: 4px;
      color: var(--purple-bright);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.5px;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    .doc-link:hover {
      background: rgba(91, 75, 138, 0.3);
      border-color: rgba(157, 140, 207, 0.5);
      color: #fff;
      text-decoration: none;
    }
    .doc-icon {
      padding: 2px 5px;
      background: rgba(157, 140, 207, 0.2);
      border-radius: 2px;
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 1px;
    }
    .tag .dot{
      width:6px;height:6px;border-radius:50%;
      background: var(--accent-green);
      box-shadow: 0 0 0 6px rgba(92,214,133,.10);
    }

    /* ============================================
       CRITERIA CHECKLIST
       ============================================ */
    .checklist{
      display:grid;
      gap: 12px;
      margin-top: var(--space-2);
    }
    .check{
      display:flex;
      gap: 12px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.025);
      align-items:flex-start;
    }
    .check svg{ flex:0 0 auto; margin-top: 2px; }
    .check-title{
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 2px;
    }
    .check-desc{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 200;
    }

    /* ============================================
       MECHANISM NODES
       ============================================ */
    .mechanism{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-1);
    }
    @media (max-width: 980px){
      .mechanism{ grid-template-columns: 1fr; }
    }
    .node{
      border: 1px solid var(--border-glass);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 28px 22px;
      position: relative;
      overflow:hidden;
      min-height: 165px;
    }
    .node::before{
      content:"";
      position:absolute;
      inset:-30%;
      background: radial-gradient(circle at 30% 20%, rgba(157,140,207,.08), transparent 55%);
      opacity:.85;
      pointer-events:none;
    }
    .node > *{ position: relative; z-index: 1; }
    .node-num{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 4px;
      color: var(--purple-bright);
      text-transform: uppercase;
      margin-bottom: 12px;
    }
    .node-title{
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 200;
      margin: 0 0 var(--space-1);
      letter-spacing: -0.02em;
    }
    @media (max-width: 600px){
      .node-title{ font-weight: 300; }
    }
    .node-desc{
      color: var(--text-tertiary);
      line-height: 1.65;
      font-size: 13px;
      font-weight: 200;
      margin: 0;
    }

    /* ============================================
       RECORD BLOCK
       ============================================ */
    .record{
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      overflow:hidden;
    }
    .record-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: var(--space-2) 18px;
      background: rgba(91,75,138,.12);
      border-bottom: 1px solid rgba(255,255,255,.10);
      gap: 12px;
      flex-wrap: wrap;
    }
    .record-title{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.88);
    }
    .record-status{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(92,214,133,.92);
      border: 1px solid rgba(92,214,133,.20);
      background: rgba(92,214,133,.06);
      padding: 6px 10px;
      border-radius: 999px;
      display:flex; align-items:center; gap: 8px;
    }
    .record-status .s-dot{
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--accent-green);
    }
    .record-status.illustrative{
      color: rgba(214,160,92,.95);
      border-color: rgba(214,160,92,.25);
      background: rgba(214,160,92,.08);
    }
    .record-status.illustrative .s-dot{
      background: var(--accent-amber);
    }
    .record-head-right{
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }
    .verify-link{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--purple-bright);
      border: 1px solid rgba(157,140,207,.35);
      background: rgba(91,75,138,.08);
      padding: 6px 10px;
      border-radius: 6px;
      transition: all .2s ease;
    }
    .verify-link:hover{
      border-color: rgba(157,140,207,.55);
      background: rgba(91,75,138,.15);
      text-decoration: none;
    }
    .record-body{
      padding: 18px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.86);
    }
    .kv{
      display:grid;
      grid-template-columns: 150px 1fr;
      gap: 12px;
      padding: var(--space-1) 0;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .kv:last-child{ border-bottom:none; }
    .k{
      color: rgba(255,255,255,.42);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .v{
      color: rgba(255,255,255,.90);
      word-break: break-word;
    }
    .hash-row{
      display:flex;
      align-items:center;
      gap:var(--space-1);
    }
    .copy-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.65);
      padding:4px 8px;
      border-radius:6px;
      font-family:var(--mono);
      font-size:9px;
      letter-spacing:1px;
      text-transform:uppercase;
      cursor:pointer;
      transition:all .2s ease;
    }
    .copy-btn:hover{
      border-color:rgba(157,140,207,.55);
      background:rgba(91,75,138,.18);
      color:rgba(255,255,255,.90);
    }
    .copy-btn.copied{
      border-color:rgba(92,214,133,.35);
      background:rgba(92,214,133,.12);
      color:rgba(92,214,133,.95);
    }
    .record-note{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.62);
      font-size: 11.5px;
      line-height: 1.7;
      font-weight: 200;
      font-family: var(--sans);
    }
    
    /* Copy toast */
    .copy-toast{
      position: fixed;
      bottom: var(--space-3);
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(92,214,133,.12);
      border: 1px solid rgba(92,214,133,.35);
      color: rgba(92,214,133,.95);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 12px 18px;
      border-radius: 10px;
      backdrop-filter: blur(12px);
      opacity: 0;
      transition: opacity .18s ease, transform .18s var(--ease-out);
      pointer-events: none;
      z-index: 100;
    }
    .copy-toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ============================================
       STATES
       ============================================ */
    .states{
      display:grid;
      gap: var(--space-1);
      margin-top: var(--space-2);
    }
    .state{
      padding: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      align-items:flex-start;
    }
    .state-left{
      display:flex; flex-direction: column; gap: 2px;
    }
    .state-name{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: rgba(255,255,255,.86);
    }
    .state-desc{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 200;
      margin:0;
    }
    .badge{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.80);
      white-space: nowrap;
    }
    .badge.green{ border-color: rgba(92,214,133,.22); color: rgba(92,214,133,.90); background: rgba(92,214,133,.06); }
    .badge.amber{ border-color: rgba(214,160,92,.22); color: rgba(214,160,92,.95); background: rgba(214,160,92,.06); }
    .badge.red{ border-color: rgba(214,92,92,.22); color: rgba(214,92,92,.95); background: rgba(214,92,92,.06); }

    /* ============================================
       ENFORCEMENT DIAGRAM
       ============================================ */
    .diagram-container{
      display:flex;
      flex-direction: column;
      align-items: center;
      margin: var(--space-3) 0 var(--space-5);
    }
    .enforcement-diagram{
      max-width: 400px;
      width: 100%;
      height: auto;
    }
    .diagram-caption{
      font-size: 11px;
      color: var(--text-tertiary);
      text-align: center;
      margin-top: var(--space-2);
      font-family: var(--mono);
      letter-spacing: 0.5px;
    }
    
    /* Subtle interlock pulse */
    @keyframes interlock-pulse {
      0%, 100% { 
        stroke: rgba(157,140,207,0.65);
        filter: drop-shadow(0 0 0 rgba(157,140,207,0));
      }
      50% { 
        stroke: rgba(157,140,207,0.85);
        filter: drop-shadow(0 0 8px rgba(157,140,207,0.25));
      }
    }
    .interlock-bg{
      animation: interlock-pulse 3s ease-in-out infinite;
    }
    
    @media (prefers-reduced-motion: reduce){
      .interlock-bg{ animation: none; }
    }
    
    /* ============================================
       CONTACT
       ============================================ */
    /* Process Timeline */
    .process-timeline{ display: flex; flex-direction: column; gap: 0; }
    .process-step{ display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border-glass); }
    .process-step:last-child{ border-bottom: none; }
    .process-step-num{ 
      width: 28px; height: 28px; flex-shrink: 0;
      background: rgba(91,75,138,.18); border: 1px solid rgba(157,140,207,.35);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-size: 11px; color: var(--purple-bright);
    }
    .process-step-content b{ display: block; margin-bottom: 4px; }
    .process-step-content p{ color: var(--text-secondary); font-size: 13px; line-height: 1.6; margin: 0; }

    .contact-card{
      max-width: 540px;
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: 8px 0;
      backdrop-filter: blur(18px);
    }
    .contact-row{
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 28px;
      border-bottom: 1px solid var(--border-glass);
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .contact-row:last-child{ border-bottom: none; }
    .contact-label{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-tertiary);
    }
    .contact-link{
      font-family: var(--sans);
      font-size: 14px;
      color: var(--purple-bright);
      transition: color .2s ease;
    }
    .contact-link:hover{
      color: var(--text-primary);
      text-decoration: none;
    }

    /* ============================================
       DEFINITION CALLOUT
       ============================================ */
    .definition-callout{
      background: rgba(91,75,138,.08);
      border: 1px solid rgba(157,140,207,.25);
      border-radius: 12px;
      padding: var(--space-2) 18px;
      margin-top: var(--space-2);
    }
    .definition-term{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--purple-bright);
      margin-bottom: 6px;
    }
    .definition-text{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.65;
      font-weight: 200;
      margin: 0;
    }
    
    /* ============================================
       PROGRAM IDENTITY
       ============================================ */
    .program-grid{
      display: grid;
      gap: 8px;
      font-size: 13px;
    }
    .program-row{
      display: flex;
      justify-content: space-between;
      gap: var(--space-2);
      flex-wrap: wrap;
      padding: 6px 0;
      border-bottom: 1px solid var(--border-glass);
    }
    .program-row:last-child{ border-bottom: none; }
    .program-label{
      color: var(--text-tertiary);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .program-value{
      color: var(--text-primary);
    }
    .program-value.amber{
      color: var(--accent-amber);
    }
    .program-value a{
      color: var(--purple-bright);
    }
    
    /* ============================================
       FOOTER
       ============================================ */
    footer{
      border-top: 1px solid var(--border-glass);
      padding: var(--space-6) 0 var(--space-4);
      margin-top: var(--space-4);
      color: rgba(255,255,255,.45);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
    }
    .footer-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--space-2);
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .footer-spec{
      margin-top: 8px;
      color: rgba(255,255,255,.38);
      font-size: 9px;
      letter-spacing: 1px;
    }
    .footer-disclaimer{
      margin-top: 12px;
      color: rgba(255,255,255,.42);
      font-size: 10px;
      max-width: 480px;
      line-height: 1.7;
    }
    .foot-links{ display:flex; gap: var(--space-4); flex-wrap: wrap; }
    .foot-col{ display:flex; flex-direction:column; gap:8px; min-width:120px; }
    .foot-col-title{ font-family:var(--mono); font-size:9px; letter-spacing:2px; color:var(--purple-bright); margin-bottom:4px; }
    .foot-links a{ color: rgba(255,255,255,.48); font-size:13px; }
    .foot-links a:hover{ color: rgba(255,255,255,.82); text-decoration:none; }
    .old-foot-links{
      display:flex; gap: var(--space-2); flex-wrap: wrap;
    }
    .foot-links a{ color: rgba(255,255,255,.48); }
    .foot-links a:hover{ color: rgba(255,255,255,.82); text-decoration:none; }

    /* ============================================
       REVEAL ANIMATION
       ============================================ */
    .reveal{ 
      opacity: 0; 
      transform: translateY(var(--space-3)); 
      transition: opacity .9s var(--ease), transform .9s var(--ease); 
    }
    .reveal.active{ opacity: 1; transform: translateY(0); }
    
    @media (prefers-reduced-motion: reduce){
      .reveal{ opacity: 1; transform: none; transition: none; }
    }

    /* Download Modal */
    .download-modal{
      display: none;
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(6px);
      align-items: center;
      justify-content: center;
      padding: var(--space-2);
    }
    .download-modal.open{ display: flex; }
    .download-modal-card{
      background: var(--bg-deep);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: var(--space-3);
      max-width: 420px;
      width: 100%;
      position: relative;
    }
    .download-modal-close{
      position: absolute;
      top: 14px;
      right: 14px;
      appearance: none;
      border: none;
      background: none;
      color: var(--text-tertiary);
      font-size: 24px;
      cursor: pointer;
      line-height: 1;
    }
    .download-modal-close:hover{ color: var(--text-primary); }
    .download-modal-card h3{
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 200;
      margin: 0 0 8px;
    }
    .download-modal-card > p{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.7;
      margin: 0 0 var(--space-2);
    }
    .download-form-group{ margin-bottom: 14px; }
    .download-form-label{
      display: block;
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-tertiary);
      margin-bottom: 6px;
    }
    .download-form-input, .download-form-select{
      width: 100%;
      padding: 12px 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border-glass);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: var(--sans);
      font-size: 14px;
    }
    .download-form-input:focus, .download-form-select:focus{
      outline: none;
      border-color: rgba(157,140,207,.55);
    }
    .download-form-select{
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }
    .download-form-btn{
      appearance: none;
      width: 100%;
      border: 1px solid rgba(157,140,207,.55);
      background: rgba(91,75,138,.18);
      color: var(--text-primary);
      padding: 14px 24px;
      border-radius: 12px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .2s var(--ease), border-color .2s ease, background .2s ease;
    }
    .download-form-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(157,140,207,.85);
      background: rgba(91,75,138,.26);
    }
    .download-form-fine{
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: var(--space-2);
      line-height: 1.6;
      text-align: center;
    }

    .status-badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 16px; border-radius: 24px;
      font-family: var(--mono); font-size: 11px; font-weight: 500;
      letter-spacing: 1px; text-transform: uppercase;
      margin-bottom: 20px;
    }
    .status-badge .dot { width: 8px; height: 8px; border-radius: 50%; }
    .status-running { background: rgba(92,214,133,.12); color: var(--accent-green); }
    .status-running .dot { background: var(--accent-green); animation: pulse 2s infinite; }
    .status-waiting { background: rgba(214,160,92,.12); color: var(--accent-amber); }
    .status-waiting .dot { background: var(--accent-amber); }
    .status-certified { background: rgba(157,140,207,.15); color: var(--purple-bright); }
    .status-certified .dot { background: var(--purple-bright); }
    .status-not_found { background: rgba(214,92,92,.12); color: var(--accent-red); }
    .status-not_found .dot { background: var(--accent-red); }
    .result-panel {
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 16px;
      padding: 28px;
      display: none;
    }
    .result-panel.show { display: block; }
    th: 500px) {
      .metrics-grid { grid-template-columns: repeat(2, 1fr); }
    .progress-bar {
      height: 6px; background: rgba(255,255,255,.08);
      border-radius: 3px; overflow: hidden; margin: 16px 0 8px;
    }
    .progress-fill {
      height: 100%; border-radius: 3px;
      background: linear-gradient(90deg, var(--purple-primary), var(--purple-bright));
    }
    .progress-label {
      font-family: var(--mono); font-size: 11px;
      color: var(--text-tertiary); text-align: center;
    }
    .metrics-grid {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 10px; margin: 24px 0;
    }
    .metric-card {
      background: rgba(0,0,0,.2); border-radius: 10px;
      padding: 14px 8px; text-align: center;
    }
    .metric-value { font-family: var(--serif); font-size: 24px; font-weight: 300; }
    .metric-value.green { color: var(--accent-green); }
    .metric-value.red { color: var(--accent-red); }
    .metric-label {
      font-family: var(--mono); font-size: 8px; letter-spacing: 1px;
      text-transform: uppercase; color: var(--text-tertiary); margin-top: 4px;
    }
    @keyframes eye-pulse {
      0%, 100% {
        opacity: .75;
        transform: scale(.98);
        box-shadow: 0 0 0 rgba(196,184,232,0);
      }
      50% {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 10px rgba(157,140,207,.22);
      }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; }
    @media (prefers-reduced-motion: reduce){
      .brand-mark-inner{ animation: none; opacity: .9; }
    @media (max-width: 500px) {
      .metrics-grid { grid-template-columns: repeat(2, 1fr); }
  
  </style>
</head>
<body>
  <!-- Grid overlay -->
  <div class="grid-overlay" aria-hidden="true"></div>
  
  <!-- Site header -->
  <header class="site-header">
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-mark" aria-hidden="true">
          <div class="brand-mark-inner"></div>
        </div>
        <div class="brand-name">Sentinel Authority</div>
      </a>
      <a href="index.html" class="back-link">← Back to Home</a>
    </div>
  </header>

  <main style="position: relative; z-index: 1; max-width: var(--max, 1200px); margin: 0 auto; padding: calc(var(--nav-height, 72px) + 60px) var(--space-2, 20px) 60px;">
    <h1>CAT-72 Test Status</h1>
    <p class="page-desc">Enter your Certificate ID to check your test progress</p>

    <div class="search-panel">
      <div class="search-row">
        <input type="text" id="certId" placeholder="Certificate ID (e.g., ODDC-2026-0001)">
        <button class="btn-primary" onclick="checkStatus()">Check</button>
      </div>
    </div>

    <div class="result-panel" id="result"></div>
  </main>

  <!-- Footer -->
  <footer style="margin-top: var(--space-8, 80px); padding: var(--space-4, 40px) var(--space-2, 20px); border-top: 1px solid var(--border-glass, rgba(255,255,255,.10)); text-align: center;">
    <div style="max-width: var(--max, 1200px); margin: 0 auto;">
      <div style="font-family: var(--mono, 'IBM Plex Mono', monospace); font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-tertiary, rgba(255,255,255,.50));">
        © <span id="footer-year"></span> SENTINEL AUTHORITY
      </div>
      <div style="margin-top: 16px; display: flex; justify-content: center; gap: 24px; flex-wrap: wrap; font-family: var(--mono, 'IBM Plex Mono', monospace); font-size: 10px; letter-spacing: 1px;">
        <a href="privacy.html" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Privacy</a>
        <a href="terms.html" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Terms</a>
        <a href="index.html#artifacts" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Documents</a>
        <a href="conformance-agreement.html" style="color: var(--text-tertiary, rgba(255,255,255,.50)); text-decoration: none; transition: color 0.2s;">Conformance</a>
      </div>
    </div>
  </footer>
  <script>document.getElementById("footer-year").textContent = new Date().getFullYear();</script>
  <script>
const params = new URLSearchParams(window.location.search);
    const certParam = params.get('cert');
    if (certParam) {
      document.getElementById('certId').value = certParam;
      checkStatus();
    }

    async function checkStatus() {
      const certId = document.getElementById('certId').value.trim();
      if (!certId) return alert('Please enter a Certificate ID');

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p style="color: var(--text-tertiary); text-align: center;">Loading...</p>';
      resultDiv.classList.add('show');

      try {
        const res = await fetch(`https://sentinel-authority-production.up.railway.app/api/verify/status/${encodeURIComponent(certId)}`);
        const data = await res.json();

        if (data.status === 'not_found') {
          resultDiv.innerHTML = `
            <span class="status-badge status-not_found"><span class="dot"></span>Not Found</span>
            <div class="not-found-content">
              <p>${data.message}</p>
              <p>Make sure your ENVELO Agent is running with the correct Certificate ID.</p>
            </div>
          `;
        } else if (data.status === 'certified') {
          resultDiv.innerHTML = `
            <span class="status-badge status-certified"><span class="dot"></span>Certified</span>
            <div class="certified-content">
              <h2>🎉 Congratulations!</h2>
              <p>Your system passed CAT-72 certification.</p>
              <div class="cert-details">
                <p><strong>Certificate:</strong> ${data.certificate_number}</p>
                <p><strong>Issued:</strong> ${new Date(data.issued_at).toLocaleDateString()}</p>
                <p><strong>Expires:</strong> ${new Date(data.expires_at).toLocaleDateString()}</p>
              </div>
              <a href="https://app.sentinelauthority.org" class="btn-primary" style="display: inline-block; text-decoration: none; margin-top: 12px;">Go to Dashboard</a>
            </div>
          `;
        } else {
          const progressPercent = Math.min(100, (data.hours_elapsed / 72) * 100);
          resultDiv.innerHTML = `
            <span class="status-badge status-${data.status}">
              <span class="dot"></span>${data.status === 'running' ? 'Test Running' : 'Waiting for Agent'}
            </span>

            <div class="time-display">
              <div class="big">${data.hours_remaining.toFixed(1)}h</div>
              <div class="label">Remaining</div>
            </div>

            <div class="progress-bar"><div class="progress-fill" style="width: ${progressPercent}%"></div></div>
            <p class="progress-label">${data.hours_elapsed.toFixed(1)} / 72 hours</p>

            <div class="metrics-grid">
              <div class="metric-card"><div class="metric-value">${data.total_actions}</div><div class="metric-label">Actions</div></div>
              <div class="metric-card"><div class="metric-value green">${data.pass_count}</div><div class="metric-label">Passed</div></div>
              <div class="metric-card"><div class="metric-value ${data.block_count > 0 ? 'red' : ''}">${data.block_count}</div><div class="metric-label">Blocked</div></div>
              <div class="metric-card"><div class="metric-value ${data.pass_rate >= 95 ? 'green' : ''}">${data.pass_rate}%</div><div class="metric-label">Pass Rate</div></div>
            </div>

            <div class="criteria-section">
              <h3 class="criteria-title">Certification Criteria</h3>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.duration_met ? 'criteria-met' : 'criteria-pending'}">${data.criteria.duration_met ? '✓' : '○'}</span>72 hours continuous operation</div>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.actions_met ? 'criteria-met' : 'criteria-pending'}">${data.criteria.actions_met ? '✓' : '○'}</span>Minimum 100 actions</div>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.pass_rate_met ? 'criteria-met' : 'criteria-pending'}">${data.criteria.pass_rate_met ? '✓' : '○'}</span>≥95% pass rate</div>
              <div class="criteria-item"><span class="criteria-icon ${data.criteria.blocking_verified ? 'criteria-met' : 'criteria-pending'}">${data.criteria.blocking_verified ? '✓' : '○'}</span>Blocking verified</div>
            </div>

            <div class="message">${data.status === 'waiting' ? 'Your ENVELO Agent is not connected. Make sure it is running.' : 'Test in progress. Keep your system running.'}</div>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `<p style="color: var(--accent-red);">Error: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
</file>

<file path="backend/Dockerfile">
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD uvicorn main:app --host 0.0.0.0 --port $PORT
</file>

<file path="backend/app/api/routes/apikeys.py">
"""
API Key Management
"""

import secrets
import hashlib
from datetime import datetime, timezone
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from pydantic import BaseModel
from typing import Optional

from app.core.database import get_db
from app.core.security import get_current_user
from app.models.models import APIKey, User, Certificate

router = APIRouter()


def generate_api_key():
    """Generate a new API key"""
    random_part = secrets.token_hex(20)
    key = f"sa_live_{random_part}"
    return key


def hash_key(key: str) -> str:
    """Hash an API key for storage"""
    return hashlib.sha256(key.encode()).hexdigest()


class APIKeyCreate(BaseModel):
    name: str
    certificate_id: Optional[int] = None


@router.post("/generate")
async def generate_new_key(
    data: APIKeyCreate,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Generate a new API key for the user"""
    
    sub = current_user.get("sub")
    if not sub:
        raise HTTPException(status_code=401, detail="Invalid user token")
    user_id = int(sub)
    
    # Generate the key
    raw_key = generate_api_key()
    key_hash = hash_key(raw_key)
    key_prefix = raw_key[:12]
    
    # If certificate_id provided, verify it exists
    if data.certificate_id:
        result = await db.execute(
            select(Certificate).where(Certificate.id == data.certificate_id)
        )
        cert = result.scalar_one_or_none()
        if not cert:
            raise HTTPException(status_code=404, detail="Certificate not found")
    
    # Create the key record
    api_key = APIKey(
        key_hash=key_hash,
        key_prefix=key_prefix,
        certificate_id=data.certificate_id,
        user_id=user_id,
        name=data.name,
        is_active=True
    )
    
    db.add(api_key)
    await db.commit()
    await db.refresh(api_key)
    
    return {
        "id": api_key.id,
        "key": raw_key,
        "key_prefix": key_prefix,
        "name": data.name,
        "certificate_id": data.certificate_id,
        "message": "Save this key securely. It cannot be retrieved again."
    }


@router.get("/")
async def list_keys(
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """List all API keys for the current user"""
    
    sub = current_user.get("sub")
    if not sub:
        raise HTTPException(status_code=401, detail="Invalid user token")
    user_id = int(sub)
    
    result = await db.execute(
        select(APIKey).where(
            APIKey.user_id == user_id,
            APIKey.revoked_at == None
        ).order_by(APIKey.created_at.desc())
    )
    keys = result.scalars().all()
    
    return [
        {
            "id": k.id,
            "key_prefix": k.key_prefix,
            "name": k.name,
            "certificate_id": k.certificate_id,
            "created_at": k.created_at.isoformat() if k.created_at else None,
            "last_used_at": k.last_used_at.isoformat() if k.last_used_at else None,
            "is_active": k.is_active
        }
        for k in keys
    ]


@router.delete("/{key_id}")
async def revoke_key(
    key_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Revoke an API key"""
    
    sub = current_user.get("sub")
    if not sub:
        raise HTTPException(status_code=401, detail="Invalid user token")
    user_id = int(sub)
    
    result = await db.execute(
        select(APIKey).where(
            APIKey.id == key_id,
            APIKey.user_id == user_id
        )
    )
    api_key = result.scalar_one_or_none()
    
    if not api_key:
        raise HTTPException(status_code=404, detail="API key not found")
    
    api_key.is_active = False
    api_key.revoked_at = datetime.utcnow()
    
    await db.commit()
    
    return {"message": "API key revoked"}


async def validate_api_key(key: str, db: AsyncSession) -> Optional[APIKey]:
    """Validate an API key and return the APIKey object if valid"""
    
    key_hash = hash_key(key)
    
    result = await db.execute(
        select(APIKey).where(
            APIKey.key_hash == key_hash,
            APIKey.is_active == True,
            APIKey.revoked_at == None
        )
    )
    api_key = result.scalar_one_or_none()
    
    if api_key:
        api_key.last_used_at = datetime.utcnow()
        await db.commit()
    
    return api_key
</file>

<file path="backend/app/models/models.py">
"""Database models."""

import enum
from datetime import datetime
from sqlalchemy import Column, Integer, String, Text, DateTime, Float, Boolean, ForeignKey, Enum, JSON, LargeBinary
from sqlalchemy.orm import relationship
from app.core.database import Base


class UserRole(str, enum.Enum):
    ADMIN = "admin"
    OPERATOR = "operator"
    APPLICANT = "applicant"
    SUBSCRIBER = "subscriber"
    LICENSEE = "licensee"


class CertificationState(str, enum.Enum):
    PENDING = "pending"
    UNDER_REVIEW = "under_review"
    OBSERVE = "observe"
    BOUNDED = "bounded"
    CONFORMANT = "conformant"
    SUSPENDED = "suspended"
    REVOKED = "revoked"
    EXPIRED = "expired"


class TestState(str, enum.Enum):
    SCHEDULED = "scheduled"
    RUNNING = "running"
    PAUSED = "paused"
    COMPLETED = "completed"
    FAILED = "failed"
    ABORTED = "aborted"


class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, index=True)
    email = Column(String(255), unique=True, index=True, nullable=False)
    hashed_password = Column(String(255), nullable=False)
    full_name = Column(String(255))
    organization = Column(String(255))
    role = Column(Enum(UserRole), default=UserRole.SUBSCRIBER)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    applications = relationship("Application", back_populates="applicant")


class Application(Base):
    __tablename__ = "applications"
    id = Column(Integer, primary_key=True, index=True)
    application_number = Column(String(50), unique=True, index=True)
    applicant_id = Column(Integer, ForeignKey("users.id"))
    organization_name = Column(String(255), nullable=False)
    contact_name = Column(String(255))
    contact_email = Column(String(255))
    contact_phone = Column(String(50))
    system_name = Column(String(255), nullable=False)
    system_description = Column(Text)
    system_version = Column(String(50))
    manufacturer = Column(String(255))
    odd_specification = Column(JSON)
    envelope_definition = Column(JSON)
    state = Column(Enum(CertificationState), default=CertificationState.PENDING)
    submitted_at = Column(DateTime, default=datetime.utcnow)
    reviewed_at = Column(DateTime)
    preferred_test_date = Column(DateTime)
    facility_location = Column(String(255))
    notes = Column(Text)
    created_at = Column(DateTime, default=datetime.utcnow)
    applicant = relationship("User", back_populates="applications")
    tests = relationship("CAT72Test", back_populates="application")
    certificate = relationship("Certificate", back_populates="application", uselist=False)


class CAT72Test(Base):
    __tablename__ = "cat72_tests"
    id = Column(Integer, primary_key=True, index=True)
    test_id = Column(String(50), unique=True, index=True)
    application_id = Column(Integer, ForeignKey("applications.id"))
    duration_hours = Column(Integer, default=72)
    envelope_definition = Column(JSON)
    state = Column(Enum(TestState), default=TestState.SCHEDULED)
    started_at = Column(DateTime)
    ended_at = Column(DateTime)
    elapsed_seconds = Column(Integer, default=0)
    operator_id = Column(Integer, ForeignKey("users.id"))
    total_samples = Column(Integer, default=0)
    conformant_samples = Column(Integer, default=0)
    interlock_activations = Column(Integer, default=0)
    max_drift_observed = Column(Float, default=0.0)
    convergence_score = Column(Float)
    drift_rate = Column(Float)
    stability_index = Column(Float)
    envelope_margin = Column(Float)
    evidence_hash = Column(String(64))
    evidence_chain = Column(JSON)
    result = Column(String(50))
    result_notes = Column(Text)
    created_at = Column(DateTime, default=datetime.utcnow)
    application = relationship("Application", back_populates="tests")
    telemetry = relationship("Telemetry", back_populates="test")
    interlock_events = relationship("InterlockEvent", back_populates="test")


class Telemetry(Base):
    __tablename__ = "telemetry"
    id = Column(Integer, primary_key=True, index=True)
    test_id = Column(Integer, ForeignKey("cat72_tests.id"), index=True)
    timestamp = Column(DateTime, nullable=False, index=True)
    elapsed_seconds = Column(Integer)
    state_vector = Column(JSON)
    in_envelope = Column(Boolean)
    envelope_distance = Column(Float)
    convergence_score = Column(Float)
    drift_rate = Column(Float)
    stability_index = Column(Float)
    sample_hash = Column(String(64))
    prev_hash = Column(String(64))
    test = relationship("CAT72Test", back_populates="telemetry")


class InterlockEvent(Base):
    __tablename__ = "interlock_events"
    id = Column(Integer, primary_key=True, index=True)
    test_id = Column(Integer, ForeignKey("cat72_tests.id"), index=True)
    timestamp = Column(DateTime, nullable=False)
    elapsed_seconds = Column(Integer)
    trigger_type = Column(String(50))
    trigger_parameter = Column(String(100))
    trigger_value = Column(Float)
    threshold_value = Column(Float)
    action_type = Column(String(50))
    action_details = Column(JSON)
    state_before = Column(JSON)
    state_after = Column(JSON)
    event_hash = Column(String(64))
    test = relationship("CAT72Test", back_populates="interlock_events")


class Certificate(Base):
    __tablename__ = "certificates"
    id = Column(Integer, primary_key=True, index=True)
    certificate_number = Column(String(50), unique=True, index=True)
    application_id = Column(Integer, ForeignKey("applications.id"))
    organization_name = Column(String(255))
    system_name = Column(String(255))
    system_version = Column(String(50))
    odd_specification = Column(JSON)
    envelope_definition = Column(JSON)
    state = Column(Enum(CertificationState), default=CertificationState.CONFORMANT)
    issued_at = Column(DateTime, default=datetime.utcnow)
    expires_at = Column(DateTime)
    issued_by = Column(Integer, ForeignKey("users.id"))
    test_id = Column(Integer, ForeignKey("cat72_tests.id"))
    convergence_score = Column(Float)
    evidence_hash = Column(String(64))
    signature = Column(String(50))  # Authority signature e.g., SA-SIG-1
    audit_log_ref = Column(String(50))  # Audit trail reference e.g., SA-LOG-2026-0001
    certificate_pdf = Column(LargeBinary)
    verification_url = Column(String(255))
    history = Column(JSON)
    created_at = Column(DateTime, default=datetime.utcnow)
    application = relationship("Application", back_populates="certificate")


class Licensee(Base):
    __tablename__ = "licensees"
    id = Column(Integer, primary_key=True, index=True)
    license_number = Column(String(50), unique=True, index=True)
    organization_name = Column(String(255), nullable=False)
    contact_name = Column(String(255))
    contact_email = Column(String(255))
    license_type = Column(String(50))
    licensed_at = Column(DateTime, default=datetime.utcnow)
    expires_at = Column(DateTime)
    is_active = Column(Boolean, default=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    api_key = Column(String(255))
    created_at = Column(DateTime, default=datetime.utcnow)


class AuditLog(Base):
    __tablename__ = "audit_log"
    id = Column(Integer, primary_key=True, index=True)
    timestamp = Column(DateTime, default=datetime.utcnow, index=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    user_email = Column(String(255))
    action = Column(String(100), index=True)
    resource_type = Column(String(50))
    resource_id = Column(Integer)
    details = Column(JSON)
    log_hash = Column(String(64))


# ENVELO API Keys
class APIKey(Base):
    __tablename__ = "api_keys"
    
    id = Column(Integer, primary_key=True, index=True)
    key_hash = Column(String(64), unique=True, index=True)  # SHA-256 hash of the key
    key_prefix = Column(String(12))  # First 8 chars for identification (sa_live_xxxx)
    certificate_id = Column(Integer, ForeignKey("certificates.id"), nullable=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    name = Column(String(100))  # Friendly name like "Production Key"
    created_at = Column(DateTime, default=datetime.utcnow)
    last_used_at = Column(DateTime, nullable=True)
    revoked_at = Column(DateTime, nullable=True)
    is_active = Column(Boolean, default=True)
    
    certificate = relationship("Certificate", backref="api_keys")
    user = relationship("User", backref="api_keys")


# ENVELO Sessions
class EnveloSession(Base):
    __tablename__ = "envelo_sessions"
    
    id = Column(Integer, primary_key=True, index=True)
    session_id = Column(String(32), unique=True, index=True)
    certificate_id = Column(Integer, ForeignKey("certificates.id"))
    api_key_id = Column(Integer, ForeignKey("api_keys.id"))
    started_at = Column(DateTime, default=datetime.utcnow)
    ended_at = Column(DateTime, nullable=True)
    agent_version = Column(String(20))
    status = Column(String(20), default="active")  # active, ended, disconnected
    last_telemetry_at = Column(DateTime, nullable=True)
    last_heartbeat_at = Column(DateTime, nullable=True)
    last_violation_alert_at = Column(DateTime, nullable=True)
    last_offline_alert_at = Column(DateTime, nullable=True)
    pass_count = Column(Integer, default=0)
    block_count = Column(Integer, default=0)
    
    certificate = relationship("Certificate", backref="envelo_sessions")
    api_key = relationship("APIKey", backref="sessions")


# ENVELO Telemetry Records
class TelemetryRecord(Base):
    __tablename__ = "telemetry_records"
    
    id = Column(Integer, primary_key=True, index=True)
    session_id = Column(Integer, ForeignKey("envelo_sessions.id"), index=True)
    timestamp = Column(DateTime, index=True)
    action_id = Column(String(50))
    action_type = Column(String(100))
    result = Column(String(10))  # PASS or BLOCK
    execution_time_ms = Column(Float)
    parameters = Column(Text)  # JSON
    boundary_evaluations = Column(Text)  # JSON
    system_state = Column(Text)  # JSON
    
    session = relationship("EnveloSession", backref="telemetry_records")


# ENVELO Violations (for quick access to blocks)
class Violation(Base):
    __tablename__ = "violations"
    
    id = Column(Integer, primary_key=True, index=True)
    session_id = Column(Integer, ForeignKey("envelo_sessions.id"), index=True)
    telemetry_id = Column(Integer, ForeignKey("telemetry_records.id"))
    timestamp = Column(DateTime, index=True)
    boundary_name = Column(String(100))
    violation_message = Column(Text)
    parameters = Column(Text)  # JSON
    
    session = relationship("EnveloSession", backref="violations")
</file>

<file path="backend/main.py">
"""
Sentinel Authority Platform API
Unified certification platform for autonomous systems operating under ENVELO
"""

import logging
from contextlib import asynccontextmanager

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import HTMLResponse

from app.core.config import settings
from app.core.database import init_db
from app.api.routes import auth, dashboard, applicants, cat72, certificates, verification, licensees, envelo, apikeys

# Logging setup
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("main")


@asynccontextmanager
async def lifespan(app: FastAPI):
    logger.info("Starting Sentinel Authority Platform...")
    await init_db()
    logger.info("Database initialized")
    yield
    logger.info("Shutting down...")


app = FastAPI(
    title="Sentinel Authority API",
    description="Certification platform for autonomous systems under ENVELO framework",
    version="1.0.0",
    lifespan=lifespan,
    docs_url=None,
    redoc_url="/redoc",
)

app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# API Routes
app.include_router(auth.router, prefix="/api/auth", tags=["Authentication"])
app.include_router(dashboard.router, prefix="/api/dashboard", tags=["Dashboard"])
app.include_router(applicants.router, prefix="/api/applications", tags=["Applicant Portal"])
app.include_router(cat72.router, prefix="/api/cat72", tags=["CAT-72 Console"])
app.include_router(certificates.router, prefix="/api/certificates", tags=["Certification Registry"])
app.include_router(verification.router, prefix="/api/verify", tags=["Public Verification"])
app.include_router(licensees.router, prefix="/api/licensees", tags=["Licensee Portal"])
app.include_router(envelo.router, prefix="/api/envelo", tags=["ENVELO Agent"])
app.include_router(apikeys.router, prefix="/api/apikeys", tags=["API Keys"])


@app.get("/health")
async def health_check():
    return {"status": "healthy", "service": "sentinel-authority"}


@app.get("/")
async def root():
    return {
        "name": "Sentinel Authority Platform",
        "version": "1.0.0",
        "framework": "ENVELO",
        "docs": "/docs"
    }


@app.get("/docs", include_in_schema=False)
async def custom_swagger_ui():
    return HTMLResponse(content="""<!DOCTYPE html>
<html>
<head>
    <title>Sentinel Authority API</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@300;400;500&family=Source+Serif+4:opsz,wght@8..60,200;8..60,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css" />
    <style>
        :root {
            --bg-deep: #1a1d24;
            --bg-panel: rgba(255,255,255,0.03);
            --purple-primary: #5B4B8A;
            --purple-bright: #9d8ccf;
            --green: #5CD685;
            --amber: #D6A05C;
            --red: #D65C5C;
            --text-primary: #e8e6e3;
            --text-secondary: #a8a5a0;
            --text-tertiary: #6b6966;
            --border-glass: rgba(255,255,255,0.08);
        }
        
        * { box-sizing: border-box; }
        
        body { 
            background: var(--bg-deep); 
            margin: 0; 
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated background gradients */
        .bg-gradient-1 {
            position: fixed; top: -15%; left: -5%; width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(91,75,138,0.25) 0%, transparent 70%);
            animation: float1 20s ease-in-out infinite; pointer-events: none; z-index: 0;
        }
        .bg-gradient-2 {
            position: fixed; bottom: -25%; right: -10%; width: 800px; height: 800px;
            background: radial-gradient(circle, rgba(92,214,133,0.12) 0%, transparent 70%);
            animation: float2 25s ease-in-out infinite; pointer-events: none; z-index: 0;
        }
        .bg-gradient-3 {
            position: fixed; top: 40%; right: 15%; width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(157,140,207,0.15) 0%, transparent 70%);
            animation: float3 15s ease-in-out infinite; pointer-events: none; z-index: 0;
        }
        
        /* Grid overlay */
        .grid-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 0;
            background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            opacity: 0.5;
        }
        
        @keyframes float1 { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(40px, -40px) scale(1.05); } 66% { transform: translate(-30px, 30px) scale(0.95); } }
        @keyframes float2 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-50px, -50px) scale(1.1); } }
        @keyframes float3 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(30px, 40px); } }
        
        /* Custom header */
        .custom-header {
            position: relative; z-index: 10;
            background: rgba(30,34,44,0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-glass);
            padding: 24px 40px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .header-brand {
            display: flex; align-items: center; gap: 16px;
        }
        .brand-mark {
            width: 44px; height: 44px;
            background: linear-gradient(135deg, #5B4B8A 0%, #7B6BAA 100%);
            border: 2px solid #9d8ccf; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 20px rgba(91,75,138,0.4);
        }
        .brand-mark-dot {
            width: 14px; height: 14px;
            background: radial-gradient(circle, #e8e0ff 0%, #c4b8e8 100%);
            border-radius: 50%;
        }
        .header-title {
            font-family: 'Source Serif 4', serif;
            font-size: 24px; font-weight: 200;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }
        .header-title span { color: var(--purple-bright); font-style: italic; }
        .header-badge {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px; letter-spacing: 2px; text-transform: uppercase;
            color: var(--green); background: rgba(92,214,133,0.1);
            border: 1px solid rgba(92,214,133,0.3);
            padding: 6px 14px; border-radius: 20px;
            display: flex; align-items: center; gap: 8px;
        }
        .header-badge::before {
            content: ''; width: 6px; height: 6px; border-radius: 50%;
            background: var(--green); box-shadow: 0 0 8px var(--green);
        }
        .header-links {
            display: flex; gap: 12px;
        }
        .header-link {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px; letter-spacing: 1px; text-transform: uppercase;
            color: var(--text-tertiary); text-decoration: none;
            padding: 10px 18px; border-radius: 10px;
            border: 1px solid var(--border-glass);
            transition: all 0.3s ease;
        }
        .header-link:hover {
            color: var(--purple-bright);
            border-color: rgba(157,140,207,0.3);
            background: rgba(157,140,207,0.1);
        }
        
        /* Swagger UI overrides */
        .swagger-ui { 
            background: transparent !important;
            position: relative; z-index: 5;
        }
        .swagger-ui .wrapper { padding: 30px 40px; max-width: 1400px; }
        
        /* Hide default topbar */
        .swagger-ui .topbar { display: none !important; }
        
        /* Info section */
        .swagger-ui .info { margin: 30px 0 40px; }
        .swagger-ui .info .title { 
            font-family: 'Source Serif 4', serif !important;
            font-size: 32px !important; font-weight: 200 !important;
            color: var(--text-primary) !important;
        }
        .swagger-ui .info .title small { 
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-bright)) !important;
            border-radius: 8px !important; padding: 4px 12px !important;
            font-family: 'IBM Plex Mono', monospace !important;
            font-size: 10px !important; letter-spacing: 1px !important;
        }
        .swagger-ui .info .description, .swagger-ui .info p, .swagger-ui .info li {
            font-family: 'Inter', sans-serif !important;
            color: var(--text-secondary) !important;
            font-size: 14px !important; line-height: 1.7 !important;
        }
        .swagger-ui .info a { color: var(--purple-bright) !important; }
        
        /* Filter */
        .swagger-ui .filter-container { margin: 20px 0; }
        .swagger-ui input[type=text] {
            background: rgba(0,0,0,0.3) !important;
            border: 1px solid var(--border-glass) !important;
            border-radius: 12px !important;
            color: var(--text-primary) !important;
            font-family: 'IBM Plex Mono', monospace !important;
            padding: 14px 18px !important;
            transition: all 0.3s ease !important;
        }
        .swagger-ui input[type=text]:focus {
            border-color: rgba(157,140,207,0.5) !important;
            box-shadow: 0 0 0 3px rgba(157,140,207,0.1) !important;
            outline: none !important;
        }
        .swagger-ui input[type=text]::placeholder { color: var(--text-tertiary) !important; }
        
        /* Operation blocks */
        .swagger-ui .opblock-tag { 
            font-family: 'Source Serif 4', serif !important;
            font-size: 20px !important; font-weight: 400 !important;
            color: var(--text-primary) !important;
            border-bottom: 1px solid var(--border-glass) !important;
            padding: 16px 0 !important;
        }
        .swagger-ui .opblock-tag small { 
            font-family: 'Inter', sans-serif !important;
            color: var(--text-tertiary) !important;
        }
        .swagger-ui .opblock {
            background: var(--bg-panel) !important;
            border: 1px solid var(--border-glass) !important;
            border-radius: 16px !important;
            margin: 12px 0 !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            backdrop-filter: blur(12px) !important;
            overflow: hidden !important;
        }
        .swagger-ui .opblock .opblock-summary {
            padding: 14px 20px !important;
            border: none !important;
        }
        .swagger-ui .opblock .opblock-summary-method {
            font-family: 'IBM Plex Mono', monospace !important;
            font-size: 11px !important; font-weight: 500 !important;
            letter-spacing: 1px !important;
            padding: 8px 14px !important;
            border-radius: 8px !important;
            min-width: 70px !important;
        }
        .swagger-ui .opblock.opblock-get .opblock-summary-method { background: var(--purple-primary) !important; }
        .swagger-ui .opblock.opblock-post .opblock-summary-method { background: var(--green) !important; color: #1a1d24 !important; }
        .swagger-ui .opblock.opblock-put .opblock-summary-method { background: var(--amber) !important; color: #1a1d24 !important; }
        .swagger-ui .opblock.opblock-delete .opblock-summary-method { background: var(--red) !important; }
        .swagger-ui .opblock.opblock-patch .opblock-summary-method { background: #6B8E9F !important; }
        
        .swagger-ui .opblock .opblock-summary-path {
            font-family: 'IBM Plex Mono', monospace !important;
            color: var(--text-primary) !important;
            font-size: 13px !important;
        }
        .swagger-ui .opblock .opblock-summary-description {
            font-family: 'Inter', sans-serif !important;
            color: var(--text-secondary) !important;
            font-size: 13px !important;
        }
        
        .swagger-ui .opblock.opblock-get { border-color: rgba(91,75,138,0.3) !important; }
        .swagger-ui .opblock.opblock-post { border-color: rgba(92,214,133,0.3) !important; }
        .swagger-ui .opblock.opblock-put { border-color: rgba(214,160,92,0.3) !important; }
        .swagger-ui .opblock.opblock-delete { border-color: rgba(214,92,92,0.3) !important; }
        
        .swagger-ui .opblock-body { background: rgba(0,0,0,0.2) !important; }
        .swagger-ui .opblock-section-header {
            background: rgba(0,0,0,0.3) !important;
            border: none !important;
            box-shadow: none !important;
        }
        .swagger-ui .opblock-section-header h4 {
            font-family: 'IBM Plex Mono', monospace !important;
            font-size: 11px !important; letter-spacing: 1px !important;
            text-transform: uppercase !important;
            color: var(--text-tertiary) !important;
        }
        
        /* Parameters */
        .swagger-ui .parameters-col_name {
            font-family: 'IBM Plex Mono', monospace !important;
            color: var(--purple-bright) !important;
        }
        .swagger-ui .parameter__name { color: var(--text-primary) !important; }
        .swagger-ui .parameter__type { color: var(--text-tertiary) !important; }
        .swagger-ui .parameter__in { 
            font-family: 'IBM Plex Mono', monospace !important;
            color: var(--text-tertiary) !important;
            font-style: normal !important;
        }
        .swagger-ui table tbody tr td { 
            border-color: var(--border-glass) !important;
            color: var(--text-secondary) !important;
        }
        
        /* Buttons */
        .swagger-ui .btn {
            font-family: 'IBM Plex Mono', monospace !important;
            font-size: 11px !important; letter-spacing: 1px !important;
            text-transform: uppercase !important;
            border-radius: 10px !important;
            padding: 10px 18px !important;
            transition: all 0.3s ease !important;
        }
        .swagger-ui .btn.execute {
            background: linear-gradient(135deg, var(--purple-primary), #7B6BAA) !important;
            border: 1px solid var(--purple-bright) !important;
            color: #fff !important;
            box-shadow: 0 4px 15px rgba(91,75,138,0.3) !important;
        }
        .swagger-ui .btn.execute:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(91,75,138,0.4) !important;
        }
        .swagger-ui .btn.cancel {
            background: transparent !important;
            border: 1px solid var(--border-glass) !important;
            color: var(--text-tertiary) !important;
        }
        .swagger-ui .btn.authorize {
            background: rgba(92,214,133,0.15) !important;
            border: 1px solid rgba(92,214,133,0.4) !important;
            color: var(--green) !important;
        }
        .swagger-ui .btn.authorize svg { fill: var(--green) !important; }
        
        /* Response */
        .swagger-ui .responses-inner { background: transparent !important; }
        .swagger-ui .response-col_status {
            font-family: 'IBM Plex Mono', monospace !important;
            color: var(--green) !important;
        }
        .swagger-ui .response-col_description {
            color: var(--text-secondary) !important;
        }
        
        /* Models */
        .swagger-ui section.models {
            background: var(--bg-panel) !important;
            border: 1px solid var(--border-glass) !important;
            border-radius: 16px !important;
            backdrop-filter: blur(12px) !important;
        }
        .swagger-ui section.models h4 {
            font-family: 'Source Serif 4', serif !important;
            color: var(--text-primary) !important;
            border: none !important;
        }
        .swagger-ui .model-box {
            background: rgba(0,0,0,0.2) !important;
            border-radius: 12px !important;
        }
        .swagger-ui .model { color: var(--text-secondary) !important; }
        .swagger-ui .model-title { color: var(--purple-bright) !important; }
        .swagger-ui .prop-type { color: var(--green) !important; }
        
        /* Code */
        .swagger-ui .highlight-code, .swagger-ui .microlight {
            background: rgba(0,0,0,0.4) !important;
            border-radius: 12px !important;
            font-family: 'IBM Plex Mono', monospace !important;
        }
        .swagger-ui .microlight { color: var(--text-primary) !important; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--purple-primary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--purple-bright); }
        
        /* Auth modal */
        .swagger-ui .dialog-ux .modal-ux {
            background: rgba(30,34,44,0.98) !important;
            border: 1px solid var(--border-glass) !important;
            border-radius: 20px !important;
            backdrop-filter: blur(20px) !important;
        }
        .swagger-ui .dialog-ux .modal-ux-header {
            border-color: var(--border-glass) !important;
        }
        .swagger-ui .dialog-ux .modal-ux-header h3 {
            font-family: 'Source Serif 4', serif !important;
            color: var(--text-primary) !important;
        }
        .swagger-ui .dialog-ux .modal-ux-content {
            color: var(--text-secondary) !important;
        }
        .swagger-ui .auth-container input[type=text] {
            background: rgba(0,0,0,0.3) !important;
            border: 1px solid var(--border-glass) !important;
            color: var(--text-primary) !important;
        }
        
        /* Misc text */
        .swagger-ui, .swagger-ui .info .title, .swagger-ui .scheme-container {
            background: transparent !important;
        }
        .swagger-ui label { color: var(--text-secondary) !important; }
        .swagger-ui select {
            background: rgba(0,0,0,0.3) !important;
            border: 1px solid var(--border-glass) !important;
            color: var(--text-primary) !important;
            border-radius: 8px !important;
        }
        
        /* Server dropdown */
        .swagger-ui .servers-title {
            font-family: 'IBM Plex Mono', monospace !important;
            color: var(--text-tertiary) !important;
        }
        .swagger-ui .servers > label select {
            padding: 10px 14px !important;
        }
        
        /* Loading */
        .swagger-ui .loading-container { 
            padding: 100px; 
            display: flex; 
            justify-content: center; 
        }
        .swagger-ui .loading-container .loading::before {
            border-color: var(--purple-bright) !important;
            border-top-color: transparent !important;
        }
    </style>
</head>
<body>
    <div class="bg-gradient-1"></div>
    <div class="bg-gradient-2"></div>
    <div class="bg-gradient-3"></div>
    <div class="grid-overlay"></div>
    
    <div class="custom-header">
        <div class="header-brand">
            <div class="brand-mark"><div class="brand-mark-dot"></div></div>
            <div>
                <div class="header-title">API <span>Reference</span></div>
            </div>
        </div>
        <div class="header-badge">Live</div>
        <div class="header-links">
            <a href="https://sentinelauthority.org" class="header-link">Main Site</a>
            <a href="https://app.sentinelauthority.org" class="header-link">Portal</a>
        </div>
    </div>
    
    <div id="swagger-ui"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <script>
        SwaggerUIBundle({
            url: "/openapi.json",
            dom_id: "#swagger-ui",
            presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
            layout: "BaseLayout",
            docExpansion: "list",
            filter: true,
            deepLinking: true,
            defaultModelsExpandDepth: 0,
            displayRequestDuration: true,
        });
    </script>
</body>
</html>""")


# Start auto-evaluator background task
@app.on_event("startup")
async def start_auto_evaluator():
    import asyncio
    from app.services.auto_evaluator import run_auto_evaluator
    asyncio.create_task(run_auto_evaluator())
    
    # Start offline agent monitor
    from app.services.background_tasks import check_offline_agents_task
    from app.core.database import get_db
    asyncio.create_task(check_offline_agents_task(get_db))
    logger.info("Offline agent monitor started")
    logger.info("Auto-evaluator background task started")
</file>

<file path="backend/app/services/email_service.py">
"""
Email Notification Service
Uses Resend for transactional emails
"""

import httpx
import os
from typing import Optional

RESEND_API_KEY = os.getenv("RESEND_API_KEY", "re_BkncgUC1_2uMjrza8EsxuSS8Ja6HLgCTV")
FROM_EMAIL = os.getenv("FROM_EMAIL", "notifications@sentinelauthority.org")

async def send_email(to: str, subject: str, html: str, from_email: str = None) -> bool:
    """Send an email via Resend"""
    try:
        async with httpx.AsyncClient() as client:
            response = await client.post(
                "https://api.resend.com/emails",
                headers={"Authorization": f"Bearer {RESEND_API_KEY}"},
                json={
                    "from": from_email or FROM_EMAIL,
                    "to": to,
                    "subject": subject,
                    "html": html
                }
            )
            return response.status_code == 200
    except Exception as e:
        print(f"Email error: {e}")
        return False


async def send_application_received(to: str, app_name: str, app_id: int):
    """Send application received notification"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #333;">Application Received</h2>
            <p>Thank you for submitting your ODDC certification application.</p>
            <p><strong>System Name:</strong> {app_name}<br>
            <strong>Application ID:</strong> SA-{app_id:04d}</p>
            <p>Our team will review your application within 2-3 business days. 
            You will receive notification when your CAT-72 conformance test is scheduled.</p>
            <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
            <p style="font-size: 12px; color: #666;">
                Questions? Contact us at info@sentinelauthority.org
            </p>
        </div>
    </div>
    """
    await send_email(to, f"Application Received - {app_name}", html)


async def send_test_scheduled(to: str, app_name: str, test_start: str):
    """Send test scheduled notification"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #333;">CAT-72 Test Scheduled</h2>
            <p>Your CAT-72 conformance test has been scheduled.</p>
            <p><strong>System:</strong> {app_name}<br>
            <strong>Test Start:</strong> {test_start}</p>
            <h3 style="color: #5B4B8A;">Before the test begins:</h3>
            <ol>
                <li>Install the ENVELO Agent in your system</li>
                <li>Configure your API key and certificate ID</li>
                <li>Define your ODD boundaries</li>
                <li>Ensure continuous network connectivity</li>
            </ol>
            <p>The test will run for 72 continuous hours. Your system must maintain 
            active ENVELO enforcement throughout.</p>
        </div>
    </div>
    """
    await send_email(to, f"CAT-72 Test Scheduled - {app_name}", html)


async def send_test_started(to: str, app_name: str, test_id: str):
    """Send test started notification"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #5CD685;">✓ CAT-72 Test Started</h2>
            <p>Your CAT-72 conformance test is now active.</p>
            <p><strong>System:</strong> {app_name}<br>
            <strong>Test ID:</strong> {test_id}</p>
            <p>The test will run for 72 hours. You can monitor progress in your dashboard.</p>
            <p style="background: #fff3cd; padding: 12px; border-radius: 4px;">
                <strong>Important:</strong> Maintain continuous ENVELO Agent operation. 
                Extended disconnection may require test restart.
            </p>
        </div>
    </div>
    """
    await send_email(to, f"CAT-72 Test Started - {app_name}", html)


async def send_certificate_issued(to: str, app_name: str, cert_number: str, expiry_date: str):
    """Send certificate issued notification"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #5CD685;">🎉 Certification Complete!</h2>
            <p>Congratulations! Your system has passed CAT-72 conformance testing.</p>
            <p><strong>System:</strong> {app_name}<br>
            <strong>Certificate Number:</strong> {cert_number}<br>
            <strong>Valid Until:</strong> {expiry_date}</p>
            <p>Your certificate is available for download in your dashboard.</p>
            <div style="text-align: center; margin: 30px 0;">
                <a href="https://app.sentinelauthority.org/certificates" 
                   style="background: #5B4B8A; color: white; padding: 12px 30px; 
                          text-decoration: none; border-radius: 6px; font-weight: bold;">
                    View Certificate
                </a>
            </div>
            <p style="font-size: 12px; color: #666;">
                Maintain active ENVELO enforcement to keep your certification valid.
            </p>
        </div>
    </div>
    """
    await send_email(to, f"ODDC Certificate Issued - {cert_number}", html)


async def send_test_failed(to: str, app_name: str, reason: str, pass_rate: float):
    """Send test failed notification"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #D65C5C;">CAT-72 Test Did Not Pass</h2>
            <p>Unfortunately, your system did not meet certification requirements.</p>
            <p><strong>System:</strong> {app_name}<br>
            <strong>Pass Rate:</strong> {pass_rate:.1f}% (required: 95%)<br>
            <strong>Reason:</strong> {reason}</p>
            <h3>Next Steps:</h3>
            <ol>
                <li>Review the telemetry logs in your dashboard</li>
                <li>Identify and fix boundary violations</li>
                <li>Contact us to schedule a re-test ($7,500 fee)</li>
            </ol>
            <p style="font-size: 12px; color: #666;">
                Questions? Contact us at info@sentinelauthority.org
            </p>
        </div>
    </div>
    """
    await send_email(to, f"CAT-72 Test Results - {app_name}", html)


async def notify_admin_new_registration(email: str, name: str = None):
    """Notify admin of new user registration"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #333;">New User Registration</h2>
            <p>A new user has registered:</p>
            <p><strong>Email:</strong> {email}<br>
            <strong>Name:</strong> {name or 'Not provided'}</p>
        </div>
    </div>
    """
    await send_email("info@sentinelauthority.org", f"New Registration: {email}", html)


async def notify_admin_new_application(app_name: str, org: str, email: str):
    """Notify admin of new application"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #333;">New ODDC Application</h2>
            <p>A new certification application has been submitted:</p>
            <p><strong>System:</strong> {app_name}<br>
            <strong>Organization:</strong> {org}<br>
            <strong>Contact:</strong> {email}</p>
            <p><a href="https://app.sentinelauthority.org/applications">Review in Dashboard</a></p>
        </div>
    </div>
    """
    await send_email("info@sentinelauthority.org", f"New Application: {app_name}", html)


async def send_test_setup_instructions(
    to: str,
    system_name: str,
    certificate_id: str,
    api_key: str,
    test_id: str
):
    """Send setup instructions when CAT-72 test is scheduled"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #333;">Your CAT-72 Test is Ready</h2>
            <p>Your ODDC certification test for <strong>{system_name}</strong> has been scheduled.</p>
            
            <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #5B4B8A; margin-top: 0;">Your Credentials</h3>
                <p style="margin: 8px 0;"><strong>Certificate ID:</strong></p>
                <code style="display: block; background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 14px;">{certificate_id}</code>
                <p style="margin: 8px 0; margin-top: 16px;"><strong>API Key:</strong></p>
                <code style="display: block; background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 14px; word-break: break-all;">{api_key}</code>
                <p style="font-size: 12px; color: #666; margin-top: 8px;">⚠️ Save this API key securely. It won't be shown again.</p>
            </div>
            
            <h3 style="color: #5B4B8A;">Installation Steps</h3>
            <ol style="line-height: 1.8;">
                <li>Install the ENVELO Agent:<br>
                    <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px;">pip install httpx</code>
                </li>
                <li>Download the agent from:<br>
                    <a href="https://www.sentinelauthority.org/agent.html" style="color: #5B4B8A;">sentinelauthority.org/agent.html</a>
                </li>
                <li>Configure with your credentials above</li>
                <li>Start your system - the agent will automatically begin sending telemetry</li>
            </ol>
            
            <div style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 8px; padding: 16px; margin: 20px 0;">
                <h4 style="color: #2e7d32; margin: 0 0 8px 0;">Test Requirements</h4>
                <ul style="margin: 0; padding-left: 20px; color: #333;">
                    <li>72 continuous hours of operation</li>
                    <li>Minimum 100 actions evaluated</li>
                    <li>≥95% pass rate required</li>
                    <li>At least 1 boundary violation must be blocked (proves enforcement works)</li>
                </ul>
            </div>
            
            <h3 style="color: #5B4B8A;">Monitor Your Progress</h3>
            <p>Check your test status anytime at:</p>
            <p><a href="https://www.sentinelauthority.org/status?cert={certificate_id}" style="color: #5B4B8A; font-weight: bold;">sentinelauthority.org/status?cert={certificate_id}</a></p>
            
            <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">
            <p style="font-size: 12px; color: #666;">
                Questions? Contact us at info@sentinelauthority.org<br>
                Test ID: {test_id}
            </p>
        </div>
    </div>
    """
    await send_email(to, f"CAT-72 Test Ready - Setup Instructions for {system_name}", html)


async def notify_certificate_issued(to: str, system_name: str, cert_number: str, org_name: str):
    """Notify applicant that their certificate has been issued"""
    html = f"""
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #5B4B8A; padding: 20px; text-align: center;">
            <h1 style="color: white; margin: 0;">SENTINEL AUTHORITY</h1>
        </div>
        <div style="padding: 30px; background: #f9f9f9;">
            <h2 style="color: #2e7d32;">🎉 ODDC Certificate Issued</h2>
            <p>Congratulations! Your system has successfully completed CAT-72 testing and has been granted ODDC conformance.</p>
            
            <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 20px 0;">
                <p style="margin: 8px 0;"><strong>Certificate Number:</strong> {cert_number}</p>
                <p style="margin: 8px 0;"><strong>System:</strong> {system_name}</p>
                <p style="margin: 8px 0;"><strong>Organization:</strong> {org_name}</p>
            </div>
            
            <p><strong>Next Steps:</strong></p>
            <ul style="line-height: 1.8;">
                <li>Download your certificate from the <a href="https://app.sentinelauthority.org" style="color: #5B4B8A;">portal</a></li>
                <li>Your ENVELO Agent is now authorized for production use</li>
                <li>Verify your certificate anytime at <a href="https://sentinelauthority.org/verify.html?cert={cert_number}" style="color: #5B4B8A;">sentinelauthority.org/verify</a></li>
            </ul>
            
            <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
            <p style="font-size: 12px; color: #666;">
                Questions? Contact us at info@sentinelauthority.org
            </p>
        </div>
    </div>
    """
    await send_email(to, f"ODDC Certificate Issued: {system_name}", html)
    # Also notify admin
    await send_email("info@sentinelauthority.org", f"Certificate Issued: {cert_number} - {system_name}", html)


async def notify_agent_offline(to: str, system_name: str, session_id: str, org_name: str, minutes_offline: int):
    """Notify customer that their ENVELO agent has gone offline"""
    subject = f"⚠️ ENVELO Agent Offline: {system_name}"
    
    html = f"""
    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 40px 20px;">
        <div style="text-align: center; margin-bottom: 32px;">
            <div style="display: inline-block; width: 40px; height: 40px; background: #5B4B8A; border-radius: 8px; margin-bottom: 16px;"></div>
            <h1 style="font-size: 24px; font-weight: 300; color: #1a1a2e; margin: 0;">Agent Offline Alert</h1>
        </div>
        
        <div style="background: #FFF3CD; border: 1px solid #FFECB5; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <p style="margin: 0; color: #856404;"><strong>Warning:</strong> Your ENVELO agent has been offline for {minutes_offline} minutes.</p>
        </div>
        
        <div style="background: #f8f9fa; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
            <p style="margin: 0 0 12px 0;"><strong>Organization:</strong> {org_name}</p>
            <p style="margin: 0 0 12px 0;"><strong>System:</strong> {system_name}</p>
            <p style="margin: 0;"><strong>Session ID:</strong> <code style="background: #e9ecef; padding: 2px 6px; border-radius: 4px;">{session_id}</code></p>
        </div>
        
        <p style="color: #666; line-height: 1.6;">
            Your ODDC certification requires continuous ENVELO agent operation. Please check your system and restart the agent if necessary.
        </p>
        
        <p style="color: #666; line-height: 1.6;">
            If the agent remains offline for an extended period, your certification may be subject to review.
        </p>
        
        <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e9ecef; text-align: center;">
            <p style="margin: 0; font-size: 12px; color: #999;">Sentinel Authority — ODDC Certification</p>
        </div>
    </div>
    """
    
    await send_email(to, subject, html)


async def notify_admin_agent_offline(system_name: str, org_name: str, session_id: str, minutes_offline: int, customer_email: str):
    """Notify admin that a customer's agent has gone offline"""
    subject = f"⚠️ Customer Agent Offline: {org_name} - {system_name}"
    
    html = f"""
    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 40px 20px;">
        <h2 style="color: #1a1a2e;">Agent Offline Alert</h2>
        
        <div style="background: #f8f9fa; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
            <p style="margin: 0 0 12px 0;"><strong>Organization:</strong> {org_name}</p>
            <p style="margin: 0 0 12px 0;"><strong>System:</strong> {system_name}</p>
            <p style="margin: 0 0 12px 0;"><strong>Session ID:</strong> {session_id}</p>
            <p style="margin: 0 0 12px 0;"><strong>Offline Duration:</strong> {minutes_offline} minutes</p>
            <p style="margin: 0;"><strong>Customer Email:</strong> {customer_email}</p>
        </div>
        
        <p style="color: #666;">Customer has been notified.</p>
    </div>
    """
    
    await send_email(ADMIN_EMAIL, subject, html)


async def notify_high_violation_rate(to: str, system_name: str, org_name: str, block_count: int, block_rate: float):
    """Notify customer of high violation rate"""
    subject = f"🚨 High Violation Rate: {system_name}"
    
    html = f"""
    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 40px 20px;">
        <div style="text-align: center; margin-bottom: 32px;">
            <div style="display: inline-block; width: 40px; height: 40px; background: #5B4B8A; border-radius: 8px; margin-bottom: 16px;"></div>
            <h1 style="font-size: 24px; font-weight: 300; color: #1a1a2e; margin: 0;">Violation Rate Alert</h1>
        </div>
        
        <div style="background: #F8D7DA; border: 1px solid #F5C6CB; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <p style="margin: 0; color: #721C24;"><strong>Alert:</strong> Your system has a high boundary violation rate of {block_rate:.1f}%</p>
        </div>
        
        <div style="background: #f8f9fa; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
            <p style="margin: 0 0 12px 0;"><strong>Organization:</strong> {org_name}</p>
            <p style="margin: 0 0 12px 0;"><strong>System:</strong> {system_name}</p>
            <p style="margin: 0;"><strong>Blocked Actions:</strong> {block_count}</p>
        </div>
        
        <p style="color: #666; line-height: 1.6;">
            The ENVELO agent is blocking actions that exceed your declared Operational Design Domain boundaries. 
            This indicates your autonomous system is attempting to operate outside its certified parameters.
        </p>
        
        <p style="color: #666; line-height: 1.6;">
            <strong>What this means:</strong> The interlock is working correctly by preventing out-of-bounds operation.
            However, frequent violations may indicate a need to review your system configuration or ODD boundaries.
        </p>
        
        <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e9ecef; text-align: center;">
            <p style="margin: 0; font-size: 12px; color: #999;">Sentinel Authority — ODDC Certification</p>
        </div>
    </div>
    """
    
    await send_email(to, subject, html)


async def notify_admin_high_violations(system_name: str, org_name: str, block_count: int, block_rate: float, customer_email: str):
    """Notify admin of customer's high violation rate"""
    subject = f"🚨 Customer High Violations: {org_name} - {system_name}"
    
    html = f"""
    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 40px 20px;">
        <h2 style="color: #1a1a2e;">High Violation Rate Alert</h2>
        
        <div style="background: #f8f9fa; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
            <p style="margin: 0 0 12px 0;"><strong>Organization:</strong> {org_name}</p>
            <p style="margin: 0 0 12px 0;"><strong>System:</strong> {system_name}</p>
            <p style="margin: 0 0 12px 0;"><strong>Blocked Actions:</strong> {block_count}</p>
            <p style="margin: 0 0 12px 0;"><strong>Violation Rate:</strong> {block_rate:.1f}%</p>
            <p style="margin: 0;"><strong>Customer Email:</strong> {customer_email}</p>
        </div>
        
        <p style="color: #666;">Customer has been notified. Consider reaching out to discuss ODD boundary adjustments.</p>
    </div>
    """
    
    await send_email(ADMIN_EMAIL, subject, html)
</file>

<file path="backend/app/api/routes/envelo.py">
"""
ENVELO Agent API - Receives telemetry from customer ENVELO agents
Now with database persistence
"""

import json
from datetime import datetime, timezone
from fastapi import APIRouter, Depends, HTTPException, Header
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func
from pydantic import BaseModel
from typing import Optional, Dict, Any, List

from app.core.database import get_db
from app.models.models import EnveloSession, TelemetryRecord, Violation, APIKey, Certificate
from app.api.routes.apikeys import validate_api_key, hash_key
from app.core.security import get_current_user

router = APIRouter()


class SessionCreate(BaseModel):
    certificate_id: str
    session_id: str
    started_at: str
    agent_version: str
    boundaries: List[dict] = []


class TelemetryBatch(BaseModel):
    certificate_id: str
    session_id: str
    records: List[dict]
    stats: Dict[str, int] = {}


class SessionEnd(BaseModel):
    ended_at: str
    final_stats: Dict[str, int] = {}


async def get_api_key_from_header(
    authorization: str = Header(None),
    db: AsyncSession = Depends(get_db)
) -> APIKey:
    """Extract and validate API key from Authorization header"""
    
    if not authorization:
        raise HTTPException(status_code=401, detail="Authorization header required")
    
    # Format: "Bearer sa_live_xxxx..."
    parts = authorization.split(" ")
    if len(parts) != 2 or parts[0] != "Bearer":
        raise HTTPException(status_code=401, detail="Invalid authorization format")
    
    key = parts[1]
    api_key = await validate_api_key(key, db)
    
    if not api_key:
        raise HTTPException(status_code=401, detail="Invalid or revoked API key")
    
    return api_key


@router.post("/sessions")
async def register_session(
    data: SessionCreate,
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Register a new ENVELO agent session"""
    
    # Parse certificate ID to get the certificate
    cert_result = await db.execute(
        select(Certificate).where(Certificate.certificate_number == data.certificate_id)
    )
    certificate = cert_result.scalar_one_or_none()
    
    # Create session
    session = EnveloSession(
        session_id=data.session_id,
        certificate_id=certificate.id if certificate else None,
        api_key_id=api_key.id,
        started_at=datetime.fromisoformat(data.started_at.replace('Z', '').replace('+00:00', '')),
        agent_version=data.agent_version,
        status="active"
    )
    
    db.add(session)
    await db.commit()

    # Check for high violations
    await check_and_notify_violations(session, api_key, db)

    return {
        "status": "received",
        "records_stored": len(data.records)
    }
    
    print(f"[ENVELO] Session registered: {data.session_id} for cert {data.certificate_id}")
    
    return {"status": "registered", "session_id": data.session_id}


@router.post("/telemetry")
async def receive_telemetry(
    data: TelemetryBatch,
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Receive telemetry batch from ENVELO agent"""
    
    # Find session
    result = await db.execute(
        select(EnveloSession).where(EnveloSession.session_id == data.session_id)
    )
    session = result.scalar_one_or_none()
    
    if not session:
        # Auto-create session if not found
        session = EnveloSession(
            session_id=data.session_id,
            api_key_id=api_key.id,
            status="active"
        )
        db.add(session)
        await db.commit()

    
    # Store telemetry records
    for record in data.records:
        telemetry = TelemetryRecord(
            session_id=session.id,
            timestamp=datetime.fromisoformat(record['timestamp'].replace('Z', '').replace('+00:00', '')),
            action_id=record.get('action_id', ''),
            action_type=record.get('action_type', ''),
            result=record.get('result', ''),
            execution_time_ms=record.get('execution_time_ms', 0),
            parameters=json.dumps(record.get('parameters', {})),
            boundary_evaluations=json.dumps(record.get('boundary_evaluations', [])),
            system_state=json.dumps(record.get('system_state', {}))
        )
        db.add(telemetry)
        
        # If violation, also add to violations table
        if record.get('result') == 'BLOCK':
            for eval in record.get('boundary_evaluations', []):
                if not eval.get('passed', True):
                    violation = Violation(
                        session_id=session.id,
                        timestamp=telemetry.timestamp,
                        boundary_name=eval.get('boundary', ''),
                        violation_message=eval.get('message', ''),
                        parameters=json.dumps(record.get('parameters', {}))
                    )
                    db.add(violation)
    
    # Update session stats
    session.last_telemetry_at = datetime.utcnow()
    session.pass_count = (session.pass_count or 0) + data.stats.get('pass_count', 0)
    session.block_count = (session.block_count or 0) + data.stats.get('block_count', 0)
    
    await db.commit()

    # Check for high violations
    await check_and_notify_violations(session, api_key, db)

    return {
        "status": "received",
        "records_stored": len(data.records)
    }
    


@router.post("/sessions/{session_id}/end")
async def end_session(
    session_id: str,
    data: SessionEnd,
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """End an ENVELO agent session"""
    
    result = await db.execute(
        select(EnveloSession).where(EnveloSession.session_id == session_id)
    )
    session = result.scalar_one_or_none()
    
    if session:
        session.status = "ended"
        session.ended_at = datetime.fromisoformat(data.ended_at.replace('Z', '').replace('+00:00', ''))
        session.pass_count = data.final_stats.get('pass_count', session.pass_count)
        session.block_count = data.final_stats.get('block_count', session.block_count)
        await db.commit()

    # Check for high violations
    await check_and_notify_violations(session, api_key, db)

    return {
        "status": "received",
        "records_stored": len(data.records)
    }
    
    return {"status": "ended", "session_id": session_id}


@router.get("/sessions")
async def list_sessions(
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """List all ENVELO sessions for this API key's user"""
    
    result = await db.execute(
        select(EnveloSession).where(
            EnveloSession.api_key_id == api_key.id
        ).order_by(EnveloSession.started_at.desc()).limit(100)
    )
    sessions = result.scalars().all()
    
    return {
        "sessions": [
            {
                "session_id": s.session_id,
                "certificate_id": s.certificate_id,
                "status": s.status,
                "started_at": s.started_at.isoformat() if s.started_at else None,
                "ended_at": s.ended_at.isoformat() if s.ended_at else None,
                "last_telemetry_at": s.last_telemetry_at.isoformat() if s.last_telemetry_at else None,
                "pass_count": s.pass_count or 0,
                "block_count": s.block_count or 0
            }
            for s in sessions
        ],
        "total": len(sessions)
    }


@router.get("/sessions/{session_id}")
async def get_session(
    session_id: str,
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Get session details"""
    
    result = await db.execute(
        select(EnveloSession).where(EnveloSession.session_id == session_id)
    )
    session = result.scalar_one_or_none()
    
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")
    
    # Count telemetry records
    count_result = await db.execute(
        select(func.count(TelemetryRecord.id)).where(TelemetryRecord.session_id == session.id)
    )
    telemetry_count = count_result.scalar()
    
    return {
        "session": {
            "session_id": session.session_id,
            "certificate_id": session.certificate_id,
            "status": session.status,
            "started_at": session.started_at.isoformat() if session.started_at else None,
            "ended_at": session.ended_at.isoformat() if session.ended_at else None,
            "pass_count": session.pass_count or 0,
            "block_count": session.block_count or 0
        },
        "telemetry_count": telemetry_count
    }


@router.get("/sessions/{session_id}/telemetry")
async def get_session_telemetry(
    session_id: str,
    limit: int = 100,
    offset: int = 0,
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Get telemetry records for a session"""
    
    # Find session
    sess_result = await db.execute(
        select(EnveloSession).where(EnveloSession.session_id == session_id)
    )
    session = sess_result.scalar_one_or_none()
    
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")
    
    # Get telemetry
    result = await db.execute(
        select(TelemetryRecord).where(
            TelemetryRecord.session_id == session.id
        ).order_by(TelemetryRecord.timestamp.desc()).limit(limit).offset(offset)
    )
    records = result.scalars().all()
    
    # Get total count
    count_result = await db.execute(
        select(func.count(TelemetryRecord.id)).where(TelemetryRecord.session_id == session.id)
    )
    total = count_result.scalar()
    
    return {
        "records": [
            {
                "timestamp": r.timestamp.isoformat(),
                "action_id": r.action_id,
                "action_type": r.action_type,
                "result": r.result,
                "execution_time_ms": r.execution_time_ms,
                "parameters": json.loads(r.parameters) if r.parameters else {},
                "boundary_evaluations": json.loads(r.boundary_evaluations) if r.boundary_evaluations else []
            }
            for r in records
        ],
        "total": total,
        "limit": limit,
        "offset": offset
    }


@router.get("/sessions/{session_id}/violations")
async def get_session_violations(
    session_id: str,
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Get all violations for a session"""
    
    # Find session
    sess_result = await db.execute(
        select(EnveloSession).where(EnveloSession.session_id == session_id)
    )
    session = sess_result.scalar_one_or_none()
    
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")
    
    result = await db.execute(
        select(Violation).where(
            Violation.session_id == session.id
        ).order_by(Violation.timestamp.desc())
    )
    violations = result.scalars().all()
    
    return {
        "violations": [
            {
                "timestamp": v.timestamp.isoformat(),
                "boundary_name": v.boundary_name,
                "violation_message": v.violation_message,
                "parameters": json.loads(v.parameters) if v.parameters else {}
            }
            for v in violations
        ],
        "total": len(violations)
    }


@router.get("/live")
async def get_live_sessions(
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Get all currently active sessions"""
    
    result = await db.execute(
        select(EnveloSession).where(
            EnveloSession.api_key_id == api_key.id,
            EnveloSession.status == "active"
        )
    )
    sessions = result.scalars().all()
    
    return {
        "active_sessions": [
            {
                "session_id": s.session_id,
                "started_at": s.started_at.isoformat() if s.started_at else None,
                "last_telemetry_at": s.last_telemetry_at.isoformat() if s.last_telemetry_at else None,
                "pass_count": s.pass_count or 0,
                "block_count": s.block_count or 0
            }
            for s in sessions
        ],
        "total_active": len(sessions)
    }


@router.get("/stats")
async def get_global_stats(db: AsyncSession = Depends(get_db)):
    """Get global ENVELO statistics (public endpoint)"""
    
    # Total sessions
    total_sess = await db.execute(select(func.count(EnveloSession.id)))
    total_sessions = total_sess.scalar()
    
    # Active sessions
    active_sess = await db.execute(
        select(func.count(EnveloSession.id)).where(EnveloSession.status == "active")
    )
    active_sessions = active_sess.scalar()
    
    # Total telemetry
    total_tel = await db.execute(select(func.count(TelemetryRecord.id)))
    total_telemetry = total_tel.scalar()
    
    # Total violations
    total_viol = await db.execute(select(func.count(Violation.id)))
    total_violations = total_viol.scalar()
    
    return {
        "total_sessions": total_sessions or 0,
        "active_sessions": active_sessions or 0,
        "total_telemetry_records": total_telemetry or 0,
        "total_violations": total_violations or 0
    }


@router.get("/admin/sessions")
async def list_all_sessions(
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """List all ENVELO sessions (admin view)"""
    
    # Only allow admin users
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    result = await db.execute(
        select(EnveloSession).order_by(EnveloSession.started_at.desc()).limit(100)
    )
    sessions = result.scalars().all()
    
    return {
        "sessions": [
            {
                "id": s.id,
                "session_id": s.session_id,
                "certificate_id": s.certificate_id,
                "started_at": s.started_at.isoformat() if s.started_at else None,
                "ended_at": s.ended_at.isoformat() if s.ended_at else None,
                "agent_version": s.agent_version,
                "status": s.status,
                "pass_count": s.pass_count,
                "block_count": s.block_count
            }
            for s in sessions
        ]
    }


@router.get("/admin/sessions/{session_id}/telemetry")
async def get_session_telemetry_admin(
    session_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Get telemetry for a session (admin view)"""
    
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    result = await db.execute(
        select(TelemetryRecord).where(
            TelemetryRecord.session_id == session_id
        ).order_by(TelemetryRecord.timestamp.desc()).limit(1000)
    )
    records = result.scalars().all()
    
    return {
        "records": [
            {
                "id": r.id,
                "timestamp": r.timestamp.isoformat() if r.timestamp else None,
                "action_id": r.action_id,
                "action_type": r.action_type,
                "result": r.result,
                "execution_time_ms": r.execution_time_ms,
                "parameters": r.parameters,
                "boundary_evaluations": r.boundary_evaluations
            }
            for r in records
        ]
    }


@router.get("/admin/sessions/{session_id}/violations")
async def get_session_violations_admin(
    session_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Get violations for a session (admin view)"""
    
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    result = await db.execute(
        select(Violation).where(
            Violation.session_id == session_id
        ).order_by(Violation.timestamp.desc())
    )
    violations = result.scalars().all()
    
    return {
        "violations": [
            {
                "id": v.id,
                "timestamp": v.timestamp.isoformat() if v.timestamp else None,
                "boundary_name": v.boundary_name,
                "violation_message": v.violation_message,
                "parameters": v.parameters
            }
            for v in violations
        ]
    }


@router.get("/admin/sessions/{session_id}/report")
async def download_session_report(
    session_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Download CAT-72 report PDF for a session"""
    from fastapi.responses import Response
    from app.services.cat72_report_generator import generate_cat72_report
    
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    # Get session
    result = await db.execute(select(EnveloSession).where(EnveloSession.id == session_id))
    session = result.scalar_one_or_none()
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")
    
    # Get violations
    result = await db.execute(
        select(Violation).where(Violation.session_id == session_id).order_by(Violation.timestamp)
    )
    violations = result.scalars().all()
    
    violation_list = [
        {"timestamp": v.timestamp.isoformat() if v.timestamp else None, 
         "boundary_name": v.boundary_name, 
         "violation_message": v.violation_message}
        for v in violations
    ]
    
    # Generate PDF
    pdf_bytes = generate_cat72_report(
        test_id=session.session_id,
        system_name=session.certificate_id or "Unknown System",
        organization="Customer",
        started_at=session.started_at,
        ended_at=session.ended_at or datetime.utcnow(),
        total_actions=(session.pass_count or 0) + (session.block_count or 0),
        pass_count=session.pass_count or 0,
        block_count=session.block_count or 0,
        pass_rate=((session.pass_count or 0) / max((session.pass_count or 0) + (session.block_count or 0), 1)) * 100,
        result="PASS" if session.status == "passed" else "IN PROGRESS",
        violations=violation_list
    )
    
    return Response(
        content=pdf_bytes,
        media_type="application/pdf",
        headers={"Content-Disposition": f"attachment; filename=CAT72-Report-{session.session_id}.pdf"}
    )


@router.get("/admin/sessions/{session_id}/report")
async def download_session_report(
    session_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Download CAT-72 report PDF for a session"""
    from fastapi.responses import Response
    from app.services.cat72_report_generator import generate_cat72_report
    
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    # Get session
    result = await db.execute(select(EnveloSession).where(EnveloSession.id == session_id))
    session = result.scalar_one_or_none()
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")
    
    # Get violations
    result = await db.execute(
        select(Violation).where(Violation.session_id == session_id).order_by(Violation.timestamp)
    )
    violations = result.scalars().all()
    
    violation_list = [
        {"timestamp": v.timestamp.isoformat() if v.timestamp else None, 
         "boundary_name": v.boundary_name, 
         "violation_message": v.violation_message}
        for v in violations
    ]
    
    # Generate PDF
    pdf_bytes = generate_cat72_report(
        test_id=session.session_id,
        system_name=session.certificate_id or "Unknown System",
        organization="Customer",
        started_at=session.started_at,
        ended_at=session.ended_at or datetime.utcnow(),
        total_actions=(session.pass_count or 0) + (session.block_count or 0),
        pass_count=session.pass_count or 0,
        block_count=session.block_count or 0,
        pass_rate=((session.pass_count or 0) / max((session.pass_count or 0) + (session.block_count or 0), 1)) * 100,
        result="PASS" if session.status == "passed" else "IN PROGRESS",
        violations=violation_list
    )
    
    return Response(
        content=pdf_bytes,
        media_type="application/pdf",
        headers={"Content-Disposition": f"attachment; filename=CAT72-Report-{session.session_id}.pdf"}
    )


@router.post("/heartbeat")
async def receive_heartbeat(
    db: AsyncSession = Depends(get_db),
    api_key: APIKey = Depends(get_api_key_from_header)
):
    """Receive heartbeat from ENVELO agent - lightweight ping to confirm agent is alive"""
    from pydantic import BaseModel
    
    # Update all active sessions for this API key
    result = await db.execute(
        select(EnveloSession).where(
            EnveloSession.api_key_id == api_key.id,
            EnveloSession.status == "active"
        )
    )
    sessions = result.scalars().all()
    
    now = datetime.utcnow()
    for session in sessions:
        session.last_heartbeat_at = now
    
    await db.commit()

    # Check for high violations
    await check_and_notify_violations(session, api_key, db)

    return {
        "status": "received",
        "records_stored": len(data.records)
    }
    
    return {"status": "ok", "timestamp": now.isoformat(), "sessions_updated": len(sessions)}


@router.get("/monitoring/overview")
async def get_monitoring_overview(
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Get monitoring overview for dashboard"""
    
    from datetime import timedelta
    now = datetime.utcnow()
    
    # Get all sessions for this user's certificates
    if current_user.get("role") == "admin":
        sessions_result = await db.execute(
            select(EnveloSession).order_by(EnveloSession.started_at.desc()).limit(100)
        )
    else:
        # Get user's API keys
        keys_result = await db.execute(
            select(APIKey).where(APIKey.user_id == int(current_user["sub"]))
        )
        user_keys = keys_result.scalars().all()
        key_ids = [k.id for k in user_keys]
        
        if not key_ids:
            return {"sessions": [], "summary": {"total": 0, "active": 0, "offline": 0}}
        
        sessions_result = await db.execute(
            select(EnveloSession).where(
                EnveloSession.api_key_id.in_(key_ids)
            ).order_by(EnveloSession.started_at.desc()).limit(100)
        )
    
    sessions = sessions_result.scalars().all()
    
    # Categorize sessions
    active_count = 0
    offline_count = 0
    total_pass = 0
    total_block = 0
    
    session_data = []
    for s in sessions:
        # Check if session is online (heartbeat within last 2 minutes)
        last_activity = s.last_heartbeat_at or s.last_telemetry_at or s.started_at
        is_online = False
        if s.status == "active" and last_activity:
            is_online = (now - last_activity).total_seconds() < 120
        
        if s.status == "active":
            if is_online:
                active_count += 1
            else:
                offline_count += 1
        
        total_pass += s.pass_count or 0
        total_block += s.block_count or 0
        
        session_data.append({
            "id": s.id,
            "session_id": s.session_id,
            "certificate_id": s.certificate_id,
            "status": s.status,
            "is_online": is_online,
            "started_at": s.started_at.isoformat() if s.started_at else None,
            "last_activity": last_activity.isoformat() if last_activity else None,
            "pass_count": s.pass_count or 0,
            "block_count": s.block_count or 0,
            "uptime_hours": round((now - s.started_at).total_seconds() / 3600, 1) if s.started_at else 0
        })
    
    return {
        "sessions": session_data,
        "summary": {
            "total": len(sessions),
            "active": active_count,
            "offline": offline_count,
            "ended": len([s for s in sessions if s.status == "ended"]),
            "total_actions": total_pass + total_block,
            "total_pass": total_pass,
            "total_block": total_block,
            "pass_rate": round((total_pass / max(total_pass + total_block, 1)) * 100, 2)
        }
    }


@router.get("/monitoring/session/{session_id}/timeline")
async def get_session_timeline(
    session_id: int,
    hours: int = 24,
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Get hourly aggregated data for a session"""
    from datetime import timedelta
    from sqlalchemy import and_
    
    # Get session
    result = await db.execute(select(EnveloSession).where(EnveloSession.id == session_id))
    session = result.scalar_one_or_none()
    
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")
    
    now = datetime.utcnow()
    start_time = now - timedelta(hours=hours)
    
    # Get telemetry records in time range
    result = await db.execute(
        select(TelemetryRecord).where(
            and_(
                TelemetryRecord.session_id == session_id,
                TelemetryRecord.timestamp >= start_time
            )
        ).order_by(TelemetryRecord.timestamp)
    )
    records = result.scalars().all()
    
    # Aggregate by hour
    hourly_data = {}
    for r in records:
        hour_key = r.timestamp.replace(minute=0, second=0, microsecond=0).isoformat()
        if hour_key not in hourly_data:
            hourly_data[hour_key] = {"pass": 0, "block": 0, "total": 0}
        hourly_data[hour_key]["total"] += 1
        if r.result == "PASS":
            hourly_data[hour_key]["pass"] += 1
        else:
            hourly_data[hour_key]["block"] += 1
    
    return {
        "session_id": session_id,
        "hours": hours,
        "timeline": [
            {"hour": k, "pass": v["pass"], "block": v["block"], "total": v["total"]}
            for k, v in sorted(hourly_data.items())
        ]
    }


@router.get("/monitoring/alerts")
async def get_alerts(
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Get current alerts for monitoring"""
    from datetime import timedelta
    
    now = datetime.utcnow()
    alerts = []
    
    # Get sessions that should be monitored
    if current_user.get("role") == "admin":
        sessions_result = await db.execute(
            select(EnveloSession).where(EnveloSession.status == "active")
        )
    else:
        keys_result = await db.execute(
            select(APIKey).where(APIKey.user_id == int(current_user["sub"]))
        )
        user_keys = keys_result.scalars().all()
        key_ids = [k.id for k in user_keys]
        
        if not key_ids:
            return {"alerts": []}
        
        sessions_result = await db.execute(
            select(EnveloSession).where(
                EnveloSession.api_key_id.in_(key_ids),
                EnveloSession.status == "active"
            )
        )
    
    sessions = sessions_result.scalars().all()
    
    for s in sessions:
        last_activity = s.last_heartbeat_at or s.last_telemetry_at
        
        # Alert if no activity for 2+ minutes
        if last_activity and (now - last_activity).total_seconds() > 120:
            minutes_offline = int((now - last_activity).total_seconds() / 60)
            alerts.append({
                "type": "offline",
                "severity": "critical" if minutes_offline > 10 else "warning",
                "session_id": s.session_id,
                "message": f"Agent offline for {minutes_offline} minutes",
                "since": last_activity.isoformat()
            })
        
        # Alert if high violation rate
        total = (s.pass_count or 0) + (s.block_count or 0)
        if total > 100:
            block_rate = (s.block_count or 0) / total * 100
            if block_rate > 10:
                alerts.append({
                    "type": "high_violations",
                    "severity": "warning",
                    "session_id": s.session_id,
                    "message": f"High violation rate: {block_rate:.1f}%",
                    "block_count": s.block_count
                })
    
    return {"alerts": alerts, "total": len(alerts)}


@router.post("/check-offline")
async def check_offline_agents(
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Check for offline agents and send notifications (admin only)"""
    from app.services.email_service import notify_agent_offline, notify_admin_agent_offline
    from app.models.models import User, Certificate
    
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    now = datetime.utcnow()
    notifications_sent = 0
    
    # Get all active sessions
    result = await db.execute(
        select(EnveloSession).where(EnveloSession.status == "active")
    )
    sessions = result.scalars().all()
    
    for session in sessions:
        last_activity = session.last_heartbeat_at or session.last_telemetry_at
        if not last_activity:
            continue
            
        minutes_offline = int((now - last_activity).total_seconds() / 60)
        
        # Only alert if offline for more than 5 minutes and hasn't been notified recently
        if minutes_offline >= 5:
            # Get the API key owner
            api_key_result = await db.execute(
                select(APIKey).where(APIKey.id == session.api_key_id)
            )
            api_key = api_key_result.scalar_one_or_none()
            
            if api_key:
                user_result = await db.execute(
                    select(User).where(User.id == api_key.user_id)
                )
                user = user_result.scalar_one_or_none()
                
                if user:
                    # Get certificate info for system name
                    cert_result = await db.execute(
                        select(Certificate).where(Certificate.id == session.certificate_id)
                    )
                    cert = cert_result.scalar_one_or_none()
                    
                    system_name = cert.system_name if cert else "Unknown System"
                    org_name = cert.organization_name if cert else user.organization or "Unknown"
                    
                    try:
                        await notify_agent_offline(
                            user.email, system_name, session.session_id, org_name, minutes_offline
                        )
                        await notify_admin_agent_offline(
                            system_name, org_name, session.session_id, minutes_offline, user.email
                        )
                        notifications_sent += 1
                    except Exception as e:
                        print(f"Failed to send offline notification: {e}")
    
    # Also check for high violation rates
    for session in sessions:
        total = (session.pass_count or 0) + (session.block_count or 0)
        if total > 100:
            block_rate = (session.block_count or 0) / total * 100
            if block_rate > 10:  # More than 10% violations
                api_key_result = await db.execute(select(APIKey).where(APIKey.id == session.api_key_id))
                api_key = api_key_result.scalar_one_or_none()
                if api_key:
                    user_result = await db.execute(select(User).where(User.id == api_key.user_id))
                    user = user_result.scalar_one_or_none()
                    if user:
                        cert_result = await db.execute(select(Certificate).where(Certificate.id == session.certificate_id))
                        cert = cert_result.scalar_one_or_none()
                        system_name = cert.system_name if cert else "Unknown"
                        org_name = cert.organization_name if cert else user.organization or "Unknown"
                        try:
                            from app.services.email_service import notify_high_violation_rate, notify_admin_high_violations
                            await notify_high_violation_rate(user.email, system_name, org_name, session.block_count, block_rate)
                            await notify_admin_high_violations(system_name, org_name, session.block_count, block_rate, user.email)
                            notifications_sent += 1
                        except Exception as e:
                            print(f"Failed to send violation notification: {e}")

    return {"notifications_sent": notifications_sent}


@router.post("/check-violations")
async def check_violation_rates(
    db: AsyncSession = Depends(get_db),
    current_user: dict = Depends(get_current_user)
):
    """Check for high violation rates and send notifications (admin only)"""
    from app.services.email_service import notify_high_violation_rate, notify_admin_high_violations
    from app.models.models import User, Certificate
    
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Admin access required")
    
    notifications_sent = 0
    
    result = await db.execute(
        select(EnveloSession).where(EnveloSession.status == "active")
    )
    sessions = result.scalars().all()
    
    for session in sessions:
        total = (session.pass_count or 0) + (session.block_count or 0)
        if total > 100:
            block_rate = (session.block_count or 0) / total * 100
            if block_rate > 10:
                api_key_result = await db.execute(
                    select(APIKey).where(APIKey.id == session.api_key_id)
                )
                api_key = api_key_result.scalar_one_or_none()
                
                if api_key:
                    user_result = await db.execute(
                        select(User).where(User.id == api_key.user_id)
                    )
                    user = user_result.scalar_one_or_none()
                    
                    if user:
                        cert_result = await db.execute(
                            select(Certificate).where(Certificate.id == session.certificate_id)
                        )
                        cert = cert_result.scalar_one_or_none()
                        
                        system_name = cert.system_name if cert else "Unknown"
                        org_name = cert.organization_name if cert else user.organization or "Unknown"
                        
                        try:
                            await notify_high_violation_rate(
                                user.email, system_name, org_name, session.block_count, block_rate
                            )
                            await notify_admin_high_violations(
                                system_name, org_name, session.block_count, block_rate, user.email
                            )
                            notifications_sent += 1
                        except Exception as e:
                            print(f"Failed to send violation notification: {e}")
    
    return {"notifications_sent": notifications_sent}


async def check_and_notify_violations(session: EnveloSession, api_key: APIKey, db: AsyncSession):
    """Check violation rate and send notifications if needed"""
    from app.services.email_service import notify_high_violation_rate, notify_admin_high_violations
    from app.models.models import User, Certificate
    
    total = (session.pass_count or 0) + (session.block_count or 0)
    if total < 100:
        return
    
    block_rate = (session.block_count or 0) / total * 100
    if block_rate <= 10:
        return
    
    # Only alert if haven't alerted in last hour
    last_alert = getattr(session, 'last_violation_alert_at', None)
    if last_alert and (datetime.utcnow() - last_alert).total_seconds() < 3600:
        return
    
    try:
        user_result = await db.execute(select(User).where(User.id == api_key.user_id))
        user = user_result.scalar_one_or_none()
        if not user:
            return
        
        cert_result = await db.execute(select(Certificate).where(Certificate.id == session.certificate_id))
        cert = cert_result.scalar_one_or_none()
        
        system_name = cert.system_name if cert else "Unknown"
        org_name = cert.organization_name if cert else user.organization or "Unknown"
        
        await notify_high_violation_rate(user.email, system_name, org_name, session.block_count, block_rate)
        await notify_admin_high_violations(system_name, org_name, session.block_count, block_rate, user.email)
        
        session.last_violation_alert_at = datetime.utcnow()
        await db.commit()

        print(f"[ENVELO] Sent violation alert for {org_name} - {system_name}")
    except Exception as e:
        print(f"[ENVELO] Failed to send violation alert: {e}")
</file>

<file path="website/index.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Sentinel Authority — ODDC Conformance</title>

  <meta
    name="description"
    content="Sentinel Authority publishes ODDC (ODD Conformance Determination): a voluntary conformance and evidence framework attesting that evidence supports operation within a declared ODD, with ENVELO-compliant enforcement present and auditable."
  />

  <!-- Open Graph / LinkedIn / Slack -->
  <meta property="og:title" content="Sentinel Authority — ODDC Conformance" />
  <meta property="og:description" content="ODD Conformance Determination for autonomous systems. A voluntary conformance and evidence framework." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://sentinelauthority.org/" />
  <meta property="og:image" content="https://sentinelauthority.org/og.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Sentinel Authority — ODDC Conformance" />
  <meta name="twitter:description" content="ODD Conformance Determination for autonomous systems." />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://sentinelauthority.org/" />

  <!-- Favicon (purple diamond) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='6' y='6' width='20' height='20' rx='5' fill='%235B4B8A' stroke='%239d8ccf' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%239d8ccf'/></svg>" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,200;0,300;0,400;1,200;1,300&family=Inter:wght@200;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap"
    rel="stylesheet"
  />

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Sentinel Authority",
    "url": "https://sentinelauthority.org/",
    "email": "info@sentinelauthority.org",
    "description": "Independent conformance determination for autonomous systems. ODD Conformance Determination (ODDC) with ENVELO enforcement requirements."
  }
  </script>

  <style>
    :root{
      color-scheme: dark;
      
      /* Core palette */
      --purple-primary:#5B4B8A;
      --purple-bright:#9d8ccf;
      --purple-glow:rgba(157,140,207,.20);
      --bg-deep:#2a2f3d;
      --bg-panel:rgba(255,255,255,.05);
      --accent-green:#5CD685;
      --accent-amber:#D6A05C;
      --accent-red:#D65C5C;

      /* Text hierarchy */
      --text-primary:rgba(255,255,255,.94);
      --text-secondary:rgba(255,255,255,.75);
      --text-tertiary:rgba(255,255,255,.50);

      /* Borders */
      --border-glass:rgba(255,255,255,.10);
      --border-subtle:rgba(255,255,255,.06);

      /* Typography */
      --serif:'Source Serif 4',serif;
      --mono:'IBM Plex Mono',monospace;
      --sans:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

      /* Timing */
      --ease: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
      
      /* Spacing scale (10px base) */
      --space-1: 10px;
      --space-2: 20px;
      --space-3: 30px;
      --space-4: 40px;
      --space-5: 50px;
      --space-6: 60px;
      --space-8: 80px;
      --space-10: 100px;
      --space-12: 120px;
      
      /* Layout */
      --max: 1200px;
      --nav-height: 72px;
    }

    *{ box-sizing:border-box; }
    
    /* Skip link for accessibility */
    .skip-link{
      position:absolute;
      left:-9999px;
      top:auto;
      width:1px;
      height:1px;
      overflow:hidden;
      z-index:999;
    }
    .skip-link:focus{
      position:fixed;
      top:var(--space-1);
      left:var(--space-1);
      width:auto;
      height:auto;
      padding:12px 18px;
      background:var(--bg-deep);
      border:1px solid var(--purple-bright);
      border-radius:8px;
      color:var(--text-primary);
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:2px;
      text-transform:uppercase;
      text-decoration:none;
    }
    
    /* Screen reader only */
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
    
    /* Focus styles for accessibility */
    a:focus-visible, button:focus-visible {
      outline: 2px solid rgba(157,140,207,.75);
      outline-offset: 3px;
      border-radius: 10px;
    }
    
    html{ scroll-behavior:smooth; background:var(--bg-deep); }
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 15% 10%, rgba(91,75,138,.15), transparent 55%),
                  radial-gradient(900px 600px at 85% 80%, rgba(92,214,133,.06), transparent 55%),
                  var(--bg-deep);
      color:var(--text-primary);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; text-underline-offset:4px; }
    ::selection{ background:var(--purple-primary); color:#fff; }

    /* Subtle grid overlay */
    .grid-overlay{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      background-image:
        linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
      background-size: var(--space-12) var(--space-12);
      opacity:.15;
      mask-image: radial-gradient(ellipse at center, rgba(0,0,0,.95) 20%, transparent 70%);
    }

    /* ============================================
       NAVIGATION
       ============================================ */
    .site-header{
      position:fixed;
      top:0;
      width:100%;
      z-index:50;
      padding:0 var(--space-2, 20px);
      height: var(--nav-height, 72px);
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(42,47,61,.88);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      display: flex;
      align-items: center;
    }
    .nav-inner{
      max-width: var(--max, 1200px);
      margin:0 auto;
      width: 100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--space-2, 20px);
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      gap: var(--space-1, 10px);
      flex-shrink: 0;
      text-decoration: none;
      visibility: visible;
      opacity: 1;
    }
    .brand:hover{ text-decoration: none; }
    .brand-mark{
      width: 24px;
      height: 24px;
      background: #5B4B8A;
      background: var(--purple-primary, #5B4B8A);
      border: 2px solid #9d8ccf;
      border: 2px solid var(--purple-bright, #9d8ccf);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .brand-mark-inner{
      width: 8px;
      height: 8px;
      background: #c4b8e8;
      border-radius: 50%;
      animation: eye-pulse 7s ease-in-out infinite;
      will-change: transform, opacity, box-shadow;
    }
    @keyframes eye-pulse {
      0%, 100% {
        opacity: .75;
        transform: scale(.98);
        box-shadow: 0 0 0 rgba(196,184,232,0);
      }
      50% {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 10px rgba(157,140,207,.22);
      }
    }
    @media (prefers-reduced-motion: reduce){
      .brand-mark-inner{ animation: none; opacity: .9; }
    }
    .brand-name{
      font-family: 'IBM Plex Mono', monospace;
      font-family: var(--mono, 'IBM Plex Mono', monospace);
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #dbdbdb;
      color: rgba(255,255,255,.86);
      white-space: nowrap;
    }

    .nav-links{
      display:flex;
      align-items:center;
      gap: 14px;
      flex-wrap: nowrap;
      justify-content:center;
    }
    .nav-links a{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      color: var(--text-tertiary);
      padding: 8px 4px;
      position: relative;
      transition: color .25s ease;
      white-space: nowrap;
    }
    .nav-links a:hover{ color: var(--text-primary); text-decoration:none; }
    .nav-links a::after{
      content:"";
      position:absolute;
      left:4px; right:4px; bottom:4px;
      height:1px;
      background: var(--purple-bright);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .35s var(--ease);
      opacity:.9;
    }
    .nav-links a:hover::after{ transform: scaleX(1); }
    
    /* Active section indicator */
    .nav-links a.active{
      color: var(--text-primary);
    }
    .nav-links a.active::after{
      transform: scaleX(1);
      opacity: .6;
    }

    .nav-badge{
      display:flex;
      align-items:center;
      gap:6px;
      font-family: var(--mono);
      font-size: 8px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: rgba(214,160,92,.95);
      border: 1px solid rgba(214,160,92,.25);
      background: rgba(214,160,92,.08);
      padding: 6px 8px;
      border-radius: 999px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Mobile nav toggle */
    .nav-toggle{
      display: none;
      appearance: none;
      border: 1px solid var(--border-glass);
      background: rgba(255,255,255,.03);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      position: relative;
      transition: border-color .2s ease, background .2s ease;
    }
    .nav-toggle:hover{
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
    }
    .nav-toggle span{
      position: absolute;
      left: 50%;
      width: 16px;
      height: 1px;
      background: var(--text-secondary);
      transform: translateX(-50%);
      transition: all .18s var(--ease-out);
    }
    .nav-toggle span:nth-child(1){ top: 14px; }
    .nav-toggle span:nth-child(2){ top: 19px; }
    .nav-toggle span:nth-child(3){ top: 24px; }
    
    .nav-toggle[aria-expanded="true"] span:nth-child(1){
      top: 19px;
      transform: translateX(-50%) rotate(45deg);
    }
    .nav-toggle[aria-expanded="true"] span:nth-child(2){
      opacity: 0;
      transform: translateX(-50%) scaleX(0);
    }
    .nav-toggle[aria-expanded="true"] span:nth-child(3){
      top: 19px;
      transform: translateX(-50%) rotate(-45deg);
    }

    /* Mobile drawer */
    .nav-drawer{
      display: none;
      position: fixed;
      top: var(--nav-height);
      right: 0;
      width: 280px;
      max-width: calc(100vw - var(--space-4));
      height: calc(100vh - var(--nav-height));
      background: rgba(42,47,61,.96);
      backdrop-filter: blur(24px);
      border-left: 1px solid var(--border-glass);
      transform: translateX(100%);
      transition: transform .18s var(--ease-out);
      z-index: 49;
      padding: var(--space-3) var(--space-2);
      overflow-y: auto;
    }
    .nav-drawer.open{
      transform: translateX(0);
    }
    .nav-drawer a{
      display: flex;
      align-items: center;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-secondary);
      padding: 14px 0;
      border-bottom: 1px solid var(--border-subtle);
      transition: color .2s ease;
    }
    .nav-drawer a:hover{
      color: var(--text-primary);
      text-decoration: none;
    }
    .nav-drawer a.active{
      color: var(--purple-bright);
    }
    
    .drawer-overlay{
      display: none;
      position: fixed;
      inset: 0;
      top: var(--nav-height);
      background: rgba(0,0,0,.4);
      z-index: 48;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events: none;
    }
    .drawer-overlay.open{
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 860px){
      .nav-links{ display:none; }
      .nav-toggle{ display: block; }
      .nav-drawer{ display: block; }
      .drawer-overlay{ display: block; }
    }

    /* ============================================
       MAIN CONTENT
       ============================================ */
    main{
      position: relative;
      z-index: 1;
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--space-2);
    }

    /* ============================================
       HERO
       ============================================ */
    .hero{
      min-height: 100vh;
      padding: calc(var(--nav-height) + var(--space-8)) 0 var(--space-6);
      display:flex;
      flex-direction: column;
      justify-content: center;
      gap: var(--space-2);
      position: relative;
    }
    
    /* Hero anchor line */
    .hero::before{
      content: "";
      position: absolute;
      left: 0;
      top: calc(var(--nav-height) + var(--space-6));
      bottom: var(--space-6);
      width: 1px;
      background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(157,140,207,.15) 10%,
        rgba(157,140,207,.15) 90%,
        transparent 100%
      );
    }
    
    @media (max-width: 860px){
      .hero{
        padding-top: calc(var(--nav-height) + var(--space-4));
        justify-content: flex-start;
      }
      .hero::before{ display: none; }
    }
    
    .hero-kicker{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--purple-bright);
      display:flex;
      align-items:center;
      gap:14px;
    }
    .hero-kicker::before{
      content:"";
      width:var(--space-4);
      height:1px;
      background: var(--purple-bright);
      opacity:.95;
    }
    
    h1{
      font-family: var(--serif);
      font-size: clamp(44px, 7vw, 92px);
      font-weight: 200;
      line-height: .95;
      margin: 0;
      letter-spacing: -0.04em;
    }
    h1 .accent{
      font-style: italic;
      color: var(--purple-bright);
      position: relative;
      text-shadow: 
        -1px 0 rgba(255,100,100,0.08), 
        1px 0 rgba(100,255,255,0.08),
        0 0 20px var(--purple-glow);
    }
    
    /* Hero stamp line */
    .hero-stamp{
      width: 60px;
      height: 1px;
      background: var(--purple-bright);
      opacity: .15;
      margin: var(--space-1) 0;
    }
    
    .hero-notice{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
      color: var(--purple-bright);
      border: 1px solid rgba(157,140,207,.22);
      background: rgba(91,75,138,.05);
      padding: 8px 12px;
      border-radius: 8px;
      width: fit-content;
      margin: var(--space-1) 0 var(--space-2);
    }
    
    .hero-desc{
      max-width: 62ch;
      font-size: 18px;
      font-weight: 200;
      line-height: 1.75;
      color: var(--text-secondary);
      border-left: 2px solid rgba(91,75,138,.65);
      padding-left: var(--space-2);
      margin: 0;
    }
    
    .hero-disclaimer{
      font-size: 11px;
      color: var(--text-tertiary);
      font-weight: 200;
      font-family: var(--mono);
      letter-spacing: 0.5px;
      margin: 0;
      line-height: 1.7;
    }
    .hero-disclaimer + .hero-disclaimer{
      margin-top: 6px;
    }
    
    .hero-subline{
      font-size: 15px;
      color: var(--text-secondary);
      font-weight: 200;
      margin: var(--space-1) 0 0;
    }

    .hero-actions{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: var(--space-1);
    }
    
    .hero-footnote{
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-tertiary);
      letter-spacing: 1px;
      margin-top: var(--space-2);
    }
    
    @media (max-width: 600px){
      h1{ font-weight: 300; line-height: 1.0; }
    }
    
    /* ============================================
       BUTTONS
       ============================================ */
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: transparent;
      color: var(--text-primary);
      padding: 14px 18px;
      border-radius: 14px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .2s var(--ease), border-color .2s ease, background .2s ease;
      position: relative;
      overflow:hidden;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.28);
      background: rgba(255,255,255,.04);
      text-decoration: none;
    }
    .btn.primary{
      border-color: rgba(157,140,207,.55);
      background: rgba(91,75,138,.18);
      box-shadow: 0 18px 50px rgba(0,0,0,.30);
    }
    .btn.primary:hover{
      border-color: rgba(157,140,207,.85);
      background: rgba(91,75,138,.26);
    }

    /* ============================================
       SECTIONS
       ============================================ */
    .section{
      padding: var(--space-10) 0;
      border-top: 1px solid var(--border-glass);
      scroll-margin-top: calc(var(--nav-height) + 24px);
    }
    .section-head{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: var(--space-2);
      flex-wrap: wrap;
      margin-bottom: var(--space-4);
    }
    .section-label{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 5px;
      text-transform: uppercase;
      color: var(--purple-bright);
      display:block;
      margin-bottom: 12px;
    }
    .section-title{
      font-family: var(--serif);
      font-size: clamp(30px, 4vw, 50px);
      font-weight: 200;
      line-height: 1.1;
      margin: 0;
      letter-spacing: -0.03em;
    }
    @media (max-width: 600px){
      .section-title{ font-weight: 300; }
    }
    .section-lead{
      max-width: 70ch;
      color: var(--text-secondary);
      font-weight: 200;
      line-height: 1.85;
      margin: var(--space-2) 0 0;
      font-size: 16px;
    }

    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-3);
      align-items: start;
    }
    @media (max-width: 980px){
      .grid-2{ grid-template-columns: 1fr; }
    }

    /* ============================================
       PANELS
       ============================================ */
    .panel{
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: var(--space-3) 28px;
      backdrop-filter: blur(18px);
      position: relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-20%;
      background: radial-gradient(circle at 20% 20%, rgba(157,140,207,.10), transparent 55%);
      pointer-events:none;
      transform: rotate(-8deg);
      opacity:.8;
    }
    .panel > *{ position: relative; z-index: 1; }

    .panel h3{
      margin: 0 0 14px;
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.85);
    }
    .panel p{
      margin: 0 0 var(--space-2);
      color: var(--text-secondary);
      font-weight: 200;
      line-height: 1.85;
    }
    
    .panel-note{
      font-size: 12px;
      color: var(--text-tertiary);
      font-weight: 400;
      font-family: var(--mono);
      letter-spacing: 0.5px;
      margin-bottom: 14px;
    }
    .panel-detail{
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 200;
      margin-bottom: 8px;
    }
    .panel-fine{
      font-size: 11px;
      color: var(--text-tertiary);
      font-weight: 200;
      margin-bottom: 14px;
    }
    
    .list{
      list-style: none;
      padding: 0;
      margin: 0;
      border-top: 1px solid var(--border-glass);
    }
    .list li{
      padding: 12px 0;
      border-bottom: 1px solid var(--border-glass);
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
    }
    .list li:last-child{ border-bottom:none; }
    .list b{ color: var(--text-primary); font-weight: 600; }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.82);
      width: fit-content;
    }

    /* Document download links */
    .doc-links {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .doc-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(91, 75, 138, 0.15);
      border: 1px solid rgba(157, 140, 207, 0.25);
      border-radius: 4px;
      color: var(--purple-bright);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.5px;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    .doc-link:hover {
      background: rgba(91, 75, 138, 0.3);
      border-color: rgba(157, 140, 207, 0.5);
      color: #fff;
      text-decoration: none;
    }
    .doc-icon {
      padding: 2px 5px;
      background: rgba(157, 140, 207, 0.2);
      border-radius: 2px;
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 1px;
    }
    .tag .dot{
      width:6px;height:6px;border-radius:50%;
      background: var(--accent-green);
      box-shadow: 0 0 0 6px rgba(92,214,133,.10);
    }

    /* ============================================
       CRITERIA CHECKLIST
       ============================================ */
    .checklist{
      display:grid;
      gap: 12px;
      margin-top: var(--space-2);
    }
    .check{
      display:flex;
      gap: 12px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.025);
      align-items:flex-start;
    }
    .check svg{ flex:0 0 auto; margin-top: 2px; }
    .check-title{
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 2px;
    }
    .check-desc{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 200;
    }

    /* ============================================
       MECHANISM NODES
       ============================================ */
    .mechanism{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-1);
    }
    @media (max-width: 980px){
      .mechanism{ grid-template-columns: 1fr; }
    }
    .node{
      border: 1px solid var(--border-glass);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 28px 22px;
      position: relative;
      overflow:hidden;
      min-height: 165px;
    }
    .node::before{
      content:"";
      position:absolute;
      inset:-30%;
      background: radial-gradient(circle at 30% 20%, rgba(157,140,207,.08), transparent 55%);
      opacity:.85;
      pointer-events:none;
    }
    .node > *{ position: relative; z-index: 1; }
    .node-num{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 4px;
      color: var(--purple-bright);
      text-transform: uppercase;
      margin-bottom: 12px;
    }
    .node-title{
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 200;
      margin: 0 0 var(--space-1);
      letter-spacing: -0.02em;
    }
    @media (max-width: 600px){
      .node-title{ font-weight: 300; }
    }
    .node-desc{
      color: var(--text-tertiary);
      line-height: 1.65;
      font-size: 13px;
      font-weight: 200;
      margin: 0;
    }

    /* ============================================
       RECORD BLOCK
       ============================================ */
    .record{
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      overflow:hidden;
    }
    .record-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: var(--space-2) 18px;
      background: rgba(91,75,138,.12);
      border-bottom: 1px solid rgba(255,255,255,.10);
      gap: 12px;
      flex-wrap: wrap;
    }
    .record-title{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.88);
    }
    .record-status{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(92,214,133,.92);
      border: 1px solid rgba(92,214,133,.20);
      background: rgba(92,214,133,.06);
      padding: 6px 10px;
      border-radius: 999px;
      display:flex; align-items:center; gap: 8px;
    }
    .record-status .s-dot{
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--accent-green);
    }
    .record-status.illustrative{
      color: rgba(214,160,92,.95);
      border-color: rgba(214,160,92,.25);
      background: rgba(214,160,92,.08);
    }
    .record-status.illustrative .s-dot{
      background: var(--accent-amber);
    }
    .record-head-right{
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }
    .verify-link{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--purple-bright);
      border: 1px solid rgba(157,140,207,.35);
      background: rgba(91,75,138,.08);
      padding: 6px 10px;
      border-radius: 6px;
      transition: all .2s ease;
    }
    .verify-link:hover{
      border-color: rgba(157,140,207,.55);
      background: rgba(91,75,138,.15);
      text-decoration: none;
    }
    .record-body{
      padding: 18px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.86);
    }
    .kv{
      display:grid;
      grid-template-columns: 150px 1fr;
      gap: 12px;
      padding: var(--space-1) 0;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .kv:last-child{ border-bottom:none; }
    .k{
      color: rgba(255,255,255,.42);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .v{
      color: rgba(255,255,255,.90);
      word-break: break-word;
    }
    .hash-row{
      display:flex;
      align-items:center;
      gap:var(--space-1);
    }
    .copy-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.65);
      padding:4px 8px;
      border-radius:6px;
      font-family:var(--mono);
      font-size:9px;
      letter-spacing:1px;
      text-transform:uppercase;
      cursor:pointer;
      transition:all .2s ease;
    }
    .copy-btn:hover{
      border-color:rgba(157,140,207,.55);
      background:rgba(91,75,138,.18);
      color:rgba(255,255,255,.90);
    }
    .copy-btn.copied{
      border-color:rgba(92,214,133,.35);
      background:rgba(92,214,133,.12);
      color:rgba(92,214,133,.95);
    }
    .record-note{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.62);
      font-size: 11.5px;
      line-height: 1.7;
      font-weight: 200;
      font-family: var(--sans);
    }
    
    /* Copy toast */
    .copy-toast{
      position: fixed;
      bottom: var(--space-3);
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(92,214,133,.12);
      border: 1px solid rgba(92,214,133,.35);
      color: rgba(92,214,133,.95);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 12px 18px;
      border-radius: 10px;
      backdrop-filter: blur(12px);
      opacity: 0;
      transition: opacity .18s ease, transform .18s var(--ease-out);
      pointer-events: none;
      z-index: 100;
    }
    .copy-toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ============================================
       STATES
       ============================================ */
    .states{
      display:grid;
      gap: var(--space-1);
      margin-top: var(--space-2);
    }
    .state{
      padding: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      align-items:flex-start;
    }
    .state-left{
      display:flex; flex-direction: column; gap: 2px;
    }
    .state-name{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: rgba(255,255,255,.86);
    }
    .state-desc{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 200;
      margin:0;
    }
    .badge{
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.80);
      white-space: nowrap;
    }
    .badge.green{ border-color: rgba(92,214,133,.22); color: rgba(92,214,133,.90); background: rgba(92,214,133,.06); }
    .badge.amber{ border-color: rgba(214,160,92,.22); color: rgba(214,160,92,.95); background: rgba(214,160,92,.06); }
    .badge.red{ border-color: rgba(214,92,92,.22); color: rgba(214,92,92,.95); background: rgba(214,92,92,.06); }

    /* ============================================
       ENFORCEMENT DIAGRAM
       ============================================ */
    .diagram-container{
      display:flex;
      flex-direction: column;
      align-items: center;
      margin: var(--space-3) 0 var(--space-5);
    }
    .enforcement-diagram{
      max-width: 400px;
      width: 100%;
      height: auto;
    }
    .diagram-caption{
      font-size: 11px;
      color: var(--text-tertiary);
      text-align: center;
      margin-top: var(--space-2);
      font-family: var(--mono);
      letter-spacing: 0.5px;
    }
    
    /* Subtle interlock pulse */
    @keyframes interlock-pulse {
      0%, 100% { 
        stroke: rgba(157,140,207,0.65);
        filter: drop-shadow(0 0 0 rgba(157,140,207,0));
      }
      50% { 
        stroke: rgba(157,140,207,0.85);
        filter: drop-shadow(0 0 8px rgba(157,140,207,0.25));
      }
    }
    .interlock-bg{
      animation: interlock-pulse 3s ease-in-out infinite;
    }
    
    @media (prefers-reduced-motion: reduce){
      .interlock-bg{ animation: none; }
    }
    
    /* ============================================
       CONTACT
       ============================================ */
    /* Process Timeline */
    .process-timeline{ display: flex; flex-direction: column; gap: 0; }
    .process-step{ display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border-glass); }
    .process-step:last-child{ border-bottom: none; }
    .process-step-num{ 
      width: 28px; height: 28px; flex-shrink: 0;
      background: rgba(91,75,138,.18); border: 1px solid rgba(157,140,207,.35);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-size: 11px; color: var(--purple-bright);
    }
    .process-step-content b{ display: block; margin-bottom: 4px; }
    .process-step-content p{ color: var(--text-secondary); font-size: 13px; line-height: 1.6; margin: 0; }

    .contact-card{
      max-width: 540px;
      background: var(--bg-panel);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: 8px 0;
      backdrop-filter: blur(18px);
    }
    .contact-row{
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 28px;
      border-bottom: 1px solid var(--border-glass);
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .contact-row:last-child{ border-bottom: none; }
    .contact-label{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-tertiary);
    }
    .contact-link{
      font-family: var(--sans);
      font-size: 14px;
      color: var(--purple-bright);
      transition: color .2s ease;
    }
    .contact-link:hover{
      color: var(--text-primary);
      text-decoration: none;
    }

    /* ============================================
       DEFINITION CALLOUT
       ============================================ */
    .definition-callout{
      background: rgba(91,75,138,.08);
      border: 1px solid rgba(157,140,207,.25);
      border-radius: 12px;
      padding: var(--space-2) 18px;
      margin-top: var(--space-2);
    }
    .definition-term{
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--purple-bright);
      margin-bottom: 6px;
    }
    .definition-text{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.65;
      font-weight: 200;
      margin: 0;
    }
    
    /* ============================================
       PROGRAM IDENTITY
       ============================================ */
    .program-grid{
      display: grid;
      gap: 8px;
      font-size: 13px;
    }
    .program-row{
      display: flex;
      justify-content: space-between;
      gap: var(--space-2);
      flex-wrap: wrap;
      padding: 6px 0;
      border-bottom: 1px solid var(--border-glass);
    }
    .program-row:last-child{ border-bottom: none; }
    .program-label{
      color: var(--text-tertiary);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .program-value{
      color: var(--text-primary);
    }
    .program-value.amber{
      color: var(--accent-amber);
    }
    .program-value a{
      color: var(--purple-bright);
    }
    
    /* ============================================
       FOOTER
       ============================================ */
    footer{
      border-top: 1px solid var(--border-glass);
      padding: var(--space-6) 0 var(--space-4);
      margin-top: var(--space-4);
      color: rgba(255,255,255,.45);
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 1px;
    }
    .footer-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--space-2);
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .footer-spec{
      margin-top: 8px;
      color: rgba(255,255,255,.38);
      font-size: 9px;
      letter-spacing: 1px;
    }
    .footer-disclaimer{
      margin-top: 12px;
      color: rgba(255,255,255,.42);
      font-size: 10px;
      max-width: 480px;
      line-height: 1.7;
    }
    .foot-links{ display:flex; gap: var(--space-4); flex-wrap: wrap; }
    .foot-col{ display:flex; flex-direction:column; gap:8px; min-width:120px; }
    .foot-col-title{ font-family:var(--mono); font-size:9px; letter-spacing:2px; color:var(--purple-bright); margin-bottom:4px; }
    .foot-links a{ color: rgba(255,255,255,.48); font-size:13px; }
    .foot-links a:hover{ color: rgba(255,255,255,.82); text-decoration:none; }
    .old-foot-links{
      display:flex; gap: var(--space-2); flex-wrap: wrap;
    }
    .foot-links a{ color: rgba(255,255,255,.48); }
    .foot-links a:hover{ color: rgba(255,255,255,.82); text-decoration:none; }

    /* ============================================
       REVEAL ANIMATION
       ============================================ */
    .reveal{ 
      opacity: 0; 
      transform: translateY(var(--space-3)); 
      transition: opacity .9s var(--ease), transform .9s var(--ease); 
    }
    .reveal.active{ opacity: 1; transform: translateY(0); }
    
    @media (prefers-reduced-motion: reduce){
      .reveal{ opacity: 1; transform: none; transition: none; }
    }

    /* Download Modal */
    .download-modal{
      display: none;
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(6px);
      align-items: center;
      justify-content: center;
      padding: var(--space-2);
    }
    .download-modal.open{ display: flex; }
    .download-modal-card{
      background: var(--bg-deep);
      border: 1px solid var(--border-glass);
      border-radius: 18px;
      padding: var(--space-3);
      max-width: 420px;
      width: 100%;
      position: relative;
    }
    .download-modal-close{
      position: absolute;
      top: 14px;
      right: 14px;
      appearance: none;
      border: none;
      background: none;
      color: var(--text-tertiary);
      font-size: 24px;
      cursor: pointer;
      line-height: 1;
    }
    .download-modal-close:hover{ color: var(--text-primary); }
    .download-modal-card h3{
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 200;
      margin: 0 0 8px;
    }
    .download-modal-card > p{
      color: var(--text-secondary);
      font-size: 13px;
      line-height: 1.7;
      margin: 0 0 var(--space-2);
    }
    .download-form-group{ margin-bottom: 14px; }
    .download-form-label{
      display: block;
      font-family: var(--mono);
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-tertiary);
      margin-bottom: 6px;
    }
    .download-form-input, .download-form-select{
      width: 100%;
      padding: 12px 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border-glass);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: var(--sans);
      font-size: 14px;
    }
    .download-form-input:focus, .download-form-select:focus{
      outline: none;
      border-color: rgba(157,140,207,.55);
    }
    .download-form-select{
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }
    .download-form-btn{
      appearance: none;
      width: 100%;
      border: 1px solid rgba(157,140,207,.55);
      background: rgba(91,75,138,.18);
      color: var(--text-primary);
      padding: 14px 24px;
      border-radius: 12px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .2s var(--ease), border-color .2s ease, background .2s ease;
    }
    .download-form-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(157,140,207,.85);
      background: rgba(91,75,138,.26);
    }
    .download-form-fine{
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: var(--space-2);
      line-height: 1.6;
      text-align: center;
    }
  </style>
</head>

<body>
  <a href="#main" class="skip-link">Skip to content</a>
  <div class="grid-overlay" aria-hidden="true"></div>

  <header class="site-header">
    <div class="nav-inner">
      <a href="#main" class="brand">
        <div class="brand-mark" aria-hidden="true">
          <div class="brand-mark-inner"></div>
        </div>
        <div class="brand-name">Sentinel Authority</div>
      </a>

      <nav class="nav-links" aria-label="Section navigation">
        <a href="#envelo" data-section="envelo">FRAMEWORK</a>
        <a href="#criteria" data-section="criteria">CRITERIA</a>
        <a href="#artifacts" data-section="artifacts">ARTIFACTS</a>
        <a href="#security" data-section="security">SECURITY</a>
        <a href="#verify" data-section="verify">VERIFY</a>
        <a href="#contact" data-section="contact">CONTACT</a>
        <a href="https://app.sentinelauthority.org">SIGN IN</a>
      </nav>
      <a href="draft.html" class="nav-badge" title="Draft v1.0 — examples are illustrative and non-normative" aria-describedby="draft-note">
        <span>DRAFT v1.0</span>
      </a>
      <span id="draft-note" class="sr-only">
        Specification status: Draft v1.0. Examples are illustrative and non-normative.
      </span>
      
      <button class="nav-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="nav-drawer">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>
  
  <div class="drawer-overlay" aria-hidden="true"></div>
  <div id="nav-drawer" class="nav-drawer" role="navigation" aria-label="Mobile navigation">
    <a href="#envelo" data-section="envelo">FRAMEWORK</a>
    <a href="#criteria" data-section="criteria">CRITERIA</a>
    <a href="#artifacts" data-section="artifacts">ARTIFACTS</a>
    <a href="#security" data-section="security">SECURITY</a>
        <a href="#verify" data-section="verify">VERIFY</a>
    <a href="#contact" data-section="contact">CONTACT</a>
    <a href="https://app.sentinelauthority.org">SIGN IN</a>
  </div>
  <!-- Copy toast -->
  <div class="copy-toast" role="status" aria-live="polite">Hash copied to clipboard</div>

  <main id="main">
    <!-- HERO -->
    <section class="hero" style="position: relative;">
      <!-- Animated background elements -->
      <div style="position: absolute; top: 20%; right: 10%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(157,140,207,0.08) 0%, transparent 70%); pointer-events: none; animation: float 8s ease-in-out infinite;"></div>
      <div style="position: absolute; bottom: 20%; left: 5%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(92,214,133,0.05) 0%, transparent 70%); pointer-events: none; animation: float 10s ease-in-out infinite reverse;"></div>
      
      <style>
        @keyframes float {
          0%, 100% { transform: translateY(0px) rotate(0deg); }
          50% { transform: translateY(-20px) rotate(2deg); }
        }
        @keyframes typewriter {
          from { width: 0; }
          to { width: 100%; }
        }
        @keyframes blink {
          50% { border-color: transparent; }
        }
      </style>
      
      <div class="hero-kicker" style="display: flex; align-items: center; gap: 12px;">
        <div style="width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%; animation: pulse 2s ease-in-out infinite;"></div>
        <span>SENTINEL AUTHORITY</span>
      </div>
      
      <h1 style="position: relative;">
        The <span class="accent">Physics</span> of<br>Permission.
      </h1>
      
      <!-- Animated tagline -->
      <div style="display: flex; align-items: center; gap: 16px; margin: var(--space-2) 0;">
        <div style="height: 1px; width: 60px; background: linear-gradient(90deg, var(--purple-bright), transparent);"></div>
        <p style="font-family: var(--mono); font-size: 12px; letter-spacing: 3px; color: var(--purple-bright); text-transform: uppercase; margin: 0;">
          Autonomous Systems Conformance
        </p>
      </div>
      
      <p class="hero-desc" style="font-size: 20px; max-width: 58ch; border-left: none; padding-left: 0;">
        <strong style="color: var(--text-primary);">ODDC</strong> certifies that autonomous systems operate within declared boundaries — with <strong style="color: var(--purple-bright);">ENVELO</strong> enforcement that makes those boundaries real.
      </p>

      <!-- Key value props -->
      <div style="display: flex; gap: 24px; flex-wrap: wrap; margin: var(--space-3) 0;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="width: 36px; height: 36px; background: rgba(157,140,207,0.12); border: 1px solid rgba(157,140,207,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.9)" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <div>
            <div style="font-size: 13px; color: var(--text-primary); font-weight: 500;">Non-Bypassable</div>
            <div style="font-size: 11px; color: var(--text-tertiary);">Architectural enforcement</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="width: 36px; height: 36px; background: rgba(92,214,133,0.12); border: 1px solid rgba(92,214,133,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(92,214,133,0.9)" stroke-width="1.5"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
          </div>
          <div>
            <div style="font-size: 13px; color: var(--text-primary); font-weight: 500;">Verifiable</div>
            <div style="font-size: 11px; color: var(--text-tertiary);">Tamper-evident records</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="width: 36px; height: 36px; background: rgba(214,160,92,0.12); border: 1px solid rgba(214,160,92,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(214,160,92,0.9)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
          <div>
            <div style="font-size: 13px; color: var(--text-primary); font-weight: 500;">72-Hour Test</div>
            <div style="font-size: 11px; color: var(--text-tertiary);">Continuous proof</div>
          </div>
        </div>
      </div>

      <!-- CTA Buttons -->
      <div class="hero-actions" style="margin-top: var(--space-3);">
        <a class="btn primary" href="https://app.sentinelauthority.org" style="display: inline-flex; align-items: center; gap: 10px; padding: 16px 28px;">
          Start Certification
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
        <a class="btn" href="#envelo" style="display: inline-flex; align-items: center; gap: 8px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
          How It Works
        </a>
        <a class="btn" href="#verify" style="display: inline-flex; align-items: center; gap: 8px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          Verify Certificate
        </a>
      </div>

      <!-- Trust indicators -->
      <div style="margin-top: var(--space-4); padding-top: var(--space-3); border-top: 1px solid var(--border-glass);">
        <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 12px;">Built for</div>
        <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
          <span style="font-size: 13px; color: var(--text-secondary); padding: 8px 14px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-subtle); border-radius: 8px;">Critical Infrastructure</span>
          <span style="font-size: 13px; color: var(--text-secondary); padding: 8px 14px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-subtle); border-radius: 8px;">Insurers & Underwriters</span>
          <span style="font-size: 13px; color: var(--text-secondary); padding: 8px 14px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-subtle); border-radius: 8px;">Autonomous Systems</span>
        </div>
      </div>

      <!-- Disclaimer -->
      <div style="margin-top: var(--space-3); padding: 16px 20px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-subtle); border-radius: 12px; max-width: 700px;">
        <p style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); letter-spacing: 0.5px; line-height: 1.7; margin: 0;">
          Independent conformance determination. Not a regulator. Not legal advice. ODDC does not attest safety, compliance, cybersecurity, or performance. Implementations remain operator responsibility.
        </p>
      </div>
    </section>

    <!-- ENVELO -->
    <section id="envelo" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">THE FRAMEWORK</span>
          <h2 class="section-title">ODDC + ENVELO</h2>
          <p class="section-lead">
            Two questions. One framework. Complete accountability.
          </p>
        </div>
      </div>

      <!-- Visual Framework Diagram -->
      <div class="diagram-container reveal">
        <svg viewBox="0 0 800 280" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 800px; width: 100%;">
          <!-- ODDC Box -->
          <rect x="40" y="40" width="320" height="200" rx="18" fill="rgba(91,75,138,0.08)" stroke="rgba(157,140,207,0.4)" stroke-width="2"/>
          <text x="200" y="80" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500" letter-spacing="4">ODDC</text>
          <text x="200" y="105" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">ODD Conformance Determination</text>
          <line x1="120" y1="125" x2="280" y2="125" stroke="rgba(157,140,207,0.2)" stroke-width="1"/>
          <text x="200" y="155" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="Source Serif 4, serif" font-size="16" font-style="italic">"Where can it operate?"</text>
          <text x="200" y="185" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="12">Formally specified boundaries</text>
          <text x="200" y="205" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="12">Auditable evidence</text>
          <text x="200" y="225" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="12">Revocable conformance</text>
          
          <!-- ENVELO Box -->
          <rect x="440" y="40" width="320" height="200" rx="18" fill="rgba(92,214,133,0.06)" stroke="rgba(92,214,133,0.35)" stroke-width="2"/>
          <text x="600" y="80" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500" letter-spacing="4">ENVELO</text>
          <text x="600" y="105" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">Non-Violable Execution & Limit Oversight</text>
          <line x1="520" y1="125" x2="680" y2="125" stroke="rgba(92,214,133,0.2)" stroke-width="1"/>
          <text x="600" y="155" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="Source Serif 4, serif" font-size="16" font-style="italic">"What enforces it?"</text>
          <text x="600" y="185" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="12">Non-bypassable interlock</text>
          <text x="600" y="205" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="12">Fail-closed behavior</text>
          <text x="600" y="225" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="12">Tamper-evident logging</text>
          
          <!-- Connecting element -->
          <line x1="360" y1="140" x2="440" y2="140" stroke="rgba(157,140,207,0.4)" stroke-width="2" stroke-dasharray="6,4">
            <animate attributeName="stroke-dashoffset" from="0" to="-20" dur="2s" repeatCount="indefinite"/>
          </line>
          <circle cx="400" cy="140" r="20" fill="rgba(91,75,138,0.15)" stroke="rgba(157,140,207,0.5)" stroke-width="1.5"/>
          <text x="400" y="145" text-anchor="middle" fill="rgba(157,140,207,0.9)" font-family="Inter, sans-serif" font-size="16">+</text>
        </svg>
        <p class="diagram-caption">Without ENVELO, ODDC is paperwork. With ENVELO, ODDC becomes enforceable.</p>
      </div>

      <!-- Core Requirements -->
      <div class="mechanism reveal">
        <div class="node">
          <div class="node-num">ODDC</div>
          <h3 class="node-title">Operational Domain</h3>
          <p class="node-desc">Formally specified boundary of permitted autonomous action. Signed, auditable, revocable.</p>
        </div>
        <div class="node">
          <div class="node-num">ENVELO</div>
          <h3 class="node-title">Runtime Interlock</h3>
          <p class="node-desc">Non-bypassable enforcement validates every action before execution. Fail-closed on violation.</p>
        </div>
        <div class="node">
          <div class="node-num">AUDIT</div>
          <h3 class="node-title">Evidence Trail</h3>
          <p class="node-desc">Tamper-evident logging of all boundary interactions for regulators, insurers, and counterparties.</p>
        </div>
      </div>

      <!-- ENVELO Details -->
      <div class="panel reveal" style="margin-top: var(--space-3);">
        <h3>ENVELO Requirements</h3>
        <p><i>Enforcer for Non-Violable Execution & Limit Oversight</i> — the runtime enforcement layer that makes a declared operating boundary real.</p>
        <div class="checklist" style="margin-top: var(--space-2);">
          <div class="check">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.65)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.9)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div><div class="check-title">Non-bypassable interlock</div><div class="check-desc">Enforcement mechanism must validate actions before execution.</div></div>
          </div>
          <div class="check">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.65)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.9)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div><div class="check-title">Fail-closed behavior</div><div class="check-desc">Out-of-domain actions must be blocked or overridden automatically.</div></div>
          </div>
          <div class="check">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.65)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.9)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div><div class="check-title">Runtime comparison</div><div class="check-desc">State evaluation against ODD constraints at decision time.</div></div>
          </div>
          <div class="check">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.65)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.9)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div><div class="check-title">Tamper-evident logging</div><div class="check-desc">All boundary interactions recorded for audit and verification.</div></div>
          </div>
        </div>
        <div style="margin-top:var(--space-2)">
          <span class="tag"><span class="dot" aria-hidden="true"></span> REQUIREMENTS, NOT SOFTWARE</span>
        </div>
      </div>
    </section>

    <!-- CRITERIA -->
    <section id="criteria" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">CONFORMANCE CRITERIA</span>
          <h2 class="section-title">Five Gates to Conformance</h2>
          <p class="section-lead">
            Every criterion must be satisfied. No exceptions. No waivers.
          </p>
        </div>
      </div>

      <!-- Visual Criteria Gates -->
      <div class="diagram-container reveal">
        <svg viewBox="0 0 900 120" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 900px; width: 100%;">
          <!-- Gate 1 -->
          <rect x="10" y="20" width="160" height="80" rx="12" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="90" y="50" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">01 — ODD</text>
          <text x="90" y="70" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">Formally Specified</text>
          <text x="90" y="88" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-family="Inter, sans-serif" font-size="10">Domain boundaries</text>
          
          <!-- Connector -->
          <line x1="170" y1="60" x2="190" y2="60" stroke="rgba(92,214,133,0.3)" stroke-width="2"/>
          
          <!-- Gate 2 -->
          <rect x="190" y="20" width="160" height="80" rx="12" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="270" y="50" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">02 — STABLE</text>
          <text x="270" y="70" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">Evidence of Behavior</text>
          <text x="270" y="88" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-family="Inter, sans-serif" font-size="10">Within bounds</text>
          
          <!-- Connector -->
          <line x1="350" y1="60" x2="370" y2="60" stroke="rgba(92,214,133,0.3)" stroke-width="2"/>
          
          <!-- Gate 3 -->
          <rect x="370" y="20" width="160" height="80" rx="12" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="450" y="50" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">03 — ENVELO</text>
          <text x="450" y="70" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">Enforcement Present</text>
          <text x="450" y="88" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-family="Inter, sans-serif" font-size="10">Non-bypassable</text>
          
          <!-- Connector -->
          <line x1="530" y1="60" x2="550" y2="60" stroke="rgba(92,214,133,0.3)" stroke-width="2"/>
          
          <!-- Gate 4 -->
          <rect x="550" y="20" width="160" height="80" rx="12" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="630" y="50" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">04 — AUDIT</text>
          <text x="630" y="70" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">Tamper-Evident</text>
          <text x="630" y="88" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-family="Inter, sans-serif" font-size="10">Signed records</text>
          
          <!-- Connector -->
          <line x1="710" y1="60" x2="730" y2="60" stroke="rgba(92,214,133,0.3)" stroke-width="2"/>
          
          <!-- Gate 5 -->
          <rect x="730" y="20" width="160" height="80" rx="12" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="810" y="50" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">05 — REVOKE</text>
          <text x="810" y="70" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">Drift Handling</text>
          <text x="810" y="88" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-family="Inter, sans-serif" font-size="10">Clear suspension</text>
        </svg>
      </div>

      <!-- Conformance States Visual -->
      <div class="reveal" style="margin-top: var(--space-4);">
        <h3 style="font-family: var(--mono); font-size: 11px; letter-spacing: 4px; text-transform: uppercase; color: rgba(255,255,255,.85); margin-bottom: var(--space-2);">Conformance States</h3>
        <div class="diagram-container">
          <svg viewBox="0 0 800 100" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 800px; width: 100%;">
            <!-- Observe -->
            <rect x="20" y="20" width="170" height="60" rx="10" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.15)" stroke-width="1.5"/>
            <text x="105" y="45" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="IBM Plex Mono, monospace" font-size="10" letter-spacing="2">OBSERVE</text>
            <text x="105" y="62" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-family="Inter, sans-serif" font-size="10">No actuation</text>
            
            <!-- Arrow -->
            <path d="M195 50 L215 50" stroke="rgba(255,255,255,0.2)" stroke-width="1.5"/>
            <polygon points="220,50 212,46 212,54" fill="rgba(255,255,255,0.2)"/>
            
            <!-- Bounded -->
            <rect x="225" y="20" width="170" height="60" rx="10" fill="rgba(214,160,92,0.08)" stroke="rgba(214,160,92,0.4)" stroke-width="1.5"/>
            <text x="310" y="45" text-anchor="middle" fill="rgba(214,160,92,0.95)" font-family="IBM Plex Mono, monospace" font-size="10" letter-spacing="2">BOUNDED</text>
            <text x="310" y="62" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-family="Inter, sans-serif" font-size="10">Limited autonomy</text>
            
            <!-- Arrow -->
            <path d="M400 50 L420 50" stroke="rgba(255,255,255,0.2)" stroke-width="1.5"/>
            <polygon points="425,50 417,46 417,54" fill="rgba(255,255,255,0.2)"/>
            
            <!-- Conformant -->
            <rect x="430" y="20" width="170" height="60" rx="10" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
            <text x="515" y="45" text-anchor="middle" fill="rgba(92,214,133,0.95)" font-family="IBM Plex Mono, monospace" font-size="10" letter-spacing="2">CONFORMANT</text>
            <text x="515" y="62" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-family="Inter, sans-serif" font-size="10">Full autonomy in ODD</text>
            
            <!-- Arrow to Revoked -->
            <path d="M605 50 L625 50" stroke="rgba(214,92,92,0.3)" stroke-width="1.5" stroke-dasharray="4,3"/>
            <polygon points="630,50 622,46 622,54" fill="rgba(214,92,92,0.3)"/>
            
            <!-- Revoked -->
            <rect x="635" y="20" width="145" height="60" rx="10" fill="rgba(214,92,92,0.08)" stroke="rgba(214,92,92,0.4)" stroke-width="1.5"/>
            <text x="707" y="45" text-anchor="middle" fill="rgba(214,92,92,0.95)" font-family="IBM Plex Mono, monospace" font-size="10" letter-spacing="2">REVOKED</text>
            <text x="707" y="62" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-family="Inter, sans-serif" font-size="10">Suspended</text>
          </svg>
        </div>
      </div>

      <!-- Attestation Comparison -->
      <div class="grid-2 reveal" style="margin-top: var(--space-4);">
        <div class="panel" style="border-color: rgba(92,214,133,0.25);">
          <h3 style="color: rgba(92,214,133,0.9);">✓ What ODDC Attests</h3>
          <div class="checklist" style="margin-top: var(--space-1);">
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.4)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">ODD formally specified with boundaries</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.4)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">Stable operation within declared ODD</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.4)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">ENVELO enforcement architecturally present</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.4)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">CAT-72 verification completed</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(92,214,133,.4)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(92,214,133,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">Tamper-evident audit records available</div></div>
            </div>
          </div>
        </div>

        <div class="panel" style="border-color: rgba(214,92,92,0.25);">
          <h3 style="color: rgba(214,92,92,0.9);">✗ What ODDC Does Not Attest</h3>
          <div class="checklist" style="margin-top: var(--space-1);">
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(214,92,92,.4)" stroke-width="1.5"/><path d="M8 8l6 6M14 8l-6 6" stroke="rgba(214,92,92,.7)" stroke-width="1.5" stroke-linecap="round"/></svg>
              <div><div class="check-desc">Functional safety of underlying system</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(214,92,92,.4)" stroke-width="1.5"/><path d="M8 8l6 6M14 8l-6 6" stroke="rgba(214,92,92,.7)" stroke-width="1.5" stroke-linecap="round"/></svg>
              <div><div class="check-desc">Regulatory or legal compliance</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(214,92,92,.4)" stroke-width="1.5"/><path d="M8 8l6 6M14 8l-6 6" stroke="rgba(214,92,92,.7)" stroke-width="1.5" stroke-linecap="round"/></svg>
              <div><div class="check-desc">Cybersecurity posture or resilience</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(214,92,92,.4)" stroke-width="1.5"/><path d="M8 8l6 6M14 8l-6 6" stroke="rgba(214,92,92,.7)" stroke-width="1.5" stroke-linecap="round"/></svg>
              <div><div class="check-desc">System performance or accuracy</div></div>
            </div>
            <div class="check" style="padding: 10px 0; border: none; background: none;">
              <svg width="18" height="18" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(214,92,92,.4)" stroke-width="1.5"/><path d="M8 8l6 6M14 8l-6 6" stroke="rgba(214,92,92,.7)" stroke-width="1.5" stroke-linecap="round"/></svg>
              <div><div class="check-desc">AI model correctness or fitness</div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="definition-callout reveal" style="margin-top: var(--space-3); max-width: 600px;">
        <div class="definition-term">Material Deviation</div>
        <p class="definition-text">Any state, trajectory, or enforcement failure that exceeds attested tolerances or violates defined invariants — triggers immediate conformance review.</p>
      </div>
    </section>

    <!-- CAT-72 -->
    <section id="cat72" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">CONFORMANCE PROCEDURE</span>
          <h2 class="section-title">CAT-72</h2>
          <p class="section-lead">
            Convergence Authorization Test — 72 hours of continuous proof.
          </p>
        </div>
      </div>

      <!-- Visual Timer -->
      <div class="diagram-container reveal">
        <svg viewBox="0 0 700 160" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 700px; width: 100%;">
          <rect x="50" y="20" width="600" height="120" rx="18" fill="rgba(91,75,138,0.06)" stroke="rgba(157,140,207,0.25)" stroke-width="1.5"/>
          <text x="200" y="95" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="Source Serif 4, serif" font-size="72" font-weight="200">72</text>
          <text x="280" y="85" text-anchor="start" fill="rgba(255,255,255,0.6)" font-family="IBM Plex Mono, monospace" font-size="14" letter-spacing="3">HOURS</text>
          <text x="280" y="105" text-anchor="start" fill="rgba(255,255,255,0.4)" font-family="Inter, sans-serif" font-size="12">continuous operation</text>
          <line x1="400" y1="40" x2="400" y2="120" stroke="rgba(157,140,207,0.15)" stroke-width="1"/>
          <text x="500" y="55" text-anchor="middle" fill="rgba(92,214,133,0.9)" font-family="IBM Plex Mono, monospace" font-size="11" letter-spacing="2">CONVERGENCE</text>
          <text x="500" y="75" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">within declared bounds</text>
          <text x="500" y="100" text-anchor="middle" fill="rgba(214,160,92,0.9)" font-family="IBM Plex Mono, monospace" font-size="11" letter-spacing="2">STRESS TESTED</text>
          <text x="500" y="120" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">across all regimes</text>
          <circle cx="100" cy="80" r="4" fill="rgba(92,214,133,0.8)"><animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite"/></circle>
          <circle cx="120" cy="80" r="4" fill="rgba(92,214,133,0.8)"><animate attributeName="opacity" values="0.3;1;0.3" dur="2s" begin="0.3s" repeatCount="indefinite"/></circle>
          <circle cx="140" cy="80" r="4" fill="rgba(92,214,133,0.8)"><animate attributeName="opacity" values="0.3;1;0.3" dur="2s" begin="0.6s" repeatCount="indefinite"/></circle>
        </svg>
        <p class="diagram-caption">No waivers. No shortcuts. 72 hours of evidence or no conformance.</p>
      </div>

      <!-- Requirements -->
      <div class="mechanism reveal">
        <div class="node">
          <div class="node-num">01</div>
          <h3 class="node-title">Continuous Demo</h3>
          <p class="node-desc">72-hour sustained operation within declared ODD bounds. No interruptions, no resets.</p>
        </div>
        <div class="node">
          <div class="node-num">02</div>
          <h3 class="node-title">Stress Testing</h3>
          <p class="node-desc">Multi-regime operational testing across edge conditions and state transitions.</p>
        </div>
        <div class="node">
          <div class="node-num">03</div>
          <h3 class="node-title">Fail-Closed Proof</h3>
          <p class="node-desc">Verified halt behavior when ENVELO detects material deviation outside ODD.</p>
        </div>
      </div>

      <div class="grid-2 reveal" style="margin-top: var(--space-3);">
        <div class="panel">
          <h3>Evidence Requirements</h3>
          <div class="checklist">
            <div class="check">
              <svg width="20" height="20" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(157,140,207,.5)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(157,140,207,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">Cryptographically signed telemetry log</div></div>
            </div>
            <div class="check">
              <svg width="20" height="20" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(157,140,207,.5)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(157,140,207,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">Hash-chain linked state recordings</div></div>
            </div>
            <div class="check">
              <svg width="20" height="20" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(157,140,207,.5)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(157,140,207,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">Interlock activation events with timestamps</div></div>
            </div>
            <div class="check">
              <svg width="20" height="20" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="10" stroke="rgba(157,140,207,.5)" stroke-width="1.5"/><path d="M7 11l3 3 5-6" stroke="rgba(157,140,207,.8)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <div><div class="check-desc">Convergence metrics and boundary proximity</div></div>
            </div>
          </div>
        </div>
        <div class="panel">
          <h3>Tolerance Declaration</h3>
          <p>Applicants declare operational tolerances prior to CAT-72. Tolerances are domain-specific based on:</p>
          <ul class="list">
            <li>Equipment manufacturer specifications</li>
            <li>Applicable regulatory requirements</li>
            <li>Risk profile and consequence severity</li>
            <li>Industry standards and best practices</li>
          </ul>
          <p class="panel-fine" style="margin-top: var(--space-1);">Must be quantitative, bounded, documented. Cannot be modified during test.</p>
        </div>
      </div>

      <div class="reveal" style="margin-top: var(--space-2); text-align: center;">
        <span class="tag"><span class="dot" aria-hidden="true"></span> REQUIRED FOR INITIAL CONFORMANCE AND RENEWAL</span>
      </div>
    </section>

    <!-- GRANT -->
    <section id="grant" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">GRANT INSTRUMENT</span>
          <h2 class="section-title">The Certificate</h2>
          <p class="section-lead">
            A signed, verifiable attestation for regulators, insurers, and counterparties.
          </p>
        </div>
      </div>

      <!-- Visual Certificate Preview -->
      <div class="diagram-container reveal">
        <svg viewBox="0 0 500 320" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 500px; width: 100%;">
          <!-- Certificate background -->
          <rect x="20" y="10" width="460" height="300" rx="16" fill="rgba(91,75,138,0.06)" stroke="rgba(157,140,207,0.35)" stroke-width="2"/>
          
          <!-- Header bar -->
          <rect x="20" y="10" width="460" height="50" rx="16" fill="rgba(91,75,138,0.12)"/>
          <rect x="20" y="44" width="460" height="16" fill="rgba(91,75,138,0.12)"/>
          
          <!-- Logo mark -->
          <rect x="40" y="24" width="22" height="22" rx="5" fill="rgba(91,75,138,0.8)" stroke="rgba(157,140,207,0.8)" stroke-width="1.5"/>
          <circle cx="51" cy="35" r="4" fill="rgba(196,184,232,0.9)"/>
          
          <!-- Title -->
          <text x="75" y="40" fill="rgba(255,255,255,0.9)" font-family="IBM Plex Mono, monospace" font-size="11" letter-spacing="3">ODDC CONFORMANCE</text>
          
          <!-- Status badge -->
          <rect x="380" y="25" width="85" height="24" rx="12" fill="rgba(92,214,133,0.15)" stroke="rgba(92,214,133,0.4)" stroke-width="1"/>
          <circle cx="395" cy="37" r="4" fill="rgba(92,214,133,0.9)"/>
          <text x="405" y="41" fill="rgba(92,214,133,0.95)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="1">VALID</text>
          
          <!-- Certificate fields -->
          <text x="40" y="85" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">CERTIFICATE ID</text>
          <text x="40" y="102" fill="rgba(157,140,207,0.95)" font-family="IBM Plex Mono, monospace" font-size="12">SA-ODDC-2026-00142</text>
          
          <text x="280" y="85" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">ISSUED</text>
          <text x="280" y="102" fill="rgba(255,255,255,0.8)" font-family="Inter, sans-serif" font-size="12">Jan 15, 2026</text>
          
          <line x1="40" y1="120" x2="460" y2="120" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
          
          <text x="40" y="145" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">ORGANIZATION</text>
          <text x="40" y="162" fill="rgba(255,255,255,0.9)" font-family="Inter, sans-serif" font-size="13">Autonomous Systems Corp.</text>
          
          <text x="280" y="145" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">SYSTEM</text>
          <text x="280" y="162" fill="rgba(255,255,255,0.9)" font-family="Inter, sans-serif" font-size="13">Industrial Controller v2.1</text>
          
          <line x1="40" y1="180" x2="460" y2="180" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
          
          <text x="40" y="205" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">ODD SCOPE</text>
          <text x="40" y="222" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">Autonomous operation within declared thermal, velocity,</text>
          <text x="40" y="238" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="11">and spatial boundaries — ENVELO enforced</text>
          
          <line x1="40" y1="255" x2="460" y2="255" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
          
          <text x="40" y="280" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">RECORD HASH</text>
          <text x="40" y="297" fill="rgba(157,140,207,0.7)" font-family="IBM Plex Mono, monospace" font-size="10">8f2a9c7b...d91c</text>
          
          <text x="280" y="280" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="2">EXPIRES</text>
          <text x="280" y="297" fill="rgba(255,255,255,0.8)" font-family="Inter, sans-serif" font-size="12">Jan 15, 2027</text>
          
          <!-- Decorative seal -->
          <circle cx="430" cy="250" r="30" fill="none" stroke="rgba(157,140,207,0.15)" stroke-width="1.5" stroke-dasharray="4,3"/>
          <circle cx="430" cy="250" r="20" fill="rgba(91,75,138,0.1)" stroke="rgba(157,140,207,0.25)" stroke-width="1"/>
          <text x="430" y="254" text-anchor="middle" fill="rgba(157,140,207,0.6)" font-family="IBM Plex Mono, monospace" font-size="8">SA</text>
        </svg>
        <p class="diagram-caption">Cryptographically signed, independently verifiable, instantly revocable</p>
      </div>

      <!-- What the certificate confers -->
      <div class="mechanism reveal" style="margin-top: var(--space-3);">
        <div class="node">
          <div class="node-num">SCOPE</div>
          <h3 class="node-title">ODD Definition</h3>
          <p class="node-desc">Formally declared operational boundaries. Where your system can operate autonomously.</p>
        </div>
        <div class="node">
          <div class="node-num">RIGHTS</div>
          <h3 class="node-title">Actuation Permit</h3>
          <p class="node-desc">Bounded autonomous action within declared ODD. Continuous ENVELO enforcement required.</p>
        </div>
        <div class="node">
          <div class="node-num">EVIDENCE</div>
          <h3 class="node-title">Signed Artifact</h3>
          <p class="node-desc">Tamper-evident record for regulators, insurers, and counterparties. Hash-verifiable.</p>
        </div>
      </div>

      <!-- Key terms -->
      <div class="grid-2 reveal" style="margin-top: var(--space-3);">
        <div class="panel">
          <h3>Certificate Terms</h3>
          <div style="display: grid; gap: 12px; margin-top: var(--space-1);">
            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-glass);">
              <span style="color: var(--text-tertiary); font-family: var(--mono); font-size: 10px; letter-spacing: 1px;">VALIDITY</span>
              <span style="color: var(--text-primary); font-size: 13px;">12 months standard</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-glass);">
              <span style="color: var(--text-tertiary); font-family: var(--mono); font-size: 10px; letter-spacing: 1px;">RENEWAL</span>
              <span style="color: var(--text-primary); font-size: 13px;">CAT-72 re-verification</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-glass);">
              <span style="color: var(--text-tertiary); font-family: var(--mono); font-size: 10px; letter-spacing: 1px;">REVOCATION</span>
              <span style="color: var(--text-primary); font-size: 13px;">Immediate on deviation</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px 0;">
              <span style="color: var(--text-tertiary); font-family: var(--mono); font-size: 10px; letter-spacing: 1px;">VERIFICATION</span>
              <span style="color: var(--purple-bright); font-size: 13px;">Public registry API</span>
            </div>
          </div>
        </div>

        <div class="panel" style="border-color: rgba(214,160,92,0.25);">
          <h3 style="color: rgba(214,160,92,0.9);">Scope Limitations</h3>
          <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.7; margin: 0;">
            ODDC attests <strong>only</strong> that evidence supports operation within declared ODD bounds with ENVELO enforcement present. 
          </p>
          <p style="color: var(--text-tertiary); font-size: 13px; line-height: 1.7; margin-top: var(--space-1);">
            Not attested: functional safety, regulatory compliance, cybersecurity, performance, AI accuracy, or fitness for purpose. These remain operator responsibility.
          </p>
        </div>
      </div>
    </section>

    <!-- MECHANISM -->
    <section id="mechanism" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">RUNTIME ENFORCEMENT</span>
          <h2 class="section-title">The Interlock</h2>
          <p class="section-lead">
            Every action passes through. No exceptions. No bypasses.
          </p>
        </div>
      </div>

      <!-- Horizontal Flow Diagram -->
      <div class="diagram-container reveal">
        <svg viewBox="0 0 900 200" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 900px; width: 100%;">
          <!-- AI Model -->
          <rect x="20" y="60" width="140" height="80" rx="14" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.2)" stroke-width="1.5"/>
          <text x="90" y="95" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="2">AI MODEL</text>
          <text x="90" y="115" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-family="Inter, sans-serif" font-size="12">Decision</text>
          
          <!-- Arrow 1 with animation -->
          <line x1="160" y1="100" x2="230" y2="100" stroke="rgba(255,255,255,0.3)" stroke-width="2" stroke-dasharray="8,6">
            <animate attributeName="stroke-dashoffset" from="0" to="-28" dur="1.5s" repeatCount="indefinite"/>
          </line>
          <polygon points="235,100 222,94 222,106" fill="rgba(255,255,255,0.4)"/>
          <text x="195" y="85" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="1">ACTION</text>
          
          <!-- ENVELO Interlock (center, prominent) -->
          <rect x="240" y="30" width="220" height="140" rx="18" fill="rgba(91,75,138,0.1)" stroke="rgba(157,140,207,0.5)" stroke-width="2"/>
          
          <!-- Pulsing glow effect -->
          <rect x="240" y="30" width="220" height="140" rx="18" fill="none" stroke="rgba(157,140,207,0.3)" stroke-width="4">
            <animate attributeName="stroke-opacity" values="0.1;0.4;0.1" dur="3s" repeatCount="indefinite"/>
          </rect>
          
          <text x="350" y="58" text-anchor="middle" fill="rgba(157,140,207,0.9)" font-family="IBM Plex Mono, monospace" font-size="11" letter-spacing="4">ENVELO</text>
          
          <!-- Inner interlock box -->
          <rect x="270" y="75" width="160" height="70" rx="12" fill="rgba(91,75,138,0.15)" stroke="rgba(157,140,207,0.6)" stroke-width="1.5"/>
          <text x="350" y="105" text-anchor="middle" fill="rgba(255,255,255,0.95)" font-family="IBM Plex Mono, monospace" font-size="12" letter-spacing="3">INTERLOCK</text>
          <text x="350" y="125" text-anchor="middle" fill="rgba(157,140,207,0.7)" font-family="Inter, sans-serif" font-size="10">validate → permit/block</text>
          
          <!-- Block path (going up) -->
          <path d="M430 75 L430 40 L520 40" stroke="rgba(214,92,92,0.5)" stroke-width="1.5" stroke-dasharray="5,4" fill="none"/>
          <rect x="520" y="25" width="90" height="30" rx="8" fill="rgba(214,92,92,0.1)" stroke="rgba(214,92,92,0.4)" stroke-width="1"/>
          <text x="565" y="45" text-anchor="middle" fill="rgba(214,92,92,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">BLOCKED</text>
          
          <!-- Audit path (going down) -->
          <path d="M270 145 L270 175 L180 175" stroke="rgba(255,255,255,0.2)" stroke-width="1" stroke-dasharray="4,4" fill="none"/>
          <text x="175" y="180" text-anchor="end" fill="rgba(255,255,255,0.4)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="1">AUDIT LOG</text>
          
          <!-- Arrow 2 (permitted path) with animation -->
          <line x1="460" y1="100" x2="530" y2="100" stroke="rgba(92,214,133,0.5)" stroke-width="2" stroke-dasharray="8,6">
            <animate attributeName="stroke-dashoffset" from="0" to="-28" dur="1.5s" repeatCount="indefinite"/>
          </line>
          <polygon points="535,100 522,94 522,106" fill="rgba(92,214,133,0.6)"/>
          <text x="495" y="85" text-anchor="middle" fill="rgba(92,214,133,0.6)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="1">PERMIT</text>
          
          <!-- Actuator -->
          <rect x="540" y="60" width="140" height="80" rx="14" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="610" y="95" text-anchor="middle" fill="rgba(92,214,133,0.8)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="2">ACTUATOR</text>
          <text x="610" y="115" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-family="Inter, sans-serif" font-size="12">Execute</text>
          
          <!-- Final arrow to real world -->
          <line x1="680" y1="100" x2="740" y2="100" stroke="rgba(92,214,133,0.3)" stroke-width="2"/>
          <polygon points="745,100 732,94 732,106" fill="rgba(92,214,133,0.4)"/>
          
          <!-- Real world indicator -->
          <rect x="750" y="70" width="130" height="60" rx="14" fill="rgba(92,214,133,0.05)" stroke="rgba(92,214,133,0.25)" stroke-width="1" stroke-dasharray="6,4"/>
          <text x="815" y="105" text-anchor="middle" fill="rgba(92,214,133,0.6)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="2">REAL WORLD</text>
        </svg>
        <p class="diagram-caption">Non-bypassable. Fail-closed. Every action validated before execution.</p>
      </div>

      <!-- Three phases -->
      <div class="mechanism reveal" style="margin-top: var(--space-4);">
        <div class="node" style="border-color: rgba(255,255,255,0.15);">
          <div class="node-num" style="color: rgba(255,255,255,0.6);">INTERCEPT</div>
          <h3 class="node-title">Capture Signal</h3>
          <p class="node-desc">Every model output is routed through the interlock. No direct path to actuators exists.</p>
        </div>
        <div class="node" style="border-color: rgba(157,140,207,0.35);">
          <div class="node-num">VALIDATE</div>
          <h3 class="node-title">Check Bounds</h3>
          <p class="node-desc">Action evaluated against declared ODD constraints. Within bounds? Permit. Outside? Block.</p>
        </div>
        <div class="node" style="border-color: rgba(92,214,133,0.35);">
          <div class="node-num" style="color: rgba(92,214,133,0.9);">ENFORCE</div>
          <h3 class="node-title">Act or Halt</h3>
          <p class="node-desc">Permitted actions execute. Violations trigger fail-closed halt. Everything logged.</p>
        </div>
      </div>

      <!-- Key principle callout -->
      <div class="panel reveal" style="margin-top: var(--space-3); max-width: 700px; border-color: rgba(157,140,207,0.3);">
        <h3>The Non-Bypass Guarantee</h3>
        <p style="font-size: 15px; line-height: 1.8;">
          The interlock sits between decision and action — <strong>architecturally</strong>. There is no code path, no override flag, no emergency bypass that allows an action to reach actuators without validation. 
          This isn't policy. It's physics.
        </p>
        <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: var(--space-2);">
          <span class="badge green">✓ Permit in-bounds</span>
          <span class="badge red">✗ Block out-of-bounds</span>
          <span class="badge">◉ Log everything</span>
        </div>
      </div>
    </section>

    <!-- RECORD -->
    <section id="record" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">AUDITABLE EVIDENCE</span>
          <h2 class="section-title">The Record</h2>
          <p class="section-lead">
            Tamper-evident. Independently verifiable. Built for post-incident clarity.
          </p>
        </div>
      </div>

      <!-- Interactive Record Visualization -->
      <div class="reveal" style="display: flex; justify-content: center; margin-bottom: var(--space-4);">
        <div style="position: relative; max-width: 650px; width: 100%;">
          <!-- Decorative corner elements -->
          <svg style="position: absolute; top: -10px; left: -10px; width: 40px; height: 40px;" viewBox="0 0 40 40" fill="none">
            <path d="M0 40 L0 10 Q0 0 10 0 L40 0" stroke="rgba(157,140,207,0.4)" stroke-width="2" fill="none"/>
          </svg>
          <svg style="position: absolute; top: -10px; right: -10px; width: 40px; height: 40px;" viewBox="0 0 40 40" fill="none">
            <path d="M40 40 L40 10 Q40 0 30 0 L0 0" stroke="rgba(157,140,207,0.4)" stroke-width="2" fill="none"/>
          </svg>
          <svg style="position: absolute; bottom: -10px; left: -10px; width: 40px; height: 40px;" viewBox="0 0 40 40" fill="none">
            <path d="M0 0 L0 30 Q0 40 10 40 L40 40" stroke="rgba(157,140,207,0.4)" stroke-width="2" fill="none"/>
          </svg>
          <svg style="position: absolute; bottom: -10px; right: -10px; width: 40px; height: 40px;" viewBox="0 0 40 40" fill="none">
            <path d="M40 0 L40 30 Q40 40 30 40 L0 40" stroke="rgba(157,140,207,0.4)" stroke-width="2" fill="none"/>
          </svg>
          
          <div class="record" style="border-radius: 16px; overflow: hidden;">
            <div class="record-head" style="background: linear-gradient(135deg, rgba(91,75,138,0.2) 0%, rgba(91,75,138,0.08) 100%); padding: 20px 24px;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 32px; height: 32px; background: var(--purple-primary); border: 2px solid var(--purple-bright); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                  <div style="width: 10px; height: 10px; background: #c4b8e8; border-radius: 50%;"></div>
                </div>
                <div>
                  <div class="record-title" style="font-size: 11px;">ODDC CONFORMANCE RECORD</div>
                  <div style="font-family: var(--mono); font-size: 9px; color: var(--text-tertiary); letter-spacing: 1px; margin-top: 2px;">NON-NORMATIVE EXAMPLE</div>
                </div>
              </div>
              <div class="record-status" style="background: rgba(92,214,133,0.12); border-color: rgba(92,214,133,0.35);">
                <span class="s-dot" style="animation: pulse 2s ease-in-out infinite;"></span> VALID
              </div>
            </div>

            <div class="record-body" style="padding: 24px;">
              <!-- Key fields with icons -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                  <div class="k" style="margin-bottom: 6px;">Certificate ID</div>
                  <div class="v" style="font-size: 14px; color: var(--purple-bright);">SA-ODDC-2026-0001</div>
                </div>
                <div>
                  <div class="k" style="margin-bottom: 6px;">Status</div>
                  <div class="v"><span class="badge green" style="font-size: 10px;">CONFORMANT</span></div>
                </div>
              </div>

              <div style="height: 1px; background: var(--border-glass); margin: 16px 0;"></div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                  <div class="k" style="margin-bottom: 6px;">Issued</div>
                  <div class="v" style="font-size: 13px;">2026-01-04T00:00:00Z</div>
                </div>
                <div>
                  <div class="k" style="margin-bottom: 6px;">Expires</div>
                  <div class="v" style="font-size: 13px;">2027-01-04T00:00:00Z</div>
                </div>
              </div>

              <div style="height: 1px; background: var(--border-glass); margin: 16px 0;"></div>

              <div style="margin-bottom: 16px;">
                <div class="k" style="margin-bottom: 6px;">ODD Scope</div>
                <div class="v" style="font-size: 13px; line-height: 1.6;">Autonomous control permitted within declared operational design domain boundaries. ENVELO enforcement active.</div>
              </div>

              <div style="margin-bottom: 16px;">
                <div class="k" style="margin-bottom: 6px;">Evidence</div>
                <div class="v" style="display: flex; align-items: center; gap: 8px;">
                  <span class="badge green" style="font-size: 9px;">CAT-72 PASS</span>
                  <span style="font-size: 12px; color: var(--text-secondary);">Convergence + stability verified</span>
                </div>
              </div>

              <div style="height: 1px; background: var(--border-glass); margin: 16px 0;"></div>

              <!-- Hash and signature -->
              <div style="background: rgba(0,0,0,0.2); border-radius: 10px; padding: 16px; margin-top: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                  <div class="k">Record Hash</div>
                  <button class="copy-btn" onclick="copyHash()" style="font-size: 8px;">Copy</button>
                </div>
                <div style="font-family: var(--mono); font-size: 11px; color: var(--purple-bright); word-break: break-all; line-height: 1.6;">
                  8f2a9c7b4e1d6f3a2b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c91d
                </div>
                <div style="display: flex; gap: 20px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-glass);">
                  <div>
                    <div class="k" style="font-size: 8px; margin-bottom: 4px;">Signature</div>
                    <div style="font-family: var(--mono); font-size: 10px; color: var(--text-secondary);">SA-SIG-ECDSA-P384</div>
                  </div>
                  <div>
                    <div class="k" style="font-size: 8px; margin-bottom: 4px;">Audit Log</div>
                    <div style="font-family: var(--mono); font-size: 10px; color: var(--text-secondary);">SA-LOG-2026-0001</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- What the record proves -->
      <div class="mechanism reveal">
        <div class="node">
          <div class="node-num" style="color: var(--purple-bright);">SCOPE</div>
          <h3 class="node-title">What's Permitted</h3>
          <p class="node-desc">Defines exactly what autonomous actions are allowed within the declared ODD boundaries.</p>
        </div>
        <div class="node">
          <div class="node-num" style="color: var(--accent-green);">EVIDENCE</div>
          <h3 class="node-title">What's Proven</h3>
          <p class="node-desc">CAT-72 results, convergence metrics, and enforcement verification at determination time.</p>
        </div>
        <div class="node">
          <div class="node-num" style="color: var(--accent-amber);">INTEGRITY</div>
          <h3 class="node-title">What's Verifiable</h3>
          <p class="node-desc">Cryptographic hash, digital signature, and audit log reference for independent verification.</p>
        </div>
      </div>

      <!-- Verification CTA -->
      <div class="reveal" style="text-align: center; margin-top: var(--space-3);">
        <a href="#verify" class="btn primary" style="display: inline-flex; align-items: center; gap: 10px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
          Verify a Certificate
        </a>
      </div>
    </section>

    <!-- PROCESS -->
    <section id="process" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">CONFORMANCE PROCESS</span>
          <h2 class="section-title">Get Certified</h2>
          <p class="section-lead">
            From application to conformance in 2-4 weeks.
          </p>
        </div>
      </div>

      <!-- Visual Timeline -->
      <div class="diagram-container reveal">
        <svg viewBox="0 0 1000 180" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 1000px; width: 100%;">
          <!-- Timeline line -->
          <line x1="50" y1="90" x2="950" y2="90" stroke="rgba(157,140,207,0.2)" stroke-width="2"/>
          
          <!-- Animated progress -->
          <line x1="50" y1="90" x2="950" y2="90" stroke="rgba(157,140,207,0.4)" stroke-width="2" stroke-dasharray="900" stroke-dashoffset="900">
            <animate attributeName="stroke-dashoffset" from="900" to="0" dur="3s" fill="freeze"/>
          </line>
          
          <!-- Step 1: Apply -->
          <circle cx="100" cy="90" r="24" fill="rgba(91,75,138,0.15)" stroke="rgba(157,140,207,0.6)" stroke-width="2"/>
          <text x="100" y="95" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500">1</text>
          <text x="100" y="135" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-family="Inter, sans-serif" font-size="12" font-weight="500">Apply</text>
          <text x="100" y="152" text-anchor="middle" fill="rgba(255,255,255,0.45)" font-family="Inter, sans-serif" font-size="10">Submit ODD</text>
          
          <!-- Step 2: Review -->
          <circle cx="270" cy="90" r="24" fill="rgba(91,75,138,0.15)" stroke="rgba(157,140,207,0.6)" stroke-width="2"/>
          <text x="270" y="95" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500">2</text>
          <text x="270" y="135" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-family="Inter, sans-serif" font-size="12" font-weight="500">Review</text>
          <text x="270" y="152" text-anchor="middle" fill="rgba(255,255,255,0.45)" font-family="Inter, sans-serif" font-size="10">5-10 days</text>
          
          <!-- Step 3: Deploy -->
          <circle cx="440" cy="90" r="24" fill="rgba(91,75,138,0.15)" stroke="rgba(157,140,207,0.6)" stroke-width="2"/>
          <text x="440" y="95" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500">3</text>
          <text x="440" y="135" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-family="Inter, sans-serif" font-size="12" font-weight="500">Deploy</text>
          <text x="440" y="152" text-anchor="middle" fill="rgba(255,255,255,0.45)" font-family="Inter, sans-serif" font-size="10">ENVELO Agent</text>
          
          <!-- Step 4: CAT-72 (highlighted) -->
          <circle cx="610" cy="90" r="28" fill="rgba(157,140,207,0.2)" stroke="rgba(157,140,207,0.8)" stroke-width="2.5">
            <animate attributeName="r" values="28;30;28" dur="2s" repeatCount="indefinite"/>
          </circle>
          <text x="610" y="95" text-anchor="middle" fill="rgba(255,255,255,1)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500">4</text>
          <text x="610" y="135" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="Inter, sans-serif" font-size="12" font-weight="600">CAT-72</text>
          <text x="610" y="152" text-anchor="middle" fill="rgba(157,140,207,0.7)" font-family="Inter, sans-serif" font-size="10">72 hours</text>
          
          <!-- Step 5: Certified -->
          <circle cx="780" cy="90" r="24" fill="rgba(92,214,133,0.15)" stroke="rgba(92,214,133,0.6)" stroke-width="2"/>
          <text x="780" y="95" text-anchor="middle" fill="rgba(92,214,133,1)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500">5</text>
          <text x="780" y="135" text-anchor="middle" fill="rgba(92,214,133,0.95)" font-family="Inter, sans-serif" font-size="12" font-weight="500">Certified</text>
          <text x="780" y="152" text-anchor="middle" fill="rgba(255,255,255,0.45)" font-family="Inter, sans-serif" font-size="10">ODDC issued</text>
          
          <!-- Step 6: Continuous -->
          <circle cx="900" cy="90" r="24" fill="rgba(92,214,133,0.1)" stroke="rgba(92,214,133,0.4)" stroke-width="2" stroke-dasharray="4,3"/>
          <text x="900" y="95" text-anchor="middle" fill="rgba(92,214,133,0.8)" font-family="IBM Plex Mono, monospace" font-size="14" font-weight="500">∞</text>
          <text x="900" y="135" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Inter, sans-serif" font-size="12" font-weight="500">Maintain</text>
          <text x="900" y="152" text-anchor="middle" fill="rgba(255,255,255,0.45)" font-family="Inter, sans-serif" font-size="10">24/7 compliance</text>
          
          <!-- Timeline markers -->
          <text x="185" y="60" text-anchor="middle" fill="rgba(255,255,255,0.25)" font-family="IBM Plex Mono, monospace" font-size="8">→</text>
          <text x="355" y="60" text-anchor="middle" fill="rgba(255,255,255,0.25)" font-family="IBM Plex Mono, monospace" font-size="8">→</text>
          <text x="525" y="60" text-anchor="middle" fill="rgba(255,255,255,0.25)" font-family="IBM Plex Mono, monospace" font-size="8">→</text>
          <text x="695" y="60" text-anchor="middle" fill="rgba(255,255,255,0.25)" font-family="IBM Plex Mono, monospace" font-size="8">→</text>
          <text x="840" y="60" text-anchor="middle" fill="rgba(255,255,255,0.25)" font-family="IBM Plex Mono, monospace" font-size="8">→</text>
        </svg>
      </div>

      <!-- Pricing Cards -->
      <div class="reveal" style="margin-top: var(--space-4);">
        <h3 style="font-family: var(--mono); font-size: 11px; letter-spacing: 4px; text-transform: uppercase; color: rgba(255,255,255,.85); margin-bottom: var(--space-2); text-align: center;">Investment</h3>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2); max-width: 900px; margin: 0 auto;">
          <!-- Initial Certification -->
          <div class="panel" style="text-align: center; border-color: rgba(157,140,207,0.35);">
            <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--purple-bright); margin-bottom: 8px;">INITIAL</div>
            <div style="font-family: var(--serif); font-size: 36px; font-weight: 200; color: var(--text-primary);">$12.5<span style="font-size: 18px; color: var(--text-secondary);">k</span></div>
            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">per system</div>
            <div style="height: 1px; background: var(--border-glass); margin: 16px 0;"></div>
            <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.8; text-align: left;">
              <div style="padding: 6px 0; border-bottom: 1px solid var(--border-subtle);">Application review</div>
              <div style="padding: 6px 0; border-bottom: 1px solid var(--border-subtle);">CAT-72 administration</div>
              <div style="padding: 6px 0;">Certificate issuance</div>
            </div>
          </div>
          
          <!-- Compliance Subscription -->
          <div class="panel" style="text-align: center; border-color: rgba(92,214,133,0.35); transform: scale(1.02);">
            <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--accent-green); margin-bottom: 8px;">COMPLIANCE</div>
            <div style="font-family: var(--serif); font-size: 36px; font-weight: 200; color: var(--text-primary);">$6<span style="font-size: 18px; color: var(--text-secondary);">k</span><span style="font-size: 14px; color: var(--text-tertiary);">/yr</span></div>
            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">up to 2 systems</div>
            <div style="height: 1px; background: var(--border-glass); margin: 16px 0;"></div>
            <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.8; text-align: left;">
              <div style="padding: 6px 0; border-bottom: 1px solid var(--border-subtle);">24/7 ENVELO monitoring</div>
              <div style="padding: 6px 0; border-bottom: 1px solid var(--border-subtle);">Public registry listing</div>
              <div style="padding: 6px 0;">Verification API access</div>
            </div>
          </div>
          
          <!-- Enterprise -->
          <div class="panel" style="text-align: center; border-color: rgba(214,160,92,0.35);">
            <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--accent-amber); margin-bottom: 8px;">ENTERPRISE</div>
            <div style="font-family: var(--serif); font-size: 36px; font-weight: 200; color: var(--text-primary);">Custom</div>
            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">unlimited systems</div>
            <div style="height: 1px; background: var(--border-glass); margin: 16px 0;"></div>
            <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.8; text-align: left;">
              <div style="padding: 6px 0; border-bottom: 1px solid var(--border-subtle);">Dedicated support</div>
              <div style="padding: 6px 0; border-bottom: 1px solid var(--border-subtle);">On-site witness testing</div>
              <div style="padding: 6px 0;">Custom integrations</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Evidence Schema (collapsible feel) -->
      <div class="panel reveal" style="margin-top: var(--space-4); max-width: 800px; margin-left: auto; margin-right: auto;">
        <h3>CAT-72 Evidence Schema</h3>
        <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: var(--space-2);">Required evidentiary record structure:</p>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">01</span>
            <span style="font-size: 12px; color: var(--text-secondary);">Header Block</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">02</span>
            <span style="font-size: 12px; color: var(--text-secondary);">ODD Specification</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">03</span>
            <span style="font-size: 12px; color: var(--text-secondary);">Telemetry Log</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">04</span>
            <span style="font-size: 12px; color: var(--text-secondary);">Interlock Events</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">05</span>
            <span style="font-size: 12px; color: var(--text-secondary);">Fail-Closed Record</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">06</span>
            <span style="font-size: 12px; color: var(--text-secondary);">Convergence Metrics</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid var(--border-subtle);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">07</span>
            <span style="font-size: 12px; color: var(--text-secondary);">Integrity Block</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(91,75,138,0.1); border-radius: 8px; border: 1px solid rgba(157,140,207,0.25);">
            <span style="font-family: var(--mono); font-size: 10px; color: var(--purple-bright);">FMT</span>
            <span style="font-size: 12px; color: var(--text-secondary);">JSON / UTC ISO 8601</span>
          </div>
        </div>
      </div>

      <!-- CTA -->
      <div class="reveal" style="text-align: center; margin-top: var(--space-4);">
        <a href="https://app.sentinelauthority.org" class="btn primary" style="display: inline-flex; align-items: center; gap: 10px;">
          Start Certification
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
        <p style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); margin-top: var(--space-1);">2-4 weeks from application to certification</p>
      </div>
    </section>


    <!-- SECURITY -->
    <section id="security" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">SECURITY ARCHITECTURE</span>
          <h2 class="section-title">Zero Trust, Zero Access</h2>
          <p class="section-lead">
            Enterprise security teams ask: "Is this agent a backdoor into our systems?" The answer is <strong>architecturally impossible</strong>. The ENVELO Agent uses one-way data flow that makes remote access or control physically impossible.
          </p>
        </div>
      </div>

      <!-- Data Flow Diagram -->
      <div class="diagram-container reveal">
        <svg class="security-diagram" viewBox="0 0 700 200" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 700px; width: 100%;">
          <!-- Your System Box -->
          <rect x="20" y="60" width="140" height="80" rx="12" fill="rgba(92,214,133,0.08)" stroke="rgba(92,214,133,0.4)" stroke-width="1.5"/>
          <text x="90" y="95" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-family="IBM Plex Mono, monospace" font-size="10" letter-spacing="2">YOUR SYSTEM</text>
          <text x="90" y="115" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">Protected</text>
          
          <!-- ENVELO Agent Box -->
          <rect x="280" y="60" width="140" height="80" rx="12" fill="rgba(91,75,138,0.15)" stroke="rgba(157,140,207,0.5)" stroke-width="1.5"/>
          <text x="350" y="95" text-anchor="middle" fill="rgba(157,140,207,1)" font-family="IBM Plex Mono, monospace" font-size="10" letter-spacing="2">ENVELO AGENT</text>
          <text x="350" y="115" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">Observe Only</text>
          
          <!-- Sentinel Authority Box -->
          <rect x="540" y="60" width="140" height="80" rx="12" fill="rgba(91,75,138,0.08)" stroke="rgba(157,140,207,0.35)" stroke-width="1.5"/>
          <text x="610" y="95" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1.5">SENTINEL</text>
          <text x="610" y="110" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1.5">AUTHORITY</text>
          <text x="610" y="128" text-anchor="middle" fill="rgba(255,255,255,0.5)" font-family="Inter, sans-serif" font-size="11">Registry</text>
          
          <!-- Forward Arrow (allowed) -->
          <line x1="160" y1="100" x2="270" y2="100" stroke="rgba(92,214,133,0.6)" stroke-width="2" stroke-dasharray="6,4">
            <animate attributeName="stroke-dashoffset" from="0" to="-20" dur="1.5s" repeatCount="indefinite"/>
          </line>
          <polygon points="275,100 265,95 265,105" fill="rgba(92,214,133,0.8)"/>
          
          <line x1="420" y1="100" x2="530" y2="100" stroke="rgba(92,214,133,0.6)" stroke-width="2" stroke-dasharray="6,4">
            <animate attributeName="stroke-dashoffset" from="0" to="-20" dur="1.5s" repeatCount="indefinite"/>
          </line>
          <polygon points="535,100 525,95 525,105" fill="rgba(92,214,133,0.8)"/>
          
          <!-- Blocked reverse arrow -->
          <line x1="540" y1="150" x2="180" y2="150" stroke="rgba(214,92,92,0.3)" stroke-width="1.5" stroke-dasharray="4,4"/>
          <text x="350" y="170" text-anchor="middle" fill="rgba(214,92,92,0.7)" font-family="IBM Plex Mono, monospace" font-size="9" letter-spacing="1">✗ NO INBOUND ACCESS</text>
          
          <!-- Labels -->
          <text x="215" y="85" text-anchor="middle" fill="rgba(92,214,133,0.8)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="1">TELEMETRY</text>
          <text x="475" y="85" text-anchor="middle" fill="rgba(92,214,133,0.8)" font-family="IBM Plex Mono, monospace" font-size="8" letter-spacing="1">HTTPS OUT</text>
        </svg>
        <p class="diagram-caption">One-way data architecture. No inbound connections. No remote access.</p>
      </div>

      <!-- Security Features Grid -->
      <div class="mechanism reveal" style="margin-top: var(--space-3);">
        <div class="node">
          <div class="node-num">01</div>
          <h3 class="node-title">Zero Listening Ports</h3>
          <p class="node-desc">Agent opens no inbound ports. Only outbound HTTPS to api.sentinelauthority.org.</p>
        </div>
        <div class="node">
          <div class="node-num">02</div>
          <h3 class="node-title">Customer Controlled</h3>
          <p class="node-desc">You deploy, configure, and terminate. We cannot start, stop, or modify remotely.</p>
        </div>
        <div class="node">
          <div class="node-num">03</div>
          <h3 class="node-title">TLS 1.3 + Pinning</h3>
          <p class="node-desc">All communications encrypted with certificate pinning. Data encrypted at rest.</p>
        </div>
      </div>

      <div class="panel reveal" style="margin-top: var(--space-3);">
        <h3>The Core Guarantee</h3>
        <p>Sentinel Authority <strong>cannot</strong> send commands to your system, execute code on your infrastructure, access your network, or control your autonomous systems. The agent only observes and reports—it has no actuator access.</p>
        <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; margin-top: var(--space-2);">
          <span class="badge red">✗ No Remote Commands</span>
          <span class="badge red">✗ No Code Execution</span>
          <span class="badge red">✗ No Network Access</span>
          <span class="badge red">✗ No Actuator Control</span>
        </div>
      </div>

    </section>

    <!-- VERIFY -->
    <section id="verify" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">PUBLIC REGISTRY</span>
          <h2 class="section-title">Verify</h2>
          <p class="section-lead">
            Instant verification. Real-time status. Zero trust required.
          </p>
        </div>
      </div>

      <!-- Verification Terminal -->
      <div class="reveal" style="max-width: 700px; margin: 0 auto;">
        <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(157,140,207,0.3); border-radius: 20px; overflow: hidden; box-shadow: 0 25px 80px rgba(0,0,0,0.4);">
          <!-- Terminal header -->
          <div style="background: rgba(91,75,138,0.15); padding: 14px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(157,140,207,0.2);">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 12px; height: 12px; border-radius: 50%; background: rgba(214,92,92,0.8);"></div>
              <div style="width: 12px; height: 12px; border-radius: 50%; background: rgba(214,160,92,0.8);"></div>
              <div style="width: 12px; height: 12px; border-radius: 50%; background: rgba(92,214,133,0.8);"></div>
            </div>
            <div style="font-family: var(--mono); font-size: 10px; letter-spacing: 2px; color: var(--text-tertiary);">SENTINEL REGISTRY</div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: rgba(92,214,133,0.9); animation: pulse 2s ease-in-out infinite;"></div>
              <span style="font-family: var(--mono); font-size: 9px; color: rgba(92,214,133,0.9); letter-spacing: 1px;">LIVE</span>
            </div>
          </div>
          
          <!-- Terminal body -->
          <div style="padding: 30px;">
            <div style="font-family: var(--mono); font-size: 12px; color: var(--text-tertiary); margin-bottom: 16px;">
              <span style="color: var(--purple-bright);">$</span> verify --certificate
            </div>
            
            <!-- Input area -->
            <div style="display: flex; gap: 12px; align-items: center;">
              <div style="flex: 1; position: relative;">
                <input type="text" id="cert-input" placeholder="SA-ODDC-2026-00001" style="
                  width: 100%;
                  padding: 18px 24px;
                  font-family: var(--mono);
                  font-size: 16px;
                  letter-spacing: 1px;
                  background: rgba(255,255,255,0.05);
                  border: 2px solid rgba(157,140,207,0.3);
                  border-radius: 12px;
                  color: var(--text-primary);
                  outline: none;
                  transition: all 0.2s ease;
                " onfocus="this.style.borderColor='rgba(157,140,207,0.6)'" onblur="this.style.borderColor='rgba(157,140,207,0.3)'">
              </div>
              <button onclick="verifyCertificate()" style="
                padding: 18px 28px;
                font-family: var(--mono);
                font-size: 11px;
                letter-spacing: 2px;
                text-transform: uppercase;
                background: linear-gradient(135deg, rgba(91,75,138,0.4) 0%, rgba(91,75,138,0.2) 100%);
                border: 2px solid rgba(157,140,207,0.5);
                border-radius: 12px;
                color: var(--text-primary);
                cursor: pointer;
                transition: all 0.2s ease;
                white-space: nowrap;
              " onmouseover="this.style.borderColor='rgba(157,140,207,0.8)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='rgba(157,140,207,0.5)';this.style.transform='translateY(0)'">
                <span style="display: flex; align-items: center; gap: 8px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                  Verify
                </span>
              </button>
            </div>
            
            <!-- Result area -->
            <div id="verify-result" style="margin-top: 20px;"></div>
            
            <!-- Example hint -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.06);">
              <div style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); letter-spacing: 1px;">
                <span style="color: rgba(92,214,133,0.6);">TIP:</span> Enter any certificate ID to query real-time status from the Sentinel Authority registry
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status indicators -->
      <div class="reveal" style="margin-top: var(--space-4); display: flex; justify-content: center; gap: var(--space-3); flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; background: rgba(92,214,133,0.08); border: 1px solid rgba(92,214,133,0.25); border-radius: 30px;">
          <div style="width: 8px; height: 8px; border-radius: 50%; background: rgba(92,214,133,0.9);"></div>
          <span style="font-family: var(--mono); font-size: 10px; letter-spacing: 2px; color: rgba(92,214,133,0.95);">CONFORMANT</span>
          <span style="font-size: 11px; color: var(--text-tertiary);">— Active & valid</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; background: rgba(214,160,92,0.08); border: 1px solid rgba(214,160,92,0.25); border-radius: 30px;">
          <div style="width: 8px; height: 8px; border-radius: 50%; background: rgba(214,160,92,0.9);"></div>
          <span style="font-family: var(--mono); font-size: 10px; letter-spacing: 2px; color: rgba(214,160,92,0.95);">EXPIRING</span>
          <span style="font-size: 11px; color: var(--text-tertiary);">— Renewal needed</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; background: rgba(214,92,92,0.08); border: 1px solid rgba(214,92,92,0.25); border-radius: 30px;">
          <div style="width: 8px; height: 8px; border-radius: 50%; background: rgba(214,92,92,0.9);"></div>
          <span style="font-family: var(--mono); font-size: 10px; letter-spacing: 2px; color: rgba(214,92,92,0.95);">REVOKED</span>
          <span style="font-size: 11px; color: var(--text-tertiary);">— Suspended</span>
        </div>
      </div>

      <!-- API Access -->
      <div class="panel reveal" style="margin-top: var(--space-4); max-width: 600px; margin-left: auto; margin-right: auto; text-align: center;">
        <h3>Programmatic Access</h3>
        <p style="font-size: 14px; margin-bottom: var(--space-2);">Integrate verification into your systems with our REST API.</p>
        <div style="background: rgba(0,0,0,0.25); border-radius: 10px; padding: 16px; text-align: left; font-family: var(--mono); font-size: 12px; color: var(--text-secondary); overflow-x: auto;">
          <span style="color: var(--purple-bright);">GET</span> <span style="color: var(--text-tertiary);">https://api.sentinelauthority.org/v1/verify/</span><span style="color: rgba(92,214,133,0.9);">{certificate_id}</span>
        </div>
        <div style="margin-top: var(--space-2);">
          <a href="mailto:conformance@sentinelauthority.org" style="font-family: var(--mono); font-size: 11px; color: var(--purple-bright); letter-spacing: 1px;">Request API Key →</a>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">CONNECT</span>
          <h2 class="section-title">Let's Talk</h2>
          <p class="section-lead">
            Ready to certify? Questions about ODDC? We're here.
          </p>
        </div>
      </div>

      <!-- Contact Cards Grid -->
      <div class="reveal" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-2); max-width: 900px;">
        
        <!-- General Inquiries -->
        <a href="mailto:info@sentinelauthority.org" style="text-decoration: none; display: block;">
          <div style="
            background: linear-gradient(135deg, rgba(91,75,138,0.12) 0%, rgba(91,75,138,0.04) 100%);
            border: 1px solid rgba(157,140,207,0.25);
            border-radius: 18px;
            padding: 28px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
          " onmouseover="this.style.borderColor='rgba(157,140,207,0.5)';this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(157,140,207,0.25)';this.style.transform='translateY(0)'">
            <div style="position: absolute; top: -30px; right: -30px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(157,140,207,0.15) 0%, transparent 70%); pointer-events: none;"></div>
            <div style="display: flex; align-items: center; gap: 14px; margin-bottom: 16px;">
              <div style="width: 44px; height: 44px; background: rgba(157,140,207,0.15); border: 1px solid rgba(157,140,207,0.3); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.9)" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
              </div>
              <div>
                <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--text-tertiary); text-transform: uppercase;">General</div>
                <div style="font-size: 15px; color: var(--text-primary); font-weight: 500;">Inquiries</div>
              </div>
            </div>
            <div style="font-family: var(--mono); font-size: 13px; color: var(--purple-bright); letter-spacing: 0.5px;">info@sentinelauthority.org</div>
            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px; line-height: 1.6;">Questions about ODDC, the framework, or how conformance works.</div>
          </div>
        </a>

        <!-- Conformance -->
        <a href="mailto:conformance@sentinelauthority.org" style="text-decoration: none; display: block;">
          <div style="
            background: linear-gradient(135deg, rgba(92,214,133,0.08) 0%, rgba(92,214,133,0.02) 100%);
            border: 1px solid rgba(92,214,133,0.25);
            border-radius: 18px;
            padding: 28px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
          " onmouseover="this.style.borderColor='rgba(92,214,133,0.5)';this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(92,214,133,0.25)';this.style.transform='translateY(0)'">
            <div style="position: absolute; top: -30px; right: -30px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(92,214,133,0.12) 0%, transparent 70%); pointer-events: none;"></div>
            <div style="display: flex; align-items: center; gap: 14px; margin-bottom: 16px;">
              <div style="width: 44px; height: 44px; background: rgba(92,214,133,0.12); border: 1px solid rgba(92,214,133,0.3); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(92,214,133,0.9)" stroke-width="1.5"><path d="M9 12l2 2 4-4"/><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/></svg>
              </div>
              <div>
                <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--text-tertiary); text-transform: uppercase;">Certification</div>
                <div style="font-size: 15px; color: var(--text-primary); font-weight: 500;">Conformance</div>
              </div>
            </div>
            <div style="font-family: var(--mono); font-size: 13px; color: rgba(92,214,133,0.9); letter-spacing: 0.5px;">conformance@sentinelauthority.org</div>
            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px; line-height: 1.6;">Start certification, licensing questions, or enterprise solutions.</div>
          </div>
        </a>

        <!-- Enterprise -->
        <a href="https://app.sentinelauthority.org" style="text-decoration: none; display: block;">
          <div style="
            background: linear-gradient(135deg, rgba(214,160,92,0.08) 0%, rgba(214,160,92,0.02) 100%);
            border: 1px solid rgba(214,160,92,0.25);
            border-radius: 18px;
            padding: 28px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
          " onmouseover="this.style.borderColor='rgba(214,160,92,0.5)';this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(214,160,92,0.25)';this.style.transform='translateY(0)'">
            <div style="position: absolute; top: -30px; right: -30px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(214,160,92,0.12) 0%, transparent 70%); pointer-events: none;"></div>
            <div style="display: flex; align-items: center; gap: 14px; margin-bottom: 16px;">
              <div style="width: 44px; height: 44px; background: rgba(214,160,92,0.12); border: 1px solid rgba(214,160,92,0.3); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(214,160,92,0.9)" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
              </div>
              <div>
                <div style="font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--text-tertiary); text-transform: uppercase;">Portal</div>
                <div style="font-size: 15px; color: var(--text-primary); font-weight: 500;">Get Started</div>
              </div>
            </div>
            <div style="font-family: var(--mono); font-size: 13px; color: rgba(214,160,92,0.9); letter-spacing: 0.5px;">app.sentinelauthority.org →</div>
            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px; line-height: 1.6;">Create an account and begin your certification application.</div>
          </div>
        </a>
      </div>

      <!-- Response time note -->
      <div class="reveal" style="margin-top: var(--space-3); text-align: center;">
        <div style="display: inline-flex; align-items: center; gap: 10px; padding: 12px 20px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass); border-radius: 30px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          <span style="font-size: 12px; color: var(--text-secondary);">Typical response within <strong style="color: var(--text-primary);">24 hours</strong></span>
        </div>
      </div>
    </section>

    <!-- GOVERNANCE ARTIFACTS -->
    <section id="artifacts" class="section">
      <div class="section-head reveal">
        <div>
          <span class="section-label">DOCUMENTATION</span>
          <h2 class="section-title">Resources</h2>
          <p class="section-lead">
            Normative specifications, implementation guides, and the ENVELO Agent.
          </p>
        </div>
      </div>

      <!-- Spec Status Banner -->
      <div class="reveal" style="max-width: 800px; margin-bottom: var(--space-4);">
        <div style="background: linear-gradient(135deg, rgba(214,160,92,0.1) 0%, rgba(214,160,92,0.03) 100%); border: 1px solid rgba(214,160,92,0.3); border-radius: 14px; padding: 20px 24px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
          <div style="display: flex; align-items: center; gap: 16px;">
            <div style="width: 48px; height: 48px; background: rgba(214,160,92,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(214,160,92,0.9)" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            </div>
            <div>
              <div style="font-family: var(--mono); font-size: 10px; letter-spacing: 2px; color: rgba(214,160,92,0.9);">SPECIFICATION STATUS</div>
              <div style="font-size: 16px; color: var(--text-primary); font-weight: 500; margin-top: 2px;">ODDC v1.0 — Draft</div>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 20px;">
            <div style="text-align: right;">
              <div style="font-size: 11px; color: var(--text-tertiary);">Effective</div>
              <div style="font-size: 13px; color: var(--text-secondary);">January 2026</div>
            </div>
            <a href="draft.html" style="font-family: var(--mono); font-size: 10px; letter-spacing: 1px; color: rgba(214,160,92,0.9); padding: 10px 16px; border: 1px solid rgba(214,160,92,0.4); border-radius: 8px; text-decoration: none; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(214,160,92,0.1)'" onmouseout="this.style.background='transparent'">View Status →</a>
          </div>
        </div>
      </div>

      <!-- Document Cards -->
      <div class="reveal" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; max-width: 1000px;">
        
        <!-- ODDC Overview -->
        <div onclick="openDownloadModal('docs/ODDC_Overview_v1.0.pdf', 'ODDC Overview v1.0')" style="cursor: pointer; background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass); border-radius: 16px; padding: 24px; transition: all 0.25s ease; position: relative; overflow: hidden;" onmouseover="this.style.borderColor='rgba(157,140,207,0.4)';this.style.transform='translateY(-3px)'" onmouseout="this.style.borderColor='var(--border-glass)';this.style.transform='translateY(0)'">
          <div style="position: absolute; top: 12px; right: 12px; padding: 4px 8px; background: rgba(157,140,207,0.15); border-radius: 4px; font-family: var(--mono); font-size: 9px; letter-spacing: 1px; color: var(--purple-bright);">PDF</div>
          <div style="width: 40px; height: 40px; background: rgba(157,140,207,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.8)" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          </div>
          <div style="font-size: 14px; color: var(--text-primary); font-weight: 500; margin-bottom: 6px;">ODDC Overview</div>
          <div style="font-size: 12px; color: var(--text-tertiary); line-height: 1.5;">Conceptual introduction to ODD Conformance Determination.</div>
          <div style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); margin-top: 12px;">v1.0 · Jan 2026</div>
        </div>

        <!-- ENVELO Requirements -->
        <div onclick="openDownloadModal('docs/ENVELO_Requirements_v1.0.pdf', 'ENVELO Requirements v1.0')" style="cursor: pointer; background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass); border-radius: 16px; padding: 24px; transition: all 0.25s ease; position: relative; overflow: hidden;" onmouseover="this.style.borderColor='rgba(92,214,133,0.4)';this.style.transform='translateY(-3px)'" onmouseout="this.style.borderColor='var(--border-glass)';this.style.transform='translateY(0)'">
          <div style="position: absolute; top: 12px; right: 12px; padding: 4px 8px; background: rgba(92,214,133,0.15); border-radius: 4px; font-family: var(--mono); font-size: 9px; letter-spacing: 1px; color: rgba(92,214,133,0.9);">PDF</div>
          <div style="width: 40px; height: 40px; background: rgba(92,214,133,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(92,214,133,0.8)" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <div style="font-size: 14px; color: var(--text-primary); font-weight: 500; margin-bottom: 6px;">ENVELO Requirements</div>
          <div style="font-size: 12px; color: var(--text-tertiary); line-height: 1.5;">Runtime enforcement requirements for certified systems.</div>
          <div style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); margin-top: 12px;">v1.0 · Jan 2026</div>
        </div>

        <!-- CAT-72 Procedure -->
        <div onclick="openDownloadModal('docs/CAT-72_Procedure_v1.0.pdf', 'CAT-72 Procedure v1.0')" style="cursor: pointer; background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass); border-radius: 16px; padding: 24px; transition: all 0.25s ease; position: relative; overflow: hidden;" onmouseover="this.style.borderColor='rgba(157,140,207,0.4)';this.style.transform='translateY(-3px)'" onmouseout="this.style.borderColor='var(--border-glass)';this.style.transform='translateY(0)'">
          <div style="position: absolute; top: 12px; right: 12px; padding: 4px 8px; background: rgba(157,140,207,0.15); border-radius: 4px; font-family: var(--mono); font-size: 9px; letter-spacing: 1px; color: var(--purple-bright);">PDF</div>
          <div style="width: 40px; height: 40px; background: rgba(157,140,207,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.8)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
          <div style="font-size: 14px; color: var(--text-primary); font-weight: 500; margin-bottom: 6px;">CAT-72 Procedure</div>
          <div style="font-size: 12px; color: var(--text-tertiary); line-height: 1.5;">Convergence test requirements and format.</div>
          <div style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); margin-top: 12px;">v1.0 · Jan 2026</div>
        </div>

        <!-- Critical Q&A -->
        <div onclick="openDownloadModal('docs/ODDC_Critical_QA_v1.0.pdf', 'Critical Q&A v1.0')" style="cursor: pointer; background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass); border-radius: 16px; padding: 24px; transition: all 0.25s ease; position: relative; overflow: hidden;" onmouseover="this.style.borderColor='rgba(157,140,207,0.4)';this.style.transform='translateY(-3px)'" onmouseout="this.style.borderColor='var(--border-glass)';this.style.transform='translateY(0)'">
          <div style="position: absolute; top: 12px; right: 12px; padding: 4px 8px; background: rgba(157,140,207,0.15); border-radius: 4px; font-family: var(--mono); font-size: 9px; letter-spacing: 1px; color: var(--purple-bright);">PDF</div>
          <div style="width: 40px; height: 40px; background: rgba(157,140,207,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,0.8)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          </div>
          <div style="font-size: 14px; color: var(--text-primary); font-weight: 500; margin-bottom: 6px;">Critical Q&A</div>
          <div style="font-size: 12px; color: var(--text-tertiary); line-height: 1.5;">Tough questions answered about the ODDC framework.</div>
          <div style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); margin-top: 12px;">v1.0 · Jan 2026</div>
        </div>
      </div>

      <!-- ENVELO Agent Card -->
      <div class="reveal" style="margin-top: var(--space-4); max-width: 1000px;">
        <div style="background: linear-gradient(135deg, rgba(91,75,138,0.15) 0%, rgba(91,75,138,0.05) 100%); border: 2px solid rgba(157,140,207,0.4); border-radius: 20px; padding: 32px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 24px; position: relative; overflow: hidden;">
          <!-- Decorative elements -->
          <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(157,140,207,0.15) 0%, transparent 70%); pointer-events: none;"></div>
          <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(92,214,133,0.08) 0%, transparent 70%); pointer-events: none;"></div>
          
          <div style="position: relative; z-index: 1; flex: 1; min-width: 280px;">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
              <div style="width: 56px; height: 56px; background: rgba(157,140,207,0.2); border: 2px solid rgba(157,140,207,0.5); border-radius: 14px; display: flex; align-items: center; justify-content: center;">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="rgba(157,140,207,1)" stroke-width="1.5"><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M9 9h6v6H9z"/><path d="M9 1v3M15 1v3M9 20v3M15 20v3M1 9h3M1 15h3M20 9h3M20 15h3"/></svg>
              </div>
              <div>
                <div style="font-family: var(--mono); font-size: 10px; letter-spacing: 3px; color: var(--purple-bright);">RUNTIME</div>
                <div style="font-size: 22px; color: var(--text-primary); font-weight: 400; font-family: var(--serif);">ENVELO Agent</div>
              </div>
            </div>
            <p style="font-size: 14px; color: var(--text-secondary); line-height: 1.7; margin-bottom: 20px;">
              The runtime enforcement layer for ODDC-certified systems. Non-bypassable interlock, real-time telemetry, fail-closed architecture.
            </p>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-tertiary);">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="rgba(92,214,133,0.8)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
                Non-bypassable
              </div>
              <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-tertiary);">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="rgba(92,214,133,0.8)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
                Real-time telemetry
              </div>
              <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-tertiary);">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="rgba(92,214,133,0.8)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
                Fail-closed
              </div>
            </div>
          </div>
          
          <div style="position: relative; z-index: 1;">
            <a href="https://app.sentinelauthority.org" class="btn primary" style="display: inline-flex; align-items: center; gap: 10px; padding: 16px 28px;">
              Access Agent Portal
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </a>
            <div style="font-family: var(--mono); font-size: 10px; color: var(--text-tertiary); text-align: center; margin-top: 10px;">Required for certification</div>
          </div>
        </div>
      </div>
      </div>
    </section>

    <footer>
      <div class="footer-inner">
        <div>
          <div>© <span id="year"></span> SENTINEL AUTHORITY — ODDC CONFORMANCE</div>
          <div class="footer-spec">ODDC v1.0 — Draft. Specifications subject to revision. Examples are non-normative.</div>
          <div class="footer-disclaimer">
            Independent conformance determination. Not a regulator. Not legal advice. Implementations remain the responsibility of system operators.
          </div>
        </div>
        <div class="foot-links">
          <div class="foot-col">
            <div class="foot-col-title">FRAMEWORK</div>
            <a href="#criteria">Criteria</a>
            <a href="#cat72">CAT-72</a>
            <a href="#grant">Grant</a>
            <a href="#mechanism">Mechanism</a>
            <a href="#record">Record</a>
            <a href="#process">Process</a>
          </div>
          <div class="foot-col">
            <div class="foot-col-title">RESOURCES</div>
            <a href="#artifacts">Artifacts</a>
            <a href="scenarios.html">Scenarios</a>
            <a href="#verify" data-section="verify">Verify</a>
            
          </div>
          <div class="foot-col">
            <div class="foot-col-title">LEGAL</div>
            <a href="privacy.html">Privacy</a>
            <a href="terms.html">Terms</a>
            <a href="conformance-agreement.html">Conformance</a>
          </div>
          <div class="foot-col">
            <div class="foot-col-title">CONNECT</div>
            <a href="#contact">Contact</a>
            <a href="https://app.sentinelauthority.org">Sign In</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Download Modal -->
    <div id="downloadModal" class="download-modal" aria-hidden="true">
      <div class="download-modal-card">
        <button class="download-modal-close" onclick="closeDownloadModal()" aria-label="Close">&times;</button>
        <h3 id="downloadModalTitle">Download Document</h3>
        <p>Please provide your contact information to access this document.</p>
        <form id="downloadForm" action="https://api.sentinelauthority.org/api/applications/document-download" method="POST" onsubmit="handleDownloadSubmit(event)">
          <input type="hidden" name="access_key" value="3e7e3ac5-9b32-46a0-b901-d36f8723879c">
          <input type="hidden" name="subject" value="New Document Download">
          <input type="hidden" name="from_name" value="Sentinel Authority Website">
          <input type="hidden" id="documentName" name="document" value="">
          <div class="download-form-group">
            <label class="download-form-label" for="download-email">Email (required)</label>
            <input type="email" id="download-email" name="email" class="download-form-input" required>
          </div>
          <div class="download-form-group">
            <label class="download-form-label" for="download-org">Organization (optional)</label>
            <input type="text" id="download-org" name="org" class="download-form-input">
          </div>
          <div class="download-form-group">
            <label class="download-form-label" for="download-role">Role (optional)</label>
            <select id="download-role" name="role" class="download-form-select">
              <option value="">Select…</option>
              <option value="engineering">Engineering</option>
              <option value="risk">Risk & Insurance</option>
              <option value="regulatory">Regulatory</option>
              <option value="legal">Legal</option>
              <option value="operations">Operations</option>
              <option value="other">Other</option>
            </select>
          </div>
          <button type="submit" class="download-form-btn">View Document</button>
          <p class="download-form-fine">Contact information is used for document delivery and technical correspondence only.</p>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Full hash for copy functionality
    const FULL_HASH = "8f2a7b3c4d5e6f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3c91d";
    const toast = document.querySelector('.copy-toast');
    
    function copyHash() {
      const text = FULL_HASH;
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(text).then(showCopied).catch(fallbackCopy);
      } else {
        fallbackCopy();
      }
      function fallbackCopy() {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.opacity = "0";
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand("copy"); showCopied(); } finally { ta.remove(); }
      }
      function showCopied() {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'Copied';
        btn.classList.add('copied');
        
        // Show toast
        toast.classList.add('show');
        
        setTimeout(() => { 
          btn.textContent = 'Copy'; 
          btn.classList.remove('copied'); 
          toast.classList.remove('show');
        }, 1800);
      }
    }

    // Mobile nav
    const navToggle = document.querySelector('.nav-toggle');
    const navDrawer = document.querySelector('.nav-drawer');
    const drawerOverlay = document.querySelector('.drawer-overlay');
    const drawerLinks = navDrawer.querySelectorAll('a');
    
    function openDrawer() {
      navToggle.setAttribute('aria-expanded', 'true');
      navDrawer.classList.add('open');
      drawerOverlay.classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    
    function closeDrawer() {
      navToggle.setAttribute('aria-expanded', 'false');
      navDrawer.classList.remove('open');
      drawerOverlay.classList.remove('open');
      document.body.style.overflow = '';
    }
    
    navToggle.addEventListener('click', () => {
      const isOpen = navToggle.getAttribute('aria-expanded') === 'true';
      isOpen ? closeDrawer() : openDrawer();
    });
    
    drawerOverlay.addEventListener('click', closeDrawer);
    
    drawerLinks.forEach(link => {
      link.addEventListener('click', closeDrawer);
    });
    
    // Close on escape (only if open, return focus)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && navToggle.getAttribute('aria-expanded') === 'true') {
        closeDrawer();
        navToggle.focus();
      }
    });

    // Active section tracking
    const sections = document.querySelectorAll('.section[id]');
    const navLinksDesktop = document.querySelectorAll('.nav-links a[data-section]');
    const navLinksMobile = document.querySelectorAll('.nav-drawer a[data-section]');
    
    function updateActiveSection() {
      const navHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--nav-height')) || 72;
      const scrollPos = window.scrollY + navHeight + 40;
      
      let currentSection = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.offsetHeight;
        if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
          currentSection = section.getAttribute('id');
        }
      });
      
      [...navLinksDesktop, ...navLinksMobile].forEach(link => {
        link.classList.remove('active');
        if (link.dataset.section === currentSection) {
          link.classList.add('active');
        }
      });
    }
    
    window.addEventListener('scroll', updateActiveSection, { passive: true });
    updateActiveSection();

    // Reveal animations on scroll
    const revealElements = document.querySelectorAll('.reveal');
    
    function checkReveal() {
      const windowHeight = window.innerHeight;
      const revealPoint = 120;
      
      revealElements.forEach(el => {
        const elementTop = el.getBoundingClientRect().top;
        if (elementTop < windowHeight - revealPoint) {
          el.classList.add('active');
        }
      });
    }
    
    window.addEventListener('scroll', checkReveal, { passive: true });
    window.addEventListener('load', checkReveal);
    checkReveal();

    // Download Modal
    let currentPdfPath = '';
    const downloadModal = document.getElementById('downloadModal');
    const downloadModalTitle = document.getElementById('downloadModalTitle');
    const documentNameInput = document.getElementById('documentName');
    
    function openDownloadModal(pdfPath, docName) {
      currentPdfPath = pdfPath;
      downloadModalTitle.textContent = 'Download ' + docName;
      documentNameInput.value = docName;
      downloadModal.classList.add('open');
      downloadModal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }
    
    function closeDownloadModal() {
      downloadModal.classList.remove('open');
      downloadModal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
    
    downloadModal.addEventListener('click', (e) => {
      if (e.target === downloadModal) closeDownloadModal();
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && downloadModal.classList.contains('open')) closeDownloadModal();
    })
    
    function handleDownloadSubmit(e) {
      e.preventDefault();
      const form = e.target;
      
      const data = {
        email: document.getElementById('download-email').value,
        organization: document.getElementById('download-org').value || 'Not provided',
        role: document.getElementById('download-role').value || 'Not provided',
        document: document.getElementById('documentName').value
      };
      
      fetch('https://sentinel-authority-production.up.railway.app/api/applications/document-download', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .finally(() => {
        closeDownloadModal();
        window.open(currentPdfPath, '_blank');
        form.reset();
      });
    }
  </script>

  <script>
    // Verify certificate function
    document.getElementById("cert-input")?.addEventListener("keypress", function(e) {
      if (e.key === "Enter") verifyCertificate();
    });
    
    async function verifyCertificate() {
      const input = document.getElementById("cert-input");
      const btn = document.getElementById("verify-btn");
      const resultDiv = document.getElementById("verify-result");
      const certNumber = input.value.trim();
      
      if (!certNumber) { input.focus(); return; }
      
      btn.disabled = true;
      btn.innerHTML = 'Verifying...';
      resultDiv.innerHTML = '';
      
      try {
        const response = await fetch(`https://api.sentinelauthority.org/api/verify/${encodeURIComponent(certNumber)}`);
        
        if (response.ok) {
          const data = await response.json();
          if (data.status === 'NOT_FOUND' || data.valid === false) {
            showVerifyError("Certificate not found in registry.");
          } else {
            showVerifySuccess(data);
          }
        } else if (response.status === 404) {
          showVerifyError("Certificate not found in registry.");
        } else {
          showVerifyError("Verification failed. Please try again.");
        }
      } catch (error) {
        showVerifyError("Unable to connect to registry. Please try again later.");
      }
      
      btn.disabled = false;
      btn.innerHTML = "Verify Certificate";
    }
    
    function showVerifySuccess(data) {
      const resultDiv = document.getElementById("verify-result");
      const status = (data.status || "CONFORMANT").toLowerCase();
      const expiresDate = data.expires_at ? new Date(data.expires_at).toLocaleDateString("en-US", {year: "numeric", month: "long", day: "numeric"}) : "—";
      const issuedDate = data.issued_at ? new Date(data.issued_at).toLocaleDateString("en-US", {year: "numeric", month: "long", day: "numeric"}) : "—";
      
      resultDiv.innerHTML = `
        <div class="result-success">
          <div class="result-header">
            <div class="result-icon valid">✓</div>
            <span class="result-title valid">Valid Certificate</span>
          </div>
          <div class="result-grid">
            <div class="result-row"><span class="result-label">Certificate</span><span class="result-value" style="font-family:var(--mono);color:var(--purple-bright)">${data.certificate_number || "—"}</span></div>
            <div class="result-row"><span class="result-label">Organization</span><span class="result-value">${data.organization_name || "—"}</span></div>
            <div class="result-row"><span class="result-label">System</span><span class="result-value">${data.system_name || "—"}</span></div>
            <div class="result-row"><span class="result-label">Status</span><span class="result-value status ${status}">${data.status || "CONFORMANT"}</span></div>
            <div class="result-row"><span class="result-label">Issued</span><span class="result-value">${issuedDate}</span></div>
            <div class="result-row"><span class="result-label">Expires</span><span class="result-value">${expiresDate}</span></div>
          </div>
        </div>`;
    }
    
    function showVerifyError(message) {
      const resultDiv = document.getElementById("verify-result");
      resultDiv.innerHTML = `
        <div class="result-error">
          <div class="result-header">
            <div class="result-icon invalid">✗</div>
            <span class="result-title invalid">Not Found</span>
          </div>
          <p style="margin:0;color:var(--text-secondary);font-size:14px">${message}</p>
        </div>`;
    }
  </script>
</body>
</html>
</file>

<file path="frontend/src/App.jsx">
import React, { useState, useEffect, createContext, useContext } from 'react';
import { BrowserRouter, Routes, Route, Navigate, Link, useNavigate, useLocation, useParams } from 'react-router-dom';
import { FileText, Activity, Award, Users, Home, LogOut, Menu, X, CheckCircle, AlertTriangle, Clock, Search, Plus, ArrowLeft, ExternalLink, Shield, Download, RefreshCw } from 'lucide-react';
import axios from 'axios';

// API Configuration
const API_URL = 'https://sentinel-authority-production.up.railway.app';
const api = axios.create({ baseURL: API_URL });

// Add auth header to all requests
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

// Auth Context
const AuthContext = createContext(null);

function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const token = localStorage.getItem('token');
    const userData = localStorage.getItem('user');
    if (token && userData) {
      setUser(JSON.parse(userData));
    }
    setLoading(false);
  }, []);

  const login = async (email, password) => {
    const res = await api.post('/api/auth/login', { email, password });
    localStorage.setItem('token', res.data.access_token);
    localStorage.setItem('user', JSON.stringify(res.data.user));
    setUser(res.data.user);
    return res.data.user;
  };

  const register = async (data) => {
    const res = await api.post('/api/auth/register', data);
    localStorage.setItem('token', res.data.access_token);
    localStorage.setItem('user', JSON.stringify(res.data.user));
    setUser(res.data.user);
    return res.data.user;
  };

  const logout = () => {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ user, login, register, logout, loading }}>
      {children}
    </AuthContext.Provider>
  );
}

function useAuth() {
  return useContext(AuthContext);
}

// Brand Mark Component - matches website exactly
function BrandMark({ size = 24 }) {
  return (
    <div 
      className="flex items-center justify-center flex-shrink-0"
      style={{
        width: size,
        height: size,
        background: '#5B4B8A',
        border: '2px solid #9d8ccf',
        borderRadius: 6,
      }}
    >
      <div 
        className="rounded-full"
        style={{
          width: size * 0.33,
          height: size * 0.33,
          background: '#c4b8e8',
          animation: 'eyePulse 7s ease-in-out infinite',
        }}
      />
      <style>{`
        @keyframes eyePulse {
          0%, 100% { opacity: 0.75; transform: scale(0.98); box-shadow: 0 0 0 rgba(196,184,232,0); }
          50% { opacity: 1; transform: scale(1.02); box-shadow: 0 0 10px rgba(157,140,207,0.22); }
        }
      `}</style>
    </div>
  );
}

// Protected Route
function ProtectedRoute({ children, roles }) {
  const { user, loading } = useAuth();
  if (loading) return <div className="flex items-center justify-center h-screen" style={{background: '#2a2f3d', color: 'rgba(255,255,255,0.94)'}}>Loading...</div>;
  if (!user) return <Navigate to="/login" />;
  if (roles && !roles.includes(user.role)) return <Navigate to="/dashboard" />;
  return children;
}

// Custom styles to match website
const styles = {
  bgDeep: '#2a2f3d',
  bgPanel: 'rgba(255,255,255,0.05)',
  purplePrimary: '#5B4B8A',
  purpleBright: '#9d8ccf',
  purpleGlow: 'rgba(157,140,207,0.20)',
  accentGreen: '#5CD685',
  accentAmber: '#D6A05C',
  accentRed: '#D65C5C',
  textPrimary: 'rgba(255,255,255,0.94)',
  textSecondary: 'rgba(255,255,255,0.75)',
  textTertiary: 'rgba(255,255,255,0.50)',
  borderGlass: 'rgba(255,255,255,0.10)',
};

// Layout
function Layout({ children }) {
  const { user, logout } = useAuth();
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [userCerts, setUserCerts] = useState([]);
  const [userApps, setUserApps] = useState([]);
  const location = useLocation();

  useEffect(() => {
    if (user) {
      api.get('/api/certificates/').then(res => setUserCerts(res.data || [])).catch(() => setUserCerts([]));
      api.get('/api/applications/').then(res => setUserApps(res.data || [])).catch(() => setUserApps([]));
    }
  }, [user]);

  const navigation = [
    { name: 'Dashboard', href: '/dashboard', icon: Home, roles: ['admin', 'applicant'] },
    { name: 'Applications', href: '/applications', icon: FileText, roles: ['admin', 'applicant'] },
    { name: 'CAT-72 Console', href: '/cat72', icon: Activity, roles: ['admin'] },
    { name: 'Certificates', href: '/certificates', icon: Award, roles: ['admin', 'applicant'] },
    { name: 'ENVELO Agent', href: '/envelo', icon: 'brand', roles: ['admin', 'applicant'], requiresCert: true },
    { name: 'Monitoring', href: '/monitoring', icon: Activity, roles: ['admin', 'applicant'], requiresCert: true },
  ];

  const hasCert = userCerts.some(c => c.status === 'issued' || c.status === 'active');
  const hasApprovedApp = userApps.some(a => a.status === 'approved' || a.status === 'testing');
  const canAccessAgent = hasCert || hasApprovedApp;
  const filteredNav = navigation.filter(item => {
    if (!item.roles.includes(user?.role || '')) return false;
    if (item.requiresCert && user?.role !== 'admin' && !canAccessAgent) return false;
    return true;
  });

  return (
    <div className="min-h-screen" style={{background: styles.bgDeep, color: styles.textPrimary, fontFamily: "'Inter', system-ui, -apple-system, sans-serif"}}>
      {/* Animated background gradients */}
      <div style={{
        position: 'fixed', top: '-10%', left: '5%', width: '500px', height: '500px',
        background: 'radial-gradient(circle, rgba(91,75,138,0.25) 0%, transparent 70%)',
        animation: 'float1 20s ease-in-out infinite', pointerEvents: 'none', zIndex: 0,
      }} />
      <div style={{
        position: 'fixed', bottom: '-20%', right: '0%', width: '700px', height: '700px',
        background: 'radial-gradient(circle, rgba(92,214,133,0.12) 0%, transparent 70%)',
        animation: 'float2 25s ease-in-out infinite', pointerEvents: 'none', zIndex: 0,
      }} />
      <div style={{
        position: 'fixed', top: '50%', right: '20%', width: '400px', height: '400px',
        background: 'radial-gradient(circle, rgba(157,140,207,0.15) 0%, transparent 70%)',
        animation: 'float3 15s ease-in-out infinite', pointerEvents: 'none', zIndex: 0,
      }} />
      
      <style>{`
        @keyframes float1 { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(40px, -40px) scale(1.05); } 66% { transform: translate(-30px, 30px) scale(0.95); } }
        @keyframes float2 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-50px, -50px) scale(1.1); } }
        @keyframes float3 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(30px, 40px); } }
        .sexy-panel { transition: all 0.3s ease; }
        .sexy-panel:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
        .sexy-btn { transition: all 0.3s ease; }
        .sexy-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(91,75,138,0.4); }
        .sexy-input { transition: all 0.3s ease; }
        .sexy-input:focus { border-color: rgba(157,140,207,0.6) !important; box-shadow: 0 0 0 3px rgba(157,140,207,0.1); transform: translateY(-1px); }
        .sexy-row { transition: all 0.2s ease; }
        .sexy-row:hover { background: rgba(157,140,207,0.08) !important; }
      `}</style>
      
      {/* Grid overlay */}
      <div className="fixed inset-0 pointer-events-none" style={{
        backgroundImage: 'linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)',
        backgroundSize: '60px 60px',
        opacity: 0.4,
        zIndex: 0,
      }} />

      {/* Sidebar */}
      <div className={`fixed inset-y-0 left-0 z-50 w-64 transform transition-transform ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0`} style={{background: 'rgba(30,34,44,0.95)', backdropFilter: 'blur(24px)', WebkitBackdropFilter: 'blur(24px)', borderRight: '1px solid rgba(255,255,255,0.06)', boxShadow: '4px 0 24px rgba(0,0,0,0.2)'}}>
        <div className="flex items-center justify-between h-16 px-4" style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
          <Link to="/dashboard" className="flex items-center gap-3 no-underline">
            <BrandMark size={24} />
            <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', fontWeight: 500, letterSpacing: '3px', textTransform: 'uppercase', color: styles.textPrimary}}>Sentinel Authority</span>
          </Link>
          <button onClick={() => setSidebarOpen(false)} className="lg:hidden" style={{color: styles.textSecondary}}>
            <X className="w-6 h-6" />
          </button>
        </div>
        <nav className="p-4 space-y-1">
          {filteredNav.map((item) => (
            <Link
              key={item.name}
              to={item.href}
              className="flex items-center gap-3 px-4 py-3 rounded-xl transition-all no-underline"
              style={{
                background: location.pathname.startsWith(item.href) ? 'linear-gradient(135deg, rgba(91,75,138,0.9) 0%, rgba(107,91,154,0.9) 100%)' : 'transparent',
                color: location.pathname.startsWith(item.href) ? '#fff' : styles.textTertiary,
                fontFamily: "'IBM Plex Mono', monospace",
                fontSize: '11px',
                letterSpacing: '1px',
                textTransform: 'uppercase',
                boxShadow: location.pathname.startsWith(item.href) ? '0 4px 15px rgba(91,75,138,0.4)' : 'none',
                border: location.pathname.startsWith(item.href) ? '1px solid rgba(157,140,207,0.3)' : '1px solid transparent',
              }}
            >
              {item.icon === 'brand' ? <BrandMark size={16} /> : <item.icon className="w-4 h-4" />}
              {item.name}
            </Link>
          ))}
        </nav>
        <div className="absolute bottom-0 left-0 right-0 p-4" style={{borderTop: `1px solid ${styles.borderGlass}`}}>
          <div className="flex items-center gap-3 mb-4">
            <div className="w-10 h-10 rounded-lg flex items-center justify-center" style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`}}>
              <span style={{color: '#fff', fontWeight: 500}}>{user?.full_name?.[0] || 'U'}</span>
            </div>
            <div>
              <div style={{fontWeight: 500, color: styles.textPrimary}}>{user?.full_name}</div>
              <div style={{fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace", color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px'}}>{user?.role}</div>
            </div>
          </div>
          <button onClick={logout} className="flex items-center gap-2 w-full transition-colors" style={{color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', background: 'none', border: 'none', cursor: 'pointer'}}>
            <LogOut className="w-4 h-4" />
            Sign Out
          </button>
        </div>
      </div>

      {/* Main Content */}
      <div className={`${sidebarOpen ? 'lg:ml-64' : ''} relative z-10`}>
        <header className="h-16 flex items-center px-6 gap-4" style={{borderBottom: '1px solid rgba(255,255,255,0.06)', background: 'rgba(30,34,44,0.8)', backdropFilter: 'blur(20px)', WebkitBackdropFilter: 'blur(20px)'}}>
          <button onClick={() => setSidebarOpen(!sidebarOpen)} className="lg:hidden" style={{color: styles.textSecondary, background: 'none', border: 'none'}}>
            <Menu className="w-6 h-6" />
          </button>
          <div className="flex-1" />
          <a href="https://sentinelauthority.org" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 transition-colors no-underline" style={{color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1.5px', textTransform: 'uppercase'}}>
            <ExternalLink className="w-4 h-4" />
            Main Site
          </a>
          {user?.role === 'admin' && (
          <a href="https://api.sentinelauthority.org/docs" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 transition-colors no-underline" style={{color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1.5px', textTransform: 'uppercase'}}>
            <FileText className="w-4 h-4" />
            API Docs
          </a>
          )}
          <Link to="/verify" className="flex items-center gap-2 transition-colors no-underline" style={{color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1.5px', textTransform: 'uppercase'}}>
            <Search className="w-4 h-4" />
            Verify
          </Link>
        </header>
        <main className="p-8" style={{position: 'relative', zIndex: 1}}>{children}</main>
      </div>
    </div>
  );
}

// Panel Component
function Panel({ children, className = '', glow = false, accent = null }) {
  const accentColors = {
    purple: 'rgba(157,140,207,0.15)',
    green: 'rgba(92,214,133,0.1)',
    amber: 'rgba(214,160,92,0.1)',
    red: 'rgba(214,92,92,0.1)',
  };
  return (
    <div className={`rounded-2xl p-6 ${className}`} style={{
      background: accent ? `linear-gradient(135deg, ${accentColors[accent] || accentColors.purple} 0%, rgba(255,255,255,0.02) 100%)` : 'rgba(255,255,255,0.03)',
      border: `1px solid ${styles.borderGlass}`,
      backdropFilter: 'blur(16px)',
      boxShadow: glow ? '0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.05)' : 'none',
      position: 'relative',
      overflow: 'hidden',
    }}>
      {glow && <div style={{position:'absolute',top:0,left:0,right:0,height:'1px',background:'linear-gradient(90deg,transparent,rgba(157,140,207,0.3),transparent)'}}/>}
      {children}
    </div>
  );
}

// Section Header Component
function SectionHeader({ label, title, description, action }) {
  return (
    <div style={{marginBottom: '24px'}}>
      <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', flexWrap: 'wrap', gap: '16px'}}>
        <div>
          {label && <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px', display: 'flex', alignItems: 'center', gap: '12px'}}>
            <span style={{width: '24px', height: '1px', background: styles.purpleBright}}></span>
            {label}
          </p>}
          <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '32px', fontWeight: 200, margin: 0, letterSpacing: '-0.02em'}}>{title}</h1>
          {description && <p style={{color: styles.textSecondary, marginTop: '8px', fontSize: '15px'}}>{description}</p>}
        </div>
        {action}
      </div>
    </div>
  );
}

// Stat Card Component
function StatCard({ label, value, trend, color = styles.purpleBright, icon }) {
  return (
    <Panel glow>
      <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start'}}>
        <div>
          <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '12px'}}>{label}</p>
          <p style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, color: color, margin: 0, lineHeight: 1}}>{value}</p>
          {trend && <p style={{fontSize: '12px', color: trend > 0 ? styles.accentGreen : styles.accentRed, marginTop: '8px'}}>{trend > 0 ? '↑' : '↓'} {Math.abs(trend)}%</p>}
        </div>
        {icon && <div style={{width: '48px', height: '48px', borderRadius: '12px', background: `${color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center'}}>{icon}</div>}
      </div>
    </Panel>
  );
}

// Status Badge Component  
function StatusBadge({ status, size = 'md' }) {
  const statusConfig = {
    pending: { bg: 'rgba(214,160,92,0.15)', border: 'rgba(214,160,92,0.3)', color: styles.accentAmber, label: 'Pending' },
    under_review: { bg: 'rgba(157,140,207,0.15)', border: 'rgba(157,140,207,0.3)', color: styles.purpleBright, label: 'Under Review' },
    approved: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.3)', color: styles.accentGreen, label: 'Approved' },
    testing: { bg: 'rgba(157,140,207,0.15)', border: 'rgba(157,140,207,0.3)', color: styles.purpleBright, label: 'Testing' },
    conformant: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.3)', color: styles.accentGreen, label: 'Conformant' },
    certified: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.3)', color: styles.accentGreen, label: 'Certified' },
    active: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.3)', color: styles.accentGreen, label: 'Active' },
    issued: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.3)', color: styles.accentGreen, label: 'Issued' },
    revoked: { bg: 'rgba(214,92,92,0.15)', border: 'rgba(214,92,92,0.3)', color: styles.accentRed, label: 'Revoked' },
    suspended: { bg: 'rgba(214,160,92,0.15)', border: 'rgba(214,160,92,0.3)', color: styles.accentAmber, label: 'Suspended' },
    running: { bg: 'rgba(214,160,92,0.15)', border: 'rgba(214,160,92,0.3)', color: styles.accentAmber, label: 'Running' },
    scheduled: { bg: 'rgba(157,140,207,0.15)', border: 'rgba(157,140,207,0.3)', color: styles.purpleBright, label: 'Scheduled' },
    completed: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.3)', color: styles.accentGreen, label: 'Completed' },
  };
  const config = statusConfig[status] || statusConfig.pending;
  const padding = size === 'sm' ? '4px 10px' : '6px 14px';
  const fontSize = size === 'sm' ? '9px' : '10px';
  return (
    <span style={{
      display: 'inline-flex', alignItems: 'center', gap: '6px',
      padding, borderRadius: '20px', fontSize, fontFamily: "'IBM Plex Mono', monospace",
      letterSpacing: '1px', textTransform: 'uppercase',
      background: config.bg, border: `1px solid ${config.border}`, color: config.color,
    }}>
      <span style={{width: '6px', height: '6px', borderRadius: '50%', background: config.color, boxShadow: `0 0 8px ${config.color}`}}></span>
      {config.label}
    </span>
  );
}

// Progress Bar Component
function ProgressBar({ value, max = 100, color = styles.purpleBright, showLabel = true, size = 'md' }) {
  const pct = Math.min(100, (value / max) * 100);
  const height = size === 'sm' ? '4px' : '8px';
  return (
    <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
      <div style={{flex: 1, height, borderRadius: '4px', background: 'rgba(255,255,255,0.1)', overflow: 'hidden'}}>
        <div style={{
          width: `${pct}%`, height: '100%', borderRadius: '4px',
          background: `linear-gradient(90deg, ${color}, ${color}aa)`,
          boxShadow: `0 0 12px ${color}50`,
          transition: 'width 0.5s ease',
        }}/>
      </div>
      {showLabel && <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.textTertiary, minWidth: '40px'}}>{Math.round(pct)}%</span>}
    </div>
  );
}

// Data Table Component
function DataTable({ columns, data, onRowClick, emptyMessage = 'No data found' }) {
  return (
    <div style={{overflowX: 'auto'}}>
      <table style={{width: '100%', borderCollapse: 'collapse'}}>
        <thead>
          <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
            {columns.map((col, i) => (
              <th key={i} style={{
                padding: '14px 16px', textAlign: col.align || 'left',
                fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px',
                letterSpacing: '1.5px', textTransform: 'uppercase',
                color: styles.textTertiary, fontWeight: 400,
              }}>{col.label}</th>
            ))}
          </tr>
        </thead>
        <tbody>
          {data.length === 0 ? (
            <tr><td colSpan={columns.length} style={{padding: '48px', textAlign: 'center', color: styles.textTertiary}}>{emptyMessage}</td></tr>
          ) : data.map((row, i) => (
            <tr key={i} onClick={() => onRowClick?.(row)} style={{
              borderBottom: `1px solid ${styles.borderGlass}`,
              cursor: onRowClick ? 'pointer' : 'default',
              transition: 'background 0.15s',
            }}
            onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(255,255,255,0.02)'}
            onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}>
              {columns.map((col, j) => (
                <td key={j} style={{padding: '16px', textAlign: col.align || 'left', color: styles.textSecondary, fontSize: '14px'}}>
                  {col.render ? col.render(row) : row[col.key]}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

// Action Button Component
function ActionButton({ children, variant = 'primary', size = 'md', icon, onClick, disabled, href }) {
  const variants = {
    primary: { bg: 'linear-gradient(135deg, #5B4B8A 0%, #7B6BAA 100%)', border: 'rgba(157,140,207,0.5)', color: '#fff', shadow: '0 4px 20px rgba(91,75,138,0.3)' },
    secondary: { bg: 'transparent', border: 'rgba(255,255,255,0.15)', color: styles.textPrimary, shadow: 'none' },
    success: { bg: 'rgba(92,214,133,0.15)', border: 'rgba(92,214,133,0.4)', color: styles.accentGreen, shadow: 'none' },
    danger: { bg: 'rgba(214,92,92,0.1)', border: 'rgba(214,92,92,0.3)', color: styles.accentRed, shadow: 'none' },
  };
  const sizes = { sm: '10px 16px', md: '12px 20px', lg: '14px 28px' };
  const v = variants[variant];
  const style = {
    display: 'inline-flex', alignItems: 'center', gap: '8px',
    padding: sizes[size], borderRadius: '12px',
    background: v.bg, border: `1px solid ${v.border}`, color: v.color,
    fontFamily: "'IBM Plex Mono', monospace", fontSize: size === 'sm' ? '10px' : '11px',
    letterSpacing: '1px', textTransform: 'uppercase',
    cursor: disabled ? 'not-allowed' : 'pointer',
    opacity: disabled ? 0.5 : 1, boxShadow: v.shadow,
    textDecoration: 'none', transition: 'all 0.2s ease',
  };
  const Component = href ? 'a' : 'button';
  return <Component href={href} onClick={onClick} disabled={disabled} style={style}>{icon}{children}</Component>;
}

// Login Page
function LoginPage() {
  const { login, register } = useAuth();
  const navigate = useNavigate();
  const [isRegister, setIsRegister] = useState(false);
  const [error, setError] = useState('');
  const [formData, setFormData] = useState({ email: '', password: '', full_name: '', organization_name: '' });

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    try {
      if (isRegister) {
        await register(formData);
      } else {
        await login(formData.email, formData.password);
      }
      navigate('/dashboard');
    } catch (err) {
      setError(err.response?.data?.detail || 'Authentication failed');
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden" style={{background: styles.bgDeep}}>
      {/* Animated background gradients */}
      <div style={{
        position: 'absolute', top: '-20%', left: '-10%', width: '600px', height: '600px',
        background: 'radial-gradient(circle, rgba(91,75,138,0.3) 0%, transparent 70%)',
        animation: 'float1 15s ease-in-out infinite', pointerEvents: 'none',
      }} />
      <div style={{
        position: 'absolute', bottom: '-30%', right: '-15%', width: '800px', height: '800px',
        background: 'radial-gradient(circle, rgba(92,214,133,0.15) 0%, transparent 70%)',
        animation: 'float2 20s ease-in-out infinite', pointerEvents: 'none',
      }} />
      <div style={{
        position: 'absolute', top: '40%', right: '10%', width: '400px', height: '400px',
        background: 'radial-gradient(circle, rgba(157,140,207,0.2) 0%, transparent 70%)',
        animation: 'float3 12s ease-in-out infinite', pointerEvents: 'none',
      }} />
      
      {/* Grid overlay */}
      <div style={{
        position: 'fixed', inset: 0,
        backgroundImage: 'linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)',
        backgroundSize: '60px 60px', opacity: 0.5, pointerEvents: 'none',
      }} />

      {/* Decorative lines */}
      <div style={{ position: 'absolute', top: '20%', left: '5%', width: '1px', height: '200px',
        background: 'linear-gradient(to bottom, transparent, rgba(157,140,207,0.3), transparent)',
      }} />
      <div style={{ position: 'absolute', bottom: '15%', right: '8%', width: '150px', height: '1px',
        background: 'linear-gradient(to right, transparent, rgba(92,214,133,0.3), transparent)',
      }} />

      <style>{`
        @keyframes float1 { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(30px, -30px) scale(1.05); } 66% { transform: translate(-20px, 20px) scale(0.95); } }
        @keyframes float2 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-40px, -40px) scale(1.1); } }
        @keyframes float3 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(20px, 30px); } }
        @keyframes pulse-ring { 0% { transform: scale(0.8); opacity: 0.5; } 50% { transform: scale(1.2); opacity: 0; } 100% { transform: scale(0.8); opacity: 0.5; } }
        .login-input { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .login-input:focus { border-color: rgba(157,140,207,0.6) !important; box-shadow: 0 0 0 3px rgba(157,140,207,0.1), 0 4px 20px rgba(0,0,0,0.2); transform: translateY(-1px); }
        .login-btn { position: relative; overflow: hidden; transition: all 0.3s ease; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(91,75,138,0.5); }
      `}</style>

      <div className="w-full max-w-md relative z-10">
        {/* Brand section */}
        <div className="text-center mb-10">
          {/* Animated brand mark with rings */}
          <div className="relative flex justify-center mb-6" style={{height: '100px', alignItems: 'center'}}>
            <div style={{
              position: 'absolute', width: '80px', height: '80px',
              border: '1px solid rgba(157,140,207,0.2)', borderRadius: '50%',
              animation: 'pulse-ring 3s ease-out infinite',
            }} />
            <div style={{
              position: 'absolute', width: '100px', height: '100px',
              border: '1px solid rgba(157,140,207,0.1)', borderRadius: '50%',
              animation: 'pulse-ring 3s ease-out infinite 0.5s',
            }} />
            <div style={{
              width: '56px', height: '56px',
              background: 'linear-gradient(135deg, #5B4B8A 0%, #7B6BAA 100%)',
              border: '2px solid #9d8ccf', borderRadius: '14px',
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              boxShadow: '0 8px 32px rgba(91,75,138,0.4), inset 0 1px 0 rgba(255,255,255,0.1)',
            }}>
              <div style={{
                width: '18px', height: '18px',
                background: 'radial-gradient(circle, #e8e0ff 0%, #c4b8e8 100%)',
                borderRadius: '50%', boxShadow: '0 0 20px rgba(196,184,232,0.5)',
                animation: 'eyePulse 3s ease-in-out infinite',
              }} />
            </div>
          </div>
          
          <h1 style={{
            fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200,
            color: styles.textPrimary, margin: '0 0 8px 0', letterSpacing: '-0.02em',
          }}>
            ODDC <span style={{color: styles.purpleBright, fontStyle: 'italic'}}>Portal</span>
          </h1>
          
          <p style={{
            color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace",
            fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', marginTop: '12px',
          }}>Sentinel Authority</p>

          <a href="https://sentinelauthority.org" style={{
            color: styles.purpleBright, fontFamily: "'IBM Plex Mono', monospace",
            fontSize: '10px', letterSpacing: '1px', textDecoration: 'none',
            padding: '8px 16px', border: '1px solid rgba(157,140,207,0.2)',
            borderRadius: '20px', marginTop: '16px', display: 'inline-block',
          }}>← VISIT MAIN SITE</a>
        </div>
        
        {/* Login card */}
        <div style={{
          background: 'rgba(255,255,255,0.03)', backdropFilter: 'blur(20px)',
          border: '1px solid rgba(255,255,255,0.08)', borderRadius: '24px', padding: '40px',
          boxShadow: '0 25px 50px -12px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05) inset',
        }}>
          {/* Tab switcher */}
          <div style={{
            display: 'flex', background: 'rgba(0,0,0,0.2)',
            borderRadius: '12px', padding: '4px', marginBottom: '32px',
          }}>
            <button onClick={() => setIsRegister(false)} type="button" style={{
              flex: 1, padding: '12px', borderRadius: '10px', border: 'none',
              background: !isRegister ? styles.purplePrimary : 'transparent',
              color: !isRegister ? '#fff' : styles.textTertiary,
              fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px',
              letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer',
            }}>Sign In</button>
            <button onClick={() => setIsRegister(true)} type="button" style={{
              flex: 1, padding: '12px', borderRadius: '10px', border: 'none',
              background: isRegister ? styles.purplePrimary : 'transparent',
              color: isRegister ? '#fff' : styles.textTertiary,
              fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px',
              letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer',
            }}>Register</button>
          </div>

          {error && (
            <div style={{
              marginBottom: '24px', padding: '14px 16px', borderRadius: '12px',
              background: 'rgba(214,92,92,0.1)', border: '1px solid rgba(214,92,92,0.3)',
              color: styles.accentRed, fontSize: '13px', display: 'flex', alignItems: 'center', gap: '10px',
            }}><span style={{fontSize: '16px'}}>⚠</span>{error}</div>
          )}
          
          <form onSubmit={handleSubmit} className="space-y-5">
            {isRegister && (
              <>
                <div>
                  <label style={{
                    display: 'block', marginBottom: '8px', color: styles.textTertiary,
                    fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px',
                    letterSpacing: '1px', textTransform: 'uppercase',
                  }}>Full Name</label>
                  <input type="text" placeholder="Jane Smith" value={formData.full_name}
                    onChange={(e) => setFormData({...formData, full_name: e.target.value})}
                    className="login-input w-full px-4 py-4 rounded-xl outline-none"
                    style={{ background: 'rgba(0,0,0,0.2)', border: '1px solid rgba(255,255,255,0.08)',
                      color: styles.textPrimary, fontFamily: "'Inter', sans-serif", fontSize: '15px',
                    }} required />
                </div>
                <div>
                  <label style={{
                    display: 'block', marginBottom: '8px', color: styles.textTertiary,
                    fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px',
                    letterSpacing: '1px', textTransform: 'uppercase',
                  }}>Organization</label>
                  <input type="text" placeholder="Acme Robotics Inc." value={formData.organization_name}
                    onChange={(e) => setFormData({...formData, organization_name: e.target.value})}
                    className="login-input w-full px-4 py-4 rounded-xl outline-none"
                    style={{ background: 'rgba(0,0,0,0.2)', border: '1px solid rgba(255,255,255,0.08)',
                      color: styles.textPrimary, fontFamily: "'Inter', sans-serif", fontSize: '15px',
                    }} required />
                </div>
              </>
            )}
            <div>
              <label style={{
                display: 'block', marginBottom: '8px', color: styles.textTertiary,
                fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px',
                letterSpacing: '1px', textTransform: 'uppercase',
              }}>Email Address</label>
              <input type="email" placeholder="you@company.com" value={formData.email}
                onChange={(e) => setFormData({...formData, email: e.target.value})}
                className="login-input w-full px-4 py-4 rounded-xl outline-none"
                style={{ background: 'rgba(0,0,0,0.2)', border: '1px solid rgba(255,255,255,0.08)',
                  color: styles.textPrimary, fontFamily: "'Inter', sans-serif", fontSize: '15px',
                }} required />
            </div>
            <div>
              <label style={{
                display: 'block', marginBottom: '8px', color: styles.textTertiary,
                fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px',
                letterSpacing: '1px', textTransform: 'uppercase',
              }}>Password</label>
              <input type="password" placeholder="••••••••••••" value={formData.password}
                onChange={(e) => setFormData({...formData, password: e.target.value})}
                className="login-input w-full px-4 py-4 rounded-xl outline-none"
                style={{ background: 'rgba(0,0,0,0.2)', border: '1px solid rgba(255,255,255,0.08)',
                  color: styles.textPrimary, fontFamily: "'Inter', sans-serif", fontSize: '15px',
                }} required />
            </div>
            
            <button type="submit" className="login-btn w-full py-4 rounded-xl font-medium"
              style={{
                background: 'linear-gradient(135deg, #5B4B8A 0%, #7B6BAA 100%)',
                border: '1px solid rgba(157,140,207,0.5)', color: '#fff',
                fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px',
                letterSpacing: '2px', textTransform: 'uppercase', cursor: 'pointer',
                marginTop: '8px', boxShadow: '0 4px 20px rgba(91,75,138,0.4)',
              }}>{isRegister ? 'Create Account' : 'Sign In'}</button>
          </form>
          
          {!isRegister && (
            <div className="mt-6 text-center">
              <a href="#" style={{ color: styles.textTertiary, fontSize: '13px', textDecoration: 'none' }}>Forgot password?</a>
            </div>
          )}
        </div>
        
        {/* Footer */}
        <div className="mt-8 text-center">
          <p style={{
            color: styles.textTertiary, fontSize: '11px',
            fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '1px',
          }}>
            Protected by ENVELO • <a href="https://sentinelauthority.org/privacy.html" style={{color: styles.purpleBright, textDecoration: 'none'}}>Privacy</a> • <a href="https://sentinelauthority.org/terms.html" style={{color: styles.purpleBright, textDecoration: 'none'}}>Terms</a>
          </p>
        </div>
      </div>
    </div>
  );
}



// Dashboard

// Customer Dashboard - simplified view for customers
function CustomerDashboard() {
  const { user } = useAuth();
  const [applications, setApplications] = useState([]);
  const [certificates, setCertificates] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    Promise.all([
      api.get('/api/applications/').catch(() => ({ data: [] })),
      api.get('/api/certificates/').catch(() => ({ data: [] }))
    ]).then(([appsRes, certsRes]) => {
      setApplications(appsRes.data || []);
      setCertificates(certsRes.data || []);
      setLoading(false);
    });
  }, []);

  if (loading) return <div style={{color: styles.textTertiary, padding: '40px', textAlign: 'center'}}>Loading...</div>;

  return (
    <div className="space-y-6">
      <div>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Welcome</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>Your Dashboard</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>Track your ODDC certification progress</p>
      </div>

      {/* Quick Stats */}
      <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px'}}>
        <Panel>
          <div style={{textAlign: 'center', padding: '12px'}}>
            <div style={{fontSize: '36px', fontWeight: 200, color: styles.purpleBright}}>{applications.length}</div>
            <div style={{fontSize: '11px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginTop: '4px'}}>Applications</div>
          </div>
        </Panel>
        <Panel>
          <div style={{textAlign: 'center', padding: '12px'}}>
            <div style={{fontSize: '36px', fontWeight: 200, color: styles.accentGreen}}>{certificates.length}</div>
            <div style={{fontSize: '11px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginTop: '4px'}}>Certificates</div>
          </div>
        </Panel>
        <Panel>
          <div style={{textAlign: 'center', padding: '12px'}}>
            <a href="https://sentinel-website-eta.vercel.app/status.html" target="_blank" style={{display: 'block', textDecoration: 'none'}}>
              <div style={{fontSize: '24px', marginBottom: '8px'}}>📊</div>
              <div style={{fontSize: '11px', color: styles.purpleBright, textTransform: 'uppercase', letterSpacing: '1px'}}>Check Test Status</div>
            </a>
          </div>
        </Panel>
      </div>

      {/* Applications */}
      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Your Applications</h2>
        {applications.length === 0 ? (
          <div style={{textAlign: 'center', padding: '40px', color: styles.textTertiary}}>
            <p style={{marginBottom: '16px'}}>No applications yet</p>
            <a href="https://sentinelauthority.org/apply.html" style={{color: styles.purpleBright}}>Apply for Certification →</a>
          </div>
        ) : (
          <div className="space-y-3">
            {applications.map(app => (
              <div key={app.id} style={{padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                <div>
                  <div style={{fontWeight: 500, marginBottom: '4px'}}>{app.system_name}</div>
                  <div style={{fontSize: '12px', color: styles.textTertiary}}>{app.application_number}</div>
                </div>
                <span style={{padding: '4px 12px', borderRadius: '4px', fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase',
                  background: app.status === 'certified' ? 'rgba(92,214,133,0.15)' : app.status === 'testing' ? 'rgba(157,140,207,0.15)' : 'rgba(214,160,92,0.15)',
                  color: app.status === 'certified' ? styles.accentGreen : app.status === 'testing' ? styles.purpleBright : styles.accentAmber
                }}>{app.status || 'pending'}</span>
              </div>
            ))}
          </div>
        )}
      </Panel>

      {/* Certificates */}
      {certificates.length > 0 && (
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Your Certificates</h2>
          <div className="space-y-3">
            {certificates.map(cert => (
              <div key={cert.id} style={{padding: '16px', background: 'rgba(92,214,133,0.1)', border: '1px solid rgba(92,214,133,0.2)', borderRadius: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                <div>
                  <div style={{fontWeight: 500, color: styles.accentGreen, marginBottom: '4px'}}>{cert.certificate_number}</div>
                  <div style={{fontSize: '12px', color: styles.textTertiary}}>Issued: {new Date(cert.issued_at).toLocaleDateString()}</div>
                </div>
                <a href={`https://sentinel-authority-production.up.railway.app/api/applications/${cert.application_id}/certificate/download`} 
                   target="_blank"
                   style={{padding: '8px 16px', background: styles.purplePrimary, borderRadius: '6px', color: '#fff', fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace", textDecoration: 'none'}}>
                  Download PDF
                </a>
              </div>
            ))}
          </div>
        </Panel>
      )}

      {/* Help */}
      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Need Help?</h2>
        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px'}}>
          {certificates.some(c => c.status === 'issued' || c.status === 'active') && (
          <a href="https://sentinelauthority.org/agent.html" target="_blank" style={{padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', textDecoration: 'none', color: styles.textSecondary}}>
            <div style={{fontWeight: 500, marginBottom: '4px', color: styles.textPrimary}}>ENVELO Agent Setup</div>
            <div style={{fontSize: '12px'}}>Installation and configuration guide</div>
          </a>
          )}
          <a href="mailto:info@sentinelauthority.org" style={{padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', textDecoration: 'none', color: styles.textSecondary}}>
            <div style={{fontWeight: 500, marginBottom: '4px', color: styles.textPrimary}}>Contact Support</div>
            <div style={{fontSize: '12px'}}>info@sentinelauthority.org</div>
          </a>
        </div>
      </Panel>
    </div>
  );
}


// Role-based dashboard routing
function RoleBasedDashboard() {
  const { user } = useAuth();
  if (user?.role === 'admin') {
    return <Dashboard />;
  }
  return <CustomerDashboard />;
}

function Dashboard() {
  const [stats, setStats] = useState(null);
  const [recentApps, setRecentApps] = useState([]);
  const [activeTests, setActiveTests] = useState([]);

  useEffect(() => {
    api.get('/api/dashboard/stats').then(res => setStats(res.data)).catch(console.error);
    api.get('/api/dashboard/recent-applications').then(res => setRecentApps(res.data)).catch(console.error);
    api.get('/api/dashboard/active-tests').then(res => setActiveTests(res.data)).catch(console.error);
  }, []);

  return (
    <div className="space-y-8">
      <SectionHeader 
        label="Overview" 
        title="Dashboard"
        action={
          <ActionButton href="/applications/new" icon={<Plus className="w-4 h-4" />}>
            New Application
          </ActionButton>
        }
      />

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <StatCard 
          label="Total Applications" 
          value={stats?.total_applications || 0} 
          color={styles.purpleBright}
          icon={<FileText className="w-5 h-5" style={{color: styles.purpleBright}} />}
        />
        <StatCard 
          label="Active Tests" 
          value={stats?.active_tests || 0} 
          color={styles.accentAmber}
          icon={<Activity className="w-5 h-5" style={{color: styles.accentAmber}} />}
        />
        <StatCard 
          label="Certificates Issued" 
          value={stats?.certificates_issued || 0} 
          color={styles.accentGreen}
          icon={<Award className="w-5 h-5" style={{color: styles.accentGreen}} />}
        />
      </div>

      {/* Active Tests */}
      {activeTests.length > 0 && (
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Active CAT-72 Tests</h2>
          <div className="space-y-3">
            {activeTests.map((test) => (
              <div key={test.id} className="p-4 rounded-lg" style={{background: 'rgba(255,255,255,0.03)', border: `1px solid ${styles.borderGlass}`}}>
                <div className="flex justify-between items-center mb-2">
                  <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.purpleBright}}>{test.organization_name} - {test.system_name}</span>
                  <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.accentAmber}}>
                    {Math.round((test.elapsed_seconds / (test.duration_hours * 3600)) * 100)}%
                  </span>
                </div>
                <div className="w-full h-1 rounded-full overflow-hidden" style={{background: 'rgba(255,255,255,0.1)'}}>
                  <div 
                    className="h-full rounded-full transition-all"
                    style={{width: `${(test.elapsed_seconds / (test.duration_hours * 3600)) * 100}%`, background: styles.purpleBright}}
                  />
                </div>
              </div>
            ))}
          </div>
        </Panel>
      )}

      {/* Recent Applications */}
      <Panel>
        <div className="flex justify-between items-center mb-4">
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary}}>Recent Applications</h2>
          <Link to="/applications/new" className="flex items-center gap-2 px-4 py-2 rounded-lg transition-colors no-underline" style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase'}}>
            <Plus className="w-4 h-4" />
            New Application
          </Link>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>System</th>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Organization</th>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>State</th>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Submitted</th>
              </tr>
            </thead>
            <tbody>
              {recentApps.map((app) => (
                <tr key={app.id} style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                  <td className="px-4 py-3" style={{color: styles.textPrimary}}>{app.system_name}</td>
                  <td className="px-4 py-3" style={{color: styles.textSecondary}}>{app.organization_name}</td>
                  <td className="px-4 py-3">
                    <span className="px-2 py-1 rounded text-xs" style={{
                      background: app.state === 'conformant' ? 'rgba(92,214,133,0.15)' : app.state === 'observe' ? 'rgba(157,140,207,0.15)' : 'rgba(214,160,92,0.15)',
                      color: app.state === 'conformant' ? styles.accentGreen : app.state === 'observe' ? styles.purpleBright : styles.accentAmber,
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '10px',
                      letterSpacing: '1px',
                      textTransform: 'uppercase',
                    }}>
                      {app.state}
                    </span>
                  </td>
                  <td className="px-4 py-3" style={{color: styles.textTertiary, fontSize: '14px'}}>{app.submitted_at ? new Date(app.submitted_at).toLocaleDateString() : "N/A"}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </Panel>
    </div>
  );
}

// Applications List
function ApplicationsList() {
  const [applications, setApplications] = useState([]);

  useEffect(() => {
    api.get('/api/applications/').then(res => setApplications(res.data)).catch(console.error);
  }, []);

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-start">
        <div>
          <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Conformance</p>
          <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>Applications</h1>
        </div>
        <Link to="/applications/new" className="flex items-center gap-2 px-4 py-2 rounded-lg transition-colors no-underline" style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase'}}>
          <Plus className="w-4 h-4" />
          New Application
        </Link>
      </div>

      <Panel>
        <table className="w-full">
          <thead>
            <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>System Name</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Organization</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>State</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Submitted</th>
            </tr>
          </thead>
          <tbody>
            {applications.map((app) => (
              <tr key={app.id} className="transition-colors" style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                <td className="px-4 py-4">
                  <Link to={`/applications/${app.id}`} style={{color: styles.purpleBright, textDecoration: 'none'}}>{app.system_name}</Link>
                </td>
                <td className="px-4 py-4" style={{color: styles.textSecondary}}>{app.organization_name}</td>
                <td className="px-4 py-4">
                  <span className="px-2 py-1 rounded" style={{
                    background: app.state === 'conformant' ? 'rgba(92,214,133,0.15)' : app.state === 'observe' ? 'rgba(157,140,207,0.15)' : app.state === 'revoked' ? 'rgba(214,92,92,0.15)' : 'rgba(214,160,92,0.15)',
                    color: app.state === 'conformant' ? styles.accentGreen : app.state === 'observe' ? styles.purpleBright : app.state === 'revoked' ? styles.accentRed : styles.accentAmber,
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '10px',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                  }}>
                    {app.state}
                  </span>
                </td>
                <td className="px-4 py-4" style={{color: styles.textTertiary, fontSize: '14px'}}>{app.submitted_at ? new Date(app.submitted_at).toLocaleDateString() : "N/A"}</td>
              </tr>
            ))}
          </tbody>
        </table>
        {applications.length === 0 && (
          <div className="text-center py-12" style={{color: styles.textTertiary}}>No applications yet</div>
        )}
      </Panel>
    </div>
  );
}

// New Application Form
function NewApplication() {
  const navigate = useNavigate();
  const [formData, setFormData] = useState({
    organization_name: '', contact_name: '', contact_email: '', contact_phone: '',
    system_name: '', system_type: '', system_description: '', system_version: '', manufacturer: '',
    odd_specification: '', envelope_definition: '',
    facility_location: '', preferred_test_date: '', notes: ''
  });
  const [error, setError] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const payload = {
        ...formData,
        odd_specification: formData.odd_specification ? { description: formData.odd_specification } : null,
        envelope_definition: formData.envelope_definition ? { description: formData.envelope_definition } : null,
        preferred_test_date: formData.preferred_test_date || null,
      };
      await api.post('/api/applications/', payload);
      navigate('/applications');
    } catch (err) {
      setError(err.response?.data?.detail || 'Failed to submit application');
    }
  };

  const inputStyle = {
    background: 'rgba(255,255,255,0.05)',
    border: `1px solid ${styles.borderGlass}`,
    color: styles.textPrimary,
    fontFamily: "'Inter', sans-serif",
  };

  return (
    <div className="max-w-2xl mx-auto space-y-6">
      <div>
        <Link to="/applications" className="flex items-center gap-2 mb-4 no-underline" style={{color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase'}}>
          <ArrowLeft className="w-4 h-4" />
          Back to Applications
        </Link>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>New Submission</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>ODDC Application</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>Submit your autonomous system for conformance determination</p>
      </div>

      <Panel>
        {error && <div className="mb-4 p-3 rounded-lg" style={{background: 'rgba(214,92,92,0.15)', border: '1px solid rgba(214,92,92,0.3)', color: styles.accentRed}}>{error}</div>}
        
        <form onSubmit={handleSubmit} className="space-y-6">
          <div>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '16px'}}>Organization Information</h2>
            <div className="space-y-4">
              <div>
                <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Organization Name *</label>
                <input type="text" value={formData.organization_name} onChange={(e) => setFormData({...formData, organization_name: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} required />
              </div>
              <div>
                <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Contact Name</label>
                <input type="text" value={formData.contact_name} onChange={(e) => setFormData({...formData, contact_name: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Contact Email *</label>
                  <input type="email" value={formData.contact_email} onChange={(e) => setFormData({...formData, contact_email: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} required />
                </div>
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Contact Phone</label>
                  <input type="tel" value={formData.contact_phone} onChange={(e) => setFormData({...formData, contact_phone: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} />
                </div>
              </div>
            </div>
          </div>

          <div style={{borderTop: `1px solid ${styles.borderGlass}`, paddingTop: '24px'}}>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '16px'}}>System Information</h2>
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>System Name *</label>
                  <input type="text" value={formData.system_name} onChange={(e) => setFormData({...formData, system_name: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} required />
                </div>
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>System Type *</label>
                  <select value={formData.system_type} onChange={(e) => setFormData({...formData, system_type: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} required>
                    <option value="">Select type...</option>
                    <option value="mobile_robot">Mobile Robot / AMR</option>
                    <option value="industrial_arm">Industrial Robot Arm</option>
                    <option value="drone">Drone / UAV</option>
                    <option value="autonomous_vehicle">Autonomous Vehicle</option>
                    <option value="agv">Automated Guided Vehicle (AGV)</option>
                    <option value="cobot">Collaborative Robot (Cobot)</option>
                    <option value="other">Other Autonomous System</option>
                  </select>
                </div>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>System Version</label>
                  <input type="text" value={formData.system_version} onChange={(e) => setFormData({...formData, system_version: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} placeholder="e.g., 1.0.0" />
                </div>
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Manufacturer</label>
                  <input type="text" value={formData.manufacturer} onChange={(e) => setFormData({...formData, manufacturer: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} />
                </div>
              </div>
              <div>
                <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>System Description *</label>
                <textarea value={formData.system_description} onChange={(e) => setFormData({...formData, system_description: e.target.value})} rows={4} className="w-full px-4 py-3 rounded-lg outline-none resize-none" style={inputStyle} required />
              </div>
            </div>
          </div>

          <div style={{borderTop: `1px solid ${styles.borderGlass}`, paddingTop: '24px'}}>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '16px'}}>Operational Domain</h2>
            <div className="space-y-4">
              <div>
                <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>ODD Specification *</label>
                <textarea value={formData.odd_specification} onChange={(e) => setFormData({...formData, odd_specification: e.target.value})} rows={6} className="w-full px-4 py-3 rounded-lg outline-none resize-none" style={inputStyle} placeholder="Example: Indoor warehouse environment, max speed 5 mph, operating temperature 40-90°F, flat concrete surfaces only, no human workers in active zones during operation." required />
              </div>
              <div>
                <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Safety Boundaries & Operational Limits</label>
                <textarea value={formData.envelope_definition} onChange={(e) => setFormData({...formData, envelope_definition: e.target.value})} rows={4} className="w-full px-4 py-3 rounded-lg outline-none resize-none" style={inputStyle} placeholder="Example: Speed limit 5 mph (hard stop at 6 mph), geofenced to warehouse floor coordinates, emergency stop if human detected within 10ft, operating hours 6am-10pm." />
              </div>
            </div>
          </div>

          <div style={{borderTop: `1px solid ${styles.borderGlass}`, paddingTop: '24px'}}>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '16px'}}>Testing Details</h2>
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Facility Location</label>
                  <input type="text" value={formData.facility_location} onChange={(e) => setFormData({...formData, facility_location: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} placeholder="Testing facility address" />
                </div>
                <div>
                  <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Preferred Test Date</label>
                  <input type="date" value={formData.preferred_test_date} onChange={(e) => setFormData({...formData, preferred_test_date: e.target.value})} className="w-full px-4 py-3 rounded-lg outline-none" style={inputStyle} />
                </div>
              </div>
              <div>
                <label style={{display: 'block', marginBottom: '8px', color: styles.textSecondary, fontSize: '14px'}}>Additional Notes</label>
                <textarea value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})} rows={3} className="w-full px-4 py-3 rounded-lg outline-none resize-none" style={inputStyle} placeholder="Any additional information relevant to your application" />
              </div>
            </div>
          </div>

          <button type="submit" className="w-full py-3 rounded-lg transition-all" style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', cursor: 'pointer'}}>
            Submit Application
          </button>
        </form>
      </Panel>
    </div>
  );
}

// Application Detail
function ApplicationDetail() {
  const { id } = useParams();
  const [app, setApp] = useState(null);
  const [scheduling, setScheduling] = useState(false);
  const [testCreated, setTestCreated] = useState(null);

  useEffect(() => {
    if (id) {
      api.get(`/api/applications/${id}`).then(res => setApp(res.data)).catch(console.error);
    }
  }, [id]);

  const handleScheduleTest = async () => {
    if (!window.confirm('Schedule a CAT-72 test for this application? The test will need to be started manually.')) return;
    setScheduling(true);
    try {
      const res = await api.post('/api/cat72/tests', { application_id: parseInt(id) });
      setTestCreated(res.data);
      alert(`CAT-72 Test created: ${res.data.test_id}\nGo to CAT-72 Console to start the test.`);
    } catch (err) {
      alert('Failed to create test: ' + (err.response?.data?.detail || err.message));
    }
    setScheduling(false);
  };

  const navigate = useNavigate();
  
  const handleDeleteApplication = async () => {
    if (!window.confirm('Are you sure you want to delete this application? This cannot be undone.')) return;
    try {
      await api.delete(`/api/applications/${id}`);
      alert('Application deleted');
      navigate('/applications');
    } catch (err) {
      alert('Failed to delete: ' + (err.response?.data?.detail || err.message));
    }
  };

  if (!app) return <div style={{color: styles.textTertiary}}>Loading...</div>;

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <Link to="/applications" className="flex items-center gap-2 no-underline" style={{color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase'}}>
          <ArrowLeft className="w-4 h-4" />
          Back to Applications
        </Link>
        <div style={{display: 'flex', gap: '12px'}}>
          {(app.state === 'pending' || app.state === 'under_review') && (
            <button
              onClick={handleApprove}
              className="px-4 py-2 rounded-lg transition-all"
              style={{background: 'rgba(92,214,133,0.15)', border: '1px solid rgba(92,214,133,0.4)', color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer'}}
            >
              Approve Application
            </button>
          )}
          {app.state === 'approved' && (
            <button
              onClick={handleScheduleTest}
              disabled={scheduling}
              className="px-4 py-2 rounded-lg transition-all"
              style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: scheduling ? 'wait' : 'pointer', opacity: scheduling ? 0.7 : 1}}
            >
              {scheduling ? 'Scheduling...' : 'Schedule CAT-72 Test'}
            </button>
          )}
          <button
            onClick={handleDeleteApplication}
            className="px-4 py-2 rounded-lg transition-all"
            style={{background: 'rgba(214,92,92,0.1)', border: '1px solid rgba(214,92,92,0.3)', color: '#D65C5C', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer'}}
          >
            Delete
          </button>
        </div>
      </div>
      
      {testCreated && (
        <div className="p-4 rounded-lg" style={{background: 'rgba(92,214,133,0.1)', border: '1px solid rgba(92,214,133,0.3)'}}>
          <p style={{color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}>
            Test Created: {testCreated.test_id} — <Link to="/cat72" style={{color: styles.purpleBright}}>Go to CAT-72 Console</Link>
          </p>
        </div>
      )}
      
      <div>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Application {app.application_number}</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>{app.system_name}</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>{app.system_description}</p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Organization</h2>
          <p style={{color: styles.textPrimary, fontSize: '18px', marginBottom: '8px'}}>{app.organization_name}</p>
          <p style={{color: styles.textSecondary, marginBottom: '4px'}}><strong>Contact:</strong> {app.contact_name}</p>
          <p style={{color: styles.textSecondary, marginBottom: '4px'}}><strong>Email:</strong> {app.contact_email}</p>
          {app.contact_phone && <p style={{color: styles.textSecondary}}><strong>Phone:</strong> {app.contact_phone}</p>}
        </Panel>
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Status</h2>
          <div className="flex items-center gap-4 mb-4">
            <span className="px-3 py-1 rounded" style={{
              background: app.state === 'conformant' ? 'rgba(92,214,133,0.15)' : app.state === 'revoked' ? 'rgba(214,92,92,0.15)' : 'rgba(214,160,92,0.15)',
              color: app.state === 'conformant' ? styles.accentGreen : app.state === 'revoked' ? styles.accentRed : styles.accentAmber,
              fontFamily: "'IBM Plex Mono', monospace",
              fontSize: '12px',
              letterSpacing: '1px',
              textTransform: 'uppercase',
            }}>
              {app.state}
            </span>
            <select 
              value={app.state}
              onChange={async (e) => {
                const newState = e.target.value;
                if (!window.confirm(`Change status to ${newState.toUpperCase()}?`)) return;
                try {
                  await api.patch(`/api/applications/${id}/state?new_state=${newState}`);
                  setApp({...app, state: newState});
                } catch (err) {
                  alert('Failed to update state: ' + (err.response?.data?.detail || err.message));
                }
              }}
              className="px-3 py-2 rounded-lg"
              style={{background: 'rgba(255,255,255,0.05)', border: `1px solid ${styles.borderGlass}`, color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px'}}
            >
              <option value="pending">Pending</option>
              <option value="under_review">Under Review</option>
              <option value="approved">Approved (Agent Access)</option>
              <option value="testing">Testing (CAT-72 Active)</option>
              <option value="conformant">Conformant</option>
              <option value="revoked">Revoked</option>
            </select>
          </div>
          <p style={{color: styles.textSecondary}}><strong>Submitted:</strong> {app.submitted_at ? new Date(app.submitted_at).toLocaleString() : 'N/A'}</p>
        </Panel>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>System Details</h2>
          <p style={{color: styles.textSecondary, marginBottom: '8px'}}><strong>Version:</strong> {app.system_version || 'N/A'}</p>
          <p style={{color: styles.textSecondary, marginBottom: '8px'}}><strong>Manufacturer:</strong> {app.manufacturer || 'N/A'}</p>
          {app.facility_location && <p style={{color: styles.textSecondary, marginBottom: '8px'}}><strong>Facility:</strong> {app.facility_location}</p>}
          {app.preferred_test_date && <p style={{color: styles.textSecondary}}><strong>Preferred Test Date:</strong> {new Date(app.preferred_test_date).toLocaleDateString()}</p>}
        </Panel>
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Safety Boundaries & Operational Limits</h2>
          <p style={{color: styles.textSecondary, lineHeight: 1.7, whiteSpace: 'pre-wrap'}}>{typeof app.envelope_definition === 'object' ? JSON.stringify(app.envelope_definition, null, 2) : (app.envelope_definition || 'Not specified')}</p>
        </Panel>
      </div>

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>ODD Specification</h2>
        <p style={{color: styles.textSecondary, lineHeight: 1.7, whiteSpace: 'pre-wrap'}}>{typeof app.odd_specification === 'object' ? (app.odd_specification?.description || JSON.stringify(app.odd_specification, null, 2)) : app.odd_specification}</p>
      </Panel>

      {app.notes && (
        <Panel>
          <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Notes</h2>
          <p style={{color: styles.textSecondary, lineHeight: 1.7, whiteSpace: 'pre-wrap'}}>{app.notes}</p>
        </Panel>
      )}
    </div>
  );
}

// CAT-72 Console
function CAT72Console() {
  const [tests, setTests] = useState([]);
  const [loading, setLoading] = useState({});

  const loadTests = () => {
    api.get('/api/cat72/tests').then(res => setTests(res.data)).catch(console.error);
  };

  useEffect(() => {
    loadTests();
  }, []);

  const handleStart = async (testId) => {
    if (!window.confirm('Start this CAT-72 test? The 72-hour timer will begin.')) return;
    setLoading(prev => ({...prev, [testId]: 'starting'}));
    try {
      await api.post(`/api/cat72/tests/${testId}/start`);
      loadTests();
    } catch (err) {
      alert('Failed to start test: ' + (err.response?.data?.detail || err.message));
    }
    setLoading(prev => ({...prev, [testId]: null}));
  };

  const handleStop = async (testId) => {
    if (!window.confirm('Stop this CAT-72 test and evaluate results?')) return;
    setLoading(prev => ({...prev, [testId]: 'stopping'}));
    try {
      await api.post(`/api/cat72/tests/${testId}/stop`);
      loadTests();
    } catch (err) {
      alert('Failed to stop test: ' + (err.response?.data?.detail || err.message));
    }
    setLoading(prev => ({...prev, [testId]: null}));
  };

  const handleIssueCertificate = async (testId) => {
    if (!window.confirm('Issue ODDC certificate for this passed test?')) return;
    setLoading(prev => ({...prev, [testId]: 'issuing'}));
    try {
      const res = await api.post(`/api/certificates/issue/${testId}`);
      alert(`Certificate issued: ${res.data.certificate_number}\nVerification URL: ${res.data.verification_url}`);
      loadTests();
    } catch (err) {
      alert('Failed to issue certificate: ' + (err.response?.data?.detail || err.message));
    }
    setLoading(prev => ({...prev, [testId]: null}));
  };

  return (
    <div className="space-y-6">
      <div>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Testing</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>CAT-72 Console</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>72-hour Convergence Authorization Tests</p>
      </div>

      <Panel>
        <table className="w-full">
          <thead>
            <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Test ID</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>State</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Progress</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Result</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Actions</th>
            </tr>
          </thead>
          <tbody>
            {tests.map((test) => (
              <tr key={test.id} style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                <td className="px-4 py-4" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.purpleBright}}>{test.organization_name} - {test.system_name}</td>
                <td className="px-4 py-4">
                  <span className="px-2 py-1 rounded" style={{
                    background: test.state === 'running' ? 'rgba(214,160,92,0.15)' : test.state === 'completed' ? 'rgba(92,214,133,0.15)' : 'rgba(157,140,207,0.15)',
                    color: test.state === 'running' ? styles.accentAmber : test.state === 'completed' ? styles.accentGreen : styles.purpleBright,
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '10px',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                  }}>
                    {test.state}
                  </span>
                </td>
                <td className="px-4 py-4">
                  <div className="flex items-center gap-2">
                    <div className="w-24 h-1 rounded-full overflow-hidden" style={{background: 'rgba(255,255,255,0.1)'}}>
                      <div className="h-full rounded-full" style={{width: `${test.state === 'completed' ? 100 : (test.elapsed_seconds / (test.duration_hours * 3600)) * 100}%`, background: styles.purpleBright}} />
                    </div>
                    <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.textTertiary}}>
                      {test.state === 'completed' ? '100%' : `${Math.round((test.elapsed_seconds / (test.duration_hours * 3600)) * 100)}%`}
                    </span>
                  </div>
                </td>
                <td className="px-4 py-4">
                  {test.result && (
                    <span style={{
                      color: test.result === 'PASS' ? styles.accentGreen : styles.accentRed,
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '11px',
                      fontWeight: 500,
                    }}>
                      {test.result}
                    </span>
                  )}
                </td>
                <td className="px-4 py-4">
                  <div className="flex gap-2">
                    {test.state === 'scheduled' && (
                      <button
                        onClick={() => handleStart(test.test_id)}
                        disabled={loading[test.test_id]}
                        className="px-3 py-1 rounded transition-colors"
                        style={{background: 'rgba(92,214,133,0.15)', border: '1px solid rgba(92,214,133,0.3)', color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer'}}
                      >
                        {loading[test.test_id] === 'starting' ? '...' : 'Start'}
                      </button>
                    )}
                    {test.state === 'running' && (
                      <button
                        onClick={() => handleStop(test.test_id)}
                        disabled={loading[test.test_id]}
                        className="px-3 py-1 rounded transition-colors"
                        style={{background: 'rgba(214,160,92,0.15)', border: '1px solid rgba(214,160,92,0.3)', color: styles.accentAmber, fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer'}}
                      >
                        {loading[test.test_id] === 'stopping' ? '...' : 'Stop & Evaluate'}
                      </button>
                    )}
                    {test.state === 'completed' && test.result === 'PASS' && !test.certificate_issued && (
                      <button
                        onClick={() => handleIssueCertificate(test.test_id)}
                        disabled={loading[test.test_id]}
                        className="px-3 py-1 rounded transition-colors"
                        style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer'}}
                      >
                        {loading[test.test_id] === 'issuing' ? '...' : 'Issue Certificate'}
                      </button>
                    )}
                    {test.certificate_issued && (
                      <><span style={{color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px'}}>✓ Certified</span><a href={`${API_BASE}/api/applications/${test.application_id}/certificate/download`} target="_blank" style={{marginLeft: '8px', padding: '2px 8px', background: styles.purplePrimary, borderRadius: '4px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', textDecoration: 'none'}}>Download PDF</a></>
                    )}
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        {tests.length === 0 && (
          <div className="text-center py-12" style={{color: styles.textTertiary}}>No tests yet</div>
        )}
      </Panel>
    </div>
  );
}

// Certificates
function CertificatesPage() {
  const [certificates, setCertificates] = useState([]);

  useEffect(() => {
    api.get('/api/certificates/').then(res => setCertificates(res.data)).catch(console.error);
  }, []);

  return (
    <div className="space-y-6">
      <div>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Records</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>Certificates</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>Issued ODDC conformance determinations</p>
      </div>

      <Panel>
        <table className="w-full">
          <thead>
            <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Certificate #</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>System</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Organization</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Status</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Expires</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Actions</th>
            </tr>
          </thead>
          <tbody>
            {certificates.map((cert) => (
              <tr key={cert.id} style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                <td className="px-4 py-4" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.purpleBright}}>{cert.certificate_number}</td>
                <td className="px-4 py-4" style={{color: styles.textPrimary}}>{cert.system_name}</td>
                <td className="px-4 py-4" style={{color: styles.textSecondary}}>{cert.organization_name}</td>
                <td className="px-4 py-4">
                  <span className="px-2 py-1 rounded" style={{
                    background: cert.state === 'conformant' ? 'rgba(92,214,133,0.15)' : cert.state === 'suspended' ? 'rgba(214,160,92,0.15)' : 'rgba(214,92,92,0.15)',
                    color: cert.state === 'conformant' ? styles.accentGreen : cert.state === 'suspended' ? styles.accentAmber : styles.accentRed,
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '10px',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                  }}>
                    {cert.state}
                  </span>
                </td>
                <td className="px-4 py-4" style={{color: styles.textTertiary, fontSize: '14px'}}>{cert.expires_at ? new Date(cert.expires_at).toLocaleDateString() : '-'}</td>
                <td className="px-4 py-4">
                  <a 
                    href={`https://sentinel-authority-production.up.railway.app/api/certificates/${cert.certificate_number}/pdf`} 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    className="px-3 py-1 rounded transition-colors no-underline"
                    style={{background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase'}}
                  >
                    Download PDF
                  </a>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        {certificates.length === 0 && (
          <div className="text-center py-12" style={{color: styles.textTertiary}}>No certificates issued</div>
        )}
      </Panel>
    </div>
  );
}

// Licensees
function LicenseesPage() {
  const [licensees, setLicensees] = useState([]);

  useEffect(() => {
    api.get('/api/licensees/').then(res => setLicensees(res.data)).catch(console.error);
  }, []);

  return (
    <div className="space-y-6">
      <div>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Partners</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>Licensed Implementers</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>Authorized ENVELO integrators</p>
      </div>

      <Panel>
        <table className="w-full">
          <thead>
            <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Company</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Contact</th>
              <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Status</th>
            </tr>
          </thead>
          <tbody>
            {licensees.map((lic) => (
              <tr key={lic.id} style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                <td className="px-4 py-4" style={{color: styles.textPrimary}}>{lic.company_name}</td>
                <td className="px-4 py-4" style={{color: styles.textSecondary}}>{lic.contact_email}</td>
                <td className="px-4 py-4">
                  <span className="px-2 py-1 rounded" style={{
                    background: lic.status === 'active' ? 'rgba(92,214,133,0.15)' : 'rgba(214,160,92,0.15)',
                    color: lic.status === 'active' ? styles.accentGreen : styles.accentAmber,
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '10px',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                  }}>
                    {lic.status}
                  </span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        {licensees.length === 0 && (
          <div className="text-center py-12" style={{color: styles.textTertiary}}>No licensees yet</div>
        )}
      </Panel>
    </div>
  );
}

// Verify Page (Public)
function VerifyPage() {
  const [certNumber, setCertNumber] = useState('');
  const [result, setResult] = useState(null);
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleVerify = async (e) => {
    e.preventDefault();
    if (!certNumber.trim()) return;
    setError('');
    setResult(null);
    setLoading(true);
    try {
      const res = await api.get(`/api/verify/${certNumber}`);
      setResult(res.data);
    } catch (err) {
      setError('Certificate not found');
    }
    setLoading(false);
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden" style={{background: styles.bgDeep}}>
      {/* Animated background gradients */}
      <div style={{
        position: 'absolute', top: '-20%', left: '-10%', width: '600px', height: '600px',
        background: 'radial-gradient(circle, rgba(91,75,138,0.3) 0%, transparent 70%)',
        animation: 'float1 15s ease-in-out infinite', pointerEvents: 'none',
      }} />
      <div style={{
        position: 'absolute', bottom: '-30%', right: '-15%', width: '800px', height: '800px',
        background: 'radial-gradient(circle, rgba(92,214,133,0.15) 0%, transparent 70%)',
        animation: 'float2 20s ease-in-out infinite', pointerEvents: 'none',
      }} />
      <div style={{
        position: 'absolute', top: '40%', right: '10%', width: '400px', height: '400px',
        background: 'radial-gradient(circle, rgba(157,140,207,0.2) 0%, transparent 70%)',
        animation: 'float3 12s ease-in-out infinite', pointerEvents: 'none',
      }} />
      
      {/* Grid overlay */}
      <div style={{
        position: 'fixed', inset: 0,
        backgroundImage: 'linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)',
        backgroundSize: '60px 60px', opacity: 0.5, pointerEvents: 'none',
      }} />

      {/* Decorative elements */}
      <div style={{ position: 'absolute', top: '15%', left: '8%', width: '1px', height: '150px',
        background: 'linear-gradient(to bottom, transparent, rgba(157,140,207,0.4), transparent)',
      }} />
      <div style={{ position: 'absolute', bottom: '20%', right: '5%', width: '100px', height: '1px',
        background: 'linear-gradient(to right, transparent, rgba(92,214,133,0.4), transparent)',
      }} />

      <style>{`
        @keyframes float1 { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(30px, -30px) scale(1.05); } 66% { transform: translate(-20px, 20px) scale(0.95); } }
        @keyframes float2 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-40px, -40px) scale(1.1); } }
        @keyframes float3 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(20px, 30px); } }
        @keyframes pulse-ring { 0% { transform: scale(0.9); opacity: 0.6; } 50% { transform: scale(1.1); opacity: 0; } 100% { transform: scale(0.9); opacity: 0.6; } }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        .verify-input { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .verify-input:focus { border-color: rgba(157,140,207,0.6) !important; box-shadow: 0 0 0 3px rgba(157,140,207,0.1), 0 4px 20px rgba(0,0,0,0.2); transform: translateY(-1px); }
        .verify-btn { position: relative; overflow: hidden; transition: all 0.3s ease; }
        .verify-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(91,75,138,0.5); }
        .verify-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
      `}</style>

      <div className="w-full max-w-lg relative z-10">
        {/* Brand section */}
        <div className="text-center mb-10">
          <div className="relative flex justify-center mb-6" style={{height: '100px', alignItems: 'center'}}>
            <div style={{
              position: 'absolute', width: '80px', height: '80px',
              border: '1px solid rgba(92,214,133,0.3)', borderRadius: '50%',
              animation: 'pulse-ring 3s ease-out infinite',
            }} />
            <div style={{
              position: 'absolute', width: '100px', height: '100px',
              border: '1px solid rgba(92,214,133,0.15)', borderRadius: '50%',
              animation: 'pulse-ring 3s ease-out infinite 0.5s',
            }} />
            <div style={{
              width: '56px', height: '56px',
              background: 'linear-gradient(135deg, #3a7d54 0%, #5CD685 100%)',
              border: '2px solid #5CD685', borderRadius: '14px',
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              boxShadow: '0 8px 32px rgba(92,214,133,0.4), inset 0 1px 0 rgba(255,255,255,0.2)',
            }}>
              <div style={{
                width: '18px', height: '18px',
                background: 'radial-gradient(circle, #e8e0ff 0%, #c4b8e8 100%)',
                borderRadius: '50%', boxShadow: '0 0 20px rgba(196,184,232,0.5)',
              }} />
            </div>
          </div>
          
          <h1 style={{
            fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200,
            color: styles.textPrimary, margin: '0 0 8px 0', letterSpacing: '-0.02em',
          }}>
            Certificate <span style={{color: styles.purpleBright, fontStyle: 'italic'}}>Verification</span>
          </h1>
          
          <p style={{
            color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace",
            fontSize: '11px', letterSpacing: '3px', textTransform: 'uppercase', marginTop: '16px',
          }}>Sentinel Authority • ODDC Registry</p>
        </div>
        
        {/* Verification card */}
        <div style={{
          background: 'rgba(255,255,255,0.03)', backdropFilter: 'blur(20px)',
          border: '1px solid rgba(255,255,255,0.08)', borderRadius: '24px', padding: '40px',
          boxShadow: '0 25px 50px -12px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05) inset',
        }}>
          <form onSubmit={handleVerify} className="space-y-6">
            <div>
              <label style={{
                display: 'block', marginBottom: '10px', color: styles.textTertiary,
                fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px',
                letterSpacing: '2px', textTransform: 'uppercase', textAlign: 'center',
              }}>Certificate Number</label>
              <input
                type="text"
                placeholder="ODDC-2026-00001"
                value={certNumber}
                onChange={(e) => setCertNumber(e.target.value.toUpperCase())}
                className="verify-input w-full px-5 py-4 rounded-xl outline-none"
                style={{
                  background: 'rgba(0,0,0,0.2)', border: '1px solid rgba(255,255,255,0.08)',
                  color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '18px', textAlign: 'center', letterSpacing: '2px',
                }}
              />
            </div>
            <button 
              type="submit" 
              disabled={loading || !certNumber.trim()}
              className="verify-btn w-full py-4 rounded-xl font-medium"
              style={{
                background: 'linear-gradient(135deg, #5B4B8A 0%, #7B6BAA 100%)',
                border: '1px solid rgba(157,140,207,0.5)', color: '#fff',
                fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px',
                letterSpacing: '2px', textTransform: 'uppercase', cursor: 'pointer',
                boxShadow: '0 4px 20px rgba(91,75,138,0.4)',
                display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px',
              }}>
              {loading ? (
                <><RefreshCw className="w-4 h-4" style={{animation: 'spin 1s linear infinite'}} /> Verifying...</>
              ) : (
                <><Search className="w-4 h-4" /> Verify Certificate</>
              )}
            </button>
          </form>

          {error && (
            <div className="mt-6 p-5 rounded-xl text-center" style={{
              background: 'rgba(214,92,92,0.1)', border: '1px solid rgba(214,92,92,0.3)',
            }}>
              <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px', marginBottom: '8px'}}>
                <AlertTriangle className="w-5 h-5" style={{color: styles.accentRed}} />
                <span style={{color: styles.accentRed, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase'}}>Not Found</span>
              </div>
              <p style={{color: styles.textSecondary, fontSize: '14px'}}>No certificate exists with this number</p>
            </div>
          )}

          {result && (result.status === 'NOT_FOUND' || result.state === 'NOT_FOUND') && (
            <div className="mt-6 p-5 rounded-xl text-center" style={{
              background: 'rgba(214,92,92,0.1)', border: '1px solid rgba(214,92,92,0.3)',
            }}>
              <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px', marginBottom: '8px'}}>
                <AlertTriangle className="w-5 h-5" style={{color: styles.accentRed}} />
                <span style={{color: styles.accentRed, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase'}}>Certificate Not Found</span>
              </div>
              <p style={{color: styles.textSecondary, fontSize: '14px'}}>No certificate exists with number: <strong>{result.certificate_number}</strong></p>
            </div>
          )}

          {result && result.status !== 'NOT_FOUND' && result.state !== 'NOT_FOUND' && (
            <div className="mt-6 rounded-xl overflow-hidden" style={{
              background: 'rgba(92,214,133,0.08)', border: '1px solid rgba(92,214,133,0.25)',
            }}>
              {/* Header */}
              <div style={{
                padding: '16px 20px', background: 'rgba(92,214,133,0.15)',
                borderBottom: '1px solid rgba(92,214,133,0.2)',
                display: 'flex', alignItems: 'center', justifyContent: 'space-between',
              }}>
                <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                  <CheckCircle className="w-5 h-5" style={{color: styles.accentGreen}} />
                  <span style={{color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', fontWeight: 500}}>Valid Certificate</span>
                </div>
                <span style={{
                  padding: '4px 12px', borderRadius: '20px', fontSize: '10px',
                  background: 'rgba(92,214,133,0.2)', color: styles.accentGreen,
                  fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px',
                  display: 'flex', alignItems: 'center', gap: '6px',
                }}>
                  <span style={{width: '6px', height: '6px', borderRadius: '50%', background: styles.accentGreen, boxShadow: '0 0 8px rgba(92,214,133,0.8)'}}></span>
                  {result.state || 'CONFORMANT'}
                </span>
              </div>
              
              {/* Details */}
              <div style={{padding: '20px'}}>
                <div style={{display: 'grid', gap: '16px'}}>
                  <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingBottom: '12px', borderBottom: '1px solid rgba(255,255,255,0.06)'}}>
                    <span style={{color: styles.textTertiary, fontSize: '12px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px'}}>Certificate</span>
                    <span style={{color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", fontSize: '14px', fontWeight: 500}}>{result.certificate_number}</span>
                  </div>
                  <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingBottom: '12px', borderBottom: '1px solid rgba(255,255,255,0.06)'}}>
                    <span style={{color: styles.textTertiary, fontSize: '12px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px'}}>Organization</span>
                    <span style={{color: styles.textPrimary, fontSize: '14px'}}>{result.organization_name}</span>
                  </div>
                  <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingBottom: '12px', borderBottom: '1px solid rgba(255,255,255,0.06)'}}>
                    <span style={{color: styles.textTertiary, fontSize: '12px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px'}}>System</span>
                    <span style={{color: styles.textPrimary, fontSize: '14px'}}>{result.system_name}</span>
                  </div>
                  <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                    <span style={{color: styles.textTertiary, fontSize: '12px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px'}}>Expires</span>
                    <span style={{color: styles.textPrimary, fontSize: '14px'}}>{result.expires_at ? new Date(result.expires_at).toLocaleDateString() : 'N/A'}</span>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
        
        {/* Footer links */}
        <div className="mt-8 text-center" style={{display: 'flex', justifyContent: 'center', gap: '24px', flexWrap: 'wrap'}}>
          <Link to="/login" style={{
            color: styles.purpleBright, fontFamily: "'IBM Plex Mono', monospace",
            fontSize: '11px', letterSpacing: '1px', textDecoration: 'none',
            padding: '10px 20px', border: '1px solid rgba(157,140,207,0.2)',
            borderRadius: '20px', transition: 'all 0.3s ease',
          }}>← Sign In</Link>
          <a href="https://sentinelauthority.org" style={{
            color: styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace",
            fontSize: '11px', letterSpacing: '1px', textDecoration: 'none',
            padding: '10px 20px', border: '1px solid rgba(255,255,255,0.1)',
            borderRadius: '20px', transition: 'all 0.3s ease',
          }}>Main Site →</a>
        </div>
        
        <div className="mt-6 text-center">
          <p style={{
            color: styles.textTertiary, fontSize: '10px',
            fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '1px',
          }}>
            Powered by ENVELO • <a href="https://sentinelauthority.org/privacy.html" style={{color: styles.purpleBright, textDecoration: 'none'}}>Privacy</a>
          </p>
        </div>
      </div>
    </div>
  );
}





// Web-based Agent Simulator
function AgentSimulator({ apiKey }) {
  const [running, setRunning] = useState(false);
  const [logs, setLogs] = useState([]);
  const [stats, setStats] = useState({ pass: 0, block: 0 });

  const addLog = (msg, type = 'info') => {
    setLogs(prev => [...prev, { msg, type, time: new Date().toLocaleTimeString() }]);
  };

  const runSimulation = async () => {
    if (!apiKey) {
      alert('Generate an API key first');
      return;
    }
    
    setRunning(true);
    setLogs([]);
    setStats({ pass: 0, block: 0 });
    
    const sessionId = Math.random().toString(36).substring(2, 18);
    const certId = 'ODDC-2026-DEMO';
    
    addLog('ENVELO Agent starting...', 'info');
    addLog(`Session: ${sessionId}`, 'info');
    addLog('', 'info');
    
    // Register session
    addLog('Registering session...', 'info');
    try {
      await api.post('/api/envelo/sessions', {
        certificate_id: certId,
        session_id: sessionId,
        started_at: new Date().toISOString(),
        agent_version: '1.0.0-web',
        boundaries: [
          { name: 'speed', min: 0, max: 100 },
          { name: 'temperature', min: -20, max: 50 }
        ]
      }, { headers: { Authorization: `Bearer ${apiKey}` }});
      addLog('✓ Session registered', 'success');
    } catch (e) {
      addLog('✓ Session registered (simulated)', 'success');
    }
    
    addLog('', 'info');
    addLog('Boundaries defined:', 'info');
    addLog('  • speed: 0-100 km/h', 'info');
    addLog('  • temperature: -20 to 50°C', 'info');
    addLog('', 'info');
    
    // Simulate actions
    const testCases = [
      { speed: 50, temperature: 25, shouldPass: true, desc: 'Normal operation' },
      { speed: 80, temperature: 30, shouldPass: true, desc: 'Highway speed' },
      { speed: 150, temperature: 25, shouldPass: false, desc: 'Speed violation' },
      { speed: 60, temperature: 60, shouldPass: false, desc: 'Temperature violation' },
      { speed: 40, temperature: 20, shouldPass: true, desc: 'City driving' },
    ];
    
    const records = [];
    let passCount = 0;
    let blockCount = 0;
    
    for (let i = 0; i < testCases.length; i++) {
      await new Promise(r => setTimeout(r, 800));
      const tc = testCases[i];
      const result = tc.shouldPass ? 'PASS' : 'BLOCK';
      
      if (tc.shouldPass) {
        passCount++;
        addLog(`Action ${i+1}: ${tc.desc}`, 'info');
        addLog(`  speed=${tc.speed}, temp=${tc.temperature}`, 'info');
        addLog(`  ✓ PASSED`, 'success');
      } else {
        blockCount++;
        addLog(`Action ${i+1}: ${tc.desc}`, 'info');
        addLog(`  speed=${tc.speed}, temp=${tc.temperature}`, 'info');
        addLog(`  ✗ BLOCKED - Outside ODD boundaries`, 'error');
      }
      
      setStats({ pass: passCount, block: blockCount });
      
      records.push({
        timestamp: new Date().toISOString(),
        action_id: Math.random().toString(36).substring(2, 10),
        action_type: 'autonomous_action',
        result,
        execution_time_ms: Math.random() * 5,
        parameters: { speed: tc.speed, temperature: tc.temperature },
        boundary_evaluations: [
          { boundary: 'speed', passed: tc.speed <= 100 },
          { boundary: 'temperature', passed: tc.temperature <= 50 }
        ]
      });
    }
    
    addLog('', 'info');
    addLog('Sending telemetry...', 'info');
    
    // Send telemetry
    try {
      await api.post('/api/envelo/telemetry', {
        certificate_id: certId,
        session_id: sessionId,
        records,
        stats: { pass_count: passCount, block_count: blockCount }
      }, { headers: { Authorization: `Bearer ${apiKey}` }});
      addLog(`✓ Sent ${records.length} records`, 'success');
    } catch (e) {
      addLog(`✓ Sent ${records.length} records (simulated)`, 'success');
    }
    
    // End session
    try {
      await api.post(`/api/envelo/sessions/${sessionId}/end`, {
        ended_at: new Date().toISOString(),
        final_stats: { pass_count: passCount, block_count: blockCount }
      }, { headers: { Authorization: `Bearer ${apiKey}` }});
    } catch (e) {}
    
    addLog('', 'info');
    addLog('═══════════════════════════════════════', 'info');
    addLog(`Session complete: ${passCount} passed, ${blockCount} blocked`, 'success');
    addLog('Telemetry visible in dashboard below ↓', 'info');
    
    setRunning(false);
  };

  return (
    <div>
      <div style={{display: 'flex', gap: '16px', alignItems: 'center', marginBottom: '16px'}}>
        <button
          onClick={runSimulation}
          disabled={running || !apiKey}
          style={{
            padding: '12px 24px',
            background: running ? 'rgba(0,0,0,0.3)' : styles.accentGreen,
            border: 'none',
            borderRadius: '6px',
            color: running ? styles.textTertiary : '#000',
            fontFamily: "'IBM Plex Mono', monospace",
            fontSize: '12px',
            fontWeight: 600,
            cursor: running || !apiKey ? 'not-allowed' : 'pointer',
            display: 'flex',
            alignItems: 'center',
            gap: '8px'
          }}
        >
          {running ? '⟳ Running...' : '▶ Run Test Simulation'}
        </button>
        {!apiKey && <span style={{color: styles.textTertiary, fontSize: '12px'}}>Generate an API key first</span>}
      </div>
      
      {stats.pass + stats.block > 0 && (
        <div style={{display: 'flex', gap: '24px', marginBottom: '16px'}}>
          <div style={{padding: '12px 20px', background: 'rgba(92,214,133,0.1)', border: '1px solid rgba(92,214,133,0.3)', borderRadius: '6px'}}>
            <div style={{fontSize: '24px', fontWeight: 700, color: styles.accentGreen}}>{stats.pass}</div>
            <div style={{fontSize: '11px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px'}}>Passed</div>
          </div>
          <div style={{padding: '12px 20px', background: 'rgba(214,92,92,0.1)', border: '1px solid rgba(214,92,92,0.3)', borderRadius: '6px'}}>
            <div style={{fontSize: '24px', fontWeight: 700, color: '#D65C5C'}}>{stats.block}</div>
            <div style={{fontSize: '11px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px'}}>Blocked</div>
          </div>
        </div>
      )}
      
      {logs.length > 0 && (
        <div style={{
          background: 'rgba(0,0,0,0.4)',
          border: `1px solid ${styles.borderGlass}`,
          borderRadius: '8px',
          padding: '16px',
          maxHeight: '300px',
          overflowY: 'auto',
          fontFamily: "'IBM Plex Mono', monospace",
          fontSize: '12px'
        }}>
          {logs.map((log, i) => (
            <div key={i} style={{
              color: log.type === 'success' ? styles.accentGreen : log.type === 'error' ? '#D65C5C' : styles.textSecondary,
              marginBottom: '4px'
            }}>
              {log.msg}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// API Key Manager Component

function SessionReport({ session }) {
  if (!session) return null;
  const passRate = session.pass_count + session.block_count > 0 
    ? ((session.pass_count / (session.pass_count + session.block_count)) * 100).toFixed(1)
    : 0;
  return (
    <div>
      <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginBottom: '24px'}}>
        <div style={{padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', textAlign: 'center'}}>
          <div style={{fontSize: '28px', fontWeight: 700, color: '#fff'}}>{(session.pass_count || 0) + (session.block_count || 0)}</div>
          <div style={{fontSize: '11px', color: '#888', textTransform: 'uppercase'}}>Total Actions</div>
        </div>
        <div style={{padding: '16px', background: 'rgba(92,214,133,0.1)', borderRadius: '8px', textAlign: 'center'}}>
          <div style={{fontSize: '28px', fontWeight: 700, color: '#5CD685'}}>{session.pass_count || 0}</div>
          <div style={{fontSize: '11px', color: '#888', textTransform: 'uppercase'}}>Passed</div>
        </div>
        <div style={{padding: '16px', background: 'rgba(214,92,92,0.1)', borderRadius: '8px', textAlign: 'center'}}>
          <div style={{fontSize: '28px', fontWeight: 700, color: '#D65C5C'}}>{session.block_count || 0}</div>
          <div style={{fontSize: '11px', color: '#888', textTransform: 'uppercase'}}>Blocked</div>
        </div>
        <div style={{padding: '16px', background: passRate >= 95 ? 'rgba(92,214,133,0.1)' : 'rgba(214,92,92,0.1)', borderRadius: '8px', textAlign: 'center'}}>
          <div style={{fontSize: '28px', fontWeight: 700, color: passRate >= 95 ? '#5CD685' : '#D65C5C'}}>{passRate}%</div>
          <div style={{fontSize: '11px', color: '#888', textTransform: 'uppercase'}}>Pass Rate</div>
        </div>
      </div>
      <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px'}}>
        <div><div style={{fontSize: '11px', color: '#888', marginBottom: '4px'}}>SESSION ID</div><div style={{fontFamily: 'monospace', color: '#ccc'}}>{session.session_id}</div></div>
        <div><div style={{fontSize: '11px', color: '#888', marginBottom: '4px'}}>CERTIFICATE</div><div style={{color: '#ccc'}}>{session.certificate_id || 'N/A'}</div></div>
        <div><div style={{fontSize: '11px', color: '#888', marginBottom: '4px'}}>STARTED</div><div style={{color: '#ccc'}}>{session.started_at ? new Date(session.started_at).toLocaleString() : 'N/A'}</div></div>
        <div><div style={{fontSize: '11px', color: '#888', marginBottom: '4px'}}>STATUS</div><span style={{padding: '4px 12px', borderRadius: '4px', fontSize: '12px', background: session.status === 'active' ? 'rgba(92,214,133,0.2)' : 'rgba(255,255,255,0.1)', color: session.status === 'active' ? '#5CD685' : '#888'}}>{session.status?.toUpperCase()}</span></div>
      </div>
    </div>
  );
}

function TelemetryLog({ sessionId }) {
  const [records, setRecords] = useState([]);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    if (sessionId) {
      api.get(`/api/envelo/admin/sessions/${sessionId}/telemetry`)
        .then(res => setRecords(res.data.records || []))
        .catch(console.error)
        .finally(() => setLoading(false));
    }
  }, [sessionId]);
  if (loading) return <div style={{color: '#888', padding: '12px'}}>Loading...</div>;
  if (!records.length) return <div style={{color: '#888', padding: '12px'}}>No telemetry records</div>;
  return (
    <div style={{maxHeight: '300px', overflowY: 'auto'}}>
      <table style={{width: '100%', borderCollapse: 'collapse', fontSize: '12px'}}>
        <thead><tr style={{borderBottom: '1px solid rgba(255,255,255,0.1)'}}><th style={{padding: '8px', textAlign: 'left', color: '#888'}}>Time</th><th style={{padding: '8px', textAlign: 'left', color: '#888'}}>Action</th><th style={{padding: '8px', textAlign: 'left', color: '#888'}}>Result</th><th style={{padding: '8px', textAlign: 'left', color: '#888'}}>Params</th></tr></thead>
        <tbody>{records.map((r, i) => (<tr key={i} style={{borderBottom: '1px solid rgba(255,255,255,0.05)'}}><td style={{padding: '8px', fontFamily: 'monospace', fontSize: '11px', color: '#aaa'}}>{r.timestamp ? new Date(r.timestamp).toLocaleTimeString() : '-'}</td><td style={{padding: '8px', color: '#fff'}}>{r.action_type}</td><td style={{padding: '8px'}}><span style={{padding: '2px 8px', borderRadius: '4px', fontSize: '10px', fontWeight: 600, background: r.result === 'PASS' ? 'rgba(92,214,133,0.2)' : 'rgba(214,92,92,0.2)', color: r.result === 'PASS' ? '#5CD685' : '#D65C5C'}}>{r.result}</span></td><td style={{padding: '8px', color: '#666', fontFamily: 'monospace', fontSize: '10px'}}>{JSON.stringify(r.parameters || {})}</td></tr>))}</tbody>
      </table>
    </div>
  );
}

function APIKeyManager({ onKeyGenerated }) {
  const [keys, setKeys] = useState([]);
  const [loading, setLoading] = useState(true);
  const [newKeyName, setNewKeyName] = useState('');
  const [generatedKey, setGeneratedKey] = useState(null);
  
  useEffect(() => {
    if (generatedKey?.key) {
      onKeyGenerated?.(generatedKey.key);
    }
  }, [generatedKey]);

  useEffect(() => {
    loadKeys();
  }, []);

  const downloadConfiguredAgent = (apiKey) => {
    // Create a configured Python script
    const configScript = `#!/usr/bin/env python3
"""
ENVELO Agent - Pre-configured for your system
Sentinel Authority - https://sentinelauthority.org

QUICK START:
1. Install dependencies: pip install httpx
2. Run this file: python envelo_agent.py
3. Check your dashboard: https://app.sentinelauthority.org/envelo
"""

import os
import sys
import time
import json
import uuid
import httpx
from datetime import datetime
from functools import wraps

# ═══════════════════════════════════════════════════════════════════
# YOUR CREDENTIALS (pre-configured)
# ═══════════════════════════════════════════════════════════════════
CERTIFICATE_ID = "ODDC-2026-PENDING"
API_KEY = "${apiKey}"
API_ENDPOINT = "https://sentinel-authority-production.up.railway.app"

# ═══════════════════════════════════════════════════════════════════
# ENVELO AGENT
# ═══════════════════════════════════════════════════════════════════

class NumericBoundary:
    def __init__(self, name, min=None, max=None, unit=""):
        self.name = name
        self.min = min
        self.max = max
        self.unit = unit
    
    def check(self, value):
        if self.min is not None and value < self.min:
            return False, f"{self.name} ({value}) below minimum ({self.min})"
        if self.max is not None and value > self.max:
            return False, f"{self.name} ({value}) above maximum ({self.max})"
        return True, None

class EnveloAgent:
    def __init__(self):
        self.boundaries = []
        self.session_id = uuid.uuid4().hex[:16]
        self.telemetry = []
        self.pass_count = 0
        self.block_count = 0
        self._register_session()
    
    def _register_session(self):
        try:
            httpx.post(
                f"{API_ENDPOINT}/api/envelo/sessions",
                json={
                    "certificate_id": CERTIFICATE_ID,
                    "session_id": self.session_id,
                    "started_at": datetime.utcnow().isoformat() + "Z",
                    "agent_version": "1.0.0",
                    "boundaries": [{"name": b.name} for b in self.boundaries]
                },
                headers={"Authorization": f"Bearer {API_KEY}"},
                timeout=10
            )
            print(f"✓ Session registered: {self.session_id}")
        except Exception as e:
            print(f"⚠ Could not register session: {e}")
    
    def add_boundary(self, boundary):
        self.boundaries.append(boundary)
        print(f"  + Boundary: {boundary.name} ({boundary.min} to {boundary.max} {boundary.unit})")
    
    def enforce(self, func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            start = time.time()
            action_id = uuid.uuid4().hex[:8]
            
            # Check all boundaries
            violations = []
            for boundary in self.boundaries:
                if boundary.name in kwargs:
                    passed, msg = boundary.check(kwargs[boundary.name])
                    if not passed:
                        violations.append({"boundary": boundary.name, "message": msg})
            
            result = "PASS" if not violations else "BLOCK"
            exec_time = (time.time() - start) * 1000
            
            # Record telemetry
            record = {
                "timestamp": datetime.utcnow().isoformat() + "Z",
                "action_id": action_id,
                "action_type": func.__name__,
                "result": result,
                "execution_time_ms": exec_time,
                "parameters": kwargs,
                "boundary_evaluations": [{"boundary": b.name, "passed": b.name not in [v["boundary"] for v in violations]} for b in self.boundaries]
            }
            self.telemetry.append(record)
            
            if result == "PASS":
                self.pass_count += 1
                return func(*args, **kwargs)
            else:
                self.block_count += 1
                raise Exception(f"ENVELO BLOCK: {violations[0]['message']}")
        
        return wrapper
    
    def send_telemetry(self):
        if not self.telemetry:
            return
        try:
            httpx.post(
                f"{API_ENDPOINT}/api/envelo/telemetry",
                json={
                    "certificate_id": CERTIFICATE_ID,
                    "session_id": self.session_id,
                    "records": self.telemetry,
                    "stats": {"pass_count": self.pass_count, "block_count": self.block_count}
                },
                headers={"Authorization": f"Bearer {API_KEY}"},
                timeout=10
            )
            print(f"✓ Sent {len(self.telemetry)} telemetry records")
            self.telemetry = []
        except Exception as e:
            print(f"⚠ Could not send telemetry: {e}")
    
    def shutdown(self):
        self.send_telemetry()
        try:
            httpx.post(
                f"{API_ENDPOINT}/api/envelo/sessions/{self.session_id}/end",
                json={
                    "ended_at": datetime.utcnow().isoformat() + "Z",
                    "final_stats": {"pass_count": self.pass_count, "block_count": self.block_count}
                },
                headers={"Authorization": f"Bearer {API_KEY}"},
                timeout=10
            )
            print(f"✓ Session ended")
        except Exception as e:
            print(f"⚠ Could not end session: {e}")

# ═══════════════════════════════════════════════════════════════════
# EXAMPLE USAGE - MODIFY FOR YOUR SYSTEM
# ═══════════════════════════════════════════════════════════════════

if __name__ == "__main__":
    print("")
    print("╔═══════════════════════════════════════════════════════════╗")
    print("║           ENVELO Agent - Sentinel Authority               ║")
    print("╚═══════════════════════════════════════════════════════════╝")
    print("")
    print(f"Certificate: {CERTIFICATE_ID}")
    print(f"API Key:     {API_KEY[:12]}...")
    print("")
    
    # Initialize agent
    agent = EnveloAgent()
    print("")
    
    # Define YOUR boundaries (modify these for your system)
    print("Defining ODD boundaries:")
    agent.add_boundary(NumericBoundary("speed", min=0, max=100, unit="km/h"))
    agent.add_boundary(NumericBoundary("temperature", min=-20, max=50, unit="celsius"))
    print("")
    
    # Example protected function (replace with your actual function)
    @agent.enforce
    def autonomous_action(speed, temperature):
        print(f"    Executing action: speed={speed}, temp={temperature}")
        return True
    
    # Test 1: Within boundaries (should PASS)
    print("─" * 50)
    print("Test 1: speed=50, temperature=25 (within bounds)")
    try:
        autonomous_action(speed=50, temperature=25)
        print("    ✓ PASSED - Action executed")
    except Exception as e:
        print(f"    ✗ BLOCKED - {e}")
    print("")
    
    # Test 2: Outside boundaries (should BLOCK)
    print("Test 2: speed=150, temperature=25 (speed exceeds limit)")
    try:
        autonomous_action(speed=150, temperature=25)
        print("    ✓ PASSED - Action executed")
    except Exception as e:
        print(f"    ✗ BLOCKED - {e}")
    print("")
    
    # Send telemetry and shutdown
    print("─" * 50)
    agent.shutdown()
    print("")
    print("═" * 50)
    print("Check your dashboard: https://app.sentinelauthority.org/envelo")
    print("═" * 50)
    print("")
`;
    
    // Create and download the file
    const blob = new Blob([configScript], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `envelo_agent_${cert.certificate_number}.py`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  const loadKeys = async () => {
    try {
      const res = await api.get('/api/apikeys/');
      setKeys(res.data);
    } catch (err) {
      console.error('Failed to load API keys:', err);
    }
    setLoading(false);
  };

  const generateKey = async () => {
    if (!newKeyName.trim()) return;
    try {
      const res = await api.post('/api/apikeys/generate', { name: newKeyName });
      setGeneratedKey(res.data);
      setNewKeyName('');
      loadKeys();
    } catch (err) {
      console.error('Failed to generate key:', err);
    }
  };

  const revokeKey = async (keyId) => {
    if (!window.confirm('Revoke this API key? This cannot be undone.')) return;
    try {
     await api.delete(`/api/apikeys/${keyId}`);
      loadKeys();
    } catch (err) {
      console.error('Failed to revoke key:', err);
    }
  };

  const copyKey = () => {
    if (generatedKey?.key) {
      navigator.clipboard.writeText(generatedKey.key);
    }
  };

  if (loading) return <div style={{color: styles.textTertiary}}>Loading...</div>;

  return (
    <div>
      {generatedKey && (
        <div style={{background: 'rgba(92,214,133,0.1)', border: '1px solid rgba(92,214,133,0.3)', borderRadius: '8px', padding: '16px', marginBottom: '20px'}}>
          <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.accentGreen, marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '1px'}}>✓ New API Key Generated</div>
          <div style={{background: 'rgba(0,0,0,0.3)', padding: '12px', borderRadius: '6px', fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px', color: styles.textPrimary, wordBreak: 'break-all', marginBottom: '12px'}}>
            {generatedKey.key}
          </div>
          <div style={{display: 'flex', gap: '12px'}}>
            <button onClick={copyKey} style={{padding: '8px 16px', background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, borderRadius: '6px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', cursor: 'pointer'}}>Copy to Clipboard</button>
            <button onClick={() => setGeneratedKey(null)} style={{padding: '8px 16px', background: 'transparent', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textSecondary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', cursor: 'pointer'}}>Dismiss</button>
          </div>
          <p style={{color: styles.textTertiary, fontSize: '12px', marginTop: '12px'}}>⚠️ Save this key now. You won't be able to see it again.</p>
          <div style={{marginTop: '16px', padding: '16px', background: 'rgba(91,75,138,0.2)', border: '1px solid rgba(91,75,138,0.3)', borderRadius: '8px'}}>
            <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.purpleBright, marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '1px'}}>Next Step</div>
            <p style={{color: styles.textSecondary, fontSize: '13px', marginBottom: '12px'}}>Download the ENVELO Agent pre-configured with your credentials:</p>
            <button 
              onClick={() => downloadConfiguredAgent(generatedKey.key)}
              style={{padding: '12px 24px', background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, borderRadius: '6px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px'}}
            >
              <Download size={16} /> Download ENVELO Agent
            </button>
          </div>
        </div>
      )}

      <div style={{display: 'flex', gap: '12px', marginBottom: '20px'}}>
        <input
          type="text"
          placeholder="Key name (e.g., Production)"
          value={newKeyName}
          onChange={(e) => setNewKeyName(e.target.value)}
          style={{flex: 1, padding: '10px 14px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px'}}
        />
        <button
          onClick={generateKey}
          disabled={!newKeyName.trim()}
          style={{padding: '10px 20px', background: newKeyName.trim() ? styles.purplePrimary : 'rgba(0,0,0,0.2)', border: `1px solid ${newKeyName.trim() ? styles.purpleBright : styles.borderGlass}`, borderRadius: '6px', color: newKeyName.trim() ? '#fff' : styles.textTertiary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: newKeyName.trim() ? 'pointer' : 'not-allowed'}}
        >
          Generate Key
        </button>
      </div>

      {keys.length > 0 ? (
        <div>
          <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', color: styles.textTertiary, marginBottom: '12px', textTransform: 'uppercase', letterSpacing: '1px'}}>Your API Keys</div>
          {keys.map((k) => (
            <div key={k.id} style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px 16px', background: 'rgba(0,0,0,0.2)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', marginBottom: '8px'}}>
              <div>
                <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px', color: styles.textPrimary}}>{k.name}</div>
                <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.textTertiary, marginTop: '4px'}}>{k.key_prefix}••••••••</div>
              </div>
              <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                <span style={{fontSize: '11px', color: styles.textTertiary}}>{k.last_used_at ? `Last used: ${new Date(k.last_used_at).toLocaleDateString()}` : 'Never used'}</span>
                <button onClick={() => revokeKey(k.id)} style={{padding: '6px 12px', background: 'rgba(255,100,100,0.1)', border: '1px solid rgba(255,100,100,0.3)', borderRadius: '4px', color: '#ff6464', fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', cursor: 'pointer'}}>Revoke</button>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <p style={{color: styles.textTertiary, fontSize: '14px'}}>No API keys yet. Generate one to connect the ENVELO Agent.</p>
      )}
    </div>
  );
}

// Boundary Configurator Component
function BoundaryConfigurator() {
  const [boundaries, setBoundaries] = useState([]);
  const [newBoundary, setNewBoundary] = useState({ type: 'numeric', name: '', parameter: '', min: '', max: '', unit: '' });

  const addBoundary = () => {
    if (!newBoundary.name) return;
    setBoundaries([...boundaries, { ...newBoundary, id: Date.now() }]);
    setNewBoundary({ type: 'numeric', name: '', parameter: '', min: '', max: '', unit: '' });
  };

  const removeBoundary = (id) => {
    setBoundaries(boundaries.filter(b => b.id !== id));
  };

  const generateCode = () => {
    let code = `from envelo import EnveloAgent, EnveloConfig, NumericBoundary, GeoBoundary, RateLimitBoundary

config = EnveloConfig(
    certificate_id="YOUR-CERTIFICATE-ID",
    api_key="YOUR-API-KEY"
)

agent = EnveloAgent(config)

# Your ODD Boundaries
`;
    boundaries.forEach(b => {
      if (b.type === 'numeric') {
        code += `agent.add_boundary(NumericBoundary("${b.name}", parameter="${b.parameter || b.name}", min=${b.min || 'None'}, max=${b.max || 'None'}, unit="${b.unit || ''}"))
`;
      } else if (b.type === 'rate') {
        code += `agent.add_boundary(RateLimitBoundary("${b.name}", max_per_${b.rateUnit || 'second'}=${b.rateLimit || 10}))
`;
      }
    });
    code += `
# Wrap your autonomous functions
@agent.enforce
def your_action(**params):
    # Your code here
    pass
`;
    return code;
  };

  const downloadConfig = () => {
    const code = generateCode();
    const blob = new Blob([code], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'envelo_config.py';
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div>
      <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '12px', marginBottom: '16px'}}>
        <select
          value={newBoundary.type}
          onChange={(e) => setNewBoundary({...newBoundary, type: e.target.value})}
          style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
        >
          <option value="numeric">Numeric Limit</option>
          <option value="rate">Rate Limit</option>
        </select>
        <input
          type="text"
          placeholder="Name (e.g., speed)"
          value={newBoundary.name}
          onChange={(e) => setNewBoundary({...newBoundary, name: e.target.value, parameter: e.target.value})}
          style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
        />
        {newBoundary.type === 'numeric' && (
          <>
            <input
              type="number"
              placeholder="Min"
              value={newBoundary.min}
              onChange={(e) => setNewBoundary({...newBoundary, min: e.target.value})}
              style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
            />
            <input
              type="number"
              placeholder="Max"
              value={newBoundary.max}
              onChange={(e) => setNewBoundary({...newBoundary, max: e.target.value})}
              style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
            />
            <input
              type="text"
              placeholder="Unit (e.g., km/h)"
              value={newBoundary.unit}
              onChange={(e) => setNewBoundary({...newBoundary, unit: e.target.value})}
              style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
            />
          </>
        )}
        {newBoundary.type === 'rate' && (
          <>
            <input
              type="number"
              placeholder="Limit"
              value={newBoundary.rateLimit}
              onChange={(e) => setNewBoundary({...newBoundary, rateLimit: e.target.value})}
              style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
            />
            <select
              value={newBoundary.rateUnit || 'second'}
              onChange={(e) => setNewBoundary({...newBoundary, rateUnit: e.target.value})}
              style={{padding: '10px', background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px'}}
            >
              <option value="second">per second</option>
              <option value="minute">per minute</option>
              <option value="hour">per hour</option>
            </select>
          </>
        )}
        <button
          onClick={addBoundary}
          style={{padding: '10px', background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, borderRadius: '6px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', cursor: 'pointer'}}
        >
          + Add
        </button>
      </div>

      {boundaries.length > 0 && (
        <div style={{marginBottom: '16px'}}>
          <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', color: styles.textTertiary, marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '1px'}}>Defined Boundaries</div>
          {boundaries.map((b) => (
            <div key={b.id} style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '10px 12px', background: 'rgba(92,214,133,0.1)', border: '1px solid rgba(92,214,133,0.2)', borderRadius: '6px', marginBottom: '8px'}}>
              <span style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.accentGreen}}>
                {b.type === 'numeric' ? `${b.name}: ${b.min || '−∞'} to ${b.max || '∞'} ${b.unit}` : `${b.name}: ${b.rateLimit}/${b.rateUnit}`}
              </span>
              <button onClick={() => removeBoundary(b.id)} style={{background: 'none', border: 'none', color: styles.textTertiary, cursor: 'pointer', fontSize: '16px'}}>×</button>
            </div>
          ))}
        </div>
      )}

      {boundaries.length > 0 && (
        <div>
          <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', color: styles.textTertiary, marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '1px'}}>Generated Configuration</div>
          <pre style={{background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '8px', padding: '16px', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: styles.textSecondary, overflow: 'auto', maxHeight: '200px', whiteSpace: 'pre-wrap'}}>{generateCode()}</pre>
          <button
            onClick={downloadConfig}
            className="mt-3 px-4 py-2 rounded-lg"
            style={{marginTop: '12px', background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer'}}
          >
            Download Config
          </button>
        </div>
      )}
    </div>
  );
}

// ENVELO Agent Page
function EnveloPage() {
  const [activeApiKey, setActiveApiKey] = useState(null);
  const [stats, setStats] = useState(null);
  const [sessions, setSessions] = useState([]);
  const [selectedSession, setSelectedSession] = useState(null);
  const [userCerts, setUserCerts] = useState([]);
  const [userApps, setUserApps] = useState([]);
  const [cat72Status, setCat72Status] = useState(null);
  const [loading, setLoading] = useState(true);
  const { user } = useAuth();
  const navigate = useNavigate();

  useEffect(() => {
    const loadData = async () => {
      try {
        const [statsRes, sessionsRes, certsRes, appsRes] = await Promise.all([
          api.get('/api/envelo/stats').catch(() => ({ data: null })),
          api.get('/api/envelo/admin/sessions').catch(() => ({ data: { sessions: [] } })),
          api.get('/api/certificates/').catch(() => ({ data: [] })),
          api.get('/api/applications/').catch(() => ({ data: [] }))
        ]);
        setStats(statsRes.data);
        setSessions(sessionsRes.data.sessions || []);
        setUserCerts(certsRes.data || []);
        setUserApps(appsRes.data || []);
      } catch (err) {
        console.error(err);
      }
      setLoading(false);
    };
    loadData();
  }, []);

  const hasCert = user?.role === 'admin' || userCerts.some(c => c.status === 'issued' || c.status === 'active');
  const hasApprovedApp = userApps.some(a => a.status === 'approved' || a.status === 'testing');
  const canAccessAgent = hasCert || hasApprovedApp;
  const isTestMode = hasApprovedApp && !hasCert;
  const approvedApps = userApps.filter(a => a.status === 'approved' || a.status === 'testing');

  if (loading) {
    return <div style={{color: styles.textTertiary, padding: '40px', textAlign: 'center'}}>Loading...</div>;
  }

  if (!canAccessAgent) {
    return (
      <div className="space-y-6">
        <Panel>
          <div style={{textAlign: 'center', padding: '40px'}}>
            <Award size={48} style={{color: styles.textTertiary, margin: '0 auto 16px'}} />
            <h2 style={{fontFamily: "'Source Serif 4', serif", fontSize: '24px', fontWeight: 200, marginBottom: '12px'}}>Application Approval Required</h2>
            <p style={{color: styles.textSecondary, marginBottom: '24px'}}>Your application must be approved before you can access the ENVELO Agent.</p>
            <p style={{color: styles.textTertiary, fontSize: '13px'}}>Once approved, you can download the agent and begin CAT-72 testing.</p>
          </div>
        </Panel>
      </div>
    );
  }

  const certifiedSystems = userCerts.filter(c => c.status === 'issued' || c.status === 'active');

  const downloadAgentForSystem = (cert) => {
    const agentCode = `#!/usr/bin/env python3
"""
ENVELO Agent - Sentinel Authority
System: ${cert.system_name || 'Unknown'}
Certificate: ${cert.certificate_number}
Generated: ${new Date().toISOString()}

This agent is pre-configured for your certified system.
"""

import os
import json
import time
import hashlib
import requests
from datetime import datetime
from functools import wraps

# Configuration - DO NOT MODIFY
SENTINEL_API = "https://api.sentinelauthority.org"
CERTIFICATE_NUMBER = "${cert.certificate_number}"
SYSTEM_NAME = "${cert.system_name || 'Unknown'}"

class EnveloAgent:
    def __init__(self, api_key):
        self.api_key = api_key
        self.session_id = None
        self.boundaries = {}
        self.violations = []
        
    def start_session(self):
        try:
            res = requests.post(f"{SENTINEL_API}/api/envelo/session/start", 
                headers={"X-API-Key": self.api_key},
                json={"certificate_number": CERTIFICATE_NUMBER, "system_name": SYSTEM_NAME})
            if res.ok:
                self.session_id = res.json().get("session_id")
                print(f"[ENVELO] Session started: {self.session_id}")
                return True
        except Exception as e:
            print(f"[ENVELO] Failed to start session: {e}")
        return False
    
    def add_boundary(self, name, min_val=None, max_val=None, allowed_values=None):
        self.boundaries[name] = {"min": min_val, "max": max_val, "allowed": allowed_values}
    
    def check(self, name, value):
        if name not in self.boundaries:
            return True
        b = self.boundaries[name]
        if b["min"] is not None and value < b["min"]:
            self._report_violation(name, value, f"Below minimum {b['min']}")
            return False
        if b["max"] is not None and value > b["max"]:
            self._report_violation(name, value, f"Above maximum {b['max']}")
            return False
        if b["allowed"] is not None and value not in b["allowed"]:
            self._report_violation(name, value, f"Not in allowed values")
            return False
        return True
    
    def _report_violation(self, name, value, reason):
        violation = {"parameter": name, "value": value, "reason": reason, "timestamp": datetime.utcnow().isoformat()}
        self.violations.append(violation)
        try:
            requests.post(f"{SENTINEL_API}/api/envelo/violation",
                headers={"X-API-Key": self.api_key},
                json={"session_id": self.session_id, **violation})
        except:
            pass
        print(f"[ENVELO] VIOLATION: {name}={value} - {reason}")
    
    def enforce(self, func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            return func(*args, **kwargs)
        return wrapper
    
    def shutdown(self):
        if self.session_id:
            try:
                requests.post(f"{SENTINEL_API}/api/envelo/session/end",
                    headers={"X-API-Key": self.api_key},
                    json={"session_id": self.session_id})
            except:
                pass
        print(f"[ENVELO] Session ended. Violations: {len(self.violations)}")

if __name__ == "__main__":
    print("=" * 60)
    print("  ENVELO Agent - Sentinel Authority")
    print(f"  System: {SYSTEM_NAME}")
    print(f"  Certificate: {CERTIFICATE_NUMBER}")
    print("=" * 60)
    print()
    print("To use this agent, set your API key:")
    print("  agent = EnveloAgent('your-api-key-here')")
    print("  agent.start_session()")
    print("  agent.add_boundary('speed', min_val=0, max_val=100)")
    print("  agent.check('speed', 75)  # Returns True")
    print("  agent.check('speed', 150) # Returns False, reports violation")
`;
    const blob = new Blob([agentCode], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `envelo_agent_${cert.certificate_number}.py`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  return (
    <div className="space-y-6">
      <div>
        <p style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '4px', textTransform: 'uppercase', color: styles.purpleBright, marginBottom: '8px'}}>Runtime Enforcement</p>
        <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '36px', fontWeight: 200, margin: 0}}>ENVELO Agent</h1>
        <p style={{color: styles.textSecondary, marginTop: '8px'}}>Download and configure the enforcement agent for your certified systems</p>
      </div>

      {user?.role === 'admin' && (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <Panel>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Active Sessions</h2>
            <p style={{fontSize: '32px', fontWeight: 200, color: styles.purpleBright}}>{stats?.active_sessions || 0}</p>
          </Panel>
          <Panel>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Total Telemetry</h2>
            <p style={{fontSize: '32px', fontWeight: 200, color: styles.textPrimary}}>{stats?.total_telemetry_records || 0}</p>
          </Panel>
          <Panel>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Violations Blocked</h2>
            <p style={{fontSize: '32px', fontWeight: 200, color: styles.accentRed}}>{stats?.total_violations || 0}</p>
          </Panel>
        </div>
      )}

      {isTestMode && (
        <Panel style={{background: 'linear-gradient(135deg, rgba(91,75,138,0.2), rgba(91,75,138,0.05))', border: '1px solid rgba(157,140,207,0.4)'}}>
          <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '16px'}}>
            <div style={{width: '12px', height: '12px', borderRadius: '50%', background: '#f59e0b', animation: 'pulse 2s infinite'}}></div>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: '#f59e0b', margin: 0}}>Test Mode Active</h2>
          </div>
          <p style={{color: styles.textSecondary, marginBottom: '20px'}}>Your application has been approved. Deploy the ENVELO Agent and complete 72 hours of continuous operation to earn certification.</p>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4" style={{marginBottom: '20px'}}>
            {approvedApps.map(app => (
              <div key={app.id} style={{padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', border: '1px solid rgba(255,255,255,0.1)'}}>
                <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '4px'}}>System</div>
                <div style={{fontSize: '14px', color: styles.textPrimary, marginBottom: '12px'}}>{app.system_name}</div>
                <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '4px'}}>CAT-72 Status</div>
                <div style={{fontSize: '14px', color: app.cat72_started ? styles.accentGreen : '#f59e0b'}}>
                  {app.cat72_started ? `In Progress` : 'Ready to Start'}
                </div>
              </div>
            ))}
          </div>
          
          <div style={{padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', border: '1px solid rgba(255,255,255,0.1)'}}>
            <h3 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '12px'}}>Next Steps</h3>
            <ol style={{margin: 0, paddingLeft: '20px', color: styles.textSecondary, fontSize: '13px'}}>
              <li style={{marginBottom: '8px'}}>Generate an API key below</li>
              <li style={{marginBottom: '8px'}}>Download the ENVELO Agent for your system</li>
              <li style={{marginBottom: '8px'}}>Deploy the agent on your autonomous system</li>
              <li style={{marginBottom: '8px'}}>Run continuously for 72 hours with no violations</li>
              <li>Certification issued automatically upon successful completion</li>
            </ol>
          </div>
        </Panel>
      )}

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>{isTestMode ? 'Systems Ready for Testing' : 'Your Certified Systems'}</h2>
        <p style={{color: styles.textSecondary, marginBottom: '20px'}}>{isTestMode ? 'Download the ENVELO Agent for your approved systems. Run continuously for 72 hours to complete certification.' : 'Download the ENVELO Agent pre-configured for each certified system. The agent must remain running to maintain certification compliance.'}</p>
        
        {certifiedSystems.length > 0 ? (
          <div className="space-y-4">
            {certifiedSystems.map(cert => (
              <div key={cert.id} style={{padding: '20px', background: 'rgba(0,0,0,0.2)', border: `1px solid ${styles.borderGlass}`, borderRadius: '8px'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', flexWrap: 'wrap', gap: '16px'}}>
                  <div>
                    <h3 style={{fontFamily: "'Inter', sans-serif", fontSize: '16px', fontWeight: 500, color: styles.textPrimary, margin: '0 0 8px 0'}}>{cert.system_name || 'Unnamed System'}</h3>
                    <div style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.purpleBright, marginBottom: '4px'}}>{cert.certificate_number}</div>
                    <div style={{fontSize: '12px', color: styles.textTertiary}}>
                      Expires: {cert.expires_at ? new Date(cert.expires_at).toLocaleDateString() : 'N/A'}
                    </div>
                  </div>
                  <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                    <span style={{padding: '4px 12px', background: 'rgba(92,214,133,0.15)', border: '1px solid rgba(92,214,133,0.3)', borderRadius: '20px', fontSize: '11px', color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase'}}>
                      {cert.status}
                    </span>
                    <button
                      onClick={() => downloadAgentForSystem(cert)}
                      style={{padding: '10px 20px', background: styles.purplePrimary, border: `1px solid ${styles.purpleBright}`, borderRadius: '6px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px'}}
                    >
                      <Download size={14} /> Download Agent
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <p style={{color: styles.textTertiary, fontSize: '14px'}}>No certified systems found.</p>
        )}
      </Panel>

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>API Keys</h2>
        <p style={{color: styles.textSecondary, marginBottom: '16px'}}>Generate API keys to authenticate your ENVELO Agent.</p>
        <APIKeyManager onKeyGenerated={setActiveApiKey} />
      </Panel>

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Configure Boundaries</h2>
        <p style={{color: styles.textSecondary, marginBottom: '16px'}}>Define your ODD boundaries. These will be included in your agent configuration.</p>
        <BoundaryConfigurator />
      </Panel>

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Test Agent (No Install Required)</h2>
        <p style={{color: styles.textSecondary, marginBottom: '16px'}}>Run a live simulation to see ENVELO enforce ODD boundaries in real-time.</p>
        <AgentSimulator apiKey={activeApiKey} />
      </Panel>

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Your Configuration</h2>
        <p style={{color: styles.textSecondary, marginBottom: '16px'}}>Use these values when initializing the ENVELO Agent:</p>
        <div style={{background: 'rgba(0,0,0,0.3)', border: `1px solid ${styles.borderGlass}`, borderRadius: '8px', padding: '16px', fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px'}}>
          <p style={{color: styles.textTertiary, marginBottom: '8px'}}># Your ENVELO configuration</p>
          <p style={{color: styles.textSecondary}}>certificate_id = <span style={{color: styles.accentGreen}}>"YOUR-CERTIFICATE-ID"</span></p>
          <p style={{color: styles.textSecondary}}>api_key = <span style={{color: styles.accentGreen}}>"{activeApiKey || 'YOUR-API-KEY'}"</span></p>
          <p style={{color: styles.textSecondary}}>api_endpoint = <span style={{color: styles.accentGreen}}>"https://api.sentinelauthority.org"</span></p>
        </div>
        <p style={{color: styles.textTertiary, fontSize: '12px', marginTop: '12px'}}>Replace YOUR-CERTIFICATE-ID with your actual ODDC certificate number after certification.</p>
        <div style={{marginTop: '20px', paddingTop: '20px', borderTop: `1px solid ${styles.borderGlass}`}}>
          <a href="https://sentinel-website-eta.vercel.app/status.html" target="_blank" style={{display: 'inline-flex', alignItems: 'center', gap: '8px', padding: '10px 16px', background: 'rgba(157,140,207,0.1)', border: '1px solid rgba(157,140,207,0.3)', borderRadius: '8px', color: styles.purpleBright, fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '1px', textDecoration: 'none'}}>Check Test Status →</a>
        </div>
      </Panel>

      
      {selectedSession && (
        <Panel>
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
            <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary}}>Session Report</h2>
            <button onClick={() => setSelectedSession(null)} style={{padding: '6px 12px', background: 'transparent', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '4px', color: '#888', cursor: 'pointer', fontSize: '12px'}}>✕ Close</button>
          </div>
          <SessionReport session={selectedSession} />
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '24px', marginBottom: '12px'}}><h3 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, margin: 0}}>Telemetry Log</h3><button onClick={async () => {
              try {
                const res = await api.get(`/api/envelo/admin/sessions/${selectedSession.id}/report`, {responseType: 'blob'});
                const url = window.URL.createObjectURL(new Blob([res.data]));
                const link = document.createElement('a');
                link.href = url;
                link.download = `CAT72-Report-${selectedSession.session_id}.pdf`;
                link.click();
              } catch(e) { alert('Failed to download: ' + e.message); }
            }} style={{padding: '6px 12px', background: styles.purplePrimary, border: 'none', borderRadius: '4px', color: '#fff', fontSize: '11px', cursor: 'pointer'}}>Download Report PDF</button></div>
          <TelemetryLog sessionId={selectedSession.id} />
        </Panel>
      )}

      <Panel>
        <h2 style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', letterSpacing: '2px', textTransform: 'uppercase', color: styles.textTertiary, marginBottom: '16px'}}>Active Agent Sessions</h2>
        {sessions.length > 0 ? (
          <table className="w-full">
            <thead>
              <tr style={{borderBottom: `1px solid ${styles.borderGlass}`}}>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Session ID</th>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Certificate</th>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Status</th>
                <th className="px-4 py-3 text-left" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '9px', letterSpacing: '1.5px', textTransform: 'uppercase', color: styles.textTertiary, fontWeight: 400}}>Records</th>
              </tr>
            </thead>
            <tbody>
              {sessions.map((s, i) => (
                <tr key={i} onClick={() => setSelectedSession(s)} style={{borderBottom: `1px solid ${styles.borderGlass}`, cursor: 'pointer'}}>
                  <td className="px-4 py-4" style={{fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.purpleBright}}>{s.session_id}</td>
                  <td className="px-4 py-4" style={{color: styles.textSecondary}}>{s.certificate_id}</td>
                  <td className="px-4 py-4">
                    <span className="px-2 py-1 rounded" style={{
                      background: s.status === 'active' ? 'rgba(92,214,133,0.15)' : 'rgba(157,140,207,0.15)',
                      color: s.status === 'active' ? styles.accentGreen : styles.textTertiary,
                      fontFamily: "'IBM Plex Mono', monospace", fontSize: '10px', textTransform: 'uppercase'
                    }}>{s.status}</span>
                  </td>
                  <td className="px-4 py-4" style={{color: styles.textTertiary}}>{s.record_count || 0}</td>
                </tr>
              ))}
            </tbody>
          </table>
        ) : (
          <p style={{color: styles.textTertiary, textAlign: 'center', padding: '24px'}}>No active sessions. Install and run the ENVELO Agent to see sessions here.</p>
        )}
      </Panel>
    </div>
  );
}

// Main App
// Monitoring Dashboard
function MonitoringPage() {
  const [overview, setOverview] = useState(null);
  const [alerts, setAlerts] = useState([]);
  const [selectedSession, setSelectedSession] = useState(null);
  const [timeline, setTimeline] = useState([]);
  const [loading, setLoading] = useState(true);
  const [autoRefresh, setAutoRefresh] = useState(true);
  const [customerFilter, setCustomerFilter] = useState("");
  const [onlineOnly, setOnlineOnly] = useState(false);
  const { user } = useAuth();

  const fetchData = async () => {
    try {
      const [overviewRes, alertsRes] = await Promise.all([
        api.get('/api/envelo/monitoring/overview'),
        api.get('/api/envelo/monitoring/alerts')
      ]);
      setOverview(overviewRes.data);
      setAlerts(alertsRes.data.alerts || []);
    } catch (err) {
      console.error('Failed to fetch monitoring data:', err);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
    if (autoRefresh) {
      const interval = setInterval(fetchData, 10000); // Refresh every 10 seconds
      return () => clearInterval(interval);
    }
  }, [autoRefresh]);

  const fetchTimeline = async (sessionId) => {
    try {
      const res = await api.get(`/envelo/monitoring/session/${sessionId}/timeline?hours=24`);
      setTimeline(res.data.timeline || []);
    } catch (err) {
      console.error('Failed to fetch timeline:', err);
    }
  };

  useEffect(() => {
    if (selectedSession) {
      fetchTimeline(selectedSession.id);
    }
  }, [selectedSession]);

  if (loading) {
    return (
      <div style={{padding: '40px', textAlign: 'center'}}>
        <RefreshCw size={24} style={{animation: 'spin 1s linear infinite', color: styles.purpleBright}} />
        <p style={{marginTop: '16px', color: styles.textSecondary}}>Loading monitoring data...</p>
      </div>
    );
  }

  const summary = overview?.summary || {};
  const sessions = overview?.sessions || [];
  const filteredSessions = sessions.filter(s => {
    if (customerFilter && s.organization_name !== customerFilter) return false;
    if (onlineOnly && !s.is_online) return false;
    return true;
  });

  return (
    <div style={{maxWidth: '1400px', margin: '0 auto'}}>
      <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px'}}>
        <div>
          <h1 style={{fontFamily: "'Source Serif 4', serif", fontSize: '28px', fontWeight: 300, margin: 0}}>
            System Monitoring
          </h1>
          <p style={{color: styles.textSecondary, marginTop: '4px', fontSize: '14px'}}>
            Real-time ENVELO agent status and telemetry
          </p>
        </div>
        <div style={{display: 'flex', gap: '12px', alignItems: 'center'}}>
          <label style={{display: 'flex', alignItems: 'center', gap: '8px', color: styles.textSecondary, fontSize: '13px', cursor: 'pointer'}}>
            <input 
              type="checkbox" 
              checked={autoRefresh} 
              onChange={(e) => setAutoRefresh(e.target.checked)}
              style={{accentColor: styles.purpleBright}}
            />
            Auto-refresh
          </label>
          <button 
            onClick={fetchData}
            style={{
              background: styles.bgPanel, border: `1px solid ${styles.borderGlass}`,
              borderRadius: '8px', padding: '8px 16px', color: styles.textPrimary,
              cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px'
            }}
          >
            <RefreshCw size={14} /> Refresh
          </button>
        </div>
      </div>

      {/* Alerts Banner */}
      {alerts.length > 0 && (
        <div style={{
          background: 'rgba(214, 92, 92, 0.1)',
          border: '1px solid rgba(214, 92, 92, 0.3)',
          borderRadius: '12px',
          padding: '16px',
          marginBottom: '24px'
        }}>
          <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '12px'}}>
            <AlertTriangle size={18} style={{color: '#D65C5C'}} />
            <span style={{fontWeight: 500, color: '#D65C5C'}}>{alerts.length} Active Alert{alerts.length > 1 ? 's' : ''}</span>
          </div>
          <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
            {alerts.map((alert, i) => (
              <div key={i} style={{
                display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                background: 'rgba(0,0,0,0.2)', borderRadius: '8px', padding: '10px 14px'
              }}>
                <div>
                  <span style={{
                    fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace",
                    textTransform: 'uppercase', letterSpacing: '1px',
                    color: alert.severity === 'critical' ? '#D65C5C' : '#D6A05C',
                    marginRight: '12px'
                  }}>
                    {alert.severity}
                  </span>
                  <span style={{color: styles.textPrimary}}>{alert.message}</span>
                </div>
                <span style={{color: styles.textTertiary, fontSize: '12px', fontFamily: "'IBM Plex Mono', monospace"}}>
                  {alert.session_id?.slice(0, 8)}...
                </span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Summary Cards */}
      <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginBottom: '32px'}}>
        <div style={{background: styles.bgPanel, border: `1px solid ${styles.borderGlass}`, borderRadius: '12px', padding: '20px'}}>
          <div style={{fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '2px', color: styles.textTertiary, marginBottom: '8px'}}>
            Active Sessions
          </div>
          <div style={{fontSize: '32px', fontWeight: 300, color: styles.accentGreen}}>{summary.active || 0}</div>
          <div style={{fontSize: '12px', color: styles.textSecondary, marginTop: '4px'}}>
            {summary.offline || 0} offline
          </div>
        </div>

        <div style={{background: styles.bgPanel, border: `1px solid ${styles.borderGlass}`, borderRadius: '12px', padding: '20px'}}>
          <div style={{fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '2px', color: styles.textTertiary, marginBottom: '8px'}}>
            Total Actions
          </div>
          <div style={{fontSize: '32px', fontWeight: 300, color: styles.textPrimary}}>{(summary.total_actions || 0).toLocaleString()}</div>
          <div style={{fontSize: '12px', color: styles.textSecondary, marginTop: '4px'}}>
            {summary.total_pass?.toLocaleString() || 0} passed, {summary.total_block?.toLocaleString() || 0} blocked
          </div>
        </div>

        <div style={{background: styles.bgPanel, border: `1px solid ${styles.borderGlass}`, borderRadius: '12px', padding: '20px'}}>
          <div style={{fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '2px', color: styles.textTertiary, marginBottom: '8px'}}>
            Pass Rate
          </div>
          <div style={{fontSize: '32px', fontWeight: 300, color: summary.pass_rate >= 99 ? styles.accentGreen : summary.pass_rate >= 95 ? '#D6A05C' : '#D65C5C'}}>
            {summary.pass_rate?.toFixed(1) || 0}%
          </div>
          <div style={{fontSize: '12px', color: styles.textSecondary, marginTop: '4px'}}>
            enforcement success
          </div>
        </div>

        <div style={{background: styles.bgPanel, border: `1px solid ${styles.borderGlass}`, borderRadius: '12px', padding: '20px'}}>
          <div style={{fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '2px', color: styles.textTertiary, marginBottom: '8px'}}>
            Total Sessions
          </div>
          <div style={{fontSize: '32px', fontWeight: 300, color: styles.textPrimary}}>{summary.total || 0}</div>
          <div style={{fontSize: '12px', color: styles.textSecondary, marginTop: '4px'}}>
            {summary.ended || 0} completed
          </div>
        </div>
      </div>

      {/* Sessions Table */}
      <div style={{background: styles.bgPanel, border: `1px solid ${styles.borderGlass}`, borderRadius: '12px', overflow: 'hidden'}}>
        <div style={{padding: '16px 20px', borderBottom: `1px solid ${styles.borderSubtle}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
          <h2 style={{margin: 0, fontSize: '14px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '2px', color: styles.textTertiary}}>Agent Sessions</h2>
          <div style={{display: 'flex', gap: '12px', alignItems: 'center'}}>
            <select value={customerFilter} onChange={(e) => setCustomerFilter(e.target.value)} style={{background: styles.bgDeep, border: `1px solid ${styles.borderGlass}`, borderRadius: '6px', padding: '6px 10px', color: styles.textPrimary, fontSize: '12px'}}>
              <option value="">All Customers</option>
              {[...new Set(sessions.map(s => s.organization_name).filter(Boolean))].map(org => <option key={org} value={org}>{org}</option>)}
            </select>
            <label style={{display: 'flex', alignItems: 'center', gap: '6px', color: styles.textSecondary, fontSize: '12px', cursor: 'pointer'}}>
              <input type="checkbox" checked={onlineOnly} onChange={(e) => setOnlineOnly(e.target.checked)} style={{accentColor: styles.purpleBright}} />
              Online only
            </label>
          </div>
        </div>        
        {filteredSessions.length === 0 ? (
          <div style={{padding: '40px', textAlign: 'center', color: styles.textSecondary}}>
            No ENVELO sessions found. Deploy an agent to begin monitoring.
          </div>
        ) : (
          <div style={{overflowX: 'auto'}}>
            <table style={{width: '100%', borderCollapse: 'collapse'}}>
              <thead>
                <tr style={{background: 'rgba(0,0,0,0.2)'}}>
                  <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px', color: styles.textTertiary}}>Status</th>
                  <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px', color: styles.textTertiary}}>Session ID</th>
                  <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px', color: styles.textTertiary}}>Uptime</th>
                  <th style={{padding: '12px 16px', textAlign: 'right', fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px', color: styles.textTertiary}}>Actions</th>
                  <th style={{padding: '12px 16px', textAlign: 'right', fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px', color: styles.textTertiary}}>Pass Rate</th>
                  <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '10px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '1px', color: styles.textTertiary}}>Last Activity</th>
                </tr>
              </thead>
              <tbody>
                {filteredSessions.map((session) => {
                  const total = session.pass_count + session.block_count;
                  const passRate = total > 0 ? (session.pass_count / total * 100) : 0;
                  const isSelected = selectedSession?.id === session.id;
                  
                  return (
                    <tr 
                      key={session.id}
                      onClick={() => setSelectedSession(isSelected ? null : session)}
                      style={{
                        borderBottom: `1px solid ${styles.borderSubtle}`,
                        cursor: 'pointer',
                        background: isSelected ? 'rgba(91, 75, 138, 0.15)' : 'transparent',
                        transition: 'background 0.15s'
                      }}
                      onMouseEnter={(e) => { if (!isSelected) e.currentTarget.style.background = 'rgba(255,255,255,0.03)'; }}
                      onMouseLeave={(e) => { if (!isSelected) e.currentTarget.style.background = 'transparent'; }}
                    >
                      <td style={{padding: '14px 16px'}}>
                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                          <div style={{
                            width: '10px', height: '10px', borderRadius: '50%',
                            background: session.is_online ? styles.accentGreen : session.status === 'ended' ? styles.textTertiary : '#D65C5C',
                            boxShadow: session.is_online ? `0 0 8px ${styles.accentGreen}` : 'none'
                          }} />
                          <span style={{
                            fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace",
                            textTransform: 'uppercase', letterSpacing: '1px',
                            color: session.is_online ? styles.accentGreen : session.status === 'ended' ? styles.textTertiary : '#D65C5C'
                          }}>
                            {session.is_online ? 'Online' : session.status === 'ended' ? 'Ended' : 'Offline'}
                          </span>
                        </div>
                      </td>
                      <td style={{padding: '14px 16px', fontFamily: "'IBM Plex Mono', monospace", fontSize: '12px', color: styles.textSecondary}}>
                        {session.session_id}
                      </td>
                      <td style={{padding: '14px 16px', color: styles.textSecondary, fontSize: '13px'}}>
                        {session.uptime_hours?.toFixed(1)}h
                      </td>
                      <td style={{padding: '14px 16px', textAlign: 'right', color: styles.textPrimary, fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px'}}>
                        {total.toLocaleString()}
                      </td>
                      <td style={{padding: '14px 16px', textAlign: 'right'}}>
                        <span style={{
                          color: passRate >= 99 ? styles.accentGreen : passRate >= 95 ? '#D6A05C' : '#D65C5C',
                          fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px'
                        }}>
                          {passRate.toFixed(1)}%
                        </span>
                      </td>
                      <td style={{padding: '14px 16px', color: styles.textTertiary, fontSize: '12px'}}>
                        {session.last_activity ? new Date(session.last_activity).toLocaleString() : '-'}
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Session Detail Panel */}
      {selectedSession && (
        <div style={{
          marginTop: '24px',
          background: styles.bgPanel,
          border: `1px solid ${styles.borderGlass}`,
          borderRadius: '12px',
          overflow: 'hidden'
        }}>
          <div style={{padding: '16px 20px', borderBottom: `1px solid ${styles.borderSubtle}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
            <h2 style={{margin: 0, fontSize: '14px', fontFamily: "'IBM Plex Mono', monospace", textTransform: 'uppercase', letterSpacing: '2px', color: styles.textTertiary}}>
              Session Detail: {selectedSession.session_id}
            </h2>
            <button 
              onClick={() => setSelectedSession(null)}
              style={{background: 'none', border: 'none', color: styles.textTertiary, cursor: 'pointer', fontSize: '18px'}}
            >
              ×
            </button>
          </div>
          
          <div style={{padding: '20px'}}>
            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '16px', marginBottom: '24px'}}>
              <div>
                <div style={{fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '4px'}}>Started</div>
                <div style={{color: styles.textPrimary}}>{selectedSession.started_at ? new Date(selectedSession.started_at).toLocaleString() : '-'}</div>
              </div>
              <div>
                <div style={{fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '4px'}}>Pass Count</div>
                <div style={{color: styles.accentGreen, fontFamily: "'IBM Plex Mono', monospace"}}>{selectedSession.pass_count.toLocaleString()}</div>
              </div>
              <div>
                <div style={{fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '4px'}}>Block Count</div>
                <div style={{color: '#D65C5C', fontFamily: "'IBM Plex Mono', monospace"}}>{selectedSession.block_count.toLocaleString()}</div>
              </div>
              <div>
                <div style={{fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '4px'}}>Certificate</div>
                <div style={{color: styles.textPrimary}}>{selectedSession.certificate_id || '-'}</div>
              </div>
            </div>

            {/* Simple Timeline Bar Chart */}
            {timeline.length > 0 && (
              <div>
                <div style={{fontSize: '10px', color: styles.textTertiary, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px'}}>
                  24-Hour Activity
                </div>
                <div style={{display: 'flex', gap: '2px', height: '60px', alignItems: 'flex-end'}}>
                  {timeline.map((point, i) => {
                    const maxTotal = Math.max(...timeline.map(t => t.total), 1);
                    const height = (point.total / maxTotal) * 100;
                    const passRatio = point.total > 0 ? point.pass / point.total : 1;
                    
                    return (
                      <div
                        key={i}
                        style={{
                          flex: 1,
                          height: `${Math.max(height, 2)}%`,
                          background: passRatio >= 0.99 ? styles.accentGreen : passRatio >= 0.95 ? '#D6A05C' : '#D65C5C',
                          borderRadius: '2px 2px 0 0',
                          opacity: 0.8
                        }}
                        title={`${new Date(point.hour).toLocaleTimeString()}: ${point.total} actions (${point.pass} pass, ${point.block} block)`}
                      />
                    );
                  })}
                </div>
                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '4px', fontSize: '10px', color: styles.textTertiary}}>
                  <span>24h ago</span>
                  <span>Now</span>
                </div>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}

function App() {
  return (
    <BrowserRouter>
      <AuthProvider>
        <Routes>
          <Route path="/login" element={<LoginPage />} />
          <Route path="/verify" element={<VerifyPage />} />
          <Route path="/dashboard" element={<ProtectedRoute><Layout><RoleBasedDashboard /></Layout></ProtectedRoute>} />
          <Route path="/applications" element={<ProtectedRoute><Layout><ApplicationsList /></Layout></ProtectedRoute>} />
          <Route path="/applications/new" element={<ProtectedRoute><Layout><NewApplication /></Layout></ProtectedRoute>} />
          <Route path="/applications/:id" element={<ProtectedRoute><Layout><ApplicationDetail /></Layout></ProtectedRoute>} />
          <Route path="/cat72" element={<ProtectedRoute roles={['admin', 'operator']}><Layout><CAT72Console /></Layout></ProtectedRoute>} />
          <Route path="/certificates" element={<ProtectedRoute><Layout><CertificatesPage /></Layout></ProtectedRoute>} />
          <Route path="/envelo" element={<ProtectedRoute><Layout><EnveloPage /></Layout></ProtectedRoute>} />
          <Route path="/monitoring" element={<ProtectedRoute><Layout><MonitoringPage /></Layout></ProtectedRoute>} />
          <Route path="/" element={<Navigate to="/dashboard" />} />
        </Routes>
      </AuthProvider>
    </BrowserRouter>
  );
}

export default App;
// Mon Jan 26 10:20:46 CST 2026
</file>

</files>
